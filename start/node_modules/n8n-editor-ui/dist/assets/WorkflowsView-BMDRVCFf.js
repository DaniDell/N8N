import{R as q}from"./ResourcesListLayout-CjzGJ-eS.js";import{cX as Q,u as Y,G as x,o as U,j as D,a as I,i as F,b as R,q as G,V as O,D as X,x as J,z as Z,v as ee,$ as te,c as se,n as oe,E as ae}from"./index-DEwaaDne.js";import{d as re}from"./dateformat-B9ocXky7.js";import{W as ie}from"./WorkflowActivator-Bh0oXchL.js";import{m as z}from"./pinia-BAhPp3pQ.js";import{_ as ne}from"./ProjectCardBadge.vue_vue_type_script_setup_true_lang-BzALVLd6.js";import{G as V,ag as o,l as c,M as $,O as a,U as s,I as u,S as f,T as l,p as h,a2 as le,P as W,V as j,m as S,R as T,F as de,a7 as ce}from"./vendor-Dv5OeN6t.js";import{_ as M}from"./n8n-B6cfQsVX.js";import{P as ue}from"./ProjectTabs-BjpVZIIc.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./useWorkflowActivate-BLjS7M0I.js";const m={OPEN:"open",SHARE:"share",DUPLICATE:"duplicate",DELETE:"delete"},pe=V({components:{TimeAgo:Q,WorkflowActivator:ie,ProjectCardBadge:ne},props:{data:{type:Object,required:!0,default:()=>({id:"",createdAt:"",updatedAt:"",active:!1,connections:{},nodes:[],name:"",sharedWithProjects:[],homeProject:{},versionId:""})},readOnly:{type:Boolean,default:!1}},setup(){return{...Y(),...x()}},computed:{...z(R,F,I,D,U),currentUser(){return this.usersStore.currentUser||{}},workflowPermissions(){return G(this.data)},actions(){const e=[{label:this.$locale.baseText("workflows.item.open"),value:m.OPEN},{label:this.$locale.baseText("workflows.item.share"),value:m.SHARE}];return this.readOnly||e.push({label:this.$locale.baseText("workflows.item.duplicate"),value:m.DUPLICATE}),this.workflowPermissions.delete&&!this.readOnly&&e.push({label:this.$locale.baseText("workflows.item.delete"),value:m.DELETE}),e},formattedCreatedAtDate(){const e=new Date().getFullYear().toString();return re(this.data.createdAt,`d mmmm${String(this.data.createdAt).startsWith(e)?"":", yyyy"}`)}},methods:{async onClick(e){if(e!=null&&e.ctrlKey||e!=null&&e.metaKey){const t=this.$router.resolve({name:O.WORKFLOW,params:{name:this.data.id}});window.open(t.href,"_blank");return}await this.$router.push({name:O.WORKFLOW,params:{name:this.data.id}})},onClickTag(e,t){t.stopPropagation(),this.$emit("click:tag",e,t)},onExpandTags(){this.$emit("expand:tags")},async onAction(e){if(e===m.OPEN)await this.onClick();else if(e===m.DUPLICATE)this.uiStore.openModalWithData({name:X,data:{id:this.data.id,name:this.data.name,tags:(this.data.tags??[]).map(t=>typeof t!="string"&&"id"in t?t.id:t)}});else if(e===m.SHARE)this.uiStore.openModalWithData({name:J,data:{id:this.data.id}}),this.$telemetry.track("User opened sharing modal",{workflow_id:this.data.id,user_id_sharer:this.currentUser.id,sub_view:"Workflows listing"});else if(e===m.DELETE){if(await this.confirm(this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.message",{interpolate:{workflowName:this.data.name}}),this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.confirmButtonText"),cancelButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.cancelButtonText")})!==Z)return;try{await this.workflowsStore.deleteWorkflow(this.data.id)}catch(r){this.showError(r,this.$locale.baseText("generic.deleteWorkflowError"));return}this.showMessage({title:this.$locale.baseText("mainSidebar.showMessage.handleSelect1.title"),type:"success"})}}}}),me="_cardLink_1ahnz_1",fe="_cardHeading_1ahnz_11",he="_cardDescription_1ahnz_20",we="_cardActions_1ahnz_27",ke={cardLink:me,cardHeading:fe,cardDescription:he,cardActions:we},ge={key:0};function be(e,t,r,i,n,w){const g=o("n8n-heading"),k=o("TimeAgo"),C=o("n8n-tags"),v=o("n8n-text"),E=o("ProjectCardBadge"),A=o("WorkflowActivator"),y=o("n8n-action-toggle"),_=o("n8n-card");return c(),$(_,{class:u(e.$style.cardLink),onClick:e.onClick},{header:a(()=>[s(g,{tag:"h2",bold:"",class:u(e.$style.cardHeading),"data-test-id":"workflow-card-name"},{default:a(()=>[f(l(e.data.name),1)]),_:1},8,["class"])]),append:a(()=>[h("div",{class:u(e.$style.cardActions),onClick:t[0]||(t[0]=le(()=>{},["stop"]))},[s(E,{resource:e.data,"personal-project":e.projectsStore.personalProject},null,8,["resource","personal-project"]),s(A,{class:"mr-s","workflow-active":e.data.active,"workflow-id":e.data.id,"data-test-id":"workflow-card-activator"},null,8,["workflow-active","workflow-id"]),s(y,{actions:e.actions,theme:"dark","data-test-id":"workflow-card-actions",onAction:e.onAction},null,8,["actions","onAction"])],2)]),default:a(()=>[h("div",{class:u(e.$style.cardDescription)},[s(v,{color:"text-light",size:"small"},{default:a(()=>[W(h("span",null,[f(l(e.$locale.baseText("workflows.item.updated"))+" ",1),s(k,{date:String(e.data.updatedAt)},null,8,["date"]),f(" | ")],512),[[j,e.data]]),W(h("span",{class:"mr-2xs"},l(e.$locale.baseText("workflows.item.created"))+" "+l(e.formattedCreatedAtDate),513),[[j,e.data]]),e.settingsStore.areTagsEnabled&&e.data.tags&&e.data.tags.length>0?W((c(),S("span",ge,[s(C,{tags:e.data.tags,"truncate-at":3,truncate:"","data-test-id":"workflow-card-tags","onClick:tag":e.onClickTag,onExpand:e.onExpandTags},null,8,["tags","onClick:tag","onExpand"])],512)),[[j,e.data]]):T("",!0)]),_:1})],2)]),_:1},8,["class","onClick"])}const ye={$style:ke},Se=M(pe,[["render",be],["__cssModules",ye]]),b={ACTIVE:!0,DEACTIVATED:!1,ALL:""},Te=V({name:"WorkflowsView",components:{ResourcesListLayout:q,WorkflowCard:Se,TagsDropdown:ee,ProjectTabs:ue},data(){return{filters:{search:"",homeProject:"",status:b.ALL,tags:[]},sourceControlStoreUnsubscribe:()=>{}}},computed:{...z(R,F,I,D,oe,se,U,te),readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},currentUser(){return this.usersStore.currentUser||{}},allWorkflows(){return this.workflowsStore.allWorkflows},isShareable(){return this.settingsStore.isEnterpriseFeatureEnabled(ae.Sharing)},statusFilterOptions(){return[{label:this.$locale.baseText("workflows.filters.status.all"),value:b.ALL},{label:this.$locale.baseText("workflows.filters.status.active"),value:b.ACTIVE},{label:this.$locale.baseText("workflows.filters.status.deactivated"),value:b.DEACTIVATED}]},userRole(){var r,i;const e=(r=this.usersStore.currentUserCloudInfo)==null?void 0:r.role;if(e)return e;const t=(i=this.usersStore.currentUser)==null?void 0:i.personalizationAnswers;if(t&&"role"in t)return t.role},isSalesUser(){return this.userRole?["Sales","sales-and-marketing"].includes(this.userRole):!1},showProjectTabs(){return!!this.$route.params.projectId||!!this.allWorkflows.length||this.projectsStore.myProjects.length>1},addWorkflowButtonText(){return this.projectsStore.currentProject?this.$locale.baseText("workflows.project.add"):this.$locale.baseText("workflows.add")}},watch:{"filters.tags"(){this.sendFiltersTelemetry("tags")},"$route.params.projectId"(){this.initialize()}},async mounted(){await this.setFiltersFromQueryString(),this.usersStore.showPersonalizationSurvey(),this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:t})=>{e==="pullWorkfolder"&&t&&t(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{onFiltersUpdated(e){this.filters=e,this.saveFiltersOnQueryString()},addWorkflow(){var e,t;this.uiStore.nodeViewInitialized=!1,this.$router.push({name:O.NEW_WORKFLOW,query:{projectId:(t=(e=this.$route)==null?void 0:e.params)==null?void 0:t.projectId}}),this.$telemetry.track("User clicked add workflow button",{source:"Workflows list"})},getTemplateRepositoryURL(){return this.templatesStore.websiteTemplateRepositoryURL},trackCategoryLinkClick(e){var t;this.$telemetry.track(`User clicked Browse ${e} Templates`,{role:(t=this.usersStore.currentUserCloudInfo)==null?void 0:t.role,active_workflow_count:this.workflowsStore.activeWorkflows.length})},async initialize(){var e,t;await Promise.all([this.usersStore.fetchUsers(),this.workflowsStore.fetchAllWorkflows((t=(e=this.$route)==null?void 0:e.params)==null?void 0:t.projectId),this.workflowsStore.fetchActiveWorkflows()])},onClickTag(e){this.filters.tags.includes(e)||this.filters.tags.push(e)},onFilter(e,t,r){return this.settingsStore.areTagsEnabled&&t.tags.length>0&&(r=r&&t.tags.every(i=>{var n;return(n=e.tags)==null?void 0:n.find(w=>typeof w=="object"?`${w.id}`==`${i}`:`${w}`==`${i}`)})),t.status!==""&&(r=r&&e.active===t.status),r},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)},saveFiltersOnQueryString(){const e={};this.filters.search&&(e.search=this.filters.search),typeof this.filters.status!="string"&&(e.status=this.filters.status.toString()),this.filters.tags.length&&(e.tags=this.filters.tags.join(",")),this.filters.homeProject&&(e.homeProject=this.filters.homeProject),this.$router.replace({query:Object.keys(e).length?e:void 0})},isValidProjectId(e){return this.projectsStore.projects.some(t=>t.id===e)},async setFiltersFromQueryString(){const{tags:e,status:t,search:r,homeProject:i}=this.$route.query,n={};if(i&&typeof i=="string"&&(await this.projectsStore.getAllProjects(),this.isValidProjectId(i)&&(n.homeProject=i)),r&&typeof r=="string"&&(n.search=r),e&&typeof e=="string"){const w=this.tagsStore.allTags.map(k=>k.id),g=e.split(",").filter(k=>w.includes(k));g.length&&(n.tags=g)}t&&typeof t=="string"&&[b.ACTIVE.toString(),b.DEACTIVATED.toString()].includes(t)&&(n.status=t==="true"),Object.keys(n).length&&(this.filters={...this.filters,...n})}}}),_e=Te,$e="_actionsContainer_1gv00_1",Ce="_emptyStateCard_1gv00_6",ve="_emptyStateCardIcon_1gv00_19",Ee={actionsContainer:$e,emptyStateCard:Ce,emptyStateCardIcon:ve},Ae={target:"_blank",href:"https://docs.n8n.io/source-control-environments/"},We={class:"text-center mt-s"},je=["href"],Oe={key:0,class:"mb-s"},Le={class:"mb-s"};function Pe(e,t,r,i,n,w){const g=o("ProjectTabs"),k=o("n8n-button"),C=o("i18n-t"),v=o("n8n-tooltip"),E=o("WorkflowCard"),A=o("n8n-heading"),y=o("n8n-text"),_=o("n8n-icon"),L=o("n8n-card"),P=o("n8n-input-label"),B=o("TagsDropdown"),N=o("n8n-option"),H=o("n8n-select"),K=o("ResourcesListLayout");return c(),$(K,{ref:"layout","resource-key":"workflows",resources:e.allWorkflows,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:80},shareable:e.isShareable,initialize:e.initialize,disabled:e.readOnlyEnv,"onClick:add":e.addWorkflow,"onUpdate:filters":e.onFiltersUpdated},{header:a(()=>[e.showProjectTabs?(c(),$(g,{key:0})):T("",!0)]),"add-button":a(({disabled:p})=>[s(v,{disabled:!e.readOnlyEnv},{content:a(()=>[s(C,{tag:"span",keypath:"mainSidebar.workflows.readOnlyEnv.tooltip"},{link:a(()=>[h("a",Ae,l(e.$locale.baseText("mainSidebar.workflows.readOnlyEnv.tooltip.link")),1)]),_:1})]),default:a(()=>[h("div",null,[s(k,{size:"large",block:"",disabled:p,"data-test-id":"resources-list-add",onClick:e.addWorkflow},{default:a(()=>[f(l(e.addWorkflowButtonText),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["disabled"])]),default:a(({data:p,updateItemSize:d})=>[s(E,{"data-test-id":"resources-list-item",class:"mb-2xs",data:p,"read-only":e.readOnlyEnv,"onExpand:tags":De=>d(p),"onClick:tag":e.onClickTag},null,8,["data","read-only","onExpand:tags","onClick:tag"])]),empty:a(()=>[h("div",We,[s(A,{tag:"h2",size:"xlarge",class:"mb-2xs"},{default:a(()=>[f(l(e.currentUser.firstName?e.$locale.baseText("workflows.empty.heading",{interpolate:{name:e.currentUser.firstName}}):e.$locale.baseText("workflows.empty.heading.userNotSetup")),1)]),_:1}),s(y,{size:"large",color:"text-base"},{default:a(()=>[f(l(e.$locale.baseText(e.readOnlyEnv?"workflows.empty.description.readOnlyEnv":"workflows.empty.description")),1)]),_:1})]),e.readOnlyEnv?T("",!0):(c(),S("div",{key:0,class:u(["text-center","mt-2xl",e.$style.actionsContainer])},[e.isSalesUser?(c(),S("a",{key:0,href:e.getTemplateRepositoryURL(),class:u(e.$style.emptyStateCard),target:"_blank"},[s(L,{hoverable:"","data-test-id":"browse-sales-templates-card",onClick:t[0]||(t[0]=p=>e.trackCategoryLinkClick("Sales"))},{default:a(()=>[s(_,{class:u(e.$style.emptyStateCardIcon),icon:"box-open"},null,8,["class"]),s(y,{size:"large",class:"mt-xs",color:"text-base"},{default:a(()=>[f(l(e.$locale.baseText("workflows.empty.browseTemplates")),1)]),_:1})]),_:1})],10,je)):T("",!0),s(L,{class:u(e.$style.emptyStateCard),hoverable:"","data-test-id":"new-workflow-card",onClick:e.addWorkflow},{default:a(()=>[s(_,{class:u(e.$style.emptyStateCardIcon),icon:"file"},null,8,["class"]),s(y,{size:"large",class:"mt-xs",color:"text-base"},{default:a(()=>[f(l(e.$locale.baseText("workflows.empty.startFromScratch")),1)]),_:1})]),_:1},8,["class","onClick"])],2))]),filters:a(({setKeyValue:p})=>[e.settingsStore.areTagsEnabled?(c(),S("div",Oe,[s(P,{label:e.$locale.baseText("workflows.filters.tags"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),s(B,{placeholder:e.$locale.baseText("workflowOpen.filterWorkflows"),"model-value":e.filters.tags,"create-enabled":!1,"onUpdate:modelValue":d=>p("tags",d)},null,8,["placeholder","model-value","onUpdate:modelValue"])])):T("",!0),h("div",Le,[s(P,{label:e.$locale.baseText("workflows.filters.status"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),s(H,{"data-test-id":"status-dropdown","model-value":e.filters.status,"onUpdate:modelValue":d=>p("status",d)},{default:a(()=>[(c(!0),S(de,null,ce(e.statusFilterOptions,d=>(c(),$(N,{key:d.label,label:d.label,value:d.value,"data-test-id":"status"},null,8,["label","value"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"])])]),_:1},8,["resources","filters","additional-filters-handler","shareable","initialize","disabled","onClick:add","onUpdate:filters"])}const Ue={$style:Ee},wt=M(_e,[["render",Pe],["__cssModules",Ue]]);export{wt as default};
//# sourceMappingURL=WorkflowsView-BMDRVCFf.js.map
