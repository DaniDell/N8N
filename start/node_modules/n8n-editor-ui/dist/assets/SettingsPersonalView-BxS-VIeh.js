import{u as v,cD as M,i as _,b as U,a as A,cE as I,cF as $,w as z}from"./index-DEwaaDne.js";import{m as B}from"./pinia-BAhPp3pQ.js";import{b as N,_ as w}from"./n8n-B6cfQsVX.js";import{G as D,l as i,m as c,p as s,U as t,O as a,S as o,T as r,I as u,R as h,M as b,F as P,a7 as V,ag as l}from"./vendor-Dv5OeN6t.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const q=D({name:"SettingsPersonalView",setup(){return{i18n:z(),...v()}},data(){return{hasAnyBasicInfoChanges:!1,formInputs:null,formBus:N(),readyToSubmit:!1,mfaDocsUrl:M,currentSelectedTheme:_().theme,themeOptions:[{name:"system",label:"settings.personal.theme.systemDefault"},{name:"light",label:"settings.personal.theme.light"},{name:"dark",label:"settings.personal.theme.dark"}]}},computed:{...B(_,A,U),currentUser(){return this.usersStore.currentUser},isExternalAuthEnabled(){var m;const e=this.settingsStore.settings.enterprise.ldap&&((m=this.currentUser)==null?void 0:m.signInType)==="ldap",n=this.settingsStore.isSamlLoginEnabled&&this.settingsStore.isDefaultAuthenticationSaml;return e||n},isPersonalSecurityEnabled(){return this.usersStore.isInstanceOwner||!this.isExternalAuthEnabled},mfaDisabled(){return!this.usersStore.mfaEnabled},isMfaFeatureEnabled(){return this.settingsStore.isMfaFeatureEnabled},hasAnyPersonalisationChanges(){return this.currentSelectedTheme!==this.uiStore.theme},hasAnyChanges(){return this.hasAnyBasicInfoChanges||this.hasAnyPersonalisationChanges}},mounted(){var e,n,m;this.formInputs=[{name:"firstName",initialValue:(e=this.currentUser)==null?void 0:e.firstName,properties:{label:this.i18n.baseText("auth.firstName"),maxlength:32,required:!0,autocomplete:"given-name",capitalize:!0,disabled:this.isExternalAuthEnabled}},{name:"lastName",initialValue:(n=this.currentUser)==null?void 0:n.lastName,properties:{label:this.i18n.baseText("auth.lastName"),maxlength:32,required:!0,autocomplete:"family-name",capitalize:!0,disabled:this.isExternalAuthEnabled}},{name:"email",initialValue:(m=this.currentUser)==null?void 0:m.email,properties:{label:this.i18n.baseText("auth.email"),type:"email",required:!0,validationRules:[{name:"VALID_EMAIL"}],autocomplete:"email",capitalize:!0,disabled:!this.isPersonalSecurityEnabled}}]},methods:{onInput(){this.hasAnyBasicInfoChanges=!0},onReadyToSubmit(e){this.readyToSubmit=e},async onSubmit(e){try{await Promise.all([this.updateUserBasicInfo(e),this.updatePersonalisationSettings()]),this.showToast({title:this.i18n.baseText("settings.personal.personalSettingsUpdated"),message:"",type:"success"})}catch(n){this.showError(n,this.i18n.baseText("settings.personal.personalSettingsUpdatedError"))}},async updateUserBasicInfo(e){!this.hasAnyBasicInfoChanges||!this.usersStore.currentUserId||(await this.usersStore.updateUser({id:this.usersStore.currentUserId,firstName:e.firstName,lastName:e.lastName,email:e.email}),this.hasAnyBasicInfoChanges=!1)},async updatePersonalisationSettings(){this.hasAnyPersonalisationChanges&&this.uiStore.setTheme(this.currentSelectedTheme)},onSaveClick(){this.formBus.emit("submit")},openPasswordModal(){this.uiStore.openModal(I)},onMfaEnableClick(){this.uiStore.openModal($)},async onMfaDisableClick(){try{await this.usersStore.disabledMfa(),this.showToast({title:this.$locale.baseText("settings.personal.mfa.toast.disabledMfa.title"),message:this.$locale.baseText("settings.personal.mfa.toast.disabledMfa.message"),type:"success",duration:0})}catch(e){this.showError(e,this.$locale.baseText("settings.personal.mfa.toast.disabledMfa.error.message"))}}}}),F="_container_z1fqc_1",L="_header_z1fqc_8",O="_user_z1fqc_17",R="_username_z1fqc_27",G="_disableMfaButton_z1fqc_39",K="_button_z1fqc_46",Y="_infoText_z1fqc_53",H="_themeSelect_z1fqc_58",W={container:F,header:L,user:O,username:R,disableMfaButton:G,button:K,infoText:Y,themeSelect:H},j={class:"mb-s"},J={"data-test-id":"personal-data-form"},Q={key:0},X={class:"mb-s"},Z={class:"mb-s"},x={key:0,"data-test-id":"mfa-section"},ee={class:"mb-xs"},te={class:"mb-s"};function se(e,n,m,ne,ie,le){const p=l("n8n-heading"),S=l("n8n-text"),T=l("n8n-avatar"),C=l("n8n-form-inputs"),y=l("n8n-link"),f=l("n8n-input-label"),g=l("n8n-button"),E=l("n8n-option"),k=l("n8n-select");return i(),c("div",{class:u(e.$style.container),"data-test-id":"personal-settings-container"},[s("div",{class:u(e.$style.header)},[t(p,{size:"2xlarge"},{default:a(()=>[o(r(e.i18n.baseText("settings.personal.personalSettings")),1)]),_:1}),e.currentUser?(i(),c("div",{key:0,class:u(e.$style.user)},[s("span",{class:u(e.$style.username),"data-test-id":"current-user-name"},[t(S,{color:"text-light"},{default:a(()=>[o(r(e.currentUser.fullName),1)]),_:1})],2),t(T,{"first-name":e.currentUser.firstName,"last-name":e.currentUser.lastName,size:"large"},null,8,["first-name","last-name"])],2)):h("",!0)],2),s("div",null,[s("div",j,[t(p,{size:"large"},{default:a(()=>[o(r(e.i18n.baseText("settings.personal.basicInformation")),1)]),_:1})]),s("div",J,[e.formInputs?(i(),b(C,{key:0,inputs:e.formInputs,"event-bus":e.formBus,onUpdate:e.onInput,onReady:e.onReadyToSubmit,onSubmit:e.onSubmit},null,8,["inputs","event-bus","onUpdate","onReady","onSubmit"])):h("",!0)])]),e.isPersonalSecurityEnabled?(i(),c("div",Q,[s("div",X,[t(p,{size:"large"},{default:a(()=>[o(r(e.i18n.baseText("settings.personal.security")),1)]),_:1})]),s("div",Z,[t(f,{label:e.i18n.baseText("auth.password")},{default:a(()=>[t(y,{"data-test-id":"change-password-link",onClick:e.openPasswordModal},{default:a(()=>[o(r(e.i18n.baseText("auth.changePassword")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),e.isMfaFeatureEnabled?(i(),c("div",x,[s("div",ee,[t(f,{label:e.$locale.baseText("settings.personal.mfa.section.title")},null,8,["label"]),t(S,{bold:!1,class:u(e.$style.infoText)},{default:a(()=>[o(r(e.mfaDisabled?e.$locale.baseText("settings.personal.mfa.button.disabled.infobox"):e.$locale.baseText("settings.personal.mfa.button.enabled.infobox"))+" ",1),t(y,{to:e.mfaDocsUrl,size:"small",bold:!0},{default:a(()=>[o(r(e.$locale.baseText("generic.learnMore")),1)]),_:1},8,["to"])]),_:1},8,["class"])]),e.mfaDisabled?(i(),b(g,{key:0,class:u(e.$style.button),type:"tertiary",label:e.$locale.baseText("settings.personal.mfa.button.enabled"),"data-test-id":"enable-mfa-button",onClick:e.onMfaEnableClick},null,8,["class","label","onClick"])):(i(),b(g,{key:1,class:u(e.$style.disableMfaButton),type:"tertiary",label:e.$locale.baseText("settings.personal.mfa.button.disabled"),"data-test-id":"disable-mfa-button",onClick:e.onMfaDisableClick},null,8,["class","label","onClick"]))])):h("",!0)])):h("",!0),s("div",null,[s("div",te,[t(p,{size:"large"},{default:a(()=>[o(r(e.i18n.baseText("settings.personal.personalisation")),1)]),_:1})]),s("div",null,[t(f,{label:e.i18n.baseText("settings.personal.theme")},{default:a(()=>[t(k,{modelValue:e.currentSelectedTheme,"onUpdate:modelValue":n[0]||(n[0]=d=>e.currentSelectedTheme=d),class:u(e.$style.themeSelect),"data-test-id":"theme-select",size:"small",filterable:""},{default:a(()=>[(i(!0),c(P,null,V(e.themeOptions,d=>(i(),b(E,{key:d.name,label:e.$t(d.label),value:d.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1},8,["label"])])]),s("div",null,[t(g,{float:"right",label:e.i18n.baseText("settings.personal.save"),size:"large",disabled:!e.hasAnyChanges||!e.readyToSubmit,"data-test-id":"save-settings-button",onClick:e.onSaveClick},null,8,["label","disabled","onClick"])])],2)}const ae={$style:W},Pe=w(q,[["render",se],["__cssModules",ae]]);export{Pe as default};
//# sourceMappingURL=SettingsPersonalView-BxS-VIeh.js.map
