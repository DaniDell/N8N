import{ae as de,u as te,b as se,a as le,d7 as ne,E as oe,w as ie,bt as ce,i as ve,n as be,z as me,F as pe,G as fe}from"./index-DEwaaDne.js";import{R as ye}from"./ResourcesListLayout-CjzGJ-eS.js";import{G as re,e as w,r as g,b as _e,d as ge,l as i,m as y,p as f,T as d,M as I,u as v,U as m,O as l,S as _,I as H,R as ee,n as ae,ag as E,D as Te,y as ke,a9 as xe}from"./vendor-Dv5OeN6t.js";import{_ as ue,aw as he}from"./n8n-B6cfQsVX.js";import"./pinia-BAhPp3pQ.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const we={class:"variables-key-column"},Ce={key:0},Ve={class:"variables-value-column"},$e={key:0},Re={class:"variables-usage-column"},Ee={key:0},Se=re({__name:"VariablesRow",props:{data:{type:Object,default:()=>({})},editing:{type:Boolean,default:!1}},emits:["save","cancel","edit","delete"],setup(C,{emit:P}){const n=ie(),L=de(),{showMessage:O}=te(),X=se(),r=le(),S=P,A=C,V=w(()=>ne(r.currentUser)),t=g({...A.data}),$=g({key:!1,value:!1}),o=w(()=>$.value.name&&$.value.value),T=g(),K=g(),u=g(`$vars.${A.data.name}`),Z=w(()=>X.isEnterpriseFeatureEnabled(oe.Variables));_e(()=>{D()});const B=[{name:"REQUIRED"},{name:"MAX_LENGTH",config:{maximum:50}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z]/,message:n.baseText("variables.editing.key.error.startsWithLetter")}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:n.baseText("variables.editing.key.error.jsonKey")}}],q=[{name:"MAX_LENGTH",config:{maximum:220}}];ge(()=>t.value.name,async()=>{await ae(),$.value.name&&k()});function k(){u.value=`$vars.${t.value.name||A.data.name}`}async function p(){t.value={...A.data},S("cancel",t.value)}async function W(){S("save",t.value)}async function Q(){S("edit",t.value),await ae(),D()}async function Y(){S("delete",t.value)}function G(b,s){$.value[b]=s}function j(){L.copy(u.value),O({title:n.baseText("variables.row.usage.copiedToClipboard"),type:"success"})}function D(){var b,s,R;(R=(s=(b=T.value)==null?void 0:b.inputRef)==null?void 0:s.focus)==null||R.call(s)}return(b,s)=>{const R=E("n8n-form-input"),F=E("n8n-tooltip"),x=E("n8n-button");return i(),y("tr",{class:H(b.$style.variablesRow),"data-test-id":"variables-row"},[f("td",we,[f("div",null,[C.editing?(i(),I(R,{key:1,ref_key:"keyInputRef",ref:T,modelValue:t.value.name,"onUpdate:modelValue":s[0]||(s[0]=c=>t.value.name=c),label:"",name:"name","data-test-id":"variable-row-key-input",placeholder:v(n).baseText("variables.editing.key.placeholder"),required:"","validate-on-blur":"","validation-rules":B,onValidate:s[1]||(s[1]=c=>G("name",c))},null,8,["modelValue","placeholder"])):(i(),y("span",Ce,d(C.data.name),1))])]),f("td",Ve,[f("div",null,[C.editing?(i(),I(R,{key:1,ref_key:"valueInputRef",ref:K,modelValue:t.value.value,"onUpdate:modelValue":s[2]||(s[2]=c=>t.value.value=c),label:"",name:"value","data-test-id":"variable-row-value-input",placeholder:v(n).baseText("variables.editing.value.placeholder"),"validate-on-blur":"","validation-rules":q,onValidate:s[3]||(s[3]=c=>G("value",c))},null,8,["modelValue","placeholder"])):(i(),y("span",$e,d(C.data.value),1))])]),f("td",Re,[f("div",null,[m(F,{placement:"top"},{content:l(()=>[_(d(v(n).baseText("variables.row.usage.copyToClipboard")),1)]),default:l(()=>[t.value.name&&u.value?(i(),y("span",{key:0,class:H(b.$style.usageSyntax),onClick:j},d(u.value),3)):ee("",!0)]),_:1})])]),Z.value?(i(),y("td",Ee,[C.editing?(i(),y("div",{key:0,class:H(b.$style.buttons)},[m(x,{"data-test-id":"variable-row-cancel-button",type:"tertiary",class:"mr-xs",onClick:p},{default:l(()=>[_(d(v(n).baseText("variables.row.button.cancel")),1)]),_:1}),m(x,{"data-test-id":"variable-row-save-button",disabled:!o.value,type:"primary",onClick:W},{default:l(()=>[_(d(v(n).baseText("variables.row.button.save")),1)]),_:1},8,["disabled"])],2)):(i(),y("div",{key:1,class:H([b.$style.buttons,b.$style.hoverButtons])},[m(F,{disabled:V.value.update,placement:"top"},{content:l(()=>[_(d(v(n).baseText("variables.row.button.edit.onlyRoleCanEdit")),1)]),default:l(()=>[f("div",null,[m(x,{"data-test-id":"variable-row-edit-button",type:"tertiary",class:"mr-xs",disabled:!V.value.update,onClick:Q},{default:l(()=>[_(d(v(n).baseText("variables.row.button.edit")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"]),m(F,{disabled:V.value.delete,placement:"top"},{content:l(()=>[_(d(v(n).baseText("variables.row.button.delete.onlyRoleCanDelete")),1)]),default:l(()=>[f("div",null,[m(x,{"data-test-id":"variable-row-delete-button",type:"tertiary",disabled:!V.value.delete,onClick:Y},{default:l(()=>[_(d(v(n).baseText("variables.row.button.delete")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])],2))])):ee("",!0)],2)}}}),Ae="_variablesRow_14ir1_1",Be="_hoverButtons_14ir1_1",Me="_buttons_14ir1_10",Ue="_usageSyntax_14ir1_21",Ie={variablesRow:Ae,hoverButtons:Be,buttons:Me,usageSyntax:Ue},De={$style:Ie},Fe=ue(Se,[["__cssModules",De]]),Ne={key:0},ze={key:1},z="@tmpvar",Le=re({__name:"VariablesView",setup(C){const P=se(),n=ce(),L=le(),O=ve(),X=pe(),r=ie(),S=fe(),A=be();let V=()=>{};const t=g(null),{showError:$}=te(),o=g([]),T=g({}),K=ne(L.currentUser),u=w(()=>P.isEnterpriseFeatureEnabled(oe.Variables)),Z=w(()=>o.value.map(e=>({id:e.id,name:e.key,value:e.value}))),B=w(()=>u.value&&K.create),q=w(()=>[{id:0,path:"name",label:r.baseText("variables.table.key"),classes:["variables-key-column"]},{id:1,path:"value",label:r.baseText("variables.table.value"),classes:["variables-value-column"]},{id:2,path:"usage",label:r.baseText("variables.table.usage"),classes:["variables-usage-column"]},...u.value?[{id:3,path:"actions",label:""}]:[]]),k=w(()=>O.contextBasedTranslationKeys),p=g([]),W=(e,a,h)=>`${e.id}`.startsWith(z)?-1:`${a.id}`.startsWith(z)?1:p.value.includes(e.id)&&p.value.includes(a.id)?p.value.indexOf(e.id)-p.value.indexOf(a.id):p.value.includes(e.id)?-1:p.value.includes(a.id)?1:h==="asc"?c(e).trim().localeCompare(c(a).trim()):c(a).trim().localeCompare(c(e).trim()),Q={nameAsc:(e,a)=>W(e,a,"asc"),nameDesc:(e,a)=>W(e,a,"desc")};function Y(){p.value=[]}const G=e=>({id:e.id,key:e.name,value:e.value});async function j(){u.value&&(await n.fetchAllVariables(),o.value=[...n.variables])}function D(){const e={id:he(z),key:"",value:""};t.value&&(t.value.$refs.listWrapperRef&&(t.value.$refs.listWrapperRef.scrollTop=0),t.value.currentPage!==1&&t.value.setCurrentPage(1)),o.value.unshift(e),T.value[e.id]=!0,X.track("User clicked add variable button")}async function b(e){let a;const h=G(e);try{if(typeof e.id=="string"&&e.id.startsWith(z)){const{id:M,...J}=h;a=await n.createVariable(J),o.value.unshift(a),o.value=o.value.filter(N=>N.id!==e.id),p.value.unshift(a.id)}else a=await n.updateVariable(h),o.value=o.value.filter(M=>M.id!==e.id),o.value.push(a),s(a)}catch(M){$(M,r.baseText("variables.errors.save"))}}function s(e){T.value={...T.value,[e.id]:!T.value[e.id]}}function R(e){typeof e.id=="string"&&e.id.startsWith(z)?o.value=o.value.filter(a=>a.id!==e.id):s(e)}async function F(e){try{if(await S.confirm(r.baseText("variables.modals.deleteConfirm.message",{interpolate:{name:e.key}}),r.baseText("variables.modals.deleteConfirm.title"),{confirmButtonText:r.baseText("variables.modals.deleteConfirm.confirmButton"),cancelButtonText:r.baseText("variables.modals.deleteConfirm.cancelButton")})!==me)return;await n.deleteVariable(e),o.value=o.value.filter(h=>h.id!==e.id)}catch(a){$(a,r.baseText("variables.errors.delete"))}}function x(){O.goToUpgrade("variables","upgrade-variables")}function c(e){return e.name}return Te(()=>{V=A.$onAction(({name:e,after:a})=>{e==="pullWorkfolder"&&a&&a(()=>{j()})})}),ke(()=>{V()}),(e,a)=>{const h=E("n8n-heading"),M=E("n8n-button"),J=E("n8n-tooltip"),N=E("n8n-action-box");return i(),I(ye,{ref_key:"layoutRef",ref:t,class:"variables-view","resource-key":"variables",disabled:!u.value,resources:Z.value,initialize:j,shareable:!1,"display-name":c,"sort-fns":Q,"sort-options":["nameAsc","nameDesc"],"show-filters-dropdown":!1,type:"datatable","type-props":{columns:q.value},onSort:Y,"onClick:add":D},xe({header:l(()=>[m(h,{size:"2xlarge",class:"mb-m"},{default:l(()=>[_(d(v(r).baseText("variables.heading")),1)]),_:1})]),"add-button":l(()=>[m(J,{placement:"top",disabled:B.value},{content:l(()=>[u.value?(i(),y("span",ze,d(v(r).baseText("variables.add.onlyOwnerCanCreate")),1)):(i(),y("span",Ne,d(v(r).baseText(`variables.add.unavailable${o.value.length===0?".empty":""}`)),1))]),default:l(()=>[f("div",null,[m(M,{size:"large",block:"",disabled:!B.value,"data-test-id":"resources-list-add",onClick:D},{default:l(()=>[_(d(e.$locale.baseText("variables.add")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])]),default:l(({data:U})=>[(i(),I(Fe,{key:U.id,editing:T.value[U.id],data:U,onSave:b,onEdit:s,onCancel:R,onDelete:F},null,8,["editing","data"]))]),_:2},[u.value?void 0:{name:"preamble",fn:l(()=>[m(N,{class:"mb-m","data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(k.value.variables.unavailable.title),description:e.$locale.baseText(k.value.variables.unavailable.description),"button-text":e.$locale.baseText(k.value.variables.unavailable.button),"button-type":"secondary","onClick:button":x},null,8,["heading","description","button-text"])]),key:"0"},!u.value||u.value&&!B.value?{name:"empty",fn:l(()=>{var U;return[u.value?B.value?ee("",!0):(i(),I(N,{key:1,"data-test-id":"cannot-create-variables",emoji:"ðŸ‘‹",heading:e.$locale.baseText("variables.empty.notAllowedToCreate.heading",{interpolate:{name:((U=v(L).currentUser)==null?void 0:U.firstName)??""}}),description:e.$locale.baseText("variables.empty.notAllowedToCreate.description"),onClick:x},null,8,["heading","description"])):(i(),I(N,{key:0,"data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(k.value.variables.unavailable.title),description:e.$locale.baseText(k.value.variables.unavailable.description),"button-text":e.$locale.baseText(k.value.variables.unavailable.button),"button-type":"secondary","onClick:button":x},null,8,["heading","description","button-text"]))]}),key:"1"}:void 0]),1032,["disabled","resources","type-props"])}}}),Oe="_sidebarContainer_pm4w0_5",We={"type-input":"_type-input_pm4w0_1",sidebarContainer:Oe},Ge={$style:We},Ta=ue(Le,[["__cssModules",Ge],["__scopeId","data-v-857fb1b9"]]);export{Ta as default};
//# sourceMappingURL=VariablesView-uUyY5gqA.js.map
