import{m as U,s as ue}from"./pinia-BAhPp3pQ.js";import{G as z,l as u,m as b,U as d,O as h,p as S,S as $,T as y,I as l,M as _,R as E,ag as c,F as le,a7 as ce,a0 as de,aH as q,az as fe,r as C,e as D,d as P,b as me,y as pe,u as xe}from"./vendor-Dv5OeN6t.js";import{j as N,V as R,J as G,bo as he,I as we,z as ye,bp as Ee,p as ge,d as X,u as j,G as ve,i as ke,b as $e,a4 as K,c as J,P as _e,cy as be,a3 as Ie,w as Te,cz as Se,F as Re}from"./index-DEwaaDne.js";import{E as Me,a as Le}from"./ExecutionsFilter-BSWo4-vK.js";import{u as We}from"./useExecutionHelpers-C0lzavRV.js";import{_ as F}from"./n8n-B6cfQsVX.js";import{W as Ce}from"./WorkflowExecutionsInfoAccordion-DvgpWxaO.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./dateFormatter-DfWOmXdP.js";const De=z({name:"WorkflowExecutionsCard",components:{ExecutionsTime:Me},props:{execution:{type:Object,required:!0},highlight:{type:Boolean,default:!1},showGap:{type:Boolean,default:!1}},emits:["retryExecution","mounted"],setup(){return{executionHelpers:We()}},computed:{...U(N),currentWorkflow(){return this.$route.params.name||this.workflowsStore.workflowId},retryExecutionActions(){return[{id:"current-workflow",label:this.$locale.baseText("executionsList.retryWithCurrentlySavedWorkflow")},{id:"original-workflow",label:this.$locale.baseText("executionsList.retryWithOriginalWorkflow")}]},executionUIDetails(){return this.executionHelpers.getUIDetails(this.execution)},isActive(){return this.execution.id===this.$route.params.executionId},isRetriable(){return this.executionHelpers.isExecutionRetriable(this.execution)},executionPreviewViewName(){return R.EXECUTION_PREVIEW}},mounted(){this.$emit("mounted",this.execution.id)},methods:{onRetryMenuItemSelect(e){this.$emit("retryExecution",{execution:this.execution,command:e})}}}),ze="_WorkflowExecutionsCard_16ozu_1",Ae="_active_16ozu_8",Oe="_executionStatus_16ozu_11",Ue="_executionLink_16ozu_14",Ne="_spinner_16ozu_17",Fe="_running_16ozu_17",Be="_statusLabel_16ozu_24",He="_success_16ozu_29",Ve="_waiting_16ozu_32",Pe="_error_16ozu_38",qe="_unknown_16ozu_44",Ge="_icon_16ozu_61",Xe="_icons_16ozu_66",je="_retry_16ozu_74",Ke="_manual_16ozu_77",Je="_showGap_16ozu_85",Qe={WorkflowExecutionsCard:ze,active:Ae,executionStatus:Oe,executionLink:Ue,new:"_new_16ozu_17",spinner:Ne,running:Fe,statusLabel:Be,success:He,waiting:Ve,error:Pe,unknown:qe,icon:Ge,icons:Xe,retry:je,manual:Ke,showGap:Je},Ye={key:0};function Ze(e,t,n,f,g,s){const w=c("n8n-text"),v=c("n8n-spinner"),m=c("ExecutionsTime"),r=c("n8n-action-dropdown"),L=c("font-awesome-icon"),M=c("n8n-tooltip"),I=c("router-link");return u(),b("div",{class:l({"execution-card":!0,[e.$style.WorkflowExecutionsCard]:!0,[e.$style.active]:e.isActive,[e.$style[e.executionUIDetails.name]]:!0,[e.$style.highlight]:e.highlight,[e.$style.showGap]:e.showGap})},[d(I,{class:l(e.$style.executionLink),to:{name:e.executionPreviewViewName,params:{name:e.currentWorkflow,executionId:e.execution.id}},"data-test-execution-status":e.executionUIDetails.name},{default:h(()=>[S("div",{class:l(e.$style.description)},[d(w,{color:"text-dark",bold:!0,size:"medium","data-test-id":"execution-time"},{default:h(()=>[$(y(e.executionUIDetails.startTime),1)]),_:1}),S("div",{class:l(e.$style.executionStatus)},[e.executionUIDetails.name==="running"?(u(),_(v,{key:0,size:"small",class:l([e.$style.spinner,"mr-4xs"])},null,8,["class"])):E("",!0),d(w,{class:l(e.$style.statusLabel),size:"small"},{default:h(()=>[$(y(e.executionUIDetails.label),1)]),_:1},8,["class"]),$(" "+y(" ")+" "),e.executionUIDetails.name==="running"?(u(),_(w,{key:1,color:e.isActive?"text-dark":"text-base",size:"small"},{default:h(()=>[$(y(e.$locale.baseText("executionDetails.runningTimeRunning"))+" ",1),d(m,{"start-time":e.execution.startedAt},null,8,["start-time"])]),_:1},8,["color"])):e.executionUIDetails.runningTime!==""?(u(),_(w,{key:2,color:e.isActive?"text-dark":"text-base",size:"small"},{default:h(()=>{var a;return[$(y(e.$locale.baseText("executionDetails.runningTimeFinished",{interpolate:{time:(a=e.executionUIDetails)==null?void 0:a.runningTime}})),1)]}),_:1},8,["color"])):E("",!0)],2),e.execution.mode==="retry"?(u(),b("div",Ye,[d(w,{color:e.isActive?"text-dark":"text-base",size:"small"},{default:h(()=>[$(y(e.$locale.baseText("executionDetails.retry"))+" #"+y(e.execution.retryOf),1)]),_:1},8,["color"])])):E("",!0)],2),S("div",{class:l(e.$style.icons)},[e.isRetriable?(u(),_(r,{key:0,class:l([e.$style.icon,e.$style.retry]),items:e.retryExecutionActions,"activator-icon":"redo","data-test-id":"retry-execution-button",onSelect:e.onRetryMenuItemSelect},null,8,["class","items","onSelect"])):E("",!0),e.execution.mode==="manual"?(u(),_(M,{key:1,placement:"top"},{content:h(()=>[S("span",null,y(e.$locale.baseText("executionsList.test")),1)]),default:h(()=>[e.execution.mode==="manual"?(u(),_(L,{key:0,class:l([e.$style.icon,e.$style.manual]),icon:"flask"},null,8,["class"])):E("",!0)]),_:1})):E("",!0)],2)]),_:1},8,["class","to","data-test-execution-status"])],2)}const et={$style:Qe},tt=F(De,[["render",Ze],["__cssModules",et]]),ot=z({name:"WorkflowExecutionsSidebar",components:{WorkflowExecutionsCard:tt,WorkflowExecutionsInfoAccordion:Ce,ExecutionsFilter:Le},props:{executions:{type:Array,required:!0},loading:{type:Boolean,default:!0},loadingMore:{type:Boolean,default:!1},temporaryExecution:{type:Object,default:null}},emits:{retryExecution:null,loadMore:null,refresh:null,filterUpdated:null,reloadExecutions:null,"update:autoRefresh":null},data(){return{filter:{},mountedItems:[],autoScrollDeps:{activeExecutionSet:!1,cardsMounted:!1,scroll:!0}}},computed:{...U(G,N)},watch:{$route(e,t){t.name===R.EXECUTION_PREVIEW&&e.name===R.EXECUTION_HOME&&this.$router.go(-1)},"executionsStore.activeExecution"(e,t){e&&e.id!==(t==null?void 0:t.id)&&(this.autoScrollDeps.activeExecutionSet=!0)},autoScrollDeps:{handler(e){Object.values(e).every(Boolean)&&this.scrollToActiveCard()},deep:!0}},methods:{onItemMounted(e){var t;this.mountedItems.push(e),this.mountedItems.length===this.executions.length&&(this.autoScrollDeps.cardsMounted=!0,this.checkListSize()),((t=this.executionsStore.activeExecution)==null?void 0:t.id)===e&&(this.autoScrollDeps.activeExecutionSet=!0)},loadMore(e=20){if(!this.loading){const t=this.$refs.executionList;if(t){const n=t.offsetHeight-(t.scrollHeight-t.scrollTop);n>-10&&n<10&&this.$emit("loadMore",e)}}},onRetryExecution(e){this.$emit("retryExecution",e)},onRefresh(){this.$emit("refresh")},onFilterChanged(e){this.$emit("filterUpdated",e)},reloadExecutions(){this.$emit("reloadExecutions")},checkListSize(){const e=this.$refs.container,t=this.$refs[`execution-${this.mountedItems[this.mountedItems.length-1]}`];if(e&&(t!=null&&t.length)){const n=t[0].$el,f=Math.ceil(e.clientHeight/n.clientHeight);f>this.executions.length&&this.$emit("loadMore",f-this.executions.length)}},scrollToActiveCard(){var n;const e=this.$refs.executionList,t=this.$refs[`execution-${(n=this.executionsStore.activeExecution)==null?void 0:n.id}`];if(e&&(t!=null&&t.length)&&this.executionsStore.activeExecution){const g=t[0].$el.getBoundingClientRect(),s=200;g.top>e.offsetHeight&&(this.autoScrollDeps.scroll=!1,e.scrollTo({top:g.top-s,behavior:"smooth"}))}}}}),nt="_container_qg8we_1",st="_heading_qg8we_12",it="_controls_qg8we_19",rt="_executionList_qg8we_31",at="_infoAccordion_qg8we_49",ut="_noResultsContainer_qg8we_61",lt={container:nt,heading:st,controls:it,executionList:rt,infoAccordion:at,noResultsContainer:ut},ct={key:0,class:"mr-l"},dt={key:3,class:"mr-m"};function ft(e,t,n,f,g,s){const w=c("n8n-heading"),v=c("el-checkbox"),m=c("ExecutionsFilter"),r=c("n8n-loading"),L=c("n8n-text"),M=c("WorkflowExecutionsCard"),I=c("WorkflowExecutionsInfoAccordion");return u(),b("div",{ref:"container",class:l(["executions-sidebar",e.$style.container]),"data-test-id":"executions-sidebar"},[S("div",{class:l(e.$style.heading)},[d(w,{tag:"h2",size:"medium",color:"text-dark"},{default:h(()=>[$(y(e.$locale.baseText("generic.executions")),1)]),_:1})],2),S("div",{class:l(e.$style.controls)},[d(v,{modelValue:e.executionsStore.autoRefresh,"onUpdate:modelValue":[t[0]||(t[0]=a=>e.executionsStore.autoRefresh=a),t[1]||(t[1]=a=>e.$emit("update:autoRefresh",a))],"data-test-id":"auto-refresh-checkbox"},{default:h(()=>[$(y(e.$locale.baseText("executionsList.autoRefresh")),1)]),_:1},8,["modelValue"]),d(m,{"popover-placement":"left-start",onFilterChanged:e.onFilterChanged},null,8,["onFilterChanged"])],2),S("div",{ref:"executionList",class:l(e.$style.executionList),"data-test-id":"current-executions-list",onScroll:t[2]||(t[2]=a=>e.loadMore(20))},[e.loading?(u(),b("div",ct,[d(r,{variant:"rect"})])):E("",!0),!e.loading&&e.executions.length===0?(u(),b("div",{key:1,class:l(e.$style.noResultsContainer),"data-test-id":"execution-list-empty"},[d(L,{color:"text-base",size:"medium",align:"center"},{default:h(()=>[$(y(e.$locale.baseText("executionsLandingPage.noResults")),1)]),_:1})],2)):e.temporaryExecution?(u(),_(M,{key:2,ref:`execution-${e.temporaryExecution.id}`,execution:e.temporaryExecution,"data-test-id":`execution-details-${e.temporaryExecution.id}`,"show-gap":!0,onRetryExecution:e.onRetryExecution},null,8,["execution","data-test-id","onRetryExecution"])):E("",!0),d(de,{name:"executions-list"},{default:h(()=>[(u(!0),b(le,null,ce(e.executions,a=>(u(),_(M,{key:a.id,ref_for:!0,ref:`execution-${a.id}`,execution:a,"data-test-id":`execution-details-${a.id}`,onRetryExecution:e.onRetryExecution,onMounted:e.onItemMounted},null,8,["execution","data-test-id","onRetryExecution","onMounted"]))),128))]),_:1}),e.loadingMore?(u(),b("div",dt,[d(r,{variant:"p",rows:1})])):E("",!0)],34),S("div",{class:l(e.$style.infoAccordion)},[d(I,{"initially-expanded":!1})],2)],2)}const mt={$style:lt},pt=F(ot,[["render",ft],["__cssModules",mt],["__scopeId","data-v-4ab2abd5"]]),xt=z({name:"WorkflowExecutionsList",components:{WorkflowExecutionsSidebar:pt},async beforeRouteLeave(e,t,n){if(he(e)===we.WORKFLOW){n();return}if(this.uiStore.stateIsDirty){const f=await this.confirm(this.$locale.baseText("generic.unsavedWork.confirmMessage.message"),{title:this.$locale.baseText("generic.unsavedWork.confirmMessage.headline"),type:"warning",confirmButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.confirmButtonText"),cancelButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.cancelButtonText"),showClose:!0});f===ye?(await this.workflowHelpers.saveCurrentWorkflow({},!1)&&await this.settingsStore.fetchPromptsData(),this.uiStore.stateIsDirty=!1,n()):f===Ee&&(this.uiStore.stateIsDirty=!1,n())}else n()},props:{loading:{type:Boolean,default:!1},workflow:{type:Object,required:!0},executions:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},execution:{type:Object,default:null},loadingMore:{type:Boolean,default:!1}},emits:["execution:delete","execution:stop","execution:retry","update:auto-refresh","update:filters","load-more","reload"],setup(){const e=Ie(),t=q(),n=ge({router:t}),{callDebounced:f}=X();return{externalHooks:e,workflowHelpers:n,callDebounced:f,...j(),...ve()}},computed:{...U(J,K,$e,ke),temporaryExecution(){return!this.executions.find(t=>{var n;return t.id===((n=this.execution)==null?void 0:n.id)})?this.execution:void 0},hidePreview(){return this.loading||!this.execution&&this.executions.length},filterApplied(){return this.filters.status!=="all"},workflowDataNotLoaded(){return this.workflow.id===_e&&this.workflow.name===""},requestFilter(){return be({...this.filters,workflowId:this.workflow.id})}},watch:{execution(e){e&&this.$router.push({name:R.EXECUTION_PREVIEW,params:{name:this.workflow.id,executionId:e.id}}).catch(()=>{})}},methods:{async onDeleteCurrentExecution(){this.$emit("execution:delete",this.execution.id)},async onStopExecution(){this.$emit("execution:stop",this.execution.id)},async onRetryExecution(e){const t=e.command==="current-workflow";this.$emit("execution:retry",{id:e.execution.id,loadWorkflow:t})}}}),ht="_container_16o1g_1",wt="_content_16o1g_7",yt={container:ht,content:wt};function Et(e,t,n,f,g,s){const w=c("WorkflowExecutionsSidebar"),v=c("router-view");return u(),b("div",{class:l(e.$style.container)},[d(w,{executions:e.executions,loading:e.loading&&!e.executions.length,"loading-more":e.loadingMore,"temporary-execution":e.temporaryExecution,"onUpdate:autoRefresh":t[0]||(t[0]=m=>e.$emit("update:auto-refresh",m)),onReloadExecutions:t[1]||(t[1]=m=>e.$emit("reload")),onFilterUpdated:t[2]||(t[2]=m=>e.$emit("update:filters",m)),onLoadMore:t[3]||(t[3]=m=>e.$emit("load-more")),onRetryExecution:e.onRetryExecution},null,8,["executions","loading","loading-more","temporary-execution","onRetryExecution"]),e.hidePreview?E("",!0):(u(),b("div",{key:0,class:l(e.$style.content)},[d(v,{name:"executionPreview",execution:e.execution,onDeleteCurrentExecution:e.onDeleteCurrentExecution,onRetryExecution:e.onRetryExecution,onStopExecution:e.onStopExecution},null,8,["execution","onDeleteCurrentExecution","onRetryExecution","onStopExecution"])],2))],2)}const gt={$style:yt},vt=F(xt,[["render",Et],["__cssModules",gt]]),to=z({__name:"WorkflowExecutionsView",setup(e){const t=G(),n=N(),f=J(),g=K(),s=Te(),w=Re(),v=fe(),m=q(),r=j(),{callDebounced:L}=X(),{filters:M}=ue(t),I=C(!1),a=C(!1),k=C(),p=D(()=>v.params.name||n.workflowId),W=D(()=>v.params.executionId),x=D(()=>[...t.currentExecutionsByWorkflowId[p.value]??[],...t.executionsByWorkflowId[p.value]??[]]),Q=D(()=>x.value.find(o=>o.id===W.value)??A.value),A=C();P(()=>p.value,async()=>{await V()}),P(()=>W.value,async()=>{await B()}),me(async()=>{await g.loadNodeTypesIfNotLoaded(),await Promise.all([g.loadNodeTypesIfNotLoaded(),V(),t.initialize(p.value)]),await B(),await Y(),document.addEventListener("visibilitychange",H)}),pe(()=>{t.reset(),document.removeEventListener("visibilitychange",H)});async function B(){if(W.value)try{A.value=await t.fetchExecution(W.value),t.activeExecution=A.value}catch(o){r.showError(o,s.baseText("nodeView.showError.openExecution.title"))}}function H(){document.visibilityState==="hidden"?t.stopAutoRefreshInterval():t.startAutoRefreshInterval(p.value)}async function Y(){v.name===R.EXECUTION_HOME&&x.value.length>0&&k.value&&await m.push({name:R.EXECUTION_PREVIEW,params:{name:k.value.id,executionId:x.value[0].id}}).catch(()=>{})}async function V(){let o=n.workflowsById[p.value];if(!o)try{o=await n.fetchWorkflow(p.value)}catch(T){r.showError(T,s.baseText("nodeView.showError.openWorkflow.title"));return}if(!o)throw new Error(s.baseText("nodeView.workflowWithIdCouldNotBeFound",{interpolate:{workflowId:p.value}}));const i=o.tags??[];k.value=o,n.setWorkflowName({newName:o.name,setStateDirty:!1}),n.setWorkflowTagIds(i.map(({id:T})=>T)??[]),f.upsertTags(i)}async function Z(o){o?await t.startAutoRefreshInterval(p.value):t.stopAutoRefreshInterval()}async function O(){if(p.value)try{await t.fetchExecutions({...t.executionsFilters,workflowId:p.value})}catch(o){o.errorCode===Se?r.showMessage({title:s.baseText("executionsList.showError.refreshData.title"),message:o.message,type:"error",duration:3500},!1):r.showError(o,s.baseText("executionsList.showError.refreshData.title"))}}async function ee(o){t.reset(),t.setFilters(o),await t.initialize(p.value)}async function te(o){try{await t.stopCurrentExecution(o),r.showMessage({title:s.baseText("executionsList.showMessage.stopExecution.title"),message:s.baseText("executionsList.showMessage.stopExecution.message",{interpolate:{activeExecutionId:o}}),type:"success"}),await O()}catch(i){r.showError(i,s.baseText("executionsList.showError.stopExecution.title"))}}async function oe(o){I.value=!0;try{const i=x.value.findIndex(ae=>ae.id===o),T=x.value[i+1]||x.value[i-1]||x.value[0];await t.deleteExecutions({ids:[o]}),k.value&&(x.value.length>0?await m.replace({name:R.EXECUTION_PREVIEW,params:{name:k.value.id,executionId:T.id}}).catch(()=>{}):await m.replace({name:R.EXECUTION_HOME,params:{name:k.value.id}}))}catch(i){I.value=!1,r.showError(i,s.baseText("executionsList.showError.handleDeleteSelected.title"));return}I.value=!1,r.showMessage({title:s.baseText("executionsList.showMessage.handleDeleteSelected.title"),type:"success"})}async function ne(o){var i;r.showMessage({title:s.baseText("executionDetails.runningMessage"),type:"info",duration:2e3}),await se(o),await O(),w.track("User clicked retry execution button",{workflow_id:(i=k.value)==null?void 0:i.id,execution_id:o.id,retry_type:o.loadWorkflow?"current":"original"})}async function se(o){try{await t.retryExecution(o.id,o.loadWorkflow)?r.showMessage({title:s.baseText("executionsList.showMessage.retrySuccessfulTrue.title"),type:"success"}):r.showMessage({title:s.baseText("executionsList.showMessage.retrySuccessfulFalse.title"),type:"error"})}catch(i){r.showError(i,s.baseText("executionsList.showError.retryExecution.title"))}}async function ie(){a.value||await L(re,{debounceTime:1e3})}async function re(){var i;if((i=t.executionsFilters.status)!=null&&i.includes("running")||x.value.length>=t.executionsCount)return;a.value=!0;let o;x.value.length!==0&&(o=x.value.slice(-1)[0].id);try{await t.fetchExecutions(t.executionsFilters,o)}catch(T){a.value=!1,r.showError(T,s.baseText("executionsList.showError.loadMore.title"));return}a.value=!1}return(o,i)=>k.value?(u(),_(vt,{key:0,executions:x.value,execution:Q.value,filters:xe(M),workflow:k.value,loading:I.value,"loading-more":a.value,"onExecution:stop":te,"onExecution:delete":oe,"onExecution:retry":ne,"onUpdate:filters":ee,"onUpdate:autoRefresh":Z,onLoadMore:ie,onReload:O},null,8,["executions","execution","filters","workflow","loading","loading-more"])):E("",!0)}});export{to as default};
//# sourceMappingURL=WorkflowExecutionsView-CY5alI5S.js.map
