import{G as ee,av as re,aH as de,r as j,e as T,ag as g,l as i,m as v,p as t,M as b,R as L,I as u,a2 as Z,T as r,U as h,O as w,u as n,S as H,d as xe,b as oe,P as me,V as fe,F as pe,a7 as ye,a0 as we,D as be,y as he}from"./vendor-Dv5OeN6t.js";import{E as ve,a as ge}from"./ExecutionsFilter-BSWo4-vK.js";import{ba as ke,N as Le,w as te,V as Te,j as ne,J as le,u as ie,z as _e,G as Ee,F as ae,cW as Ae,a3 as Ce}from"./index-DEwaaDne.js";import{a as Ie}from"./dateFormatter-DfWOmXdP.js";import{u as Se}from"./useExecutionHelpers-C0lzavRV.js";import{_ as ce}from"./n8n-B6cfQsVX.js";import{s as $e}from"./pinia-BAhPp3pQ.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Me={key:0},De={key:1},Ne={key:0},Oe={key:1},We=t("br",null,null,-1),je={key:2},ze=t("br",null,null,-1),Re=ee({__name:"GlobalExecutionsListItem",props:{execution:{type:Object,required:!0},selected:{type:Boolean,default:!1},workflowName:{type:String,default:void 0}},emits:["stop","select","retrySaved","retryOriginal","delete"],setup(o,{emit:S}){const p=S,c=o,s=re(),l=te(),$=de(),m=Se(),_=j(!1),y=T(()=>c.execution.status==="running"),f=T(()=>c.execution.waitTill?new Date(c.execution.waitTill).toISOString()===ke:!1),d=T(()=>m.isExecutionRetriable(c.execution)),D=T(()=>({[s.executionListItem]:!0,[s[c.execution.status??""]]:!!c.execution.status})),k=T(()=>c.execution.startedAt?F(c.execution.startedAt):""),I=T(()=>c.execution.waitTill?F(c.execution.waitTill):""),N=T(()=>c.execution.stoppedAt?l.displayTimer(new Date(c.execution.stoppedAt).getTime()-new Date(c.execution.startedAt).getTime(),!0):""),E=T(()=>c.execution.status==="waiting"&&f.value?l.baseText("executionsList.statusTooltipText.theWorkflowIsWaitingIndefinitely"):""),O=T(()=>{switch(c.execution.status){case"waiting":return l.baseText("executionsList.waiting");case"canceled":return l.baseText("executionsList.canceled");case"crashed":return l.baseText("executionsList.error");case"new":return l.baseText("executionsList.running");case"running":return l.baseText("executionsList.running");case"success":return l.baseText("executionsList.succeeded");case"error":return l.baseText("executionsList.error");default:return l.baseText("executionsList.unknown")}}),P=T(()=>{switch(c.execution.status){case"waiting":return"executionsList.statusWaiting";case"canceled":return"executionsList.statusCanceled";case"crashed":case"error":case"success":return c.execution.stoppedAt?"executionsList.statusText":"executionsList.statusTextWithoutTime";case"new":return"executionsList.statusRunning";case"running":return"executionsList.statusRunning";default:return"executionsList.statusUnknown"}});function F(x){const{date:z,time:R}=Ie(x);return Le.baseText("executionsList.started",{interpolate:{time:R,date:z}})}function M(){const x=$.resolve({name:Te.EXECUTION_PREVIEW,params:{name:c.execution.workflowId,executionId:c.execution.id}});window.open(x.href,"_blank")}function q(){_.value=!0,p("stop",c.execution)}function J(){p("select",c.execution)}async function X(x){p(x,c.execution)}return(x,z)=>{const R=g("ElCheckbox"),U=g("FontAwesomeIcon"),K=g("i18n-t"),B=g("N8nTooltip"),G=g("N8nButton"),Q=g("N8nIconButton"),V=g("ElDropdownItem"),e=g("ElDropdownMenu"),a=g("ElDropdown");return i(),v("tr",{class:u(D.value)},[t("td",null,[o.execution.stoppedAt&&o.execution.id?(i(),b(R,{key:0,"model-value":o.selected,label:"","data-test-id":"select-execution-checkbox","onUpdate:modelValue":J},null,8,["model-value"])):L("",!0)]),t("td",null,[t("span",{class:u(x.$style.link),onClick:Z(M,["stop"])},r(o.execution.workflowName||o.workflowName),3)]),t("td",null,[t("span",null,r(k.value),1)]),t("td",null,[t("div",{class:u(x.$style.statusColumn)},[y.value?(i(),v("span",{key:0,class:u(x.$style.spinner)},[h(U,{icon:"spinner",spin:""})],2)):L("",!0),f.value?(i(),b(B,{key:2,placement:"top"},{content:w(()=>[t("span",null,r(E.value),1)]),default:w(()=>[t("span",{class:u(x.$style.status)},r(O.value),3)]),_:1})):(i(),b(K,{key:1,"data-test-id":"execution-status",tag:"span",keypath:P.value},{status:w(()=>[t("span",{class:u(x.$style.status)},r(O.value),3)]),time:w(()=>[o.execution.waitTill?(i(),v("span",Me,r(I.value),1)):o.execution.stoppedAt?(i(),v("span",De,r(N.value),1)):(i(),b(ve,{key:2,"start-time":o.execution.startedAt},null,8,["start-time"]))]),_:1},8,["keypath"]))],2)]),t("td",null,[o.execution.id?(i(),v("span",Ne,"#"+r(o.execution.id),1)):L("",!0),o.execution.retryOf?(i(),v("span",Oe,[We,t("small",null," ("+r(n(l).baseText("executionsList.retryOf"))+" #"+r(o.execution.retryOf)+") ",1)])):o.execution.retrySuccessId?(i(),v("span",je,[ze,t("small",null," ("+r(n(l).baseText("executionsList.successRetry"))+" #"+r(o.execution.retrySuccessId)+") ",1)])):L("",!0)]),t("td",null,[o.execution.mode==="manual"?(i(),b(B,{key:0,placement:"top"},{content:w(()=>[t("span",null,r(n(l).baseText("executionsList.test")),1)]),default:w(()=>[h(U,{icon:"flask"})]),_:1})):L("",!0)]),t("td",null,[t("div",{class:u(x.$style.buttonCell)},[o.execution.stoppedAt&&o.execution.id?(i(),b(G,{key:0,size:"small",outline:"",label:n(l).baseText("executionsList.view"),onClick:Z(M,["stop"])},null,8,["label"])):L("",!0)],2)]),t("td",null,[t("div",{class:u(x.$style.buttonCell)},[!o.execution.stoppedAt||o.execution.waitTill?(i(),b(G,{key:0,"data-test-id":"stop-execution-button",size:"small",outline:"",label:n(l).baseText("executionsList.stop"),loading:_.value,onClick:Z(q,["stop"])},null,8,["label","loading"])):L("",!0)],2)]),t("td",null,[y.value?L("",!0):(i(),b(a,{key:0,trigger:"click",onCommand:X},{dropdown:w(()=>[h(e,{class:u({[x.$style.actions]:!0,[x.$style.deleteOnly]:!d.value})},{default:w(()=>[d.value?(i(),b(V,{key:0,"data-test-id":"execution-retry-saved-dropdown-item",class:u(x.$style.retryAction),command:"retrySaved"},{default:w(()=>[H(r(n(l).baseText("executionsList.retryWithCurrentlySavedWorkflow")),1)]),_:1},8,["class"])):L("",!0),d.value?(i(),b(V,{key:1,"data-test-id":"execution-retry-original-dropdown-item",class:u(x.$style.retryAction),command:"retryOriginal"},{default:w(()=>[H(r(n(l).baseText("executionsList.retryWithOriginalWorkflow")),1)]),_:1},8,["class"])):L("",!0),h(V,{"data-test-id":"execution-delete-dropdown-item",class:u(x.$style.deleteAction),command:"delete"},{default:w(()=>[H(r(n(l).baseText("generic.delete")),1)]),_:1},8,["class"])]),_:1},8,["class"])]),default:w(()=>[h(Q,{text:"",type:"tertiary",size:"mini",icon:"ellipsis-v"})]),_:1}))])],2)}}}),Be="_executionListItem_jgpi5_1",Ve="_crashed_jgpi5_30",He="_error_jgpi5_30",Fe="_success_jgpi5_33",Ue="_running_jgpi5_36",Ge="_waiting_jgpi5_39",Pe="_unknown_jgpi5_42",qe="_link_jgpi5_46",Je="_statusColumn_jgpi5_52",Xe="_spinner_jgpi5_57",Ke="_status_jgpi5_52",Qe="_buttonCell_jgpi5_83",Ye={executionListItem:Be,crashed:Ve,error:He,success:Fe,new:"_new_jgpi5_36",running:Ue,waiting:Ge,unknown:Pe,link:qe,statusColumn:Je,spinner:Xe,status:Ke,buttonCell:Qe},Ze={$style:Ye},et=ce(Re,[["__cssModules",Ze]]),tt={key:1},st=t("th",null,null,-1),ot=t("th",null,null,-1),nt=t("th",null,null,-1),lt=t("th",null,null,-1),it=ee({__name:"GlobalExecutionsList",props:{executions:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},total:{type:Number,default:0},estimated:{type:Boolean,default:!1}},emits:["closeModal","execution:stop","update:autoRefresh","update:filters"],setup(o,{emit:S}){const p=o,c=S,s=te(),l=ae(),$=ne(),m=le(),_=j(!1),y=j(!1),f=j(!1),d=j({}),D=Ee(),k=ie(),I=T(()=>f.value?p.total:Object.keys(d.value).length),N=T(()=>[{id:"all",name:s.baseText("executionsList.allWorkflows")},...$.allWorkflows]);xe(()=>p.executions,()=>{p.executions.length===0&&M(),R()}),oe(()=>{_.value=!0});function E(){f.value=!f.value,y.value=!f.value,O()}function O(){y.value=!y.value,y.value?z():(f.value=!1,d.value={})}function P(e){const a=e.id;if(d.value[a]){const{[a]:A,...W}=d.value;d.value=W}else d.value={...d.value,[a]:!0};y.value=Object.keys(d.value).length===p.executions.length,f.value=Object.keys(d.value).length===p.total}async function F(){if(await D.confirm(s.baseText("executionsList.confirmMessage.message",{interpolate:{count:I.value.toString()}}),s.baseText("executionsList.confirmMessage.headline"),{type:"warning",confirmButtonText:s.baseText("executionsList.confirmMessage.confirmButtonText"),cancelButtonText:s.baseText("executionsList.confirmMessage.cancelButtonText")})===_e){try{await m.deleteExecutions({filters:m.executionsFilters,...f.value?{deleteBefore:p.executions[0].startedAt}:{ids:Object.keys(d.value)}})}catch(a){k.showError(a,s.baseText("executionsList.showError.handleDeleteSelected.title"));return}k.showMessage({title:s.baseText("executionsList.showMessage.handleDeleteSelected.title"),type:"success"}),M()}}function M(){y.value=!1,f.value=!1,d.value={}}async function q(e){c("update:filters",e),M()}function J(e){return X(e.workflowId??"")??s.baseText("executionsList.unsavedWorkflow")}function X(e){var a;return(a=N.value.find(A=>A.id===e))==null?void 0:a.name}async function x(){if(m.filters.status==="running")return;let e;p.executions.length!==0&&(e=p.executions.slice(-1)[0].id);try{await m.fetchExecutions(m.executionsFilters,e)}catch(a){k.showError(a,s.baseText("executionsList.showError.loadMore.title"))}}function z(){p.executions.forEach(e=>{d.value[e.id]=!0})}function R(){f.value&&(y.value=!0,z())}async function U(e){await B(e,!0)}async function K(e){await B(e,!1)}async function B(e,a){try{await m.retryExecution(e.id,a)?k.showMessage({title:s.baseText("executionsList.showMessage.retrySuccessfulTrue.title"),type:"success"}):k.showMessage({title:s.baseText("executionsList.showMessage.retrySuccessfulFalse.title"),type:"error"})}catch(A){k.showError(A,s.baseText("executionsList.showError.retryExecution.title"))}l.track("User clicked retry execution button",{workflow_id:$.workflowId,execution_id:e.id,retry_type:a?"current":"original"})}async function G(e){try{await m.stopCurrentExecution(e.id),k.showMessage({title:s.baseText("executionsList.showMessage.stopExecution.title"),message:s.baseText("executionsList.showMessage.stopExecution.message",{interpolate:{activeExecutionId:e.id}}),type:"success"}),c("execution:stop")}catch(a){k.showError(a,s.baseText("executionsList.showError.stopExecution.title"))}}async function Q(e){try{if(await m.deleteExecutions({ids:[e.id]}),y.value){const{[e.id]:a,...A}=d.value;d.value=A}}catch(a){k.showError(a,s.baseText("executionsList.showError.handleDeleteSelected.title"))}}async function V(e){e?await m.startAutoRefreshInterval():m.stopAutoRefreshInterval()}return(e,a)=>{const A=g("N8nHeading"),W=g("N8nLoading"),se=g("ElCheckbox"),ue=g("el-checkbox"),Y=g("N8nButton");return i(),v("div",{class:u(e.$style.execListWrapper)},[t("div",{class:u(e.$style.execList)},[t("div",{class:u(e.$style.execListHeader)},[h(A,{tag:"h1",size:"2xlarge"},{default:w(()=>[H(r(n(s).baseText("executionsList.workflowExecutions")),1)]),_:1}),t("div",{class:u(e.$style.execListHeaderControls)},[_.value?(i(),b(se,{key:1,modelValue:n(m).autoRefresh,"onUpdate:modelValue":[a[0]||(a[0]=C=>n(m).autoRefresh=C),a[1]||(a[1]=C=>V(C))],class:"mr-xl","data-test-id":"execution-auto-refresh-checkbox"},{default:w(()=>[H(r(n(s).baseText("executionsList.autoRefresh")),1)]),_:1},8,["modelValue"])):(i(),b(W,{key:0,class:u(e.$style.filterLoader),variant:"custom"},null,8,["class"])),me(h(ge,{workflows:N.value,onFilterChanged:q},null,8,["workflows"]),[[fe,_.value]])],2)],2),y.value&&o.total>0?(i(),b(se,{key:0,class:u(e.$style.selectAll),label:n(s).baseText("executionsList.selectAll",{adjustToNumber:o.total,interpolate:{executionNum:`${o.total}`}}),"model-value":f.value,"data-test-id":"select-all-executions-checkbox","onUpdate:modelValue":E},null,8,["class","label","model-value"])):L("",!0),_.value?(i(),v("table",{key:2,class:u(e.$style.execTable)},[t("thead",null,[t("tr",null,[t("th",null,[h(ue,{"model-value":y.value,disabled:o.total<1,label:"","data-test-id":"select-visible-executions-checkbox","onUpdate:modelValue":O},null,8,["model-value","disabled"])]),t("th",null,r(n(s).baseText("executionsList.name")),1),t("th",null,r(n(s).baseText("executionsList.startedAt")),1),t("th",null,r(n(s).baseText("executionsList.status")),1),t("th",null,r(n(s).baseText("executionsList.id")),1),st,ot,nt,lt])]),h(we,{tag:"tbody",name:"executions-list"},{default:w(()=>[(i(!0),v(pe,null,ye(o.executions,C=>(i(),b(et,{key:C.id,execution:C,"workflow-name":J(C),selected:d.value[C.id]||f.value,onStop:G,onDelete:Q,onSelect:P,onRetrySaved:U,onRetryOriginal:K},null,8,["execution","workflow-name","selected"]))),128))]),_:1})],2)):(i(),v("div",tt,[h(W,{class:u(e.$style.tableLoader),variant:"custom"},null,8,["class"]),h(W,{class:u(e.$style.tableLoader),variant:"custom"},null,8,["class"]),h(W,{class:u(e.$style.tableLoader),variant:"custom"},null,8,["class"])])),!o.executions.length&&_.value&&!n(m).loading?(i(),v("div",{key:3,class:u(e.$style.loadedAll),"data-test-id":"execution-list-empty"},r(n(s).baseText("executionsList.empty")),3)):o.total>o.executions.length||o.estimated?(i(),v("div",{key:4,class:u(e.$style.loadMore)},[h(Y,{icon:"sync",title:n(s).baseText("executionsList.loadMore"),label:n(s).baseText("executionsList.loadMore"),loading:n(m).loading,"data-test-id":"load-more-button",onClick:a[2]||(a[2]=C=>x())},null,8,["title","label","loading"])],2)):_.value&&!n(m).loading?(i(),v("div",{key:5,class:u(e.$style.loadedAll),"data-test-id":"execution-all-loaded"},r(n(s).baseText("executionsList.loadedAll")),3)):L("",!0)],2),I.value>0?(i(),v("div",{key:0,class:u(e.$style.selectionOptions),"data-test-id":"selected-executions-info"},[t("span",null,r(n(s).baseText("executionsList.selected",{adjustToNumber:I.value,interpolate:{count:`${I.value}`}})),1),h(Y,{label:n(s).baseText("generic.delete"),type:"tertiary","data-test-id":"delete-selected-button",onClick:F},null,8,["label"]),h(Y,{label:n(s).baseText("executionsList.clearSelection"),type:"tertiary","data-test-id":"clear-selection-button",onClick:M},null,8,["label"])],2)):L("",!0)],2)}}}),at="_execListWrapper_1xozp_1",ct="_execList_1xozp_1",ut="_execListHeader_1xozp_22",rt="_execListHeaderControls_1xozp_29",dt="_selectionOptions_1xozp_35",xt="_execTable_1xozp_53",mt="_loadMore_1xozp_96",ft="_loadedAll_1xozp_102",pt="_actions_1xozp_109",yt="_deleteOnly_1xozp_109",wt="_retryAction_1xozp_113",bt="_deleteAction_1xozp_113",ht="_selectAll_1xozp_117",vt="_filterLoader_1xozp_123",gt="_tableLoader_1xozp_128",kt={execListWrapper:at,execList:ct,execListHeader:ut,execListHeaderControls:rt,selectionOptions:dt,execTable:xt,loadMore:mt,loadedAll:ft,actions:pt,deleteOnly:yt,retryAction:wt,deleteAction:bt,selectAll:ht,filterLoader:vt,tableLoader:gt},Lt={$style:kt},Tt=ce(it,[["__cssModules",Lt]]),os=ee({__name:"ExecutionsView",setup(o){const S=te(),p=ae(),c=Ce(),s=ne(),l=le(),$=ie();j(!1);const{executionsCount:m,executionsCountEstimated:_,filters:y,allExecutions:f}=$e(l);be(async()=>{await d(),c.run("executionsList.openDialog"),p.track("User opened Executions log",{workflow_id:s.workflowId})}),oe(async()=>{Ae(`n8n - ${S.baseText("executionsList.workflowExecutions")}`),document.addEventListener("visibilitychange",D),await l.initialize()}),he(()=>{l.reset(),document.removeEventListener("visibilitychange",D)});async function d(){try{await s.fetchAllWorkflows()}catch(E){$.showError(E,S.baseText("executionsList.showError.loadWorkflows.title"))}}function D(){document.visibilityState==="hidden"?l.stopAutoRefreshInterval():l.startAutoRefreshInterval()}async function k(){try{await l.fetchExecutions()}catch(E){$.showError(E,S.baseText("executionsList.showError.refreshData.title"))}}async function I(E){l.reset(),l.setFilters(E),await l.initialize()}async function N(){await k()}return(E,O)=>(i(),b(Tt,{executions:n(f),filters:n(y),total:n(m),"estimated-total":n(_),"onExecution:stop":N,"onUpdate:filters":I},null,8,["executions","filters","total","estimated-total"]))}});export{os as default};
//# sourceMappingURL=ExecutionsView-Bztejjur.js.map
