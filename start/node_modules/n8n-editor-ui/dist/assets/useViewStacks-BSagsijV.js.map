{"version":3,"file":"useViewStacks-BSagsijV.js","sources":["../../src/components/Node/NodeCreator/viewsData.ts","../../src/components/Node/NodeCreator/composables/useKeyboardNavigation.ts","../../src/components/Node/NodeCreator/composables/useViewStacks.ts"],"sourcesContent":["import {\n\tCORE_NODES_CATEGORY,\n\tWEBHOOK_NODE_TYPE,\n\tOTHER_TRIGGER_NODES_SUBCATEGORY,\n\tEXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\tFORM_TRIGGER_NODE_TYPE,\n\tMANUAL_TRIGGER_NODE_TYPE,\n\tMANUAL_CHAT_TRIGGER_NODE_TYPE,\n\tSCHEDULE_TRIGGER_NODE_TYPE,\n\tREGULAR_NODE_CREATOR_VIEW,\n\tTRANSFORM_DATA_SUBCATEGORY,\n\tFLOWS_CONTROL_SUBCATEGORY,\n\tTRIGGER_NODE_CREATOR_VIEW,\n\tEMAIL_IMAP_NODE_TYPE,\n\tDEFAULT_SUBCATEGORY,\n\tAI_NODE_CREATOR_VIEW,\n\tAI_CATEGORY_AGENTS,\n\tAI_CATEGORY_CHAINS,\n\tAI_CATEGORY_DOCUMENT_LOADERS,\n\tAI_CATEGORY_LANGUAGE_MODELS,\n\tAI_CATEGORY_MEMORY,\n\tAI_CATEGORY_OUTPUTPARSER,\n\tAI_CATEGORY_RETRIEVERS,\n\tAI_CATEGORY_TEXT_SPLITTERS,\n\tAI_CATEGORY_TOOLS,\n\tAI_CATEGORY_VECTOR_STORES,\n\tAI_SUBCATEGORY,\n\tAI_CATEGORY_EMBEDDING,\n\tAI_OTHERS_NODE_CREATOR_VIEW,\n\tAI_UNCATEGORIZED_CATEGORY,\n\tCONVERT_TO_FILE_NODE_TYPE,\n\tEXTRACT_FROM_FILE_NODE_TYPE,\n\tSET_NODE_TYPE,\n\tCODE_NODE_TYPE,\n\tDATETIME_NODE_TYPE,\n\tFILTER_NODE_TYPE,\n\tREMOVE_DUPLICATES_NODE_TYPE,\n\tSPLIT_OUT_NODE_TYPE,\n\tLIMIT_NODE_TYPE,\n\tSUMMARIZE_NODE_TYPE,\n\tAGGREGATE_NODE_TYPE,\n\tMERGE_NODE_TYPE,\n\tHTML_NODE_TYPE,\n\tMARKDOWN_NODE_TYPE,\n\tXML_NODE_TYPE,\n\tCRYPTO_NODE_TYPE,\n\tIF_NODE_TYPE,\n\tSPLIT_IN_BATCHES_NODE_TYPE,\n\tHTTP_REQUEST_NODE_TYPE,\n\tHELPERS_SUBCATEGORY,\n\tRSS_READ_NODE_TYPE,\n\tEMAIL_SEND_NODE_TYPE,\n\tEDIT_IMAGE_NODE_TYPE,\n\tCOMPRESSION_NODE_TYPE,\n\tAI_CODE_TOOL_LANGCHAIN_NODE_TYPE,\n\tAI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE,\n} from '@/constants';\nimport { useI18n } from '@/composables/useI18n';\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\nimport type { SimplifiedNodeType } from '@/Interface';\nimport type { INodeTypeDescription } from 'n8n-workflow';\nimport { NodeConnectionType } from 'n8n-workflow';\nimport { useTemplatesStore } from '@/stores/templates.store';\n\nexport interface NodeViewItemSection {\n\tkey: string;\n\ttitle: string;\n\titems: string[];\n}\n\nexport interface NodeViewItem {\n\tkey: string;\n\ttype: string;\n\tproperties: {\n\t\tname?: string;\n\t\ttitle?: string;\n\t\ticon?: string;\n\t\ticonProps?: {\n\t\t\tcolor?: string;\n\t\t};\n\t\turl?: string;\n\t\tconnectionType?: NodeConnectionType;\n\t\tpanelClass?: string;\n\t\tgroup?: string[];\n\t\tsections?: NodeViewItemSection[];\n\t\tdescription?: string;\n\t\tdisplayName?: string;\n\t\ttag?: {\n\t\t\ttype: string;\n\t\t\ttext: string;\n\t\t};\n\t\tforceIncludeNodes?: string[];\n\t\ticonData?: {\n\t\t\ttype: string;\n\t\t\ticon?: string;\n\t\t\tfileBuffer?: string;\n\t\t};\n\t};\n\tcategory?: string | string[];\n}\n\ninterface NodeView {\n\tvalue: string;\n\ttitle: string;\n\tinfo?: string;\n\tsubtitle?: string;\n\titems: NodeViewItem[];\n}\n\nfunction getAiNodesBySubcategory(nodes: INodeTypeDescription[], subcategory: string) {\n\treturn nodes\n\t\t.filter(\n\t\t\t(node) => !node.hidden && node.codex?.subcategories?.[AI_SUBCATEGORY]?.includes(subcategory),\n\t\t)\n\t\t.map((node) => ({\n\t\t\tkey: node.name,\n\t\t\ttype: 'node',\n\t\t\tproperties: {\n\t\t\t\tgroup: [],\n\t\t\t\tname: node.name,\n\t\t\t\tdisplayName: node.displayName,\n\t\t\t\ttitle: node.displayName,\n\t\t\t\tdescription: node.description,\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\ticon: node.icon!,\n\t\t\t\ticonData: node.name.toLowerCase().includes('openai')\n\t\t\t\t\t? {\n\t\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\t\ticon: 'openai',\n\t\t\t\t\t\t\tfileBuffer: '/static/open-ai.svg',\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t},\n\t\t}))\n\t\t.sort((a, b) => a.properties.displayName.localeCompare(b.properties.displayName));\n}\n\nexport function AIView(_nodes: SimplifiedNodeType[]): NodeView {\n\tconst i18n = useI18n();\n\tconst nodeTypesStore = useNodeTypesStore();\n\tconst templatesStore = useTemplatesStore();\n\n\tconst chainNodes = getAiNodesBySubcategory(nodeTypesStore.allLatestNodeTypes, AI_CATEGORY_CHAINS);\n\tconst agentNodes = getAiNodesBySubcategory(nodeTypesStore.allLatestNodeTypes, AI_CATEGORY_AGENTS);\n\n\treturn {\n\t\tvalue: AI_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiNodes'),\n\t\tsubtitle: i18n.baseText('nodeCreator.aiPanel.selectAiNode'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: 'ai_templates_root',\n\t\t\t\ttype: 'link',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.linkItem.title'),\n\t\t\t\t\ticon: 'box-open',\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.linkItem.description'),\n\t\t\t\t\tname: 'ai_templates_root',\n\t\t\t\t\turl: templatesStore.getWebsiteCategoryURL(undefined, 'AdvancedAI'),\n\t\t\t\t\ttag: {\n\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\ttext: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerTag'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t...agentNodes,\n\t\t\t...chainNodes,\n\t\t\t{\n\t\t\t\tkey: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\t\t\ttype: 'view',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiOtherNodes'),\n\t\t\t\t\ticon: 'robot',\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.aiOtherNodesDescription'),\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n}\n\nexport function AINodesView(_nodes: SimplifiedNodeType[]): NodeView {\n\tconst i18n = useI18n();\n\n\tfunction getAISubcategoryProperties(nodeConnectionType: NodeConnectionType) {\n\t\treturn {\n\t\t\tconnectionType: nodeConnectionType,\n\t\t\ticonProps: {\n\t\t\t\tcolor: `var(--node-type-${nodeConnectionType}-color)`,\n\t\t\t},\n\t\t\tpanelClass: `nodes-list-panel-${nodeConnectionType}`,\n\t\t};\n\t}\n\n\treturn {\n\t\tvalue: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiOtherNodes'),\n\t\tsubtitle: i18n.baseText('nodeCreator.aiPanel.selectAiNode'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_DOCUMENT_LOADERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_DOCUMENT_LOADERS,\n\t\t\t\t\ticon: 'file-import',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiDocument),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_LANGUAGE_MODELS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_LANGUAGE_MODELS,\n\t\t\t\t\ticon: 'language',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiLanguageModel),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_MEMORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_MEMORY,\n\t\t\t\t\ticon: 'brain',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiMemory),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_OUTPUTPARSER,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_OUTPUTPARSER,\n\t\t\t\t\ticon: 'list',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiOutputParser),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_RETRIEVERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_RETRIEVERS,\n\t\t\t\t\ticon: 'search',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiRetriever),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_TEXT_SPLITTERS,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_TEXT_SPLITTERS,\n\t\t\t\t\ticon: 'grip-lines-vertical',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiTextSplitter),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: AI_CATEGORY_TOOLS,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_TOOLS,\n\t\t\t\t\ticon: 'tools',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiTool),\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [AI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE, AI_CODE_TOOL_LANGCHAIN_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_EMBEDDING,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_EMBEDDING,\n\t\t\t\t\ticon: 'vector-square',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiEmbedding),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_CATEGORY_VECTOR_STORES,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_CATEGORY_VECTOR_STORES,\n\t\t\t\t\ticon: 'project-diagram',\n\t\t\t\t\t...getAISubcategoryProperties(NodeConnectionType.AiVectorStore),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: AI_UNCATEGORIZED_CATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: AI_UNCATEGORIZED_CATEGORY,\n\t\t\t\t\ticon: 'code',\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n}\n\nexport function TriggerView() {\n\tconst i18n = useI18n();\n\n\tconst view: NodeView = {\n\t\tvalue: TRIGGER_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.selectATrigger'),\n\t\tsubtitle: i18n.baseText('nodeCreator.triggerHelperPanel.selectATriggerDescription'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: MANUAL_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: MANUAL_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.manualTriggerDescription'),\n\t\t\t\t\ticon: 'fa:mouse-pointer',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: DEFAULT_SUBCATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\tforceIncludeNodes: [WEBHOOK_NODE_TYPE, EMAIL_IMAP_NODE_TYPE],\n\t\t\t\t\ttitle: 'App Trigger Nodes',\n\t\t\t\t\ticon: 'satellite-dish',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: SCHEDULE_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: SCHEDULE_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.scheduleTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.scheduleTriggerDescription'),\n\t\t\t\t\ticon: 'fa:clock',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: WEBHOOK_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: WEBHOOK_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.webhookTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.webhookTriggerDescription'),\n\t\t\t\t\ticonData: {\n\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\ticon: 'webhook',\n\t\t\t\t\t\tfileBuffer: '/static/webhook-icon.svg',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: FORM_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: FORM_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.formTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.formTriggerDescription'),\n\t\t\t\t\ticonData: {\n\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\ticon: 'form',\n\t\t\t\t\t\tfileBuffer: '/static/form-grey.svg',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.workflowTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.workflowTriggerDescription'),\n\t\t\t\t\ticon: 'fa:sign-out-alt',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: MANUAL_CHAT_TRIGGER_NODE_TYPE,\n\t\t\t\ttype: 'node',\n\t\t\t\tcategory: [CORE_NODES_CATEGORY],\n\t\t\t\tproperties: {\n\t\t\t\t\tgroup: [],\n\t\t\t\t\tname: MANUAL_CHAT_TRIGGER_NODE_TYPE,\n\t\t\t\t\tdisplayName: i18n.baseText('nodeCreator.triggerHelperPanel.manualChatTriggerDisplayName'),\n\t\t\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.manualChatTriggerDescription'),\n\t\t\t\t\ticon: 'fa:comments',\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: OTHER_TRIGGER_NODES_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: OTHER_TRIGGER_NODES_SUBCATEGORY,\n\t\t\t\t\ticon: 'folder-open',\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n\n\treturn view;\n}\n\nexport function RegularView(nodes: SimplifiedNodeType[]) {\n\tconst i18n = useI18n();\n\n\tconst view: NodeView = {\n\t\tvalue: REGULAR_NODE_CREATOR_VIEW,\n\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.whatHappensNext'),\n\t\titems: [\n\t\t\t{\n\t\t\t\tkey: DEFAULT_SUBCATEGORY,\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: 'App Regular Nodes',\n\t\t\t\t\ticon: 'globe',\n\t\t\t\t\tforceIncludeNodes: [RSS_READ_NODE_TYPE, EMAIL_SEND_NODE_TYPE],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: TRANSFORM_DATA_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: TRANSFORM_DATA_SUBCATEGORY,\n\t\t\t\t\ticon: 'pen',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [SET_NODE_TYPE, CODE_NODE_TYPE, DATETIME_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'addOrRemove',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.addOrRemove'),\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\tFILTER_NODE_TYPE,\n\t\t\t\t\t\t\t\tREMOVE_DUPLICATES_NODE_TYPE,\n\t\t\t\t\t\t\t\tSPLIT_OUT_NODE_TYPE,\n\t\t\t\t\t\t\t\tLIMIT_NODE_TYPE,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'combine',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.combine'),\n\t\t\t\t\t\t\titems: [SUMMARIZE_NODE_TYPE, AGGREGATE_NODE_TYPE, MERGE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'convert',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.transform.convert'),\n\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\tHTML_NODE_TYPE,\n\t\t\t\t\t\t\t\tMARKDOWN_NODE_TYPE,\n\t\t\t\t\t\t\t\tXML_NODE_TYPE,\n\t\t\t\t\t\t\t\tCRYPTO_NODE_TYPE,\n\t\t\t\t\t\t\t\tEXTRACT_FROM_FILE_NODE_TYPE,\n\t\t\t\t\t\t\t\tCONVERT_TO_FILE_NODE_TYPE,\n\t\t\t\t\t\t\t\tCOMPRESSION_NODE_TYPE,\n\t\t\t\t\t\t\t\tEDIT_IMAGE_NODE_TYPE,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: FLOWS_CONTROL_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: FLOWS_CONTROL_SUBCATEGORY,\n\t\t\t\t\ticon: 'code-branch',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [FILTER_NODE_TYPE, IF_NODE_TYPE, SPLIT_IN_BATCHES_NODE_TYPE, MERGE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'subcategory',\n\t\t\t\tkey: HELPERS_SUBCATEGORY,\n\t\t\t\tcategory: CORE_NODES_CATEGORY,\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: HELPERS_SUBCATEGORY,\n\t\t\t\t\ticon: 'toolbox',\n\t\t\t\t\tsections: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: 'popular',\n\t\t\t\t\t\t\ttitle: i18n.baseText('nodeCreator.sectionNames.popular'),\n\t\t\t\t\t\t\titems: [HTTP_REQUEST_NODE_TYPE, WEBHOOK_NODE_TYPE, CODE_NODE_TYPE],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t};\n\n\tconst hasAINodes = (nodes ?? []).some((node) => node.codex?.categories?.includes(AI_SUBCATEGORY));\n\tif (hasAINodes)\n\t\tview.items.push({\n\t\t\tkey: AI_NODE_CREATOR_VIEW,\n\t\t\ttype: 'view',\n\t\t\tproperties: {\n\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.langchainAiNodes'),\n\t\t\t\ticon: 'robot',\n\t\t\t\tdescription: i18n.baseText('nodeCreator.aiPanel.nodesForAi'),\n\t\t\t\ttag: {\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\ttext: i18n.baseText('nodeCreator.aiPanel.newTag'),\n\t\t\t\t},\n\t\t\t\tborderless: true,\n\t\t\t},\n\t\t} as NodeViewItem);\n\n\tview.items.push({\n\t\tkey: TRIGGER_NODE_CREATOR_VIEW,\n\t\ttype: 'view',\n\t\tproperties: {\n\t\t\ttitle: i18n.baseText('nodeCreator.triggerHelperPanel.addAnotherTrigger'),\n\t\t\ticon: 'bolt',\n\t\t\tdescription: i18n.baseText('nodeCreator.triggerHelperPanel.addAnotherTriggerDescription'),\n\t\t},\n\t});\n\n\treturn view;\n}\n","import { ref } from 'vue';\nimport { defineStore } from 'pinia';\n\nexport type KeyboardKey = (typeof WATCHED_KEYS)[number];\ninterface KeyHook {\n\tkeyboardKeys: KeyboardKey[];\n\tcondition?: (type: string, activeItemId: string) => boolean;\n\thandler: (activeItemId: string, keyboardKey: KeyboardKey) => void;\n}\n\nexport const KEYBOARD_ID_ATTR = 'data-keyboard-nav-id';\nexport const WATCHED_KEYS = [\n\t'ArrowUp',\n\t'ArrowDown',\n\t'ArrowLeft',\n\t'ArrowRight',\n\t'Enter',\n\t'Escape',\n\t'Tab',\n];\n\nexport const useKeyboardNavigation = defineStore('nodeCreatorKeyboardNavigation', () => {\n\tconst selectableItems = ref<Array<WeakRef<Element>>>([]);\n\tconst activeItemId = ref<string | null>(null);\n\t// Array of objects that contains key code and handler\n\tconst keysHooks = ref<Record<string, KeyHook>>({});\n\n\tfunction getItemType(element?: Element) {\n\t\treturn element?.getAttribute('data-keyboard-nav-type');\n\t}\n\tfunction getElementId(element?: Element) {\n\t\treturn element?.getAttribute(KEYBOARD_ID_ATTR) || undefined;\n\t}\n\tasync function refreshSelectableItems(): Promise<void> {\n\t\treturn await new Promise((resolve) => {\n\t\t\t// Wait for DOM to update\n\t\t\tcleanupSelectableItems();\n\t\t\tsetTimeout(() => {\n\t\t\t\tselectableItems.value = Array.from(\n\t\t\t\t\tdocument.querySelectorAll('[data-keyboard-nav-type]'),\n\t\t\t\t).map((el) => new WeakRef(el));\n\t\t\t\tresolve();\n\t\t\t}, 0);\n\t\t});\n\t}\n\n\tfunction executeKeyHooks(keyboardKey: KeyboardKey, activeItem: Element) {\n\t\tconst flatHooks = Object.values(keysHooks.value);\n\t\tconst hooks = flatHooks.filter((hook) => hook.keyboardKeys.includes(keyboardKey));\n\n\t\thooks.forEach((hook) => {\n\t\t\tif (!activeItemId.value) return;\n\n\t\t\tconst conditionPassed =\n\t\t\t\thook.condition === undefined ||\n\t\t\t\thook.condition(getItemType(activeItem) || '', activeItemId.value);\n\n\t\t\tif (conditionPassed && activeItemId.value) {\n\t\t\t\thook.handler(activeItemId.value, keyboardKey);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync function onKeyDown(e: KeyboardEvent) {\n\t\tconst pressedKey = e.key;\n\t\tif (!WATCHED_KEYS.includes(pressedKey)) return;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tawait refreshSelectableItems();\n\t\tconst activeItemIndex = selectableItems.value.findIndex(\n\t\t\t(item) => getElementId(item?.deref()) === activeItemId.value,\n\t\t);\n\t\tconst activeItem = selectableItems.value[activeItemIndex]?.deref();\n\n\t\tconst isArrowDown = pressedKey === 'ArrowDown';\n\t\tconst isArrowUp = pressedKey === 'ArrowUp';\n\n\t\tif (!activeItem) return;\n\n\t\tif (isArrowDown) {\n\t\t\tconst nextItemIndex =\n\t\t\t\tactiveItemIndex < selectableItems.value.length - 1 ? activeItemIndex + 1 : 0;\n\n\t\t\tsetActiveItem(selectableItems.value[nextItemIndex]?.deref());\n\t\t}\n\t\tif (isArrowUp) {\n\t\t\tconst previousIndex =\n\t\t\t\tactiveItemIndex > 0 ? activeItemIndex - 1 : selectableItems.value.length - 1;\n\n\t\t\tsetActiveItem(selectableItems.value[previousIndex]?.deref());\n\t\t}\n\t\texecuteKeyHooks(pressedKey, activeItem);\n\t}\n\n\tfunction setActiveItemId(id: string) {\n\t\tactiveItemId.value = id;\n\t}\n\n\tfunction setActiveItem(item?: Element) {\n\t\tconst itemId = getElementId(item);\n\t\tif (!itemId) return;\n\n\t\tsetActiveItemId(itemId);\n\t\tif (item?.scrollIntoView) {\n\t\t\titem?.scrollIntoView({ block: 'center' });\n\t\t}\n\t}\n\n\tasync function setActiveItemIndex(index: number) {\n\t\tawait refreshSelectableItems();\n\n\t\tsetActiveItem(selectableItems.value[index]?.deref());\n\t}\n\n\tfunction attachKeydownEvent() {\n\t\tdocument.addEventListener('keydown', onKeyDown, { capture: true });\n\t}\n\n\tfunction detachKeydownEvent() {\n\t\tcleanupSelectableItems();\n\t\tdocument.removeEventListener('keydown', onKeyDown, { capture: true });\n\t}\n\n\tfunction registerKeyHook(name: string, hook: KeyHook) {\n\t\thook.keyboardKeys.forEach((keyboardKey) => {\n\t\t\tif (WATCHED_KEYS.includes(keyboardKey)) {\n\t\t\t\tkeysHooks.value = { ...keysHooks.value, [name]: hook };\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Key ${keyboardKey} is not supported`);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction cleanupSelectableItems() {\n\t\t// Cleanup to make sure DOM elements get garbage collected\n\t\tselectableItems.value = [];\n\t}\n\n\tfunction getActiveItemIndex() {\n\t\treturn selectableItems.value.findIndex(\n\t\t\t(item) => getElementId(item?.deref()) === activeItemId.value,\n\t\t);\n\t}\n\n\treturn {\n\t\tactiveItemId,\n\t\tattachKeydownEvent,\n\t\trefreshSelectableItems,\n\t\tdetachKeydownEvent,\n\t\tregisterKeyHook,\n\t\tgetActiveItemIndex,\n\t\tsetActiveItemId,\n\t\tsetActiveItemIndex,\n\t};\n});\n","import type {\n\tINodeCreateElement,\n\tNodeCreateElement,\n\tNodeFilterType,\n\tSimplifiedNodeType,\n} from '@/Interface';\nimport {\n\tAI_CATEGORY_ROOT_NODES,\n\tAI_CODE_NODE_TYPE,\n\tAI_NODE_CREATOR_VIEW,\n\tAI_OTHERS_NODE_CREATOR_VIEW,\n\tAI_SUBCATEGORY,\n\tDEFAULT_SUBCATEGORY,\n\tTRIGGER_NODE_CREATOR_VIEW,\n} from '@/constants';\nimport { defineStore } from 'pinia';\nimport { v4 as uuid } from 'uuid';\nimport { computed, nextTick, ref } from 'vue';\nimport difference from 'lodash-es/difference';\n\nimport { useNodeCreatorStore } from '@/stores/nodeCreator.store';\n\nimport {\n\tflattenCreateElements,\n\tgroupItemsInSections,\n\tisAINode,\n\tsearchNodes,\n\tsortNodeCreateElements,\n\tsubcategorizeItems,\n\ttransformNodeType,\n} from '../utils';\n\nimport type { NodeViewItem, NodeViewItemSection } from '@/components/Node/NodeCreator/viewsData';\nimport { AINodesView } from '@/components/Node/NodeCreator/viewsData';\nimport { useI18n } from '@/composables/useI18n';\nimport { useKeyboardNavigation } from './useKeyboardNavigation';\n\nimport { useNodeTypesStore } from '@/stores/nodeTypes.store';\nimport type { INodeInputFilter, NodeConnectionType } from 'n8n-workflow';\nimport { useCanvasStore } from '@/stores/canvas.store';\n\ninterface ViewStack {\n\tuuid?: string;\n\ttitle?: string;\n\tsubtitle?: string;\n\tsearch?: string;\n\tsubcategory?: string;\n\tinfo?: string;\n\tnodeIcon?: {\n\t\ticonType?: string;\n\t\ticon?: string;\n\t\tcolor?: string;\n\t};\n\ticonUrl?: string;\n\trootView?: NodeFilterType;\n\tactiveIndex?: number;\n\ttransitionDirection?: 'in' | 'out';\n\thasSearch?: boolean;\n\tpreventBack?: boolean;\n\titems?: INodeCreateElement[];\n\tbaselineItems?: INodeCreateElement[];\n\tsearchItems?: SimplifiedNodeType[];\n\tforceIncludeNodes?: string[];\n\tmode?: 'actions' | 'nodes';\n\tbaseFilter?: (item: INodeCreateElement) => boolean;\n\titemsMapper?: (item: INodeCreateElement) => INodeCreateElement;\n\tpanelClass?: string;\n\tsections?: string[] | NodeViewItemSection[];\n}\n\nexport const useViewStacks = defineStore('nodeCreatorViewStacks', () => {\n\tconst nodeCreatorStore = useNodeCreatorStore();\n\tconst { getActiveItemIndex } = useKeyboardNavigation();\n\tconst i18n = useI18n();\n\n\tconst viewStacks = ref<ViewStack[]>([]);\n\n\tconst activeStackItems = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\n\t\tif (!stack?.baselineItems) {\n\t\t\treturn stack.items ? extendItemsWithUUID(stack.items) : [];\n\t\t}\n\n\t\tif (stack.search && searchBaseItems.value) {\n\t\t\tconst searchBase =\n\t\t\t\tsearchBaseItems.value.length > 0\n\t\t\t\t\t? searchBaseItems.value\n\t\t\t\t\t: flattenCreateElements(stack.baselineItems ?? []);\n\n\t\t\tconst canvasHasAINodes = useCanvasStore().aiNodes.length > 0;\n\t\t\tconst filteredNodes =\n\t\t\t\tisAiRootView(stack) || canvasHasAINodes ? searchBase : filterOutAiNodes(searchBase);\n\n\t\t\tconst searchResults = extendItemsWithUUID(searchNodes(stack.search || '', filteredNodes));\n\n\t\t\tconst groupedNodes = groupIfAiNodes(searchResults, false) ?? searchResults;\n\t\t\t// Set the active index to the second item if there's a section\n\t\t\t// as the first item is collapsable\n\t\t\tstack.activeIndex = groupedNodes.some((node) => node.type === 'section') ? 1 : 0;\n\n\t\t\treturn groupedNodes;\n\t\t}\n\t\treturn extendItemsWithUUID(groupIfAiNodes(stack.baselineItems, true));\n\t});\n\n\tconst activeViewStack = computed<ViewStack>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack) return {};\n\n\t\tconst flatBaselineItems = flattenCreateElements(stack.baselineItems ?? []);\n\n\t\treturn {\n\t\t\t...stack,\n\t\t\titems: activeStackItems.value,\n\t\t\thasSearch: flatBaselineItems.length > 8 || stack?.hasSearch,\n\t\t};\n\t});\n\n\tconst activeViewStackMode = computed(\n\t\t() => activeViewStack.value.mode || TRIGGER_NODE_CREATOR_VIEW,\n\t);\n\n\tconst searchBaseItems = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack?.searchItems) return [];\n\n\t\treturn stack.searchItems.map((item) => transformNodeType(item, stack.subcategory));\n\t});\n\n\tfunction getLastActiveStack() {\n\t\treturn viewStacks.value[viewStacks.value.length - 1];\n\t}\n\n\t// Generate a delta between the global search results(all nodes) and the stack search results\n\tconst globalSearchItemsDiff = computed<INodeCreateElement[]>(() => {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack?.search) return [];\n\n\t\tconst allNodes = nodeCreatorStore.mergedNodes.map((item) => transformNodeType(item));\n\t\t// Apply filtering for AI nodes if the current view is not the AI root view\n\t\tconst filteredNodes = isAiRootView(stack) ? allNodes : filterOutAiNodes(allNodes);\n\n\t\tlet globalSearchResult: INodeCreateElement[] = extendItemsWithUUID(\n\t\t\tsearchNodes(stack.search || '', filteredNodes),\n\t\t);\n\t\tif (isAiRootView(stack)) {\n\t\t\tglobalSearchResult = groupIfAiNodes(globalSearchResult);\n\t\t}\n\n\t\tconst filteredItems = globalSearchResult.filter((item) => {\n\t\t\treturn !activeStackItems.value.find((activeItem) => {\n\t\t\t\tif (activeItem.type === 'section') {\n\t\t\t\t\tconst matchingSectionItem = activeItem.children.some(\n\t\t\t\t\t\t(sectionItem) => sectionItem.key === item.key,\n\t\t\t\t\t);\n\t\t\t\t\treturn matchingSectionItem;\n\t\t\t\t}\n\n\t\t\t\treturn activeItem.key === item.key;\n\t\t\t});\n\t\t});\n\n\t\t// Filter out empty sections if all of their children are filtered out\n\t\tconst filteredSections = filteredItems.filter((item) => {\n\t\t\tif (item.type === 'section') {\n\t\t\t\tconst hasVisibleChildren = item.children.some((child) =>\n\t\t\t\t\tactiveStackItems.value.some((filteredItem) => filteredItem.key === child.key),\n\t\t\t\t);\n\n\t\t\t\treturn hasVisibleChildren;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\treturn filteredSections;\n\t});\n\n\tconst itemsBySubcategory = computed(() => subcategorizeItems(nodeCreatorStore.mergedNodes));\n\n\tfunction isAiRootView(stack: ViewStack) {\n\t\treturn stack.rootView === AI_NODE_CREATOR_VIEW;\n\t}\n\n\tfunction groupIfAiNodes(items: INodeCreateElement[], sortAlphabetically = true) {\n\t\tconst aiNodes = items.filter((node): node is NodeCreateElement => isAINode(node));\n\n\t\tif (aiNodes.length > 0) {\n\t\t\tconst sectionsMap = new Map<string, NodeViewItemSection>();\n\t\t\taiNodes.forEach((node) => {\n\t\t\t\tconst section = node.properties.codex?.subcategories?.[AI_SUBCATEGORY]?.[0];\n\n\t\t\t\tif (section) {\n\t\t\t\t\tconst currentItems = sectionsMap.get(section)?.items ?? [];\n\t\t\t\t\tconst isSubnodesSection =\n\t\t\t\t\t\t!node.properties.codex?.subcategories?.[AI_SUBCATEGORY].includes(\n\t\t\t\t\t\t\tAI_CATEGORY_ROOT_NODES,\n\t\t\t\t\t\t);\n\n\t\t\t\t\tsectionsMap.set(section, {\n\t\t\t\t\t\tkey: section,\n\t\t\t\t\t\ttitle: isSubnodesSection\n\t\t\t\t\t\t\t? `${section} (${i18n.baseText('nodeCreator.subnodes')})`\n\t\t\t\t\t\t\t: section,\n\t\t\t\t\t\titems: [...currentItems, node.key],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst nonAiNodes = difference(items, aiNodes);\n\t\t\tconst nonAiTriggerNodes = nonAiNodes.filter(\n\t\t\t\t(item) => item.type === 'node' && useNodeTypesStore().isTriggerNode(item.properties.name),\n\t\t\t);\n\n\t\t\tconst nonAiRegularNodes = difference(nonAiNodes, nonAiTriggerNodes);\n\n\t\t\tif (nonAiNodes.length > 0) {\n\t\t\t\tlet sectionKey = '';\n\t\t\t\tif (nonAiRegularNodes.length && nonAiTriggerNodes.length) {\n\t\t\t\t\tsectionKey = i18n.baseText('nodeCreator.actionsCategory.regularAndTriggers');\n\t\t\t\t} else {\n\t\t\t\t\tsectionKey = nonAiRegularNodes.length\n\t\t\t\t\t\t? i18n.baseText('nodeCreator.actionsCategory.regularNodes')\n\t\t\t\t\t\t: i18n.baseText('nodeCreator.actionsCategory.triggerNodes');\n\t\t\t\t}\n\n\t\t\t\tconst nodesKeys = nonAiNodes.map((node) => node.key);\n\n\t\t\t\tsectionsMap.set(sectionKey, {\n\t\t\t\t\tkey: sectionKey,\n\t\t\t\t\ttitle: sectionKey,\n\t\t\t\t\titems: [...nodesKeys],\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Convert sectionsMap to array of sections\n\t\t\tconst sections = Array.from(sectionsMap.values());\n\n\t\t\treturn groupItemsInSections(items, sections, sortAlphabetically);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tfunction filterOutAiNodes(items: INodeCreateElement[]) {\n\t\tconst filteredSearchBase = items.filter((item) => {\n\t\t\tif (item.type === 'node') {\n\t\t\t\tconst isAICategory = item.properties.codex?.categories?.includes(AI_SUBCATEGORY) === true;\n\n\t\t\t\tif (!isAICategory) return true;\n\n\t\t\t\tconst isRootNodeSubcategory =\n\t\t\t\t\titem.properties.codex?.subcategories?.[AI_SUBCATEGORY]?.includes(AI_CATEGORY_ROOT_NODES);\n\n\t\t\t\treturn isRootNodeSubcategory;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\treturn filteredSearchBase;\n\t}\n\n\tasync function gotoCompatibleConnectionView(\n\t\tconnectionType: NodeConnectionType,\n\t\tisOutput?: boolean,\n\t\tfilter?: INodeInputFilter,\n\t) {\n\t\tlet nodesByConnectionType: { [key: string]: string[] };\n\t\tlet relatedAIView: { properties: NodeViewItem['properties'] } | undefined;\n\n\t\tif (isOutput === true) {\n\t\t\tnodesByConnectionType = useNodeTypesStore().visibleNodeTypesByInputConnectionTypeNames;\n\t\t\trelatedAIView = {\n\t\t\t\tproperties: {\n\t\t\t\t\ttitle: i18n.baseText('nodeCreator.aiPanel.aiNodes'),\n\t\t\t\t\ticon: 'robot',\n\t\t\t\t},\n\t\t\t};\n\t\t} else {\n\t\t\tnodesByConnectionType = useNodeTypesStore().visibleNodeTypesByOutputConnectionTypeNames;\n\n\t\t\trelatedAIView = AINodesView([]).items.find(\n\t\t\t\t(item) => item.properties.connectionType === connectionType,\n\t\t\t);\n\t\t}\n\n\t\tawait nextTick();\n\t\tpushViewStack({\n\t\t\ttitle: relatedAIView?.properties.title,\n\t\t\trootView: AI_OTHERS_NODE_CREATOR_VIEW,\n\t\t\tmode: 'nodes',\n\t\t\titems: nodeCreatorStore.allNodeCreatorNodes,\n\t\t\tnodeIcon: {\n\t\t\t\ticonType: 'icon',\n\t\t\t\ticon: relatedAIView?.properties.icon,\n\t\t\t\tcolor: relatedAIView?.properties.iconProps?.color,\n\t\t\t},\n\t\t\tpanelClass: relatedAIView?.properties.panelClass,\n\t\t\tbaseFilter: (i: INodeCreateElement) => {\n\t\t\t\t// AI Code node could have any connection type so we don't want to display it\n\t\t\t\t// in the compatible connection view as it would be displayed in all of them\n\t\t\t\tif (i.key === AI_CODE_NODE_TYPE) return false;\n\t\t\t\tconst displayNode = nodesByConnectionType[connectionType].includes(i.key);\n\n\t\t\t\t// TODO: Filtering works currently fine for displaying compatible node when dropping\n\t\t\t\t//       input connections. However, it does not work for output connections.\n\t\t\t\t//       For that reason does it currently display nodes that are maybe not compatible\n\t\t\t\t//       but then errors once it got selected by the user.\n\t\t\t\tif (displayNode && filter?.nodes?.length) {\n\t\t\t\t\treturn filter.nodes.includes(i.key);\n\t\t\t\t}\n\n\t\t\t\treturn displayNode;\n\t\t\t},\n\t\t\titemsMapper(item) {\n\t\t\t\treturn {\n\t\t\t\t\t...item,\n\t\t\t\t\tsubcategory: connectionType,\n\t\t\t\t};\n\t\t\t},\n\t\t\tpreventBack: true,\n\t\t});\n\t}\n\n\tfunction setStackBaselineItems() {\n\t\tconst stack = getLastActiveStack();\n\t\tif (!stack || !activeViewStack.value.uuid) return;\n\n\t\tlet stackItems = stack?.items ?? [];\n\n\t\tif (!stack?.items) {\n\t\t\tconst subcategory = stack?.subcategory ?? DEFAULT_SUBCATEGORY;\n\t\t\tconst itemsInSubcategory = itemsBySubcategory.value[subcategory];\n\t\t\tconst sections = stack.sections;\n\n\t\t\tif (sections) {\n\t\t\t\tstackItems = groupItemsInSections(itemsInSubcategory, sections);\n\t\t\t} else {\n\t\t\t\tstackItems = itemsInSubcategory;\n\t\t\t}\n\t\t}\n\n\t\t// Ensure that the nodes specified in `stack.forceIncludeNodes` are always included,\n\t\t// regardless of whether the subcategory is matched\n\t\tif ((stack.forceIncludeNodes ?? []).length > 0) {\n\t\t\tconst matchedNodes = nodeCreatorStore.mergedNodes\n\t\t\t\t.filter((item) => stack.forceIncludeNodes?.includes(item.name))\n\t\t\t\t.map((item) => transformNodeType(item, stack.subcategory));\n\n\t\t\tstackItems.push(...matchedNodes);\n\t\t}\n\n\t\tif (stack.baseFilter) {\n\t\t\tstackItems = stackItems.filter(stack.baseFilter);\n\t\t}\n\n\t\tif (stack.itemsMapper) {\n\t\t\tstackItems = stackItems.map(stack.itemsMapper);\n\t\t}\n\n\t\t// Sort only if non-root view\n\t\tif (!stack.items) {\n\t\t\tstackItems = sortNodeCreateElements(stackItems);\n\t\t}\n\n\t\tupdateCurrentViewStack({ baselineItems: stackItems });\n\t}\n\n\tfunction extendItemsWithUUID(items: INodeCreateElement[]) {\n\t\treturn items.map((item) => ({\n\t\t\t...item,\n\t\t\tuuid: `${item.key}-${uuid()}`,\n\t\t}));\n\t}\n\n\tfunction pushViewStack(stack: ViewStack) {\n\t\tif (activeViewStack.value.uuid) {\n\t\t\tupdateCurrentViewStack({ activeIndex: getActiveItemIndex() });\n\t\t}\n\n\t\tconst newStackUuid = uuid();\n\t\tviewStacks.value.push({\n\t\t\t...stack,\n\t\t\tuuid: newStackUuid,\n\t\t\ttransitionDirection: 'in',\n\t\t\tactiveIndex: 0,\n\t\t});\n\t\tsetStackBaselineItems();\n\t}\n\n\tfunction popViewStack() {\n\t\tif (activeViewStack.value.uuid) {\n\t\t\tviewStacks.value.pop();\n\t\t\tupdateCurrentViewStack({ transitionDirection: 'out' });\n\t\t}\n\t}\n\n\tfunction updateCurrentViewStack(stack: Partial<ViewStack>) {\n\t\tconst currentStack = getLastActiveStack();\n\t\tconst matchedIndex = viewStacks.value.findIndex((s) => s.uuid === currentStack.uuid);\n\t\tif (!currentStack) return;\n\n\t\t// For each key in the stack, update the matched stack\n\t\tObject.keys(stack).forEach((key) => {\n\t\t\tconst typedKey = key as keyof ViewStack;\n\t\t\tviewStacks.value[matchedIndex] = {\n\t\t\t\t...viewStacks.value[matchedIndex],\n\t\t\t\t[key]: stack[typedKey],\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction resetViewStacks() {\n\t\tviewStacks.value = [];\n\t}\n\n\treturn {\n\t\tviewStacks,\n\t\tactiveViewStack,\n\t\tactiveViewStackMode,\n\t\tglobalSearchItemsDiff,\n\t\tgotoCompatibleConnectionView,\n\t\tresetViewStacks,\n\t\tupdateCurrentViewStack,\n\t\tpushViewStack,\n\t\tpopViewStack,\n\t};\n});\n"],"names":["getAiNodesBySubcategory","nodes","subcategory","node","_c","_b","_a","AI_SUBCATEGORY","a","b","AIView","_nodes","i18n","useI18n","nodeTypesStore","useNodeTypesStore","templatesStore","useTemplatesStore","chainNodes","AI_CATEGORY_CHAINS","agentNodes","AI_CATEGORY_AGENTS","AI_NODE_CREATOR_VIEW","AI_OTHERS_NODE_CREATOR_VIEW","AINodesView","getAISubcategoryProperties","nodeConnectionType","AI_CATEGORY_DOCUMENT_LOADERS","NodeConnectionType","AI_CATEGORY_LANGUAGE_MODELS","AI_CATEGORY_MEMORY","AI_CATEGORY_OUTPUTPARSER","AI_CATEGORY_RETRIEVERS","AI_CATEGORY_TEXT_SPLITTERS","AI_CATEGORY_TOOLS","CORE_NODES_CATEGORY","AI_WORKFLOW_TOOL_LANGCHAIN_NODE_TYPE","AI_CODE_TOOL_LANGCHAIN_NODE_TYPE","AI_CATEGORY_EMBEDDING","AI_CATEGORY_VECTOR_STORES","AI_UNCATEGORIZED_CATEGORY","TriggerView","TRIGGER_NODE_CREATOR_VIEW","MANUAL_TRIGGER_NODE_TYPE","DEFAULT_SUBCATEGORY","WEBHOOK_NODE_TYPE","EMAIL_IMAP_NODE_TYPE","SCHEDULE_TRIGGER_NODE_TYPE","FORM_TRIGGER_NODE_TYPE","EXECUTE_WORKFLOW_TRIGGER_NODE_TYPE","MANUAL_CHAT_TRIGGER_NODE_TYPE","OTHER_TRIGGER_NODES_SUBCATEGORY","RegularView","view","REGULAR_NODE_CREATOR_VIEW","RSS_READ_NODE_TYPE","EMAIL_SEND_NODE_TYPE","TRANSFORM_DATA_SUBCATEGORY","SET_NODE_TYPE","CODE_NODE_TYPE","DATETIME_NODE_TYPE","FILTER_NODE_TYPE","REMOVE_DUPLICATES_NODE_TYPE","SPLIT_OUT_NODE_TYPE","LIMIT_NODE_TYPE","SUMMARIZE_NODE_TYPE","AGGREGATE_NODE_TYPE","MERGE_NODE_TYPE","HTML_NODE_TYPE","MARKDOWN_NODE_TYPE","XML_NODE_TYPE","CRYPTO_NODE_TYPE","EXTRACT_FROM_FILE_NODE_TYPE","CONVERT_TO_FILE_NODE_TYPE","COMPRESSION_NODE_TYPE","EDIT_IMAGE_NODE_TYPE","FLOWS_CONTROL_SUBCATEGORY","IF_NODE_TYPE","SPLIT_IN_BATCHES_NODE_TYPE","HELPERS_SUBCATEGORY","HTTP_REQUEST_NODE_TYPE","KEYBOARD_ID_ATTR","WATCHED_KEYS","useKeyboardNavigation","defineStore","selectableItems","ref","activeItemId","keysHooks","getItemType","element","getElementId","refreshSelectableItems","resolve","cleanupSelectableItems","el","executeKeyHooks","keyboardKey","activeItem","hook","onKeyDown","e","pressedKey","activeItemIndex","item","isArrowDown","isArrowUp","nextItemIndex","setActiveItem","previousIndex","setActiveItemId","id","itemId","setActiveItemIndex","index","attachKeydownEvent","detachKeydownEvent","registerKeyHook","name","getActiveItemIndex","useViewStacks","nodeCreatorStore","useNodeCreatorStore","viewStacks","activeStackItems","computed","stack","getLastActiveStack","extendItemsWithUUID","searchBaseItems","searchBase","flattenCreateElements","canvasHasAINodes","useCanvasStore","filteredNodes","isAiRootView","filterOutAiNodes","searchResults","searchNodes","groupedNodes","groupIfAiNodes","activeViewStack","flatBaselineItems","activeViewStackMode","transformNodeType","globalSearchItemsDiff","allNodes","globalSearchResult","sectionItem","child","filteredItem","itemsBySubcategory","subcategorizeItems","items","sortAlphabetically","aiNodes","isAINode","sectionsMap","section","currentItems","_d","isSubnodesSection","_f","_e","AI_CATEGORY_ROOT_NODES","nonAiNodes","difference","nonAiTriggerNodes","nonAiRegularNodes","sectionKey","nodesKeys","sections","groupItemsInSections","gotoCompatibleConnectionView","connectionType","isOutput","filter","nodesByConnectionType","relatedAIView","nextTick","pushViewStack","i","AI_CODE_NODE_TYPE","displayNode","setStackBaselineItems","stackItems","itemsInSubcategory","matchedNodes","sortNodeCreateElements","updateCurrentViewStack","uuid","newStackUuid","popViewStack","currentStack","matchedIndex","s","key","typedKey","resetViewStacks"],"mappings":"83BA6GA,SAASA,GAAwBC,EAA+BC,EAAqB,CACpF,OAAOD,EACL,OACCE,GAAS,WAAA,OAACA,EAAK,UAAUC,GAAAC,GAAAC,EAAAH,EAAK,QAAL,YAAAG,EAAY,gBAAZ,YAAAD,EAA4BE,KAA5B,YAAAH,EAA6C,SAASF,IAAW,EAE3F,IAAKC,IAAU,CACf,IAAKA,EAAK,KACV,KAAM,OACN,WAAY,CACX,MAAO,CAAC,EACR,KAAMA,EAAK,KACX,YAAaA,EAAK,YAClB,MAAOA,EAAK,YACZ,YAAaA,EAAK,YAElB,KAAMA,EAAK,KACX,SAAUA,EAAK,KAAK,cAAc,SAAS,QAAQ,EAChD,CACA,KAAM,OACN,KAAM,SACN,WAAY,qBAEZ,EAAA,MACJ,CACC,EAAA,EACD,KAAK,CAACK,EAAGC,IAAMD,EAAE,WAAW,YAAY,cAAcC,EAAE,WAAW,WAAW,CAAC,CAClF,CAEO,SAASC,GAAOC,EAAwC,CAC9D,MAAMC,EAAOC,IACPC,EAAiBC,IACjBC,EAAiBC,KAEjBC,EAAalB,GAAwBc,EAAe,mBAAoBK,EAAkB,EAC1FC,EAAapB,GAAwBc,EAAe,mBAAoBO,EAAkB,EAEzF,MAAA,CACN,MAAOC,EACP,MAAOV,EAAK,SAAS,6BAA6B,EAClD,SAAUA,EAAK,SAAS,kCAAkC,EAC1D,MAAO,CACN,CACC,IAAK,oBACL,KAAM,OACN,WAAY,CACX,MAAOA,EAAK,SAAS,oCAAoC,EACzD,KAAM,WACN,YAAaA,EAAK,SAAS,0CAA0C,EACrE,KAAM,oBACN,IAAKI,EAAe,sBAAsB,OAAW,YAAY,EACjE,IAAK,CACJ,KAAM,OACN,KAAMJ,EAAK,SAAS,iDAAiD,CACtE,CACD,CACD,EACA,GAAGQ,EACH,GAAGF,EACH,CACC,IAAKK,EACL,KAAM,OACN,WAAY,CACX,MAAOX,EAAK,SAAS,kCAAkC,EACvD,KAAM,QACN,YAAaA,EAAK,SAAS,6CAA6C,CACzE,CACD,CACD,CAAA,CAEF,CAEO,SAASY,GAAYb,EAAwC,CACnE,MAAMC,EAAOC,IAEb,SAASY,EAA2BC,EAAwC,CACpE,MAAA,CACN,eAAgBA,EAChB,UAAW,CACV,MAAO,mBAAmBA,CAAkB,SAC7C,EACA,WAAY,oBAAoBA,CAAkB,EAAA,CAEpD,CAEO,MAAA,CACN,MAAOH,EACP,MAAOX,EAAK,SAAS,kCAAkC,EACvD,SAAUA,EAAK,SAAS,kCAAkC,EAC1D,MAAO,CACN,CACC,IAAKe,EACL,KAAM,cACN,WAAY,CACX,MAAOA,EACP,KAAM,cACN,GAAGF,EAA2BG,EAAmB,UAAU,CAC5D,CACD,EACA,CACC,IAAKC,EACL,KAAM,cACN,WAAY,CACX,MAAOA,EACP,KAAM,WACN,GAAGJ,EAA2BG,EAAmB,eAAe,CACjE,CACD,EACA,CACC,IAAKE,EACL,KAAM,cACN,WAAY,CACX,MAAOA,EACP,KAAM,QACN,GAAGL,EAA2BG,EAAmB,QAAQ,CAC1D,CACD,EACA,CACC,IAAKG,EACL,KAAM,cACN,WAAY,CACX,MAAOA,EACP,KAAM,OACN,GAAGN,EAA2BG,EAAmB,cAAc,CAChE,CACD,EACA,CACC,IAAKI,GACL,KAAM,cACN,WAAY,CACX,MAAOA,GACP,KAAM,SACN,GAAGP,EAA2BG,EAAmB,WAAW,CAC7D,CACD,EACA,CACC,IAAKK,GACL,KAAM,cACN,WAAY,CACX,MAAOA,GACP,KAAM,sBACN,GAAGR,EAA2BG,EAAmB,cAAc,CAChE,CACD,EACA,CACC,KAAM,cACN,IAAKM,GACL,SAAUC,EACV,WAAY,CACX,MAAOD,GACP,KAAM,QACN,GAAGT,EAA2BG,EAAmB,MAAM,EACvD,SAAU,CACT,CACC,IAAK,UACL,MAAOhB,EAAK,SAAS,kCAAkC,EACvD,MAAO,CAACwB,GAAsCC,EAAgC,CAC/E,CACD,CACD,CACD,EACA,CACC,IAAKC,GACL,KAAM,cACN,WAAY,CACX,MAAOA,GACP,KAAM,gBACN,GAAGb,EAA2BG,EAAmB,WAAW,CAC7D,CACD,EACA,CACC,IAAKW,GACL,KAAM,cACN,WAAY,CACX,MAAOA,GACP,KAAM,kBACN,GAAGd,EAA2BG,EAAmB,aAAa,CAC/D,CACD,EACA,CACC,IAAKY,GACL,KAAM,cACN,WAAY,CACX,MAAOA,GACP,KAAM,MACP,CACD,CACD,CAAA,CAEF,CAEO,SAASC,IAAc,CAC7B,MAAM7B,EAAOC,IA4GN,MA1GgB,CACtB,MAAO6B,EACP,MAAO9B,EAAK,SAAS,+CAA+C,EACpE,SAAUA,EAAK,SAAS,0DAA0D,EAClF,MAAO,CACN,CACC,IAAK+B,GACL,KAAM,OACN,SAAU,CAACR,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMQ,GACN,YAAa/B,EAAK,SAAS,yDAAyD,EACpF,YAAaA,EAAK,SAAS,yDAAyD,EACpF,KAAM,kBACP,CACD,EACA,CACC,IAAKgC,EACL,KAAM,cACN,WAAY,CACX,kBAAmB,CAACC,EAAmBC,EAAoB,EAC3D,MAAO,oBACP,KAAM,gBACP,CACD,EACA,CACC,IAAKC,GACL,KAAM,OACN,SAAU,CAACZ,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMY,GACN,YAAanC,EAAK,SAAS,2DAA2D,EACtF,YAAaA,EAAK,SAAS,2DAA2D,EACtF,KAAM,UACP,CACD,EACA,CACC,IAAKiC,EACL,KAAM,OACN,SAAU,CAACV,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMU,EACN,YAAajC,EAAK,SAAS,0DAA0D,EACrF,YAAaA,EAAK,SAAS,0DAA0D,EACrF,SAAU,CACT,KAAM,OACN,KAAM,UACN,WAAY,0BACb,CACD,CACD,EACA,CACC,IAAKoC,GACL,KAAM,OACN,SAAU,CAACb,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMa,GACN,YAAapC,EAAK,SAAS,uDAAuD,EAClF,YAAaA,EAAK,SAAS,uDAAuD,EAClF,SAAU,CACT,KAAM,OACN,KAAM,OACN,WAAY,uBACb,CACD,CACD,EACA,CACC,IAAKqC,GACL,KAAM,OACN,SAAU,CAACd,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMc,GACN,YAAarC,EAAK,SAAS,2DAA2D,EACtF,YAAaA,EAAK,SAAS,2DAA2D,EACtF,KAAM,iBACP,CACD,EACA,CACC,IAAKsC,GACL,KAAM,OACN,SAAU,CAACf,CAAmB,EAC9B,WAAY,CACX,MAAO,CAAC,EACR,KAAMe,GACN,YAAatC,EAAK,SAAS,6DAA6D,EACxF,YAAaA,EAAK,SAAS,6DAA6D,EACxF,KAAM,aACP,CACD,EACA,CACC,KAAM,cACN,IAAKuC,GACL,SAAUhB,EACV,WAAY,CACX,MAAOgB,GACP,KAAM,aACP,CACD,CACD,CAAA,CAIF,CAEO,SAASC,GAAYnD,EAA6B,CACxD,MAAMW,EAAOC,IAEPwC,EAAiB,CACtB,MAAOC,GACP,MAAO1C,EAAK,SAAS,gDAAgD,EACrE,MAAO,CACN,CACC,IAAKgC,EACL,KAAM,cACN,WAAY,CACX,MAAO,oBACP,KAAM,QACN,kBAAmB,CAACW,GAAoBC,EAAoB,CAC7D,CACD,EACA,CACC,KAAM,cACN,IAAKC,GACL,SAAUtB,EACV,WAAY,CACX,MAAOsB,GACP,KAAM,MACN,SAAU,CACT,CACC,IAAK,UACL,MAAO7C,EAAK,SAAS,kCAAkC,EACvD,MAAO,CAAC8C,GAAeC,GAAgBC,EAAkB,CAC1D,EACA,CACC,IAAK,cACL,MAAOhD,EAAK,SAAS,gDAAgD,EACrE,MAAO,CACNiD,GACAC,GACAC,GACAC,EACD,CACD,EACA,CACC,IAAK,UACL,MAAOpD,EAAK,SAAS,4CAA4C,EACjE,MAAO,CAACqD,GAAqBC,GAAqBC,EAAe,CAClE,EACA,CACC,IAAK,UACL,MAAOvD,EAAK,SAAS,4CAA4C,EACjE,MAAO,CACNwD,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,EACD,CACD,CACD,CACD,CACD,EACA,CACC,KAAM,cACN,IAAKC,GACL,SAAUzC,EACV,WAAY,CACX,MAAOyC,GACP,KAAM,cACN,SAAU,CACT,CACC,IAAK,UACL,MAAOhE,EAAK,SAAS,kCAAkC,EACvD,MAAO,CAACiD,GAAkBgB,GAAcC,GAA4BX,EAAe,CACpF,CACD,CACD,CACD,EACA,CACC,KAAM,cACN,IAAKY,GACL,SAAU5C,EACV,WAAY,CACX,MAAO4C,GACP,KAAM,UACN,SAAU,CACT,CACC,IAAK,UACL,MAAOnE,EAAK,SAAS,kCAAkC,EACvD,MAAO,CAACoE,GAAwBnC,EAAmBc,EAAc,CAClE,CACD,CACD,CACD,CACD,CAAA,EAIG,OADgB1D,GAAS,CAAC,GAAG,KAAME,YAAS,OAAAE,GAAAC,EAAAH,EAAK,QAAL,YAAAG,EAAY,aAAZ,YAAAD,EAAwB,SAASE,GAAe,GAE/F8C,EAAK,MAAM,KAAK,CACf,IAAK/B,EACL,KAAM,OACN,WAAY,CACX,MAAOV,EAAK,SAAS,sCAAsC,EAC3D,KAAM,QACN,YAAaA,EAAK,SAAS,gCAAgC,EAC3D,IAAK,CACJ,KAAM,UACN,KAAMA,EAAK,SAAS,4BAA4B,CACjD,EACA,WAAY,EACb,CAAA,CACgB,EAElByC,EAAK,MAAM,KAAK,CACf,IAAKX,EACL,KAAM,OACN,WAAY,CACX,MAAO9B,EAAK,SAAS,kDAAkD,EACvE,KAAM,OACN,YAAaA,EAAK,SAAS,6DAA6D,CACzF,CAAA,CACA,EAEMyC,CACR,CC7gBO,MAAM4B,GAAmB,uBACnBC,GAAe,CAC3B,UACA,YACA,YACA,aACA,QACA,SACA,KACD,EAEaC,GAAwBC,GAAY,gCAAiC,IAAM,CACjF,MAAAC,EAAkBC,EAA6B,CAAA,CAAE,EACjDC,EAAeD,EAAmB,IAAI,EAEtCE,EAAYF,EAA6B,CAAA,CAAE,EAEjD,SAASG,EAAYC,EAAmB,CAChC,OAAAA,GAAA,YAAAA,EAAS,aAAa,yBAC9B,CACA,SAASC,EAAaD,EAAmB,CACjC,OAAAA,GAAA,YAAAA,EAAS,aAAaT,MAAqB,MACnD,CACA,eAAeW,GAAwC,CACtD,OAAO,MAAM,IAAI,QAASC,GAAY,CAEdC,IACvB,WAAW,IAAM,CAChBT,EAAgB,MAAQ,MAAM,KAC7B,SAAS,iBAAiB,0BAA0B,CAAA,EACnD,IAAKU,GAAO,IAAI,QAAQA,CAAE,CAAC,EACrBF,KACN,CAAC,CAAA,CACJ,CACF,CAES,SAAAG,EAAgBC,EAA0BC,EAAqB,CACrD,OAAO,OAAOV,EAAU,KAAK,EACvB,OAAQW,GAASA,EAAK,aAAa,SAASF,CAAW,CAAC,EAE1E,QAASE,GAAS,CACvB,GAAI,CAACZ,EAAa,MAAO,QAGxBY,EAAK,YAAc,QACnBA,EAAK,UAAUV,EAAYS,CAAU,GAAK,GAAIX,EAAa,KAAK,IAE1CA,EAAa,OAC9BY,EAAA,QAAQZ,EAAa,MAAOU,CAAW,CAC7C,CACA,CACF,CAEA,eAAeG,EAAUC,EAAkB,WAC1C,MAAMC,EAAaD,EAAE,IACjB,GAAA,CAACnB,GAAa,SAASoB,CAAU,EAAG,OACxCD,EAAE,eAAe,EACjBA,EAAE,gBAAgB,EAElB,MAAMT,EAAuB,EACvB,MAAAW,EAAkBlB,EAAgB,MAAM,UAC5CmB,GAASb,EAAaa,GAAA,YAAAA,EAAM,OAAO,IAAMjB,EAAa,KAAA,EAElDW,GAAa5F,EAAA+E,EAAgB,MAAMkB,CAAe,IAArC,YAAAjG,EAAwC,QAErDmG,EAAcH,IAAe,YAC7BI,EAAYJ,IAAe,UAEjC,GAAKJ,EAEL,IAAIO,EAAa,CAChB,MAAME,EACLJ,EAAkBlB,EAAgB,MAAM,OAAS,EAAIkB,EAAkB,EAAI,EAE5EK,GAAcvG,EAAAgF,EAAgB,MAAMsB,CAAa,IAAnC,YAAAtG,EAAsC,OAAO,CAC5D,CACA,GAAIqG,EAAW,CACd,MAAMG,EACLN,EAAkB,EAAIA,EAAkB,EAAIlB,EAAgB,MAAM,OAAS,EAE5EuB,GAAcxG,EAAAiF,EAAgB,MAAMwB,CAAa,IAAnC,YAAAzG,EAAsC,OAAO,CAC5D,CACA4F,EAAgBM,EAAYJ,CAAU,EACvC,CAEA,SAASY,EAAgBC,EAAY,CACpCxB,EAAa,MAAQwB,CACtB,CAEA,SAASH,EAAcJ,EAAgB,CAChC,MAAAQ,EAASrB,EAAaa,CAAI,EAC3BQ,IAELF,EAAgBE,CAAM,EAClBR,GAAA,MAAAA,EAAM,iBACTA,GAAA,MAAAA,EAAM,eAAe,CAAE,MAAO,QAAU,IAE1C,CAEA,eAAeS,EAAmBC,EAAe,OAChD,MAAMtB,EAAuB,EAE7BgB,GAActG,EAAA+E,EAAgB,MAAM6B,CAAK,IAA3B,YAAA5G,EAA8B,OAAO,CACpD,CAEA,SAAS6G,GAAqB,CAC7B,SAAS,iBAAiB,UAAWf,EAAW,CAAE,QAAS,GAAM,CAClE,CAEA,SAASgB,GAAqB,CACNtB,IACvB,SAAS,oBAAoB,UAAWM,EAAW,CAAE,QAAS,GAAM,CACrE,CAES,SAAAiB,EAAgBC,EAAcnB,EAAe,CAChDA,EAAA,aAAa,QAASF,GAAgB,CACtC,GAAAf,GAAa,SAASe,CAAW,EAC1BT,EAAA,MAAQ,CAAE,GAAGA,EAAU,MAAO,CAAC8B,CAAI,EAAGnB,OAEhD,OAAM,IAAI,MAAM,OAAOF,CAAW,mBAAmB,CACtD,CACA,CACF,CAEA,SAASH,GAAyB,CAEjCT,EAAgB,MAAQ,EACzB,CAEA,SAASkC,GAAqB,CAC7B,OAAOlC,EAAgB,MAAM,UAC3BmB,GAASb,EAAaa,GAAA,YAAAA,EAAM,OAAO,IAAMjB,EAAa,KAAA,CAEzD,CAEO,MAAA,CACN,aAAAA,EACA,mBAAA4B,EACA,uBAAAvB,EACA,mBAAAwB,EACA,gBAAAC,EACA,mBAAAE,EACA,gBAAAT,EACA,mBAAAG,CAAA,CAEF,CAAC,ECrFYO,GAAgBpC,GAAY,wBAAyB,IAAM,CACvE,MAAMqC,EAAmBC,KACnB,CAAE,mBAAAH,GAAuBpC,KACzBvE,EAAOC,IAEP8G,EAAarC,EAAiB,CAAA,CAAE,EAEhCsC,EAAmBC,EAA+B,IAAM,CAC7D,MAAMC,EAAQC,IAEV,GAAA,EAACD,GAAA,MAAAA,EAAO,eACX,OAAOA,EAAM,MAAQE,EAAoBF,EAAM,KAAK,EAAI,GAGrD,GAAAA,EAAM,QAAUG,EAAgB,MAAO,CACpC,MAAAC,EACLD,EAAgB,MAAM,OAAS,EAC5BA,EAAgB,MAChBE,GAAsBL,EAAM,eAAiB,CAAE,CAAA,EAE7CM,EAAmBC,GAAA,EAAiB,QAAQ,OAAS,EACrDC,EACLC,EAAaT,CAAK,GAAKM,EAAmBF,EAAaM,EAAiBN,CAAU,EAE7EO,EAAgBT,EAAoBU,GAAYZ,EAAM,QAAU,GAAIQ,CAAa,CAAC,EAElFK,EAAeC,EAAeH,EAAe,EAAK,GAAKA,EAGvD,OAAAX,EAAA,YAAca,EAAa,KAAMxI,GAASA,EAAK,OAAS,SAAS,EAAI,EAAI,EAExEwI,CACR,CACA,OAAOX,EAAoBY,EAAed,EAAM,cAAe,EAAI,CAAC,CAAA,CACpE,EAEKe,EAAkBhB,EAAoB,IAAM,CACjD,MAAMC,EAAQC,IACd,GAAI,CAACD,EAAO,MAAO,GAEnB,MAAMgB,EAAoBX,GAAsBL,EAAM,eAAiB,CAAE,CAAA,EAElE,MAAA,CACN,GAAGA,EACH,MAAOF,EAAiB,MACxB,UAAWkB,EAAkB,OAAS,IAAKhB,GAAA,YAAAA,EAAO,UAAA,CACnD,CACA,EAEKiB,EAAsBlB,EAC3B,IAAMgB,EAAgB,MAAM,MAAQnG,CAAA,EAG/BuF,EAAkBJ,EAA+B,IAAM,CAC5D,MAAMC,EAAQC,IACd,OAAKD,GAAA,MAAAA,EAAO,YAELA,EAAM,YAAY,IAAKtB,GAASwC,EAAkBxC,EAAMsB,EAAM,WAAW,CAAC,EAFjD,EAEiD,CACjF,EAED,SAASC,GAAqB,CAC7B,OAAOJ,EAAW,MAAMA,EAAW,MAAM,OAAS,CAAC,CACpD,CAGM,MAAAsB,EAAwBpB,EAA+B,IAAM,CAClE,MAAMC,EAAQC,IACd,GAAI,EAACD,GAAA,MAAAA,EAAO,QAAQ,MAAO,GAErB,MAAAoB,EAAWzB,EAAiB,YAAY,IAAKjB,GAASwC,EAAkBxC,CAAI,CAAC,EAE7E8B,EAAgBC,EAAaT,CAAK,EAAIoB,EAAWV,EAAiBU,CAAQ,EAEhF,IAAIC,EAA2CnB,EAC9CU,GAAYZ,EAAM,QAAU,GAAIQ,CAAa,CAAA,EAE1C,OAAAC,EAAaT,CAAK,IACrBqB,EAAqBP,EAAeO,CAAkB,GAGjCA,EAAmB,OAAQ3C,GACzC,CAACoB,EAAiB,MAAM,KAAM1B,GAChCA,EAAW,OAAS,UACKA,EAAW,SAAS,KAC9CkD,GAAgBA,EAAY,MAAQ5C,EAAK,GAAA,EAKrCN,EAAW,MAAQM,EAAK,GAC/B,CACD,EAGsC,OAAQA,GAC1CA,EAAK,OAAS,UACUA,EAAK,SAAS,KAAM6C,GAC9CzB,EAAiB,MAAM,KAAM0B,GAAiBA,EAAa,MAAQD,EAAM,GAAG,CAAA,EAMvE,EACP,CAEM,CACP,EAEKE,EAAqB1B,EAAS,IAAM2B,GAAmB/B,EAAiB,WAAW,CAAC,EAE1F,SAASc,EAAaT,EAAkB,CACvC,OAAOA,EAAM,WAAaxG,CAC3B,CAES,SAAAsH,EAAea,EAA6BC,EAAqB,GAAM,CAC/E,MAAMC,EAAUF,EAAM,OAAQtJ,GAAoCyJ,GAASzJ,CAAI,CAAC,EAE5E,GAAAwJ,EAAQ,OAAS,EAAG,CACjB,MAAAE,MAAkB,IAChBF,EAAA,QAASxJ,GAAS,iBACzB,MAAM2J,GAAU1J,GAAAC,GAAAC,EAAAH,EAAK,WAAW,QAAhB,YAAAG,EAAuB,gBAAvB,YAAAD,EAAuCE,KAAvC,YAAAH,EAAyD,GAEzE,GAAI0J,EAAS,CACZ,MAAMC,KAAeC,EAAAH,EAAY,IAAIC,CAAO,IAAvB,YAAAE,EAA0B,QAAS,GAClDC,GACL,GAACC,GAAAC,EAAAhK,EAAK,WAAW,QAAhB,YAAAgK,EAAuB,gBAAvB,MAAAD,EAAuC3J,GAAgB,SACvD6J,KAGFP,EAAY,IAAIC,EAAS,CACxB,IAAKA,EACL,MAAOG,GACJ,GAAGH,CAAO,KAAKlJ,EAAK,SAAS,sBAAsB,CAAC,IACpDkJ,EACH,MAAO,CAAC,GAAGC,GAAc5J,EAAK,GAAG,CAAA,CACjC,CACF,CAAA,CACA,EAEK,MAAAkK,EAAaC,GAAWb,EAAOE,CAAO,EACtCY,EAAoBF,EAAW,OACnC7D,GAASA,EAAK,OAAS,QAAUzF,EAAoB,EAAA,cAAcyF,EAAK,WAAW,IAAI,CAAA,EAGnFgE,EAAoBF,GAAWD,EAAYE,CAAiB,EAE9D,GAAAF,EAAW,OAAS,EAAG,CAC1B,IAAII,EAAa,GACbD,EAAkB,QAAUD,EAAkB,OACpCE,EAAA7J,EAAK,SAAS,gDAAgD,EAE9D6J,EAAAD,EAAkB,OAC5B5J,EAAK,SAAS,0CAA0C,EACxDA,EAAK,SAAS,0CAA0C,EAG5D,MAAM8J,EAAYL,EAAW,IAAKlK,GAASA,EAAK,GAAG,EAEnD0J,EAAY,IAAIY,EAAY,CAC3B,IAAKA,EACL,MAAOA,EACP,MAAO,CAAC,GAAGC,CAAS,CAAA,CACpB,CACF,CAEA,MAAMC,EAAW,MAAM,KAAKd,EAAY,OAAQ,CAAA,EAEzC,OAAAe,GAAqBnB,EAAOkB,EAAUjB,CAAkB,CAChE,CAEO,OAAAD,CACR,CAEA,SAASjB,EAAiBiB,EAA6B,CAc/C,OAboBA,EAAM,OAAQjD,GAAS,eAC7C,OAAAA,EAAK,OAAS,UACInG,GAAAC,EAAAkG,EAAK,WAAW,QAAhB,YAAAlG,EAAuB,aAAvB,YAAAD,EAAmC,SAASE,MAAoB,IAKpF4J,GAAAH,GAAA5J,EAAAoG,EAAK,WAAW,QAAhB,YAAApG,EAAuB,gBAAvB,YAAA4J,EAAuCzJ,KAAvC,YAAA4J,EAAwD,SAASC,IAI5D,EAAA,CACP,CAEF,CAEe,eAAAS,EACdC,EACAC,EACAC,EACC,OACG,IAAAC,EACAC,EAEAH,IAAa,IAChBE,EAAwBlK,EAAoB,EAAA,2CAC5BmK,EAAA,CACf,WAAY,CACX,MAAOtK,EAAK,SAAS,6BAA6B,EAClD,KAAM,OACP,CAAA,IAGDqK,EAAwBlK,EAAoB,EAAA,4CAE5CmK,EAAgB1J,GAAc,EAAE,MAAM,KACpCgF,GAASA,EAAK,WAAW,iBAAmBsE,CAAA,GAI/C,MAAMK,GAAS,EACDC,EAAA,CACb,MAAOF,GAAA,YAAAA,EAAe,WAAW,MACjC,SAAU3J,EACV,KAAM,QACN,MAAOkG,EAAiB,oBACxB,SAAU,CACT,SAAU,OACV,KAAMyD,GAAA,YAAAA,EAAe,WAAW,KAChC,OAAO5K,EAAA4K,GAAA,YAAAA,EAAe,WAAW,YAA1B,YAAA5K,EAAqC,KAC7C,EACA,WAAY4K,GAAA,YAAAA,EAAe,WAAW,WACtC,WAAaG,GAA0B,OAGtC,GAAIA,EAAE,MAAQC,GAA0B,MAAA,GACxC,MAAMC,EAAcN,EAAsBH,CAAc,EAAE,SAASO,EAAE,GAAG,EAMpE,OAAAE,KAAejL,EAAA0K,GAAA,YAAAA,EAAQ,QAAR,MAAA1K,EAAe,QAC1B0K,EAAO,MAAM,SAASK,EAAE,GAAG,EAG5BE,CACR,EACA,YAAY/E,EAAM,CACV,MAAA,CACN,GAAGA,EACH,YAAasE,CAAA,CAEf,EACA,YAAa,EAAA,CACb,CACF,CAEA,SAASU,GAAwB,CAChC,MAAM1D,EAAQC,IACd,GAAI,CAACD,GAAS,CAACe,EAAgB,MAAM,KAAM,OAEvC,IAAA4C,GAAa3D,GAAA,YAAAA,EAAO,QAAS,GAE7B,GAAA,EAACA,GAAA,MAAAA,EAAO,OAAO,CACZ,MAAA5H,GAAc4H,GAAA,YAAAA,EAAO,cAAelF,EACpC8I,EAAqBnC,EAAmB,MAAMrJ,CAAW,EACzDyK,EAAW7C,EAAM,SAEnB6C,EACUc,EAAAb,GAAqBc,EAAoBf,CAAQ,EAEjDc,EAAAC,CAEf,CAIA,IAAK5D,EAAM,mBAAqB,CAAA,GAAI,OAAS,EAAG,CACzC,MAAA6D,EAAelE,EAAiB,YACpC,OAAQjB,GAAS,OAAA,OAAAlG,EAAAwH,EAAM,oBAAN,YAAAxH,EAAyB,SAASkG,EAAK,MAAK,EAC7D,IAAKA,GAASwC,EAAkBxC,EAAMsB,EAAM,WAAW,CAAC,EAE/C2D,EAAA,KAAK,GAAGE,CAAY,CAChC,CAEI7D,EAAM,aACI2D,EAAAA,EAAW,OAAO3D,EAAM,UAAU,GAG5CA,EAAM,cACI2D,EAAAA,EAAW,IAAI3D,EAAM,WAAW,GAIzCA,EAAM,QACV2D,EAAaG,GAAuBH,CAAU,GAGxBI,EAAA,CAAE,cAAeJ,CAAA,CAAY,CACrD,CAEA,SAASzD,EAAoByB,EAA6B,CAClD,OAAAA,EAAM,IAAKjD,IAAU,CAC3B,GAAGA,EACH,KAAM,GAAGA,EAAK,GAAG,IAAIsF,IAAM,EAC1B,EAAA,CACH,CAEA,SAASV,EAActD,EAAkB,CACpCe,EAAgB,MAAM,MACzBgD,EAAuB,CAAE,YAAatE,EAAmB,CAAG,CAAA,EAG7D,MAAMwE,EAAeD,KACrBnE,EAAW,MAAM,KAAK,CACrB,GAAGG,EACH,KAAMiE,EACN,oBAAqB,KACrB,YAAa,CAAA,CACb,EACqBP,GACvB,CAEA,SAASQ,GAAe,CACnBnD,EAAgB,MAAM,OACzBlB,EAAW,MAAM,MACMkE,EAAA,CAAE,oBAAqB,KAAA,CAAO,EAEvD,CAEA,SAASA,EAAuB/D,EAA2B,CAC1D,MAAMmE,EAAelE,IACfmE,EAAevE,EAAW,MAAM,UAAWwE,GAAMA,EAAE,OAASF,EAAa,IAAI,EAC9EA,GAGL,OAAO,KAAKnE,CAAK,EAAE,QAASsE,GAAQ,CACnC,MAAMC,EAAWD,EACNzE,EAAA,MAAMuE,CAAY,EAAI,CAChC,GAAGvE,EAAW,MAAMuE,CAAY,EAChC,CAACE,CAAG,EAAGtE,EAAMuE,CAAQ,CAAA,CACtB,CACA,CACF,CAEA,SAASC,GAAkB,CAC1B3E,EAAW,MAAQ,EACpB,CAEO,MAAA,CACN,WAAAA,EACA,gBAAAkB,EACA,oBAAAE,EACA,sBAAAE,EACA,6BAAA4B,EACA,gBAAAyB,EACA,uBAAAT,EACA,cAAAT,EACA,aAAAY,CAAA,CAEF,CAAC"}