const __vite__fileDeps=["assets/NodeCreation-DHuCOx3T.js","assets/n8n-B6cfQsVX.js","assets/axios-Mm4CS0gO.js","assets/esprima-next-nhoSXAeq.js","assets/luxon-CLwAIbs0.js","assets/vendor-Dv5OeN6t.js","assets/lodash-es-BxV-E8rt.js","assets/n8n-Dbo88Vem.css","assets/index-DEwaaDne.js","assets/pinia-BAhPp3pQ.js","assets/flatted-DN8lQ2XG.js","assets/@vueuse/core-9E8Shwsg.js","assets/@n8n/permissions-BxxteU-C.js","assets/dateformat-B9ocXky7.js","assets/vue-i18n-Delvyc9x.js","assets/uuid-SoommWqA.js","assets/@n8n/codemirror-lang-sql-x14jMqbG.js","assets/@lezer/common-B6ct0j_v.js","assets/prettier-bS6l4Vb1.js","assets/@jsplumb/util-DS-9vq_E.js","assets/@jsplumb/core-CVBraiyY.js","assets/@jsplumb/common-CF-b-6-M.js","assets/@jsplumb/connector-bezier-BGU0Ovbw.js","assets/@jsplumb/browser-ui-BVF2KoJK.js","assets/codemirror-lang-html-n8n-DcTmlMkf.js","assets/@n8n/codemirror-lang-Qkdx7NoQ.js","assets/fast-json-stable-stringify-LluJPcs3.js","assets/timeago.js-CiyKClrF.js","assets/qrcode.vue-BGkPba5A.js","assets/vue3-touch-events-mV0oX_Sl.js","assets/chart.js-343vZi4M.js","assets/index-C2bc09x9.css","assets/nodeCreator.store-DR3dfsvW.js","assets/NodeCreation-gfazfzcF.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as E,N as W,o as at,k as lt,e as rt}from"./n8n-B6cfQsVX.js";import{G as T,z as V,e as d,l as b,m as x,p as R,M as I,u as v,R as O,U as k,I as w,av as S,ag as pe,H as te,T as z,J as F,L as it,af as De,X as A,E as Oe,O as D,F as de,a7 as ke,b as Pe,Y as ct,K as ue,a2 as dt,aH as ut,az as pt,r as Te,y as ft,aM as vt,aK as mt}from"./vendor-Dv5OeN6t.js";import{c as _t,d as Q,e as yt,f as bt,h as gt,P as wt,u as Nt,i as Ct}from"./@vue-flow/core-B52NSkuk.js";import{_ as ht}from"./@vue-flow/background-D2lL98mx.js";import{_ as $t}from"./@vue-flow/controls-BSXHzp1O.js";import{_ as kt}from"./@vue-flow/minimap-Ln1mW_RP.js";import{w as K,cr as L,cs as oe,a4 as fe,a9 as Tt,ct as xt,i as ve,bn as It,j as We,as as Et,bG as St,cq as Mt,L as Bt,bj as Rt,c6 as Dt,F as Ve,a3 as He,u as Ot,aq as Pt,c as Wt,n as Vt,b as Ht,ar as At,bt as Ut,bs as jt,l as zt,al as Lt,V as qt,E as xe,bA as ee,cm as Ie,bD as Ft,bK as Kt,bf as Yt,cb as Xt}from"./index-DEwaaDne.js";import{v as Ae}from"./uuid-SoommWqA.js";import{u as Gt}from"./nodeCreator.store-DR3dfsvW.js";import{u as Jt}from"./collaboration.store-zz8xH0zY.js";import"./axios-Mm4CS0gO.js";import"./esprima-next-nhoSXAeq.js";import"./luxon-CLwAIbs0.js";import"./lodash-es-BxV-E8rt.js";import"./pinia-BAhPp3pQ.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const Zt=!1,Qt="Test",eo=T({__name:"CanvasNodeToolbar",emits:["delete"],setup(o,{emit:e}){const s=e,t=S(),l=V(L),u=K(),_=d(()=>l==null?void 0:l.data.value);function c(){}function f(){}function y(){s("delete")}function g(n,r){}return(n,r)=>{var i;const a=pe("N8nIconButton");return b(),x("div",{class:w(v(t).canvasNodeToolbar)},[R("div",{class:w(v(t).canvasNodeToolbarItems)},[((i=_.value)==null?void 0:i.renderType)!=="configuration"?(b(),I(a,{key:0,"data-test-id":"execute-node-button",type:"tertiary",text:"",size:"small",icon:"play",disabled:Zt,title:v(u).baseText("node.testStep"),onClick:c},null,8,["title"])):O("",!0),k(a,{"data-test-id":"disable-node-button",type:"tertiary",text:"",size:"small",icon:"power-off",title:Qt,onClick:f}),k(a,{"data-test-id":"delete-node-button",type:"tertiary",size:"small",text:"",icon:"trash",title:v(u).baseText("node.delete"),onClick:y},null,8,["title"]),k(a,{"data-test-id":"overflow-node-button",type:"tertiary",size:"small",text:"",icon:"ellipsis-h",onClick:r[0]||(r[0]=N=>void 0)})],2)],2)}}}),to="_canvasNodeToolbar_jnu94_1",oo="_canvasNodeToolbarItems_jnu94_5",no={canvasNodeToolbar:to,canvasNodeToolbarItems:oo},so={$style:no},ao=E(eo,[["__cssModules",so]]);function me({inputs:o,outputs:e}){const s=d(()=>v(o).filter(c=>c.type===W.Main)),t=d(()=>v(o).filter(c=>c.type!==W.Main)),l=d(()=>t.value.filter(c=>c.required)),u=d(()=>v(e).filter(c=>c.type===W.Main)),_=d(()=>v(e).filter(c=>c.type!==W.Main));return{mainInputs:s,nonMainInputs:t,requiredNonMainInputs:l,mainOutputs:u,nonMainOutputs:_}}const lo=T({__name:"CanvasNodeDefault",setup(o){const e=V(L),s=S(),t=d(()=>(e==null?void 0:e.label.value)??""),l=d(()=>(e==null?void 0:e.data.value.inputs)??[]),u=d(()=>(e==null?void 0:e.data.value.outputs)??[]),{mainOutputs:_}=me({inputs:l,outputs:u}),c=d(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value})),f=d(()=>({"--node-main-output-count":_.value.length}));return(y,g)=>v(e)?(b(),x("div",{key:0,class:w(c.value),style:F(f.value),"data-test-id":"canvas-node-default"},[te(y.$slots,"default"),t.value?(b(),x("div",{key:0,class:w(v(s).label)},z(t.value),3)):O("",!0)],6)):O("",!0)}}),ro="_node_xjq7r_1",io="_label_xjq7r_12",co="_selected_xjq7r_22",uo={node:ro,label:io,selected:co},po={$style:uo},Ee=E(lo,[["__cssModules",po]]),fo=T({__name:"CanvasNodeConfiguration",setup(o){const e=V(L),s=S(),t=d(()=>(e==null?void 0:e.label.value)??""),l=d(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value}));return(u,_)=>(b(),x("div",{class:w(l.value),"data-test-id":"canvas-node-configuration"},[te(u.$slots,"default"),t.value?(b(),x("div",{key:0,class:w(v(s).label)},z(t.value),3)):O("",!0)],2))}}),vo="_node_moq9d_1",mo="_selected_moq9d_12",_o="_label_moq9d_16",yo={node:vo,selected:mo,label:_o},bo={$style:yo},go=E(fo,[["__cssModules",bo]]),wo=T({__name:"CanvasNodeConfigurable",setup(o){const e=V(L),s=S(),t=d(()=>(e==null?void 0:e.label.value)??""),l=d(()=>(e==null?void 0:e.data.value.inputs)??[]),u=d(()=>(e==null?void 0:e.data.value.outputs)??[]),{nonMainInputs:_,requiredNonMainInputs:c}=me({inputs:l,outputs:u}),f=d(()=>({[s.node]:!0,[s.selected]:e==null?void 0:e.selected.value})),y=d(()=>{const g={};if(c.value.length>0){let n=0;g["--configurable-node-input-count"]=_.value.length+n}return g});return(g,n)=>(b(),x("div",{class:w(f.value),style:F(y.value),"data-test-id":"canvas-node-configurable"},[te(g.$slots,"default"),R("div",{class:w(v(s).label)},z(t.value),3)],6))}}),No="_node_14d7w_1",Co="_label_14d7w_14",ho="_selected_14d7w_22",$o={node:No,label:Co,selected:ho},ko={$style:$o},To=E(wo,[["__cssModules",ko]]),xo=T({__name:"CanvasNodeRenderer",setup(o){const e=V(L),s=it(),t=()=>{let l;switch(e==null?void 0:e.data.value.renderType){case"configurable":l=To;break;case"configuration":l=go;break;case"trigger":l=Ee;break;default:l=Ee}return De(l,s.default)};return(l,u)=>(b(),I(t))}}),Io=T({__name:"CanvasHandleMainInput",setup(o){const e=V(oe),s=S(),t=d(()=>(e==null?void 0:e.label.value)??"");return(l,u)=>(b(),x("div",{class:w(["canvas-node-handle-main-input",v(s).handle])},[R("div",{class:w(v(s).label)},z(t.value),3)],2))}}),Eo="_handle_xh297_1",So="_label_xh297_11",Mo={handle:Eo,label:So},Bo={$style:Mo},Ro=E(Io,[["__cssModules",Bo]]),Do=T({__name:"CanvasHandleMainOutput",setup(o){const e=V(oe),s=S(),t=d(()=>(e==null?void 0:e.label.value)??"");return(l,u)=>(b(),x("div",{class:w(["canvas-node-handle-main-output",v(s).handle])},[R("div",{class:w(v(s).label)},z(t.value),3),R("div",{class:w(v(s).circle)},null,2)],2))}}),Oo="_handle_ro506_1",Po="_circle_ro506_6",Wo="_plus_ro506_16",Vo="_label_ro506_28",Ho={handle:Oo,circle:Po,plus:Wo,label:Vo},Ao={$style:Ho},Uo=E(Do,[["__cssModules",Ao]]),jo=T({__name:"CanvasHandleNonMain",setup(o){const e=V(oe),s=S(),t=d(()=>(e==null?void 0:e.label.value)??"");return(l,u)=>(b(),x("div",{class:w(["canvas-node-handle-non-main",v(s).handle])},[R("div",{class:w(v(s).diamond)},null,2),R("div",{class:w(v(s).label)},z(t.value),3)],2))}}),zo="_handle_b5gv0_1",Lo="_diamond_b5gv0_7",qo="_label_b5gv0_17",Fo={handle:zo,diamond:Lo,label:qo},Ko={$style:Fo},Yo=E(jo,[["__cssModules",Ko]]),Xo=T({__name:"HandleRenderer",props:{mode:{},label:{},type:{},index:{},position:{},offset:{}},setup(o){const e=o,s=S(),t=d(()=>e.mode==="input"?"target":"source"),l=d(()=>e.mode==="output"),u=d(()=>e.mode==="input"),_=f=>{let y;return e.type===W.Main?e.mode==="input"?y=Ro:y=Uo:y=Yo,De(y,f)},c=A(e,"label");return Oe(oe,{label:c}),(f,y)=>(b(),I(v(_t),{id:`${f.mode}s/${f.type}/${f.index}`,class:w([v(s).handle]),type:t.value,position:f.position,style:F(f.offset),"connectable-start":l.value,"connectable-end":u.value},{default:D(()=>[k(_,{label:c.value},null,8,["label"])]),_:1},8,["id","class","type","position","style","connectable-start","connectable-end"]))}}),Go="_handle_n4rp3_1",Jo={handle:Go},Zo={$style:Jo},Se=E(Xo,[["__cssModules",Zo]]),Qo=T({__name:"CanvasNode",props:{id:{},type:{},selected:{type:Boolean},connectable:{type:[Boolean,Number,String,Function]},position:{},dimensions:{},label:{},isValidTargetPos:{type:Function},isValidSourcePos:{type:Function},parent:{},parentNodeId:{},dragging:{type:Boolean},resizing:{type:Boolean},zIndex:{},targetPosition:{},sourcePosition:{},dragHandle:{},data:{},events:{}},emits:["delete"],setup(o,{emit:e}){const s=e,t=o,l=d(()=>t.data.inputs),u=d(()=>t.data.outputs),_=fe(),{mainInputs:c,nonMainInputs:f,mainOutputs:y,nonMainOutputs:g}=me({inputs:l,outputs:u}),n=d(()=>_.getNodeType(t.data.type,t.data.typeVersion)),r=d(()=>[...c.value.map(i(Q.Left,"top")),...f.value.map(i(Q.Bottom,"left"))]),a=d(()=>[...y.value.map(i(Q.Right,"top")),...g.value.map(i(Q.Top,"left"))]),i=(j,Y)=>(C,ne,se)=>({...C,position:j,offset:{[Y]:`${100/(se.length+1)*(ne+1)}%`}}),N=A(t,"id"),$=A(t,"data"),M=A(t,"label"),P=A(t,"selected");Oe(L,{id:N,data:$,label:M,selected:P,nodeType:n});function U(){s("delete",t.id)}return(j,Y)=>(b(),x("div",{class:w(j.$style.canvasNode),"data-test-id":"canvas-node"},[(b(!0),x(de,null,ke(a.value,C=>(b(),I(Se,{key:`${C.type}/${C.index}`,mode:"output","data-test-id":"canvas-node-output-handle",type:C.type,label:C.label,index:C.index,position:C.position,offset:C.offset},null,8,["type","label","index","position","offset"]))),128)),(b(!0),x(de,null,ke(r.value,C=>(b(),I(Se,{key:`${C.type}/${C.index}`,mode:"input","data-test-id":"canvas-node-input-handle",type:C.type,label:C.label,index:C.index,position:C.position,offset:C.offset},null,8,["type","label","index","position","offset"]))),128)),n.value?(b(),I(ao,{key:0,"data-test-id":"canvas-node-toolbar",class:w(j.$style.canvasNodeToolbar),onDelete:U},null,8,["class"])):O("",!0),n.value?(b(),I(xo,{key:1},{default:D(()=>[k(Tt,{"node-type":n.value,size:40,shrink:!1},null,8,["node-type"])]),_:1})):O("",!0)],2))}}),en="_canvasNode_4o1th_1",tn="_canvasNodeToolbar_4o1th_1",on={canvasNode:en,canvasNodeToolbar:tn},nn={$style:on},sn=E(Qo,[["__cssModules",nn]]),an=T({__name:"CanvasEdge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},emits:["delete"],setup(o,{emit:e}){const s=e,t=o,l=K(),u=S(),_=d(()=>({strokeWidth:2,...t.style})),c=d(()=>({transform:`translate(-50%, -50%) translate(${f.value[1]}px,${f.value[2]}px)`})),f=d(()=>yt({sourceX:t.sourceX,sourceY:t.sourceY,sourcePosition:t.sourcePosition,targetX:t.targetX,targetY:t.targetY,targetPosition:t.targetPosition})),y=d(()=>({source:t.source,target:t.target,sourceHandle:t.sourceHandleId,targetHandle:t.targetHandleId}));function g(){s("delete",y.value)}return(n,r)=>{var i;const a=pe("N8nIconButton");return b(),x(de,null,[k(v(bt),{id:n.id,style:F(_.value),path:f.value[0],"marker-end":n.markerEnd,label:(i=n.data)==null?void 0:i.label,"label-x":f.value[1],"label-y":f.value[2],"label-style":{fill:"white"},"label-show-bg":!0,"label-bg-style":{fill:"red"},"label-bg-padding":[2,4],"label-bg-border-radius":2},null,8,["id","style","path","marker-end","label","label-x","label-y"]),k(v(gt),null,{default:D(()=>[R("div",{class:w([v(u).edgeToolbar,"nodrag","nopan"]),style:F(c.value)},[k(a,{"data-test-id":"delete-connection-button",type:"tertiary",size:"small",icon:"trash",title:v(l).baseText("node.delete"),onClick:g},null,8,["title"])],6)]),_:1})],64)}}}),ln="_edgeToolbar_ve6hj_1",rn={edgeToolbar:ln},cn={$style:rn},dn=E(an,[["__cssModules",cn]]),un=T({__name:"Canvas",props:{id:{default:"canvas"},elements:{default:()=>[]},connections:{default:()=>[]},controlsPosition:{default:wt.BottomLeft}},emits:["update:modelValue","update:node:position","delete:node","delete:connection","create:connection"],setup(o,{emit:e}){const s=S(),t=e,l=o,{getSelectedEdges:u,getSelectedNodes:_}=Nt({id:l.id});Pe(()=>{document.addEventListener("keydown",n)}),ct(()=>{document.removeEventListener("keydown",n)});function c(r){r.nodes.forEach(a=>{t("update:node:position",a.id,a.position)})}function f(r){t("delete:node",r)}function y(r){t("delete:connection",r)}function g(...r){t("create:connection",r[0])}function n(r){r.key==="Delete"&&(u.value.forEach(y),_.value.forEach(({id:a})=>f(a)))}return(r,a)=>(b(),I(v(Ct),{id:r.id,nodes:r.elements,edges:r.connections,"apply-changes":!1,"fit-view-on-init":"","pan-on-scroll":"","min-zoom":.2,"max-zoom":2,"data-test-id":"canvas",onNodeDragStop:c,onConnect:g},{"node-canvas-node":D(i=>[k(sn,ue(i,{onDelete:f}),null,16)]),"edge-canvas-edge":D(i=>[k(dn,ue(i,{onDelete:y}),null,16)]),default:D(()=>[k(v(ht),{"data-test-id":"canvas-background","pattern-color":"#aaa",gap:16}),k(v(kt),{"data-test-id":"canvas-minimap",pannable:""}),k(v($t),{"data-test-id":"canvas-controls",class:w(v(s).canvasControls),position:r.controlsPosition},null,8,["class","position"])]),_:1},8,["id","nodes","edges"]))}});function pn(o,e){const s=[];return Object.keys(o).forEach(t=>{var _;const l=(_=e.find(c=>c.name===t))==null?void 0:_.id;Object.keys(o[t]).forEach(c=>{o[t][c].forEach((y,g)=>{y.forEach(n=>{var N;const r=(N=e.find($=>$.name===n.node))==null?void 0:N.id,a=n.type,i=n.index;l&&r&&s.push({id:`[${l}/${c}/${g}][${r}/${a}/${i}]`,source:l,target:r,sourceHandle:`outputs/${c}/${g}`,targetHandle:`inputs/${a}/${i}`,data:{fromNodeName:t,source:{index:g,type:c},target:{index:i,type:a}}})})})})}),s}function Me(o){const[,e,s]=(o??"").split("/"),t=xt(e)?e:W.Main;let l=parseInt(s,10);return isNaN(l)&&(l=0),{type:t,index:l}}function Be(o,e,s){const t=(o==null?void 0:o.name)??"",{type:l,index:u}=Me(s.sourceHandle),_=(e==null?void 0:e.name)??"",{type:c,index:f}=Me(s.targetHandle);return[{node:t,type:l,index:u},{node:_,type:c,index:f}]}function Re(o){return typeof o=="string"?(console.warn("Node endpoints have not been evaluated",o),[]):o.map((e,s)=>{const t=typeof e=="string"?e:e.type,l=typeof e=="string"?void 0:e.displayName,u=o.slice(0,s+1).filter(c=>(typeof c=="string"?c:c.type)===t).length-1,_=typeof e=="string"?!1:e.required;return{type:t,index:u,label:l,..._?{required:_}:{}}})}function fn(o,e){if(!e.has(o))return o;for(let s=1;s<100;s++){const t=`${o} ${s}`;if(!e.has(t))return t}return`${o} ${Ae()}`}function vn({workflow:o,workflowObject:e}){const s=K(),t=fe(),l=d(()=>o.value.nodes.reduce((n,r)=>{let a="default";switch(!0){case t.isTriggerNode(r.type):a="trigger";break;case t.isConfigNode(e.value,r,r.type):a="configuration";break;case t.isConfigurableNode(e.value,r,r.type):a="configurable";break}return n[r.type]=a,n},{})??{}),u=d(()=>o.value.nodes.reduce((n,r)=>{const a=t.getNodeType(r.type),i=e.value.getNode(r.name);return n[r.id]=i&&a?Re(at(e.value,i,a)):[],n},{})),_=d(()=>o.value.nodes.reduce((n,r)=>{const a=t.getNodeType(r.type),i=e.value.getNode(r.name);return n[r.id]=i&&a?Re(lt(e.value,i,a)):[],n},{})),c=d(()=>[...o.value.nodes.map(n=>{const r={id:n.id,type:n.type,typeVersion:n.typeVersion,inputs:u.value[n.id]??[],outputs:_.value[n.id]??[],renderType:l.value[n.type]??"default"};return{id:n.id,label:n.name,type:"canvas-node",position:{x:n.position[0],y:n.position[1]},data:r}})]),f=d(()=>pn(o.value.connections??[],o.value.nodes??[]).map(r=>{const a=y(),i=g(r);return{...r,type:a,label:i}}));function y(n){return"canvas-edge"}function g(n){var a,i;const r=(i=o.value.pinData)==null?void 0:i[((a=n.data)==null?void 0:a.fromNodeName)??""];return r!=null&&r.length?s.baseText("ndv.output.items",{adjustToNumber:r.length,interpolate:{count:String(r.length)}}):""}return{connections:f,elements:c}}const mn=T({__name:"WorkflowCanvas",props:{id:{},workflow:{},workflowObject:{}},setup(o){const e=o,s=S(),t=A(e,"workflow"),l=A(e,"workflowObject"),{elements:u,connections:_}=vn({workflow:t,workflowObject:l});return(c,f)=>(b(),x("div",{class:w(v(s).wrapper)},[R("div",{class:w(v(s).canvas)},[t.value?(b(),I(un,ue({key:0,elements:v(u),connections:v(_)},c.$attrs),null,16,["elements","connections"])):O("",!0)],2),te(c.$slots,"default")],2))}}),_n="_wrapper_jh0fs_1",yn="_canvas_jh0fs_9",bn="_executionButtons_jh0fs_16",gn={wrapper:_n,canvas:yn,executionButtons:bn},wn={$style:gn},Nn=E(mn,[["__cssModules",wn]]),Cn=T({__name:"CanvasExecuteWorkflowButton",emits:["click"],setup(o){const e=ve(),s=K(),t=d(()=>e.isActionActive("workflowRunning")),l=d(()=>t.value?s.baseText("nodeView.runButtonText.executingWorkflow"):s.baseText("nodeView.runButtonText.executeWorkflow"));return(u,_)=>{const c=pe("N8nButton");return b(),I(It,{label:l.value,shortcut:{metaKey:!0,keys:["↵"]}},{default:D(()=>[k(c,{loading:t.value,label:l.value,size:"large",icon:"flask",type:"primary","data-test-id":"execute-workflow-button",onClick:_[0]||(_[0]=dt(f=>u.$emit("click",f),["stop"]))},null,8,["loading","label"])]),_:1},8,["label"])}}});function hn(){const o=We(),e=Et(),s=ve(),t=Ve(),l=He();function u(a,i,{trackHistory:N=!1,trackBulk:$=!0}={}){const M=o.getNodeById(a);if(!M)return;N&&$&&e.startRecordingUndo();const P=[...M.position],U=[i.x,i.y];o.setNodePositionById(a,U),N&&(e.pushCommandToUndo(new St(M.name,P,U)),$&&e.stopRecordingUndo())}function _(a,{trackHistory:i=!1,trackBulk:N=!0}={}){const $=o.getNodeById(a);$&&(i&&N&&e.startRecordingUndo(),o.removeNodeById(a),o.removeNodeConnectionsById(a),o.removeNodeExecutionDataById(a),i&&(e.pushCommandToUndo(new Mt($)),N&&e.stopRecordingUndo()),f(a))}function c(a){o.addNode(a)}function f(a){const i=o.getNodeById(a);i&&(i.type===Bt?t.track("User deleted workflow note",{workflow_id:o.workflowId,is_welcome_note:i.name===Rt}):(l.run("node.deleteNode",{node:i}),t.track("User deleted node",{node_type:i.type,workflow_id:o.workflowId})))}function y(a){const i=o.getNodeById(a.source),N=o.getNodeById(a.target);if(!i||!N||!r(i,N))return;const $=Be(i,N,a);o.addConnection({connection:$}),s.stateIsDirty=!0}function g(a,{trackHistory:i=!1,trackBulk:N=!0}={}){const $=o.getNodeById(a.source),M=o.getNodeById(a.target);if(!$||!M)return;const P=Be($,M,a);i&&N&&e.startRecordingUndo(),o.removeConnection({connection:P}),i&&(e.pushCommandToUndo(new Dt(P)),N&&e.stopRecordingUndo())}function n(a){o.addConnection({connection:a})}function r(a,i){return a.id!==i.id}return{updateNodePosition:u,deleteNode:_,revertDeleteNode:c,trackDeleteNode:f,createConnection:y,deleteConnection:g,revertDeleteConnection:n,isConnectionAllowed:r}}const $n=T({__name:"NodeView.v2",setup(o){const e=mt(async()=>await rt(()=>import("./NodeCreation-DHuCOx3T.js").then(p=>p.N),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),s=S(),t=ut(),l=pt(),u=K(),_=Ve(),c=He(),f=Ot(),y=fe(),g=ve(),n=We();Pt();const r=Wt(),a=Vt(),i=Gt(),N=Ht(),$=At(),M=Ut(),P=jt(),U=zt(),j=Jt(),{runWorkflow:Y}=Lt({router:t}),{updateNodePosition:C,deleteNode:ne,revertDeleteNode:se,createConnection:Ue,deleteConnection:je,revertDeleteConnection:ze}=hn(),ae=Te(!0),_e=Te(null),X=d(()=>l.params.workflowId),le=d(()=>n.workflowsById[X.value]),H=d(()=>n.workflow),ye=d(()=>n.getCurrentWorkflow()),be=d(()=>l.name===qt.DEMO),re=d(()=>{var p;return((p=l==null?void 0:l.meta)==null?void 0:p.readOnlyCanvas)===!0}),q=d(()=>a.preferences.branchReadOnly),ge=d(()=>n.workflowTriggerNodes);d(()=>ge.value.length>0&&!ae.value&&!be.value&&!q.value),Pe(()=>{Le()});async function Le(){ae.value=!0;const p=[y.getNodeTypes(),n.fetchWorkflow(X.value)];!N.isPreviewMode&&!be.value&&(p.push(n.fetchActiveWorkflows(),$.fetchAllCredentials(),$.fetchCredentialTypes(!0)),N.isEnterpriseFeatureEnabled(xe.Variables)&&p.push(M.fetchAllVariables()),N.isEnterpriseFeatureEnabled(xe.ExternalSecrets)&&p.push(P.fetchAllSecrets()));try{await Promise.all(p)}catch(m){return f.showError(m,u.baseText("nodeView.showError.mounted1.title"),u.baseText("nodeView.showError.mounted1.message")+":")}Ke(X.value),qe(),window.parent&&window.parent.postMessage(JSON.stringify({command:"n8nReady",version:U.versionCli}),"*"),ae.value=!1}ft(()=>{Fe()});function qe(){ee.on("revertRemoveNode",we),ee.on("revertRemoveConnection",Ce)}function Fe(){ee.off("revertRemoveNode",we),ee.off("revertRemoveConnection",Ce)}function Ke(p){const m=n.workflowsById[p];n.addWorkflow(m),n.setWorkflow(m),n.setActive(m.active||!1),n.setWorkflowId(m.id),n.setWorkflowName({newName:m.name,setStateDirty:!1}),n.setWorkflowSettings(m.settings??{}),n.setWorkflowPinData(m.pinData??{}),n.setWorkflowVersionId(m.versionId),n.setWorkflowMetadata(m.meta),m.usedCredentials&&n.setUsedCredentials(m.usedCredentials);const h=m.tags??[],B=h.map(G=>G.id);n.setWorkflowTagIds(B||[]),r.upsertTags(h),c.run("workflow.open",{workflowId:le.value.id,workflowName:le.value.name}),j.notifyWorkflowOpened(le.value.id)}async function Ye(){await Y({})}function Xe(p,m){C(p,m,{trackHistory:!0})}function Ge(p){ne(p,{trackHistory:!0})}function we({node:p}){se(p)}function Ne(p){Ue(p)}function Je(p){je(p,{trackHistory:!0})}function Ce({connection:p}){ze(p)}function Ze({source:p,createNodeActive:m,nodeCreatorView:h}){if(m===g.isCreateNodeActive)return;h||(h=ge.value.length>0?Ie:Ft),i.setSelectedView(h);let B;switch(i.selectedView){case Xt:B="ai";break;case Ie:B="regular";break;default:B="regular"}g.isCreateNodeActive=m,m&&p&&i.setOpenSource(p),c.run("nodeView.createNodeActiveChanged",{source:p,mode:B,createNodeActive:m}),_.trackNodesPanel("nodeView.createNodeActiveChanged",{source:p,mode:B,createNodeActive:m,workflow_id:X.value})}async function Qe({nodes:p,connections:m},h=!1,B){let G=B;for(const{type:J,name:Z,position:ie,isAutoAdd:ce,openDetail:nt}of p){try{await et({name:Z,type:J,position:ie??G},{dragAndDrop:h,openNDV:nt??!1,trackHistory:!0,isAutoAdd:ce})}catch(st){f.showError(st,u.baseText("error"));continue}const $e=H.value.nodes[H.value.nodes.length-1];G=[$e.position[0]+Kt*2+Yt,$e.position[1]]}const he=H.value.nodes.length-p.length;for(const{from:J,to:Z}of m){const ie=H.value.nodes[he+J.nodeIndex],ce=H.value.nodes[he+Z.nodeIndex];Ne({source:ie.id,sourceHandle:`outputs/${W.Main}/${J.outputIndex??0}`,target:ce.id,targetHandle:`inputs/${W.Main}/${Z.inputIndex??0}`})}}async function et(p,m={}){if(!ot())throw new Error(u.baseText("nodeViewV2.showError.editingNotAllowed"));const h=await tt(p);if(!h)throw new Error(u.baseText("nodeViewV2.showError.failedToCreateNode"));return h.name=fn(h.name,n.canvasNames),n.addNode(h),h}async function tt(p){const m=y.getNodeType(p.type);let h=m.defaultVersion;return h===void 0&&(h=Array.isArray(m.version)?m.version.slice(-1)[0]:m.version),{id:Ae(),name:p.name??m.defaults.name,type:m.name,typeVersion:h,position:p.position??[0,0],parameters:{}}}function ot(){var p;if((p=_e.value)!=null&&p.visible)return!1;if(re.value||q.value){const m=re.value?"executions":"workflows";return _e.value=f.showMessage({title:u.baseText(q.value?`readOnlyEnv.showMessage.${m}.title`:"readOnly.showMessage.executions.title"),message:u.baseText(q.value?`readOnlyEnv.showMessage.${m}.message`:"readOnly.showMessage.executions.message"),type:"info",dangerouslyUseHTMLString:!0}),!1}return!0}return(p,m)=>H.value&&ye.value?(b(),I(Nn,{key:0,workflow:H.value,"workflow-object":ye.value,"onUpdate:node:position":Xe,"onDelete:node":Ge,"onCreate:connection":Ne,"onDelete:connection":Je},{default:D(()=>[R("div",{class:w(v(s).executionButtons)},[k(Cn,{onClick:Ye})],2),(b(),I(vt,null,{default:D(()=>[!re.value&&!q.value?(b(),I(v(e),{key:0,"create-node-active":v(g).isCreateNodeActive,"node-view-scale":1,onToggleNodeCreator:Ze,onAddNodes:Qe},null,8,["create-node-active"])):O("",!0)]),_:1}))]),_:1},8,["workflow","workflow-object"])):O("",!0)}}),kn="_executionButtons_1bnph_1",Tn={executionButtons:kn},xn={$style:Tn},cs=E($n,[["__cssModules",xn]]);export{cs as default};
//# sourceMappingURL=NodeView.v2-B5Hn0oJ1.js.map
