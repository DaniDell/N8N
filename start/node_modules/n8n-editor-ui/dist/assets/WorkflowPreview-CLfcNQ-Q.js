import{u as $,l as b,J as B,w as A}from"./index-DEwaaDne.js";import{G as J,r as a,e as M,b as R,y as C,d as f,l as m,m as v,I as d,U as P,R as U,p as X,ag as V}from"./vendor-Dv5OeN6t.js";import{_ as Y}from"./n8n-B6cfQsVX.js";const j=["src"],G=J({__name:"WorkflowPreview",props:{loading:{type:Boolean,default:!1},mode:{default:"workflow"},workflow:{},executionId:{},executionMode:{},loaderType:{default:"image"},canOpenNDV:{type:Boolean,default:!0},hideNodeIssues:{type:Boolean,default:!1}},emits:["close"],setup(I,{emit:D}){const e=I,T=D,s=A(),p=$();b();const k=B(),l=a(null),c=a(!1),y=a(!1),u=a(!1),_=a(0),E=a(0),O=M(()=>`${window.BASE_PATH??"/"}workflows/demo`),t=M(()=>!e.loading&&(e.mode==="workflow"&&e.workflow||e.mode==="execution"&&e.executionId)&&y.value),x=()=>{var o,n,r;try{if(!e.workflow)throw new Error(s.baseText("workflowPreview.showError.missingWorkflow"));if(!e.workflow.nodes||!Array.isArray(e.workflow.nodes))throw new Error(s.baseText("workflowPreview.showError.arrayEmpty"));(r=(n=(o=l.value)==null?void 0:o.contentWindow)==null?void 0:n.postMessage)==null||r.call(n,JSON.stringify({command:"openWorkflow",workflow:e.workflow,canOpenNDV:e.canOpenNDV,hideNodeIssues:e.hideNodeIssues}),"*")}catch(i){p.showError(i,s.baseText("workflowPreview.showError.previewError.title"),s.baseText("workflowPreview.showError.previewError.message"))}},g=()=>{var o,n,r,i,w,z;try{if(!e.executionId)throw new Error(s.baseText("workflowPreview.showError.missingExecution"));(r=(n=(o=l.value)==null?void 0:o.contentWindow)==null?void 0:n.postMessage)==null||r.call(n,JSON.stringify({command:"openExecution",executionId:e.executionId,executionMode:e.executionMode||"",canOpenNDV:e.canOpenNDV}),"*"),k.activeExecution&&((z=(w=(i=l.value)==null?void 0:i.contentWindow)==null?void 0:w.postMessage)==null||z.call(w,JSON.stringify({command:"setActiveExecution",executionId:k.activeExecution.id}),"*"))}catch(W){p.showError(W,s.baseText("workflowPreview.showError.previewError.title"),s.baseText("workflowPreview.executionMode.showError.previewError.message"))}},S=()=>{u.value=!0,_.value=window.scrollX,E.value=window.scrollY},L=()=>{u.value=!1},h=({data:o})=>{var n;if((n=o==null?void 0:o.includes)!=null&&n.call(o,'"command"'))try{const r=JSON.parse(o);r.command==="n8nReady"?y.value=!0:r.command==="openNDV"?c.value=!0:r.command==="closeNDV"?c.value=!1:r.command==="error"&&T("close")}catch(r){console.error(r)}},N=()=>{u.value&&window.scrollTo(_.value,E.value)};return R(()=>{window.addEventListener("message",h),document.addEventListener("scroll",N)}),C(()=>{window.removeEventListener("message",h),document.removeEventListener("scroll",N)}),f(()=>t.value,()=>{t.value&&(e.mode==="workflow"?x():e.mode==="execution"&&g())}),f(()=>e.executionId,()=>{e.mode==="execution"&&e.executionId&&g()}),f(()=>e.workflow,()=>{e.mode==="workflow"&&e.workflow&&x()}),(o,n)=>{const r=V("n8n-loading"),i=V("n8n-spinner");return m(),v("div",{class:d(o.$style.container)},[o.loaderType==="image"&&!t.value?(m(),v("div",{key:0,class:d(o.$style.imageLoader)},[P(r,{loading:!t.value,rows:1,variant:"image"},null,8,["loading"])],2)):o.loaderType==="spinner"&&!t.value?(m(),v("div",{key:1,class:d(o.$style.spinner)},[P(i,{type:"dots"})],2)):U("",!0),X("iframe",{ref_key:"iframeRef",ref:l,class:d({[o.$style.workflow]:!c.value,[o.$style.executionPreview]:o.mode==="execution",[o.$style.openNDV]:c.value,[o.$style.show]:t.value}),src:O.value,"data-test-id":"workflow-preview-iframe",onMouseenter:S,onMouseleave:L},null,42,j)],2)}}}),H="_container_tdzzv_1",q="_workflow_tdzzv_8",F="_show_tdzzv_14",K="_openNDV_tdzzv_20",Q="_spinner_tdzzv_29",Z="_imageLoader_tdzzv_37",ee="_executionPreview_tdzzv_45",oe={container:H,workflow:q,show:F,openNDV:K,spinner:Q,imageLoader:Z,executionPreview:ee},re={$style:oe},ie=Y(G,[["__cssModules",re]]);export{ie as W};
//# sourceMappingURL=WorkflowPreview-CLfcNQ-Q.js.map
