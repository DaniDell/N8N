import{R as B}from"./ResourcesListLayout-CjzGJ-eS.js";import{cX as D,e7 as M,G as U,o as A,a as z,i as k,ar as P,e8 as V,z as F,bs as O,n as R,a4 as H,e9 as W,b as Y,E as G,bt as q}from"./index-DEwaaDne.js";import{d as K}from"./dateformat-B9ocXky7.js";import{m as L}from"./pinia-BAhPp3pQ.js";import{_ as X}from"./ProjectCardBadge.vue_vue_type_script_setup_true_lang-BzALVLd6.js";import{G as j,ag as a,l as m,M as $,O as r,U as n,I as p,S as y,T as l,p as d,a2 as J,m as v,R as Q,P as g,V as E,F as Z,a7 as x}from"./vendor-Dv5OeN6t.js";import{_ as I}from"./n8n-B6cfQsVX.js";import{P as ee}from"./ProjectTabs-BjpVZIIc.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";const u={OPEN:"open",DELETE:"delete"},te=j({components:{TimeAgo:D,CredentialIcon:M,ProjectCardBadge:X},props:{data:{type:Object,required:!0,default:()=>({id:"",createdAt:"",updatedAt:"",type:"",name:"",sharedWithProjects:[],homeProject:{}})},readonly:{type:Boolean,default:!1}},setup(){return{...U()}},computed:{...L(P,k,z,A),currentUser(){return this.usersStore.currentUser},credentialType(){return this.credentialsStore.getCredentialTypeByName(this.data.type)},credentialPermissions(){return this.currentUser?V(this.data):null},actions(){return this.credentialPermissions?[{label:this.$locale.baseText("credentials.item.open"),value:u.OPEN}].concat(this.credentialPermissions.delete?[{label:this.$locale.baseText("credentials.item.delete"),value:u.DELETE}]:[]):[]},formattedCreatedAtDate(){const e=new Date().getFullYear().toString();return K(this.data.createdAt,`d mmmm${this.data.createdAt.startsWith(e)?"":", yyyy"}`)}},methods:{async onClick(e){const t=this.$refs.cardActions,s=e.target;t===s||s&&(t!=null&&t.contains(s))||this.uiStore.openExistingCredential(this.data.id)},async onAction(e){e===u.OPEN?await this.onClick(new Event("click")):e===u.DELETE&&await this.confirm(this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.message",{interpolate:{savedCredentialName:this.data.name}}),this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.headline"),{confirmButtonText:this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.confirmButtonText")})===F&&await this.credentialsStore.deleteCredential({id:this.data.id})}}}),se="_cardLink_1no2l_1",ae="_cardHeading_1no2l_11",re="_cardDescription_1no2l_19",ne="_cardActions_1no2l_26",oe={cardLink:se,cardHeading:ae,cardDescription:re,cardActions:ne},ie={key:0};function le(e,t,s,i,N,w){const h=a("CredentialIcon"),C=a("n8n-heading"),f=a("TimeAgo"),_=a("n8n-text"),b=a("ProjectCardBadge"),T=a("n8n-action-toggle"),S=a("n8n-card");return m(),$(S,{class:p(e.$style.cardLink),onClick:e.onClick},{prepend:r(()=>[n(h,{"credential-type-name":e.credentialType?e.credentialType.name:""},null,8,["credential-type-name"])]),header:r(()=>[n(C,{tag:"h2",bold:"",class:p(e.$style.cardHeading)},{default:r(()=>[y(l(e.data.name),1)]),_:1},8,["class"])]),append:r(()=>[n(b,{resource:e.data,"personal-project":e.projectsStore.personalProject},null,8,["resource","personal-project"]),d("div",{ref:"cardActions",class:p(e.$style.cardActions)},[n(T,{actions:e.actions,theme:"dark",onAction:e.onAction,onClick:t[0]||(t[0]=J(()=>{},["stop"]))},null,8,["actions","onAction"])],2)]),default:r(()=>[d("div",{class:p(e.$style.cardDescription)},[n(_,{color:"text-light",size:"small"},{default:r(()=>[e.credentialType?(m(),v("span",ie,l(e.credentialType.displayName)+" | ",1)):Q("",!0),g(d("span",null,[y(l(e.$locale.baseText("credentials.item.updated"))+" ",1),n(f,{date:e.data.updatedAt},null,8,["date"]),y(" | ")],512),[[E,e.data]]),g(d("span",null,l(e.$locale.baseText("credentials.item.created"))+" "+l(e.formattedCreatedAtDate),513),[[E,e.data]])]),_:1})],2)]),_:1},8,["class","onClick"])}const de={$style:oe},ce=I(te,[["render",le],["__cssModules",de]]),pe=j({name:"CredentialsView",components:{ResourcesListLayout:B,CredentialCard:ce,ProjectTabs:ee},data(){return{filters:{search:"",homeProject:"",type:""},sourceControlStoreUnsubscribe:()=>{}}},computed:{...L(P,H,k,R,O,A),allCredentials(){return this.credentialsStore.allCredentials},allCredentialTypes(){return this.credentialsStore.allCredentialTypes},credentialTypesById(){return this.credentialsStore.credentialTypesById},addCredentialButtonText(){return this.projectsStore.currentProject?this.$locale.baseText("credentials.project.add"):this.$locale.baseText("credentials.add")}},watch:{"filters.type"(){this.sendFiltersTelemetry("type")},"$route.params.projectId"(){this.initialize()}},mounted(){this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:t})=>{e==="pullWorkfolder"&&t&&t(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{addCredential(){this.uiStore.openModal(W),this.$telemetry.track("User clicked add cred button",{source:"Creds list"})},async initialize(){var s,i;const e=Y().isEnterpriseFeatureEnabled(G.Variables),t=[this.credentialsStore.fetchAllCredentials((i=(s=this.$route)==null?void 0:s.params)==null?void 0:i.projectId),this.credentialsStore.fetchCredentialTypes(!1),this.externalSecretsStore.fetchAllSecrets(),this.nodeTypesStore.loadNodeTypesIfNotLoaded(),e?q().fetchAllVariables():Promise.resolve()];await Promise.all(t)},onFilter(e,t,s){if(t.type.length>0&&(s=s&&t.type.includes(e.type)),t.search){const i=t.search.toLowerCase();s=s||this.credentialTypesById[e.type]&&this.credentialTypesById[e.type].displayName.toLowerCase().includes(i)}return s},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)}}}),me="_sidebarContainer_pm4w0_5",ue={"type-input":"_type-input_pm4w0_1",sidebarContainer:me},ye={class:"mb-s"};function he(e,t,s,i,N,w){const h=a("ProjectTabs"),C=a("n8n-button"),f=a("CredentialCard"),_=a("n8n-input-label"),b=a("n8n-option"),T=a("n8n-select"),S=a("ResourcesListLayout");return m(),$(S,{ref:"layout","resource-key":"credentials",resources:e.allCredentials,initialize:e.initialize,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:77},"onClick:add":e.addCredential,"onUpdate:filters":t[0]||(t[0]=o=>e.filters=o)},{header:r(()=>[n(h)]),"add-button":r(({disabled:o})=>[d("div",null,[n(C,{size:"large",block:"",disabled:o,"data-test-id":"resources-list-add",onClick:e.addCredential},{default:r(()=>[y(l(e.addCredentialButtonText),1)]),_:2},1032,["disabled","onClick"])])]),default:r(({data:o})=>[n(f,{"data-test-id":"resources-list-item",class:"mb-2xs",data:o},null,8,["data"])]),filters:r(({setKeyValue:o})=>[d("div",ye,[n(_,{label:e.$locale.baseText("credentials.filters.type"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),n(T,{ref:"typeInput","model-value":e.filters.type,size:"medium",multiple:"",filterable:"",class:p(e.$style["type-input"]),"onUpdate:modelValue":c=>o("type",c)},{default:r(()=>[(m(!0),v(Z,null,x(e.allCredentialTypes,c=>(m(),$(b,{key:c.name,value:c.name,label:c.displayName},null,8,["value","label"]))),128))]),_:2},1032,["model-value","class","onUpdate:modelValue"])])]),_:1},8,["resources","initialize","filters","additional-filters-handler","onClick:add"])}const Ce={$style:ue},Xe=I(pe,[["render",he],["__cssModules",Ce]]);export{Xe as default};
//# sourceMappingURL=CredentialsView-lvIyWvdA.js.map
