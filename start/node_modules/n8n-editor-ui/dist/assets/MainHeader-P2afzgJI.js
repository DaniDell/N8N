import{G as y,l as c,m as v,H as z,M as C,O as h,p as O,a7 as He,F as Xe,J as ze,ag as w,I as k,S as Y,T as F,U as f,P as Te,a8 as we,aq as je,a2 as Ge,r as A,e as W,b as Ye,y as qe,aH as Ee,az as Je,d as Qe,u as b,R as q,av as Ze,V as et}from"./vendor-Dv5OeN6t.js";import{m as ye}from"./pinia-BAhPp3pQ.js";import{s as tt,c as $e,d as ot,B as he,e as ve,f as be,g as ke,h as st,i as ne,a as Se,j as re,k as at,T as nt,l as rt,m as it,b as lt,n as Oe,o as ut,u as dt,p as ct,P as X,V as m,q as pt,W as E,r as mt,E as _e,t as ft,v as wt,S as ht,w as vt,x as bt,y as ge,z as kt,A as _t,C as gt,D as Tt,F as Et,G as yt,H as $t,I as B,J as St,K as Ot,L as It}from"./index-DEwaaDne.js";import{_ as $,b as x}from"./n8n-B6cfQsVX.js";import{d as Wt}from"./lodash-es-BxV-E8rt.js";import{P as Bt}from"./PushConnectionTracker-Dt9-l7zj.js";import{W as Ct}from"./WorkflowActivator-Bh0oXchL.js";import{u as Mt}from"./collaboration.store-zz8xH0zY.js";import{F as Rt}from"./file-saver-B3jMAULB.js";import{u as Nt}from"./usePushConnection-3xfZ5wSJ.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./useWorkflowActivate-BLjS7M0I.js";const Dt=25,Lt=4,Ut=y({name:"ShortenName",props:["name","limit","testId"],computed:{shortenedName(){return tt(this.name,this.limit||Dt,Lt)}}}),Vt=["title","data-test-id"];function At(e,t,s,a,r,d){return c(),v("span",{title:e.name,"data-test-id":e.testId},[z(e.$slots,"default",{shortenedName:e.shortenedName})],8,Vt)}const Ft=$(Ut,[["render",At]]),xt=y({name:"IntersectionObserver",props:{threshold:{type:Number,default:0},enabled:{type:Boolean,default:!1},eventBus:{type:Object,default:()=>x()}},data(){return{observer:null}},mounted(){if(!this.enabled)return;const e={root:this.$refs.root,rootMargin:"0px",threshold:this.threshold},t=new IntersectionObserver(s=>{s.forEach(({target:a,isIntersecting:r})=>{this.$emit("observed",{el:a,isIntersecting:r})})},e);this.observer=t,this.eventBus.on("observe",s=>{s&&t.observe(s)}),this.eventBus.on("unobserve",s=>{t.unobserve(s)})},beforeUnmount(){this.enabled&&this.observer&&this.observer.disconnect()}}),Pt={ref:"root"};function Kt(e,t,s,a,r,d){return c(),v("div",Pt,[z(e.$slots,"default")],512)}const Ht=$(xt,[["render",Kt]]),Xt=y({name:"IntersectionObserved",props:{enabled:{type:Boolean,default:!1},eventBus:{type:Object,default:()=>x()}},async mounted(){this.enabled&&(await this.$nextTick(),this.eventBus.emit("observe",this.$refs.observed))},beforeUnmount(){this.enabled&&this.eventBus.emit("unobserve",this.$refs.observed)}}),zt={ref:"observed"};function jt(e,t,s,a,r,d){return c(),v("span",zt,[z(e.$slots,"default")],512)}const Gt=$(Xt,[["render",jt]]),Yt=20,qt=y({name:"TagsContainer",components:{IntersectionObserver:Ht,IntersectionObserved:Gt},props:{tagIds:{type:Array,required:!0},limit:{type:Number,default:Yt},clickable:Boolean,responsive:Boolean,hoverable:Boolean},emits:{click:null},data(){return{maxWidth:320,intersectionEventBus:x(),visibility:{},debouncedSetMaxWidth:()=>{}}},computed:{...ye($e),style(){return{"max-width":`${this.maxWidth}px`}},tags(){const e=this.tagIds.map(a=>this.tagsStore.getTagById(a)).filter(Boolean);let t=this.limit?e.slice(0,this.limit):e;t=t.map(a=>({...a,hidden:this.responsive&&!this.visibility[a.id]}));let s=t.length;if(this.responsive&&(s=Object.values(this.visibility).reduce((a,r)=>r?a+1:a,0)),s<e.length){const a=e.slice(s),r=a.reduce((p,T)=>p?`${p}, ${T.name}`:T.name,""),d={id:"count",name:`+${a.length}`,title:r,isCount:!0};t.splice(s,0,d)}return t}},created(){this.debouncedSetMaxWidth=Wt(this.setMaxWidth,100)},mounted(){this.setMaxWidth(),window.addEventListener("resize",this.debouncedSetMaxWidth)},beforeUnmount(){window.removeEventListener("resize",this.debouncedSetMaxWidth)},methods:{setMaxWidth(){const s=this.$refs.tagsContainer.$el.parentNode;s&&(this.maxWidth=0,this.$nextTick(()=>{this.maxWidth=s.clientWidth}))},onObserved({el:e,isIntersecting:t}){e.dataset.id&&(this.visibility={...this.visibility,[e.dataset.id]:t})},onClick(e,t){this.clickable&&e.stopPropagation(),t.hidden||this.$emit("click",t.id)}}}),Jt={class:"tags"},Qt=["onClick"];function Zt(e,t,s,a,r,d){const p=w("el-tag"),T=w("IntersectionObserved"),l=w("IntersectionObserver");return c(),C(l,{ref:"tagsContainer",threshold:1,class:"tags-container",style:ze(e.style),enabled:e.responsive,"event-bus":e.intersectionEventBus,onObserved:e.onObserved},{default:h(()=>[O("span",Jt,[(c(!0),v(Xe,null,He(e.tags,_=>(c(),v("span",{key:_.id,class:k({clickable:!_.hidden}),onClick:L=>e.onClick(L,_)},[_.isCount?(c(),C(p,{key:0,title:_.title,type:"info",size:"small",class:"count-container","disable-transitions":!0},{default:h(()=>[Y(F(_.name),1)]),_:2},1032,["title"])):(c(),C(T,{key:1,class:k({hideTag:_.hidden}),"data-id":_.id,enabled:e.responsive,"event-bus":e.intersectionEventBus},{default:h(()=>[f(p,{title:_.name,type:"info",size:"small",class:k({hoverable:e.hoverable}),"disable-transitions":!0},{default:h(()=>[Y(F(_.name),1)]),_:2},1032,["title","class"])]),_:2},1032,["class","data-id","enabled","event-bus"]))],10,Qt))),128))])]),_:1},8,["style","enabled","event-bus","onObserved"])}const eo=$(qt,[["render",Zt],["__scopeId","data-v-f4d542ee"]]),to=y({name:"ExpandableInputBase",props:["modelValue","placeholder","staticSize"],computed:{hiddenValue(){let e=this.modelValue.replace(/\s/g,".");return e||(e=this.placeholder),`${e}`}}}),oo=["data-value"];function so(e,t,s,a,r,d){return c(),v("div",{class:k({"el-input":!0,"static-size":e.staticSize}),"data-value":e.hiddenValue},[z(e.$slots,"default",{},void 0,!0)],10,oo)}const Ie=$(to,[["render",so],["__scopeId","data-v-e0207138"]]),ao=y({name:"ExpandableInputEdit",components:{ExpandableInputBase:Ie},props:{modelValue:{type:String,required:!0},placeholder:{type:String,required:!0},maxlength:{type:Number},autofocus:{type:Boolean},eventBus:{type:Object}},emits:["update:modelValue","enter","blur","esc"],mounted(){var e;this.autofocus&&this.$refs.input&&this.focus(),(e=this.eventBus)==null||e.on("focus",this.focus)},beforeUnmount(){var e;(e=this.eventBus)==null||e.off("focus",this.focus)},methods:{focus(){this.$refs.input&&this.$refs.input.focus()},onInput(){this.$emit("update:modelValue",this.$refs.input.value)},onEnter(){this.$emit("enter",this.$refs.input.value)},onClickOutside(e){e.type==="click"&&this.$emit("blur",this.$refs.input.value)},onEscape(){this.$emit("esc")}}}),no=["value","placeholder","maxlength"];function ro(e,t,s,a,r,d){const p=w("ExpandableInputBase"),T=je("on-click-outside");return c(),C(p,{"model-value":e.modelValue,placeholder:e.placeholder},{default:h(()=>[Te(O("input",{ref:"input",class:"el-input__inner",value:e.modelValue,placeholder:e.placeholder,maxlength:e.maxlength,size:"4",onInput:t[0]||(t[0]=(...l)=>e.onInput&&e.onInput(...l)),onKeydown:[t[1]||(t[1]=we((...l)=>e.onEnter&&e.onEnter(...l),["enter"])),t[2]||(t[2]=we((...l)=>e.onEscape&&e.onEscape(...l),["esc"]))]},null,40,no),[[T,e.onClickOutside]])]),_:1},8,["model-value","placeholder"])}const io=$(ao,[["render",ro]]),lo=y({name:"ExpandableInputPreview",components:{ExpandableInputBase:Ie},props:["modelValue"]}),uo=["value"];function co(e,t,s,a,r,d){const p=w("ExpandableInputBase");return c(),C(p,{"model-value":e.modelValue,"static-size":!0},{default:h(()=>[O("input",{class:k({"el-input__inner":!0,clickable:!0}),value:e.modelValue,disabled:!0,size:"4"},null,8,uo)]),_:1},8,["model-value"])}const po=$(lo,[["render",co],["__scopeId","data-v-2b5f366c"]]),mo=y({name:"InlineTextEdit",components:{ExpandableInputEdit:io,ExpandableInputPreview:po},props:{isEditEnabled:{type:Boolean,default:!1},modelValue:{type:String,default:""},placeholder:{type:String,default:""},maxLength:{type:Number,default:0},previewValue:{type:String,default:""},disabled:{type:Boolean,default:!1}},data(){return{isDisabled:this.disabled,newValue:"",escPressed:!1,inputBus:x()}},watch:{disabled(e){this.isDisabled=e}},methods:{onInput(e){this.disabled||(this.newValue=e)},onClick(){this.disabled||(this.newValue=this.modelValue,this.$emit("toggle"))},onBlur(){this.disabled||(this.escPressed||this.submit(),this.escPressed=!1)},submit(){if(this.disabled)return;const e=t=>{this.isDisabled=!1,t||this.inputBus.emit("focus")};this.isDisabled=!0,this.$emit("submit",{name:this.newValue,onSubmit:e})},onEscape(){this.disabled||(this.escPressed=!0,this.$emit("toggle"))}}}),fo={key:0};function wo(e,t,s,a,r,d){const p=w("ExpandableInputEdit"),T=w("ExpandableInputPreview");return c(),v("span",{class:"inline-edit",onKeydown:t[1]||(t[1]=Ge(()=>{},["stop"]))},[e.isEditEnabled&&!e.isDisabled?(c(),v("span",fo,[f(p,{placeholder:e.placeholder,"model-value":e.newValue,maxlength:e.maxLength,autofocus:!0,"event-bus":e.inputBus,"onUpdate:modelValue":e.onInput,onEsc:e.onEscape,onBlur:e.onBlur,onEnter:e.submit},null,8,["placeholder","model-value","maxlength","event-bus","onUpdate:modelValue","onEsc","onBlur","onEnter"])])):(c(),v("span",{key:1,class:"preview",onClick:t[0]||(t[0]=(...l)=>e.onClick&&e.onClick(...l))},[f(T,{"model-value":e.previewValue||e.modelValue},null,8,["model-value"])]))],32)}const ho=$(mo,[["render",wo],["__scopeId","data-v-bfb9d8f5"]]),vo=y({name:"BreakpointsObserver",props:["valueXS","valueXL","valueLG","valueMD","valueSM","valueDefault"],setup(){const{callDebounced:e}=ot();return{callDebounced:e}},data(){return{width:window.innerWidth}},computed:{bp(){return this.width<he?"XS":this.width>=ve?"XL":this.width>=be?"LG":this.width>=ke?"MD":"SM"},value(){return this.valueXS!==void 0&&this.width<he?this.valueXS:this.valueXL!==void 0&&this.width>=ve?this.valueXL:this.valueLG!==void 0&&this.width>=be?this.valueLG:this.valueMD!==void 0&&this.width>=ke?this.valueMD:this.valueSM!==void 0?this.valueSM:this.valueDefault}},created(){window.addEventListener("resize",this.onResize)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{onResize(){this.callDebounced(this.onResizeEnd,{debounceTime:50})},async onResizeEnd(){this.width=window.innerWidth,await this.$nextTick();const e=await st();ne().updateBannersHeight(e)}}});function bo(e,t,s,a,r,d){return c(),v("span",null,[z(e.$slots,"default",{bp:e.bp,value:e.value})])}const ko=$(vo,[["render",bo]]),_o=y({__name:"CollaborationPane",setup(e){const t=Mt(),s=Se(),a=re(),r=5*nt.MINUTE,d=A(null),p=W(()=>{const S=(t.getUsersForCurrentWorkflow??[]).map(g=>g.user),M=S.find(at);return{defaultGroup:M?[M,...S.filter(g=>g.id!==M.id)]:S}}),T=W(()=>{var S;return(S=s.currentUser)==null?void 0:S.email}),l=()=>{d.value!==null&&(clearInterval(d.value),d.value=null),d.value=window.setInterval(()=>{t.notifyWorkflowOpened(a.workflow.id)},r)},_=()=>{d.value!==null&&clearInterval(d.value)},L=()=>{document.visibilityState==="hidden"?_():l()};return Ye(()=>{t.initialize(),l(),document.addEventListener("visibilitychange",L)}),qe(()=>{document.removeEventListener("visibilitychange",L),_(),t.terminate()}),(S,M)=>{const g=w("n8n-user-stack");return c(),v("div",{class:k(`collaboration-pane-container ${S.$style.container}`),"data-test-id":"collaboration-pane"},[f(g,{users:p.value,"current-user-email":T.value},null,8,["users","current-user-email"])],2)}}}),go="_container_iuui0_1",To={container:go},Eo={$style:To},yo=$(_o,[["__cssModules",Eo]]),$o={key:0,class:"tags","data-test-id":"workflow-tags-container"},So={key:1},Oo={key:1,class:"tags"},Io=y({__name:"WorkflowDetails",props:{workflow:{},readOnly:{type:Boolean}},setup(e){const t=e,s=Ze(),a=rt(),r=it(),d=lt(),p=Oe(),T=$e(),l=ne(),_=Se(),L=re(),S=ut(),M=Ee(),g=Je(),i=vt(),J=Et(),ie=yt(),U=dt(),We=$t(),j=ct({router:M}),R=A(!1),N=A(!1),G=A([]),Q=A(!1),Z=A(),le=x(),Be=x(),Ce=(o,u)=>{if(o.length!==u.length)return!0;const n=new Set(o);return u.reduce((I,D)=>I||!n.has(D),!1)},P=W(()=>!t.workflow.id||t.workflow.id===X||t.workflow.id==="new"),ue=W(()=>l.isActionActive("workflowSaving")),V=W(()=>g.meta&&(g.meta.nodeView||g.meta.keepWorkflowAlive===!0)),ee=W(()=>[m.EXECUTION_HOME.toString(),m.WORKFLOW_EXECUTIONS.toString(),m.EXECUTION_PREVIEW].includes(g.name||"")),Me=W(()=>pt(L.getWorkflowById(t.workflow.id))),Re=W(()=>{const o=[{id:E.DOWNLOAD,label:i.baseText("menuActions.download"),disabled:!V.value}];return t.readOnly||(o.unshift({id:E.DUPLICATE,label:i.baseText("menuActions.duplicate"),disabled:!V.value||!t.workflow.id}),o.push({id:E.IMPORT_FROM_URL,label:i.baseText("menuActions.importFromUrl"),disabled:!V.value||ee.value},{id:E.IMPORT_FROM_FILE,label:i.baseText("menuActions.importFromFile"),disabled:!V.value||ee.value})),mt(["rbac"],{rbac:{scope:"sourceControl:push"}})&&o.push({id:E.PUSH,label:i.baseText("menuActions.push"),disabled:!p.isEnterpriseSourceControlEnabled||!V.value||ee.value||p.preferences.branchReadOnly}),o.push({id:E.SETTINGS,label:i.baseText("generic.settings"),disabled:!V.value||P.value}),(Me.value.delete&&!t.readOnly||P.value)&&o.push({id:E.DELETE,label:i.baseText("menuActions.delete"),disabled:!V.value||P.value,customClass:s.deleteItem,divided:!0}),o}),Ne=W(()=>d.isEnterpriseFeatureEnabled(_e.WorkflowHistory)),De=W(()=>({name:m.WORKFLOW_HISTORY,params:{workflowId:t.workflow.id}})),Le=W(()=>P.value);Qe(()=>t.workflow.id,()=>{R.value=!1,N.value=!1});function de(){let o;return t.workflow.id!==X?o=t.workflow.id:g.params.name&&g.params.name!=="new"&&(o=g.params.name),o}async function ce(){if(ue.value)return;const o=de(),u=t.workflow.name,n=t.workflow.tags;await j.saveCurrentWorkflow({id:o,name:u,tags:n})&&(fe(o),await d.fetchPromptsData(),g.name===m.EXECUTION_DEBUG&&await M.replace({name:m.WORKFLOW,params:{name:t.workflow.id}}))}function Ue(){var o;l.openModalWithData({name:bt,data:{id:t.workflow.id}}),J.track("User opened sharing modal",{workflow_id:t.workflow.id,user_id_sharer:(o=_.currentUser)==null?void 0:o.id,sub_view:g.name===m.WORKFLOWS?"Workflows listing":"Workflow editor"})}function pe(){G.value=t.workflow.tags??[],R.value=!0,setTimeout(()=>{N.value=!1,le.emit("focus")},0)}async function me(){const o=t.workflow.tags??[],u=G.value;if(!Ce(o,u)){R.value=!1;return}if(Q.value)return;Q.value=!0;const n=await j.saveCurrentWorkflow({tags:u});J.track("User edited workflow tags",{workflow_id:t.workflow.id,new_tag_count:u.length}),Q.value=!1,n&&(R.value=!1)}function Ve(){R.value=!1}function Ae(){N.value=!N.value,N.value&&(R.value&&me(),R.value=!1)}async function Fe({name:o,onSubmit:u}){const n=o.trim();if(!n){U.showMessage({title:i.baseText("workflowDetails.showMessage.title"),message:i.baseText("workflowDetails.showMessage.message"),type:"error"}),u(!1);return}if(n===t.workflow.name){N.value=!1,u(!0);return}l.addActiveAction("workflowSaving");const I=de(),D=await j.saveCurrentWorkflow({name:o});D&&(N.value=!1,fe(I)),l.removeActiveAction("workflowSaving"),u(D)}async function xe(){const o=Z.value;if(o!=null&&o.files&&o.files.length!==0){const u=new FileReader;u.onload=()=>{let n;try{n=JSON.parse(u.result)}catch{U.showMessage({title:i.baseText("mainSidebar.showMessage.handleFileImport.title"),message:i.baseText("mainSidebar.showMessage.handleFileImport.message"),type:"error"});return}finally{u.onload=null,o.value=""}ge.emit("importWorkflowData",{data:n})},u.readAsText(o.files[0])}}async function Pe(o){var u;switch(o){case E.DUPLICATE:{l.openModalWithData({name:Tt,data:{id:t.workflow.id,name:t.workflow.name,tags:t.workflow.tags}});break}case E.DOWNLOAD:{const n=await j.getWorkflowDataToSave(),{tags:I,...D}=n,te={...D,meta:{...t.workflow.meta??{},instanceId:a.instanceId},tags:(I??[]).map(se=>{const{usageCount:H,...ae}=T.getTagById(se);return ae})},oe=new Blob([JSON.stringify(te,null,2)],{type:"application/json;charset=utf-8"});let K=t.workflow.name||"unsaved_workflow";K=K.replace(/[^a-z0-9]/gi,"_"),J.track("User exported workflow",{workflow_id:n.id}),Rt.saveAs(oe,K+".json");break}case E.IMPORT_FROM_URL:{try{const n=await ie.prompt(i.baseText("mainSidebar.prompt.workflowUrl")+":",i.baseText("mainSidebar.prompt.importWorkflowFromUrl")+":",{confirmButtonText:i.baseText("mainSidebar.prompt.import"),cancelButtonText:i.baseText("mainSidebar.prompt.cancel"),inputErrorMessage:i.baseText("mainSidebar.prompt.invalidUrl"),inputPattern:/^http[s]?:\/\/.*\.json$/i});if(n.action==="cancel")return;ge.emit("importWorkflowUrl",{url:n.value})}catch{}break}case E.IMPORT_FROM_FILE:{(u=Z.value)==null||u.click();break}case E.PUSH:{r.startLoading();try{await ce();const n=await p.getAggregatedStatus();l.openModalWithData({name:gt,data:{eventBus:Be,status:n}})}catch(n){switch(n.message){case"source_control_not_connected":U.showError({...n,message:""},i.baseText("settings.sourceControl.error.not.connected.title"),i.baseText("settings.sourceControl.error.not.connected.message"));break;default:U.showError(n,i.baseText("error"))}}finally{r.stopLoading()}break}case E.SETTINGS:{l.openModal(_t);break}case E.DELETE:{if(await ie.confirm(i.baseText("mainSidebar.confirmMessage.workflowDelete.message",{interpolate:{workflowName:t.workflow.name}}),i.baseText("mainSidebar.confirmMessage.workflowDelete.headline"),{type:"warning",confirmButtonText:i.baseText("mainSidebar.confirmMessage.workflowDelete.confirmButtonText"),cancelButtonText:i.baseText("mainSidebar.confirmMessage.workflowDelete.cancelButtonText")})!==kt)return;try{await L.deleteWorkflow(t.workflow.id)}catch(I){U.showError(I,i.baseText("generic.deleteWorkflowError"));return}l.stateIsDirty=!1,We.titleReset(),U.showMessage({title:i.baseText("mainSidebar.showMessage.handleSelect1.title"),type:"success"}),await M.push({name:m.WORKFLOWS});break}}}function Ke(){l.goToUpgrade("workflow_sharing","upgrade-workflow-sharing")}function fe(o){if(!o||["new",X].includes(o)){let u=i.baseText("workflows.create.personal.toast.title"),n=i.baseText("workflows.create.personal.toast.text");S.currentProject&&(u=i.baseText("workflows.create.project.toast.title",{interpolate:{projectName:S.currentProject.name??""}}),n=i.baseText("workflows.create.project.toast.text",{interpolate:{projectName:S.currentProject.name??""}})),U.showMessage({title:u,message:n,type:"success"})}}return(o,u)=>{const n=w("N8nButton"),I=w("i18n-t"),D=w("N8nTooltip"),te=w("EnterpriseEdition"),oe=w("N8nIconButton"),K=w("RouterLink"),se=w("N8nActionDropdown");return c(),v("div",{class:k(b(s).container)},[f(ko,{"value-x-s":15,"value-s-m":25,"value-m-d":50,class:"name-container"},{default:h(({value:H})=>[f(Ft,{name:o.workflow.name,limit:H,custom:!0,"test-id":"workflow-name-input"},{default:h(({shortenedName:ae})=>[f(ho,{"model-value":o.workflow.name,"preview-value":ae,"is-edit-enabled":N.value,"max-length":b(ft),disabled:o.readOnly,placeholder:"Enter workflow name",class:"name",onToggle:Ae,onSubmit:Fe},null,8,["model-value","preview-value","is-edit-enabled","max-length","disabled"])]),_:2},1032,["name","limit"])]),_:1}),b(d).areTagsEnabled?(c(),v("span",$o,[R.value&&!o.readOnly?(c(),C(wt,{key:0,ref:"dropdown",modelValue:G.value,"onUpdate:modelValue":u[0]||(u[0]=H=>G.value=H),"create-enabled":!0,"event-bus":b(le),placeholder:o.$locale.baseText("workflowDetails.chooseOrCreateATag"),class:"tags-edit","data-test-id":"workflow-tags-dropdown",onBlur:me,onEsc:Ve},null,8,["modelValue","event-bus","placeholder"])):(o.workflow.tags??[]).length===0&&!o.readOnly?(c(),v("div",So,[O("span",{class:"add-tag clickable","data-test-id":"new-tag-link",onClick:pe}," + "+F(o.$locale.baseText("workflowDetails.addTag")),1)])):(c(),C(eo,{key:o.workflow.id,"tag-ids":o.workflow.tags,clickable:!0,responsive:!0,"data-test-id":"workflow-tags",onClick:pe},null,8,["tag-ids"]))])):(c(),v("span",Oo)),f(Bt,{class:"actions"},{default:h(()=>[O("span",{class:k(`activator ${b(s).group}`)},[f(Ct,{"workflow-active":o.workflow.active,"workflow-id":o.workflow.id},null,8,["workflow-active","workflow-id"])],2),f(te,{features:[b(_e).Sharing]},{fallback:h(()=>[f(D,null,{content:h(()=>[f(I,{keypath:b(l).contextBasedTranslationKeys.workflows.sharing.unavailable.description.tooltip,tag:"span"},{action:h(()=>[O("a",{onClick:Ke},F(o.$locale.baseText(b(l).contextBasedTranslationKeys.workflows.sharing.unavailable.button)),1)]),_:1},8,["keypath"])]),default:h(()=>[f(n,{type:"secondary",class:k(["mr-2xs",b(s).disabledShareButton])},{default:h(()=>[Y(F(o.$locale.baseText("workflowDetails.share")),1)]),_:1},8,["class"])]),_:1})]),default:h(()=>[O("div",{class:k(b(s).group)},[f(yo),f(n,{type:"secondary","data-test-id":"workflow-share-button",onClick:Ue},{default:h(()=>[Y(F(o.$locale.baseText("workflowDetails.share")),1)]),_:1})],2)]),_:1},8,["features"]),O("div",{class:k(b(s).group)},[f(ht,{type:"primary",saved:!b(l).stateIsDirty&&!P.value,disabled:ue.value||o.readOnly,"with-shortcut":"","shortcut-tooltip":o.$locale.baseText("saveWorkflowButton.hint"),"data-test-id":"workflow-save-button",onClick:ce},null,8,["saved","disabled","shortcut-tooltip"]),Ne.value?(c(),C(K,{key:0,to:De.value,class:k(b(s).workflowHistoryButton)},{default:h(()=>[f(oe,{disabled:Le.value,"data-test-id":"workflow-history-button",type:"tertiary",icon:"history",size:"medium",text:""},null,8,["disabled"])]),_:1},8,["to","class"])):q("",!0)],2),O("div",{class:k([b(s).workflowMenuContainer,b(s).group])},[O("input",{ref_key:"importFileRef",ref:Z,class:k(b(s).hiddenInput),type:"file","data-test-id":"workflow-import-input",onChange:u[1]||(u[1]=H=>xe())},null,34),f(se,{items:Re.value,"data-test-id":"workflow-menu",onSelect:Pe},null,8,["items"])],2)]),_:1})],2)}}}),Wo="_container_osj4g_1",Bo="_group_osj4g_9",Co="_hiddenInput_osj4g_14",Mo="_deleteItem_osj4g_18",Ro="_disabledShareButton_osj4g_22",No="_workflowHistoryButton_osj4g_26",Do={container:Wo,group:Bo,hiddenInput:Co,deleteItem:Mo,disabledShareButton:Ro,workflowHistoryButton:No},Lo={$style:Do},Uo=$(Io,[["__cssModules",Lo],["__scopeId","data-v-5ef96cee"]]),Vo=y({__name:"TabBar",props:{items:{},modelValue:{default:B.WORKFLOW}},emits:["update:modelValue"],setup(e,{emit:t}){const s=t;function a(r,d){s("update:modelValue",r,d)}return(r,d)=>{const p=w("N8nRadioButtons");return r.items?(c(),v("div",{key:0,class:k({[r.$style.container]:!0,"tab-bar-container":!0})},[f(p,{"model-value":r.modelValue,options:r.items,"onUpdate:modelValue":a},null,8,["model-value","options"])],2)):q("",!0)}}}),Ao="_container_1ndnk_1",Fo={container:Ao},xo={$style:Fo},Po=$(Vo,[["__cssModules",xo]]),Ko=y({name:"MainHeader",components:{WorkflowDetails:Uo,TabBar:Po},setup(){const e=Ee();return{pushConnection:Nt({router:e})}},data(){return{activeHeaderTab:B.WORKFLOW,workflowToReturnTo:"",executionToReturnTo:"",dirtyState:!1}},computed:{...ye(Ot,ne,Oe,re,St),tabBarItems(){return[{value:B.WORKFLOW,label:this.$locale.baseText("generic.editor")},{value:B.EXECUTIONS,label:this.$locale.baseText("generic.executions")}]},activeNode(){return this.ndvStore.activeNode},hideMenuBar(){return!!(this.activeNode&&this.activeNode.type!==It)},workflow(){return this.workflowsStore.workflow},currentWorkflow(){return String(this.$route.params.name||this.workflowsStore.workflowId)},onWorkflowPage(){return!!(this.$route.meta.nodeView||this.$route.meta.keepWorkflowAlive)},readOnly(){return this.sourceControlStore.preferences.branchReadOnly}},watch:{$route(e,t){this.syncTabsWithRoute(e,t)}},beforeMount(){this.pushConnection.initialize()},mounted(){this.dirtyState=this.uiStore.stateIsDirty,this.syncTabsWithRoute(this.$route)},beforeUnmount(){this.pushConnection.terminate()},methods:{syncTabsWithRoute(e,t){e.name===m.EXECUTION_HOME||e.name===m.WORKFLOW_EXECUTIONS||e.name===m.EXECUTION_PREVIEW?this.activeHeaderTab=B.EXECUTIONS:(e.name===m.WORKFLOW||e.name===m.NEW_WORKFLOW||e.name===m.EXECUTION_DEBUG)&&(this.activeHeaderTab=B.WORKFLOW),e.params.name!=="new"&&typeof e.params.name=="string"&&(this.workflowToReturnTo=e.params.name),(t==null?void 0:t.name)===m.EXECUTION_PREVIEW&&e.params.name===t.params.name&&typeof t.params.executionId=="string"&&(this.executionToReturnTo=t.params.executionId)},onTabSelected(e,t){const s=t.ctrlKey||t.metaKey;switch(e){case B.WORKFLOW:this.navigateToWorkflowView(s);break;case B.EXECUTIONS:this.navigateToExecutionsView(s);break}},async navigateToWorkflowView(e){let t;if(["","new",X].includes(this.workflowToReturnTo)?t={name:m.NEW_WORKFLOW}:t={name:m.WORKFLOW,params:{name:this.workflowToReturnTo}},e){const{href:s}=this.$router.resolve(t);window.open(s,"_blank")}else this.$route.name!==t.name&&(this.$route.name===m.NEW_WORKFLOW&&(this.uiStore.stateIsDirty=this.dirtyState),this.activeHeaderTab=B.WORKFLOW,await this.$router.push(t))},async navigateToExecutionsView(e){var r;const t=this.currentWorkflow===X?"new":this.currentWorkflow,s=((r=this.executionsStore.activeExecution)==null?void 0:r.id)||this.executionToReturnTo,a=s?{name:m.EXECUTION_PREVIEW,params:{name:t,executionId:s}}:{name:m.EXECUTION_HOME,params:{name:t}};if(e){const{href:d}=this.$router.resolve(a);window.open(d,"_blank")}else this.$route.name!==a.name&&(this.dirtyState=this.uiStore.stateIsDirty,this.workflowToReturnTo=this.currentWorkflow,this.activeHeaderTab=B.EXECUTIONS,await this.$router.push(a))}}}),Ho={class:"top-menu"};function Xo(e,t,s,a,r,d){var l;const p=w("WorkflowDetails"),T=w("TabBar");return c(),v("div",null,[O("div",{class:k({"main-header":!0,expanded:!e.uiStore.sidebarMenuCollapsed})},[Te(O("div",Ho,[(l=e.workflow)!=null&&l.name?(c(),C(p,{key:0,workflow:e.workflow,"read-only":e.readOnly},null,8,["workflow","read-only"])):q("",!0),e.onWorkflowPage?(c(),C(T,{key:1,items:e.tabBarItems,"model-value":e.activeHeaderTab,"onUpdate:modelValue":e.onTabSelected},null,8,["items","model-value","onUpdate:modelValue"])):q("",!0)],512),[[et,!e.hideMenuBar]])],2)])}const Os=$(Ko,[["render",Xo]]);export{Os as default};
//# sourceMappingURL=MainHeader-P2afzgJI.js.map
