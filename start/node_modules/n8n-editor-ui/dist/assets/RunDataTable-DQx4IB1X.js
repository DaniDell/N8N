import{m as V}from"./pinia-BAhPp3pQ.js";import{j,K as L,s as O,eo as R,ep as S,a3 as B}from"./index-DEwaaDne.js";import{D as F}from"./NodeView-_cMwqhWw.js";import{M as W,_ as J}from"./TextWithHighlights.vue_vue_type_script_setup_true_lang-D-nZ3pe4.js";import{G as q,ag as f,l as r,m as g,I as n,p as s,F as M,a7 as E,U as m,O as d,S as _,T as $,R as N,M as K}from"./vendor-Dv5OeN6t.js";import{_ as G}from"./n8n-B6cfQsVX.js";import"./axios-Mm4CS0gO.js";import"./flatted-DN8lQ2XG.js";import"./@vueuse/core-9E8Shwsg.js";import"./lodash-es-BxV-E8rt.js";import"./@n8n/permissions-BxxteU-C.js";import"./dateformat-B9ocXky7.js";import"./vue-i18n-Delvyc9x.js";import"./uuid-SoommWqA.js";import"./luxon-CLwAIbs0.js";import"./@n8n/codemirror-lang-sql-x14jMqbG.js";import"./@lezer/common-B6ct0j_v.js";import"./prettier-bS6l4Vb1.js";import"./@jsplumb/util-DS-9vq_E.js";import"./@jsplumb/core-CVBraiyY.js";import"./@jsplumb/common-CF-b-6-M.js";import"./@jsplumb/connector-bezier-BGU0Ovbw.js";import"./@jsplumb/browser-ui-BVF2KoJK.js";import"./codemirror-lang-html-n8n-DcTmlMkf.js";import"./@n8n/codemirror-lang-Qkdx7NoQ.js";import"./esprima-next-nhoSXAeq.js";import"./fast-json-stable-stringify-LluJPcs3.js";import"./timeago.js-CiyKClrF.js";import"./qrcode.vue-BGkPba5A.js";import"./vue3-touch-events-mV0oX_Sl.js";import"./chart.js-343vZi4M.js";import"./useExecutionDebugging-vMuoV-iO.js";import"./file-saver-B3jMAULB.js";import"./vue-json-pretty-4sRLvjgA.js";import"./dateFormatter-DfWOmXdP.js";import"./RunDataAi-D3971Kwm.js";import"./useWorkflowActivate-BLjS7M0I.js";import"./nodeCreator.store-DR3dfsvW.js";import"./collaboration.store-zz8xH0zY.js";import"./useViewStacks-BSagsijV.js";const I=40,U=q({name:"RunDataTable",components:{Draggable:F,MappingPill:W,TextWithHighlights:J},props:{node:{type:Object,required:!0},inputData:{type:Array,required:!0},mappingEnabled:{type:Boolean},distanceFromActive:{type:Number,required:!0},runIndex:{type:Number},outputIndex:{type:Number},totalRuns:{type:Number},pageOffset:{type:Number,required:!0},hasDefaultHoverState:{type:Boolean},search:{type:String}},setup(){return{externalHooks:B()}},data(){return{activeColumn:-1,forceShowGrip:!1,draggedColumn:!1,draggingPath:null,hoveringPath:null,mappingHintVisible:!1,activeRow:null,columnLimit:I,columnLimitExceeded:!1}},mounted(){if(this.tableData&&this.tableData.columns&&this.$refs.draggable){const e=this.$refs.draggable.$refs.wrapper;e&&this.$emit("mounted",{avgRowHeight:e.offsetHeight/this.tableData.data.length})}},computed:{...V(L,j),hoveringItem(){return this.ndvStore.hoveringItem},pairedItemMappings(){return this.workflowsStore.workflowExecutionPairedItemMappings},tableData(){return this.convertToTable(this.inputData)},focusedMappableInput(){return this.ndvStore.focusedMappableInput},highlight(){return this.ndvStore.highlightDraggables}},methods:{shorten:O,isHoveringRow(e){var l;if(e===this.activeRow)return!0;const t=this.pageOffset+e;if(t===0&&!this.hoveringItem&&this.hasDefaultHoverState&&this.distanceFromActive===1)return!0;const a=R(((l=this.node)==null?void 0:l.name)??"",this.runIndex||0,this.outputIndex||0,t);if(!this.hoveringItem||!this.pairedItemMappings[a])return!1;const h=R(this.hoveringItem.nodeName,this.hoveringItem.runIndex,this.hoveringItem.outputIndex,this.hoveringItem.itemIndex);return this.pairedItemMappings[a].has(h)},onMouseEnterCell(e){const t=e.target;if(t&&this.mappingEnabled){const a=t.dataset.col;a&&!isNaN(parseInt(a,10))&&(this.activeColumn=parseInt(a,10))}if(t){const a=t.dataset.row;a&&!isNaN(parseInt(a,10))&&(this.activeRow=parseInt(a,10),this.$emit("activeRowChanged",this.pageOffset+this.activeRow))}},onMouseLeaveCell(){this.activeColumn=-1,this.activeRow=null,this.$emit("activeRowChanged",null)},onMouseEnterKey(e,t){this.hoveringPath=this.getCellExpression(e,t)},onMouseLeaveKey(){this.hoveringPath=null},isHovering(e,t){const a=this.getCellExpression(e,t);return this.hoveringPath===a},getExpression(e){return this.node?S({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[e]}):""},getPathNameFromTarget(e){return e?e.dataset.name:""},getCellPathName(e,t){const a=e[e.length-1];return typeof a=="string"?a:e.length>1?`${e[e.length-2]}[${a}]`:`${this.tableData.columns[t]}[${a}]`},getCellExpression(e,t){if(!this.node)return"";const a=this.tableData.columns[t];return S({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[a,...e]})},isEmpty(e){return e===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&e!==null&&Object.keys(e).length===0||e===null||e===void 0},getValueToRender(e){return e===""?this.$locale.baseText("runData.emptyString"):typeof e=="string"?e.replaceAll(`
`,"\\n"):Array.isArray(e)&&e.length===0?this.$locale.baseText("runData.emptyArray"):typeof e=="object"&&e!==null&&Object.keys(e).length===0?this.$locale.baseText("runData.emptyObject"):e==null?`[${e}]`:e===!0||e===!1||typeof e=="number"?e.toString():JSON.stringify(e)},onDragStart(){this.draggedColumn=!0,this.ndvStore.resetMappingTelemetry()},onCellDragStart(e){e!=null&&e.dataset.value&&(this.draggingPath=e.dataset.value),this.onDragStart()},onCellDragEnd(e){this.draggingPath=null,this.onDragEnd(e.dataset.name||"","tree",e.dataset.depth||"0")},isDraggingKey(e,t){if(this.draggingPath)return this.draggingPath===this.getCellExpression(e,t)},onDragEnd(e,t,a="0"){setTimeout(()=>{const h=this.ndvStore.mappingTelemetry,l={src_node_type:this.node.type,src_field_name:e,src_nodes_back:this.distanceFromActive,src_run_index:this.runIndex,src_runs_total:this.totalRuns,src_field_nest_level:parseInt(a,10),src_view:"table",src_element:t,success:!1,...h};this.externalHooks.run("runDataTable.onDragEnd",l),this.$telemetry.track("User dragged data for mapping",l,{withPostHog:!0})},1e3)},isSimple(e){return typeof e!="object"||e===null||Array.isArray(e)&&e.length===0||typeof e=="object"&&Object.keys(e).length===0},hasJsonInColumn(e){return this.tableData.hasJson[this.tableData.columns[e]]},convertToTable(e){const t=[],a=[];let h,l,c;const C={};return e.forEach(y=>{if(!y.hasOwnProperty("json"))return;c=y.json,l=[];const D=Object.keys(c||{});D.length>I?(this.columnLimitExceeded=!0,h=D.slice(0,I)):h=D,a.forEach(o=>{c.hasOwnProperty(o)?(l.push(c[o]),h.splice(h.indexOf(o),1),C[o]=C[o]||typeof c[o]=="object"&&Object.keys(c[o]||{}).length>0||!1):l.push(void 0)}),h.forEach(o=>{a.push(o),l.push(c[o]),C[o]=C[o]||typeof c[o]=="object"&&Object.keys(c[o]||{}).length>0||!1}),t.push(l)}),t.forEach(y=>{a.length>y.length&&y.push(...new Array(a.length-y.length))}),{hasJson:C,columns:a,data:t}},switchToJsonView(){this.$emit("displayModeChange","json")}},watch:{focusedMappableInput(e){setTimeout(()=>{this.forceShowGrip=!!this.focusedMappableInput},e?300:150)}}}),z="/%257B%257BBASE_PATH%257D%257D/static/data-mapping-gif.gif",X="_dataDisplay_1ivrv_1",Q="_table_1ivrv_14",Y="_nodeClass_1ivrv_62",Z="_emptyCell_1ivrv_66",x="_header_1ivrv_70",ee="_draggableHeader_1ivrv_82",te="_dragButton_1ivrv_86",ae="_highlight_1ivrv_90",ne="_draggingHeader_1ivrv_94",oe="_activeHeader_1ivrv_99",se="_dataKey_1ivrv_108",re="_value_1ivrv_117",ie="_nestedValue_1ivrv_121 _value_1ivrv_117",le="_mappable_1ivrv_126",ge="_empty_1ivrv_66",de="_limitColWidth_1ivrv_134",pe="_minColWidth_1ivrv_138",me="_hoveringKey_1ivrv_142",he="_draggingKey_1ivrv_146",ue="_tableRightMargin_1ivrv_150",ce="_hoveringRow_1ivrv_158",ye="_warningTooltip_1ivrv_163",ve={dataDisplay:X,table:Q,nodeClass:Y,emptyCell:Z,header:x,draggableHeader:ee,dragButton:te,highlight:ae,draggingHeader:ne,activeHeader:oe,dataKey:se,value:re,nestedValue:ie,mappable:le,empty:ge,limitColWidth:de,minColWidth:pe,hoveringKey:me,draggingKey:he,tableRightMargin:ue,hoveringRow:ce,warningTooltip:ye},be=["data-row"],fe=s("img",{src:z},null,-1),Ce=["data-test-id"],De=["data-row","data-col"],we=["data-name","data-value","data-depth","onMouseenter"],$e={key:0};function Me(e,t,a,h,l,c){const C=f("n8n-info-tip"),y=f("MappingPill"),D=f("TextWithHighlights"),o=f("font-awesome-icon"),T=f("Draggable"),H=f("n8n-tooltip"),P=f("i18n-t"),k=f("n8n-tree");return r(),g("div",{class:n([e.$style.dataDisplay,{[e.$style.highlight]:e.highlight}])},[e.tableData.columns&&e.tableData.columns.length===0?(r(),g("table",{key:0,class:n(e.$style.table)},[s("tr",null,[s("th",{class:n(e.$style.emptyCell)},null,2),s("th",{class:n(e.$style.tableRightMargin)},null,2)]),(r(!0),g(M,null,E(e.tableData.data,(u,p)=>(r(),g("tr",{key:p,class:n({[e.$style.hoveringRow]:e.isHoveringRow(p)})},[s("td",{"data-row":p,"data-col":0,onMouseenter:t[0]||(t[0]=(...i)=>e.onMouseEnterCell&&e.onMouseEnterCell(...i)),onMouseleave:t[1]||(t[1]=(...i)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...i))},[m(C,null,{default:d(()=>[_($(e.$locale.baseText("runData.emptyItemHint")),1)]),_:1})],40,be),s("td",{class:n(e.$style.tableRightMargin)},null,2)],2))),128))],2)):(r(),g("table",{key:1,class:n(e.$style.table)},[s("thead",null,[s("tr",null,[(r(!0),g(M,null,E(e.tableData.columns||[],(u,p)=>(r(),g("th",{key:u},[m(H,{placement:"bottom-start",disabled:!e.mappingEnabled,"show-after":1e3},{content:d(()=>[s("div",null,[fe,_(" "+$(e.$locale.baseText("dataMapping.dragColumnToFieldHint")),1)])]),default:d(()=>[m(T,{type:"mapping",data:e.getExpression(u),disabled:!e.mappingEnabled,onDragstart:e.onDragStart,onDragend:i=>e.onDragEnd(i,"column")},{preview:d(({canDrop:i})=>[m(y,{html:e.shorten(u,16,2),"can-drop":i},null,8,["html","can-drop"])]),default:d(({isDragging:i})=>[s("div",{class:n({[e.$style.header]:!0,[e.$style.draggableHeader]:e.mappingEnabled,[e.$style.activeHeader]:(p===e.activeColumn||e.forceShowGrip)&&e.mappingEnabled,[e.$style.draggingHeader]:i})},[m(D,{content:e.getValueToRender(u||""),search:e.search},null,8,["content","search"]),s("div",{class:n(e.$style.dragButton)},[m(o,{icon:"grip-vertical"})],2)],2)]),_:2},1032,["data","disabled","onDragstart","onDragend"])]),_:2},1032,["disabled"])]))),128)),e.columnLimitExceeded?(r(),g("th",{key:0,class:n(e.$style.header)},[m(H,{placement:"bottom-end"},{content:d(()=>[s("div",null,[m(P,{tag:"span",keypath:"dataMapping.tableView.tableColumnsExceeded.tooltip"},{columnLimit:d(()=>[_($(e.columnLimit),1)]),link:d(()=>[s("a",{onClick:t[2]||(t[2]=(...u)=>e.switchToJsonView&&e.switchToJsonView(...u))},$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded.tooltip.link")),1)]),_:1})])]),default:d(()=>[s("span",null,[m(o,{class:n(e.$style.warningTooltip),icon:"exclamation-triangle"},null,8,["class"]),_(" "+$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded")),1)])]),_:1})],2)):N("",!0),s("th",{class:n(e.$style.tableRightMargin)},null,2)])]),m(T,{ref:"draggable",tag:"tbody",type:"mapping","target-data-key":"mappable",disabled:!e.mappingEnabled,onDragstart:e.onCellDragStart,onDragend:e.onCellDragEnd},{preview:d(({canDrop:u,el:p})=>[m(y,{html:e.shorten(e.getPathNameFromTarget(p)||"",16,2),"can-drop":u},null,8,["html","can-drop"])]),default:d(()=>[(r(!0),g(M,null,E(e.tableData.data,(u,p)=>(r(),g("tr",{key:p,class:n({[e.$style.hoveringRow]:e.isHoveringRow(p)}),"data-test-id":e.isHoveringRow(p)?"hovering-item":void 0},[(r(!0),g(M,null,E(u,(i,v)=>(r(),g("td",{key:v,"data-row":p,"data-col":v,class:n(e.hasJsonInColumn(v)?e.$style.minColWidth:e.$style.limitColWidth),onMouseenter:t[4]||(t[4]=(...b)=>e.onMouseEnterCell&&e.onMouseEnterCell(...b)),onMouseleave:t[5]||(t[5]=(...b)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...b))},[e.isSimple(i)?(r(),K(D,{key:0,content:e.getValueToRender(i),search:e.search,class:n({[e.$style.value]:!0,[e.$style.empty]:e.isEmpty(i)})},null,8,["content","search","class"])):(r(),K(k,{key:1,"node-class":e.$style.nodeClass,value:i},{label:d(({label:b,path:w})=>[s("span",{class:n({[e.$style.hoveringKey]:e.mappingEnabled&&e.isHovering(w,v),[e.$style.draggingKey]:e.isDraggingKey(w,v),[e.$style.dataKey]:!0,[e.$style.mappable]:e.mappingEnabled}),"data-target":"mappable","data-name":e.getCellPathName(w,v),"data-value":e.getCellExpression(w,v),"data-depth":w.length,onMouseenter:()=>e.onMouseEnterKey(w,v),onMouseleave:t[3]||(t[3]=(...A)=>e.onMouseLeaveKey&&e.onMouseLeaveKey(...A))},$(b||e.$locale.baseText("runData.unnamedField")),43,we)]),value:d(({value:b})=>[m(D,{content:e.getValueToRender(b),search:e.search,class:n({[e.$style.nestedValue]:!0,[e.$style.empty]:e.isEmpty(b)})},null,8,["content","search","class"])]),_:2},1032,["node-class","value"]))],42,De))),128)),e.columnLimitExceeded?(r(),g("td",$e)):N("",!0),s("td",{class:n(e.$style.tableRightMargin)},null,2)],10,Ce))),128))]),_:1},8,["disabled","onDragstart","onDragend"])],2))],2)}const Ee={$style:ve},mt=G(U,[["render",Me],["__cssModules",Ee]]);export{mt as default};
//# sourceMappingURL=RunDataTable-DQx4IB1X.js.map
