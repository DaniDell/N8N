const __vite__fileDeps=["assets/RunDataTable-DQx4IB1X.js","assets/pinia-BAhPp3pQ.js","assets/n8n-B6cfQsVX.js","assets/axios-Mm4CS0gO.js","assets/esprima-next-nhoSXAeq.js","assets/luxon-CLwAIbs0.js","assets/vendor-Dv5OeN6t.js","assets/lodash-es-BxV-E8rt.js","assets/n8n-Dbo88Vem.css","assets/index-DEwaaDne.js","assets/flatted-DN8lQ2XG.js","assets/@vueuse/core-9E8Shwsg.js","assets/@n8n/permissions-BxxteU-C.js","assets/dateformat-B9ocXky7.js","assets/vue-i18n-Delvyc9x.js","assets/uuid-SoommWqA.js","assets/@n8n/codemirror-lang-sql-x14jMqbG.js","assets/@lezer/common-B6ct0j_v.js","assets/prettier-bS6l4Vb1.js","assets/@jsplumb/util-DS-9vq_E.js","assets/@jsplumb/core-CVBraiyY.js","assets/@jsplumb/common-CF-b-6-M.js","assets/@jsplumb/connector-bezier-BGU0Ovbw.js","assets/@jsplumb/browser-ui-BVF2KoJK.js","assets/codemirror-lang-html-n8n-DcTmlMkf.js","assets/@n8n/codemirror-lang-Qkdx7NoQ.js","assets/fast-json-stable-stringify-LluJPcs3.js","assets/timeago.js-CiyKClrF.js","assets/qrcode.vue-BGkPba5A.js","assets/vue3-touch-events-mV0oX_Sl.js","assets/chart.js-343vZi4M.js","assets/index-C2bc09x9.css","assets/TextWithHighlights.vue_vue_type_script_setup_true_lang-D-nZ3pe4.js","assets/TextWithHighlights-Btp7aQhN.css","assets/useExecutionDebugging-vMuoV-iO.js","assets/file-saver-B3jMAULB.js","assets/vue-json-pretty-4sRLvjgA.js","assets/dateFormatter-DfWOmXdP.js","assets/RunDataAi-D3971Kwm.js","assets/RunDataAi-BTTIiRHW.css","assets/useWorkflowActivate-BLjS7M0I.js","assets/nodeCreator.store-DR3dfsvW.js","assets/collaboration.store-zz8xH0zY.js","assets/useViewStacks-BSagsijV.js","assets/RunDataTable-DbnIA8mC.css","assets/RunDataJson-BLrjtyKU.js","assets/RunDataJson-rdWf51eY.css","assets/RunDataSchema-B-52gDNr.js","assets/RunDataSchema-DhJhloeZ.css","assets/RunDataSearch-ZA9rLECQ.js","assets/RunDataSearch-DPX1pnw0.css","assets/NodeCreation-DHuCOx3T.js","assets/NodeCreation-gfazfzcF.css","assets/CanvasControls-CQPytmej.js","assets/CanvasControls-BsWaXMAp.css","assets/SetupWorkflowCredentialsButton-DkvMQv2u.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{b as Jt,a9 as Me,_ as Z,N as U,ai as cn,o as De,m as Ie,aj as gs,h as xe,p as Ze,ak as ys,al as ws,am as vs,a6 as Ns,an as ks,ao as So,j as Xt,k as Oe,ap as bs,e as Ae,aq as Ts,ag as Ss,x as Ds,ar as Wt,n as Cs}from"./n8n-B6cfQsVX.js";import{m as ve,s as Qt}from"./pinia-BAhPp3pQ.js";import{_ as Do,$ as Co,a0 as Eo,a1 as wt}from"./@jsplumb/core-CVBraiyY.js";import{i as Ne,a4 as ue,j as oe,n as Zt,a5 as Pt,L as ke,a6 as Ce,w as We,a7 as hn,m as eo,a8 as Es,a9 as Fe,K as ae,aa as pn,ab as Is,ac as Ps,ad as fn,a3 as ze,F as to,ae as oo,p as $t,u as qe,af as Io,ag as _s,ah as ut,ai as He,aj as je,d as Ot,ak as jt,al as mn,G as no,am as so,an as io,y as pe,z as et,ao as $s,ap as Os,aq as gn,ar as yn,as as ao,at as Rs,au as Qe,av as Po,aw as wn,ax as _o,U as Re,ay as $o,l as ro,az as vn,aA as Ms,aB as As,aC as Ws,aD as Vs,aE as Bs,aF as Oo,aG as Ro,aH as Us,aI as Ls,aJ as $e,aK as Mo,aL as xs,aM as Hs,aN as Ao,aO as Kt,aP as Fs,aQ as zs,aR as lo,aS as qs,aT as js,aU as Ks,aV as Ys,aW as Et,V as te,A as Gs,b as Nn,aX as Js,aY as Xs,E as It,aZ as Wo,a_ as tt,a$ as kn,b0 as Vt,b1 as Qs,b2 as Zs,b3 as ei,b4 as ti,b5 as Yt,b6 as nt,b7 as oi,b8 as ni,b9 as si,ba as ii,bb as ai,bc as ri,bd as li,be as di,bf as dt,bg as Bt,bh as vt,bi as ui,bj as bn,bk as Tn,bl as ci,bm as Vo,bn as hi,bo as Nt,I as st,P as it,bp as Bo,bq as pi,H as fi,br as ye,o as mi,J as gi,bs as yi,bt as wi,a as vi,$ as Ni,c as ki,bu as bi,bv as Ti,bw as Si,bx as Di,by as Ci,bz as Ei,Y as Uo,bA as we,bB as Ii,bC as Pi,bD as Ut,bE as _i,bF as $i,bG as Oi,bH as Ri,bI as Ge,bJ as Mi,bK as at,bL as Ai,bM as Wi,bN as Lt,bO as Vi,bP as Lo,bQ as kt,bR as bt,bS as Bi,bT as Ui,bU as Li,bV as xi,bW as Hi,bX as Fi,bY as zi,bZ as xo,b_ as Ho,b$ as Fo,c0 as zo,c1 as xt,c2 as qi,c3 as qo,c4 as jo,c5 as ji,c6 as Tt,c7 as Ko,c8 as Yo,c9 as Ki,ca as Yi,cb as Go,cc as Jo,cd as Xo,ce as Gi,T as Ji,cf as Xi,cg as Qo,ch as Qi,ci as Zi,cj as ea,ck as ta,cl as oa,cm as Zo,cn as na,co as sa,cp as ia,cq as aa}from"./index-DEwaaDne.js";import{r as K,e as W,d as _e,b as uo,G as Q,l as d,m as k,p as h,U as v,I as T,O as b,S as R,T as N,M as O,R as E,a8 as en,a2 as fe,n as Sn,ag as D,aH as ct,F as se,a7 as he,aw as Dn,ax as Cn,J as ie,aq as ht,P as ee,K as ra,V as de,H as le,a5 as En,Q as In,y as Pn,u as j,X as la,aK as Ve,aM as Ee,a9 as co,aR as da,W as ua}from"./vendor-Dv5OeN6t.js";import{u as ca}from"./useExecutionDebugging-vMuoV-iO.js";import{g as Se,s as Je,A as Ht,e as ha,z as pa}from"./lodash-es-BxV-E8rt.js";import{F as Ft}from"./file-saver-B3jMAULB.js";import{V as fa}from"./vue-json-pretty-4sRLvjgA.js";import{c as ma}from"./dateFormatter-DfWOmXdP.js";import ga from"./RunDataAi-D3971Kwm.js";import{u as ya}from"./useWorkflowActivate-BLjS7M0I.js";import{u as Gt}from"./nodeCreator.store-DR3dfsvW.js";import{a as wa,u as va}from"./collaboration.store-zz8xH0zY.js";import{g as Na,f as St,h as tn,a as on,E as nn,b as sn,d as an,i as Dt}from"./@jsplumb/browser-ui-BVF2KoJK.js";import{u as ka}from"./useViewStacks-BSagsijV.js";import{v as Ue}from"./uuid-SoommWqA.js";const _t=Jt(),zt=K([0,0]),rt=K(!1),lt=K({source:"canvas"}),Ct=K([]),rn=K(()=>{}),pt=(e=()=>{})=>{const t=Ne(),o=ue(),n=oe(),s=Zt(),i=We(),l=W(()=>s.preferences.branchReadOnly||t.isReadOnlyView),r=W(()=>{if(!rt.value)return[];const y=t.selectedNodes.map(w=>n.getNodeByName(w.name)),S=lt.value;return S.source==="canvas"?y:S.source==="node-right-click"?y.some(C=>C.name===S.node.name)?y:[S.node]:[S.node]}),a=y=>{const S=n.allNodes.filter(w=>w.type===y.name);return y.maxNodes===void 0||S.length<y.maxNodes},u=y=>{const S=o.getNodeType(y.type,y.typeVersion);return!S||hn.includes(S.name)?!1:a(S)},c=y=>!!n.pinDataByNodeName(y.name),p=()=>{lt.value={source:"canvas"},rt.value=!1,Ct.value=[],zt.value=[0,0]},g=(y,S={source:"canvas"})=>{if(y.stopPropagation(),rt.value&&S.source===lt.value.source){p();return}y.preventDefault(),rn.value=e,lt.value=S,zt.value=Pt(y),rt.value=!0;const w=r.value,C=w.every(V=>V.type===ke),I={adjustToNumber:w.length,interpolate:{subject:C?i.baseText("contextMenu.sticky",{adjustToNumber:w.length}):i.baseText("contextMenu.node",{adjustToNumber:w.length})}},P=[{id:"select_all",divided:!0,label:i.baseText("contextMenu.selectAll"),shortcut:{metaKey:!0,keys:["A"]},disabled:w.length===n.allNodes.length},{id:"deselect_all",label:i.baseText("contextMenu.deselectAll"),disabled:w.length===0}];if(w.length===0)Ct.value=[{id:"add_node",shortcut:{keys:["Tab"]},label:i.baseText("contextMenu.addNode"),disabled:l.value},{id:"add_sticky",shortcut:{shiftKey:!0,keys:["s"]},label:i.baseText("contextMenu.addSticky"),disabled:l.value},...P];else{const V=[!C&&{id:"toggle_activation",label:w.every(H=>H.disabled)?i.baseText("contextMenu.activate",I):i.baseText("contextMenu.deactivate",I),shortcut:{keys:["D"]},disabled:l.value},!C&&{id:"toggle_pin",label:w.every(H=>c(H))?i.baseText("contextMenu.unpin",I):i.baseText("contextMenu.pin",I),shortcut:{keys:["p"]},disabled:l.value||!w.every(H=>Ce(H).canPinNode(!0))},{id:"copy",label:i.baseText("contextMenu.copy",I),shortcut:{metaKey:!0,keys:["C"]}},{id:"duplicate",label:i.baseText("contextMenu.duplicate",I),shortcut:{metaKey:!0,keys:["D"]},disabled:l.value||!w.every(u)},...P,{id:"delete",divided:!0,label:i.baseText("contextMenu.delete",I),shortcut:{keys:["Del"]},disabled:l.value}].filter(Boolean);if(w.length===1){const H=C?[{id:"open",label:i.baseText("contextMenu.editSticky"),shortcut:{keys:["↵"]},disabled:l.value},{id:"change_color",label:i.baseText("contextMenu.changeColor"),disabled:l.value}]:[{id:"open",label:i.baseText("contextMenu.open"),shortcut:{keys:["↵"]}},{id:"execute",label:i.baseText("contextMenu.test"),disabled:l.value},{id:"rename",label:i.baseText("contextMenu.rename"),shortcut:{keys:["F2"]},disabled:l.value}];V.unshift(...H)}Ct.value=V}},m=y=>{rn.value(y,r.value)};return _e(()=>t.nodeViewOffsetPosition,()=>{p()}),{isOpen:rt,position:zt,target:lt,actions:Ct,targetNodes:r,open:g,close:p,_dispatchAction:m}};function ba(){const e=K(!1),t=K(document.createElement("span")),{isTouchDevice:o,isCtrlKeyPressed:n}=Me(),s=Ne(),i=eo(),l=oe(),{isOpen:r}=pt();function a(f){Object.assign(t.value.style,f)}function u(f){const[$,A]=I(f);t.value=Object.assign(t.value,{x:$,y:A}),a({left:t.value.x+"px",top:t.value.y+"px",visibility:"visible"}),e.value=!0}function c(f){const $=g(f);a({left:$.x+"px",top:$.y+"px",width:$.width+"px",height:$.height+"px"})}function p(){t.value.x=0,t.value.y=0,a({visibility:"hidden",left:"0px",top:"0px",width:"0px",height:"0px"}),e.value=!1}function g(f){const[$,A]=I(f);return{x:Math.min($,t.value.x),y:Math.min(A,t.value.y),width:Math.abs($-t.value.x),height:Math.abs(A-t.value.y)}}function m(f){const $=[],A=g(f);return l.allNodes.forEach(B=>{B.position[0]<A.x||B.position[0]>A.x+A.width||B.position[1]<A.y||B.position[1]>A.y+A.height||$.push(B)}),$}function y(){t.value.id="select-box",a({margin:"0px auto",border:"2px dotted #FF0000",position:"absolute",zIndex:"100",visibility:"hidden"}),t.value.addEventListener("mouseup",w),document.querySelector("#node-view").appendChild(t.value)}function S(f){if(f.buttons===0){w(f);return}c(f)}function w(f){if("button"in f&&f.button===2||r.value)return;if(!e.value){o&&f.target instanceof HTMLElement&&f.target&&f.target.id.includes("node-view")&&H();return}document.removeEventListener("mousemove",S),H();const $=m(f);$.forEach(A=>{V(A)}),$.length===1&&(s.lastSelectedNode=$[0].name),p()}function C(f,$){n(f)||$||f.button===2||s.isActionActive("dragActive")||(u(f),document.addEventListener("mousemove",S))}function I(f){const $=Pt(f),[A,B]=i.canvasPositionFromPagePosition($),Y=i.nodeViewScale,M=s.nodeViewOffsetPosition;return Es(A,B,Y,M)}function P(f){s.removeNodeFromSelection(f),x.value.removeFromDragSelection(x.value.getManagedElement(f==null?void 0:f.id))}function V(f){s.addSelectedNode(f),x.value.addToDragSelection(x.value.getManagedElement(f==null?void 0:f.id))}function H(){x.value.clearDragSelection(),s.resetSelectedNodes(),s.lastSelectedNode=null,s.lastSelectedNodeOutputIndex=null,i.newNodeInsertPosition=null,i.setLastSelectedConnection(void 0)}const x=W(()=>i.jsPlumbInstance);return uo(()=>{y()}),{selectActive:e,getMousePositionWithinNodeView:I,mouseUpMouseSelect:w,mouseDownMouseSelect:C,nodeDeselected:P,nodeSelected:V,deselectAllNodes:H}}function Ta(){function e(){return ue().allNodeTypes.reduce((o,n)=>{if(typeof n.defaults.name!="string")throw new Error("Expected node name default to be a string");return/\d$/.test(n.defaults.name)&&o.push(n.defaults.name),o},[])}function t(o,n=[]){var c,p;const{canvasNames:s}=oe();if(!s.has(o)&&!n.includes(o))return o;const l=e().find(g=>o.startsWith(g));if(l){let g="",m=1;const y=o.split(l).pop(),S=y==null?void 0:y[y.length-1];for(S&&Number.isInteger(Number(S))&&(m=parseInt(S,10),o=o.slice(0,-1)),g=o;s.has(g)||n.includes(g);)g=o+m++;return g}if(/^\d+-?\d*$/.test(o)){let g="",m=1;const y=o.match(/(?<base>\d+)-?(?<suffix>\d*)/);if(!(y!=null&&y.groups))throw new Error("Failed to find match for unique name");for(((c=y==null?void 0:y.groups)==null?void 0:c.suffix)!==""&&(m=parseInt(y.groups.suffix,10)),g=y.groups.base;s.has(g)||n.includes(g);)g=y.groups.base+"-"+m++;return g}let r="",a=1;const u=o.match(/(?<base>.*\D+)(?<suffix>\d*)/);if(!(u!=null&&u.groups))throw new Error("Failed to find match for unique name");for(((p=u==null?void 0:u.groups)==null?void 0:p.suffix)!==""&&(a=parseInt(u.groups.suffix,10)),r=u.groups.base;s.has(r)||n.includes(r);)r=u.groups.base+a++;return r}return{uniqueNodeName:t}}const Sa=Q({__name:"NodeTitle",props:{modelValue:{default:""},nodeType:{default:void 0},readOnly:{type:Boolean,default:!1}},emits:["update:model-value"],setup(e,{emit:t}){const o=e,n=t,s=K(!1),i=K(""),l=K(),r=W(()=>!o.readOnly&&window===window.parent);async function a(){i.value=o.modelValue,s.value=!0,await Sn(),l.value&&l.value.focus()}function u(){i.value.trim()!==""&&n("update:model-value",i.value.trim()),s.value=!1}return(c,p)=>{const g=D("n8n-text"),m=D("n8n-input"),y=D("n8n-button"),S=D("font-awesome-icon"),w=D("n8n-popover");return d(),k("span",{class:T(c.$style.container),"data-test-id":"node-title-container",onClick:a},[h("span",{class:T(c.$style.iconWrapper)},[v(Fe,{"node-type":c.nodeType,size:18},null,8,["node-type"])],2),v(w,{placement:"right",width:"200",visible:s.value,disabled:!r.value},{reference:b(()=>[h("div",{class:T({[c.$style.title]:!0,[c.$style.hoverable]:r.value})},[R(N(c.modelValue)+" ",1),h("div",{class:T(c.$style.editIconContainer)},[r.value?(d(),O(S,{key:0,class:T(c.$style.editIcon),icon:"pencil-alt"},null,8,["class"])):E("",!0)],2)],2)]),default:b(()=>[h("div",{class:T(c.$style.editContainer),onKeydown:[en(u,["enter"]),p[2]||(p[2]=fe(()=>{},["stop"])),p[3]||(p[3]=en(C=>s.value=!1,["esc"]))]},[v(g,{bold:!0,color:"text-base",tag:"div"},{default:b(()=>[R(N(c.$locale.baseText("ndv.title.renameNode")),1)]),_:1}),v(m,{ref_key:"input",ref:l,modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=C=>i.value=C),size:"small","data-test-id":"node-rename-input"},null,8,["modelValue"]),h("div",{class:T(c.$style.editButtons)},[v(y,{type:"secondary",size:"small",label:c.$locale.baseText("ndv.title.cancel"),onClick:p[1]||(p[1]=C=>s.value=!1)},null,8,["label"]),v(y,{type:"primary",size:"small",label:c.$locale.baseText("ndv.title.rename"),onClick:u},null,8,["label"])],2)],34)]),_:1},8,["visible","disabled"])],2)}}}),Da="_container_9bi3m_1",Ca="_title_9bi3m_11",Ea="_hoverable_9bi3m_19",Ia="_editIcon_9bi3m_22",Pa="_iconWrapper_9bi3m_26",_a="_editIconContainer_9bi3m_39",$a="_editButtons_9bi3m_45",Oa="_editContainer_9bi3m_53",Ra={container:Da,title:Ca,hoverable:Ea,editIcon:Ia,iconWrapper:Pa,editIconContainer:_a,editButtons:$a,editContainer:Oa},Ma={$style:Ra},Aa=Z(Sa,[["__cssModules",Ma]]),Wa=Q({__name:"NodeSettingsTabs",props:{modelValue:{default:"params"},nodeType:{default:void 0},pushRef:{default:""}},emits:["update:model-value"],setup(e,{emit:t}){const o=e,n=t,s=ze(),i=ae(),l=oe(),r=We(),a=to(),u=W(()=>i.activeNode),c=W(()=>{const w=o.nodeType;return w?pn(w.name):!1}),p=W(()=>{var w;return((w=o.nodeType)==null?void 0:w.name.split(".")[0])??""}),g=W(()=>{var P,V,H,x;const w=o.nodeType;if(!w)return"";if(w.documentationUrl&&w.documentationUrl.startsWith("http"))return w.documentationUrl;const C=new URLSearchParams({utm_source:"n8n_app",utm_medium:"node_settings_modal-credential_link",utm_campaign:w.name}),I=(x=(H=(V=(P=w.codex)==null?void 0:P.resources)==null?void 0:V.primaryDocumentation)==null?void 0:H[0])==null?void 0:x.url;return I?`${I}?${C.toString()}`:c.value?`${Is}${p.value}`:`${Ps}?${C.toString()}`}),m=W(()=>{const w=[{label:r.baseText("nodeSettings.parameters"),value:"params"},{label:r.baseText("nodeSettings.settings"),value:"settings"}];return c.value&&w.push({icon:"cube",value:"communityNode",align:"right",tooltip:r.baseText("generic.communityNode.tooltip",{interpolate:{docUrl:fn,packageName:p.value}})}),g.value&&w.push({label:r.baseText("nodeSettings.docs"),value:"docs",href:g.value,align:"right"}),w});function y(w){var C;w==="docs"&&o.nodeType&&(s.run("dataDisplay.onDocumentationUrlClick",{nodeType:o.nodeType,documentationUrl:g.value}),a.track("User clicked ndv link",{node_type:(C=u.value)==null?void 0:C.type,workflow_id:l.workflowId,push_ref:o.pushRef,pane:U.Main,type:"docs"})),w==="settings"&&o.nodeType&&a.track("User viewed node settings",{node_type:o.nodeType.name,workflow_id:l.workflowId}),(w==="settings"||w==="params")&&n("update:model-value",w)}function S(w,C){w==="communityNode"&&C.target.localName==="a"&&a.track("user clicked cnr docs link",{source:"node details view"})}return(w,C)=>{const I=D("N8nTabs");return d(),O(I,{options:m.value,"model-value":w.modelValue,"onUpdate:modelValue":y,onTooltipClick:S},null,8,["options","model-value"])}}}),Va=Q({name:"NodeWebhooks",props:["node","nodeType"],setup(){const e=ct(),t=oo(),o=$t({router:e});return{clipboard:t,workflowHelpers:o,...qe()}},data(){return{isMinimized:this.nodeType&&!Io.includes(this.nodeType.name),showUrlFor:"test"}},computed:{isProductionOnly(){return this.nodeType&&_s.includes(this.nodeType.name)},urlOptions(){return[...this.isProductionOnly?[]:[{label:this.baseText.testUrl,value:"test"}],{label:this.baseText.productionUrl,value:"production"}]},visibleWebhookUrls(){return this.webhooksNode.filter(e=>typeof e.ndvHideUrl=="string"?!this.workflowHelpers.getWebhookExpressionValue(e,"ndvHideUrl"):!e.ndvHideUrl)},webhooksNode(){return this.nodeType===null||this.nodeType.webhooks===void 0?[]:this.nodeType.webhooks.filter(e=>e.restartWebhook!==!0)},baseText(){switch(this.nodeType.name){case He:return{toggleTitle:this.$locale.baseText("nodeWebhooks.webhookUrls.chatTrigger"),clickToDisplay:this.$locale.baseText("nodeWebhooks.clickToDisplayWebhookUrls.formTrigger"),clickToHide:this.$locale.baseText("nodeWebhooks.clickToHideWebhookUrls.chatTrigger"),clickToCopy:this.$locale.baseText("nodeWebhooks.clickToCopyWebhookUrls.chatTrigger"),testUrl:this.$locale.baseText("nodeWebhooks.testUrl"),productionUrl:this.$locale.baseText("nodeWebhooks.productionUrl"),copyTitle:this.$locale.baseText("nodeWebhooks.showMessage.title.chatTrigger"),copyMessage:this.$locale.baseText("nodeWebhooks.showMessage.message.chatTrigger")};case ut:return{toggleTitle:this.$locale.baseText("nodeWebhooks.webhookUrls.formTrigger"),clickToDisplay:this.$locale.baseText("nodeWebhooks.clickToDisplayWebhookUrls.formTrigger"),clickToHide:this.$locale.baseText("nodeWebhooks.clickToHideWebhookUrls.formTrigger"),clickToCopy:this.$locale.baseText("nodeWebhooks.clickToCopyWebhookUrls.formTrigger"),testUrl:this.$locale.baseText("nodeWebhooks.testUrl"),productionUrl:this.$locale.baseText("nodeWebhooks.productionUrl"),copyTitle:this.$locale.baseText("nodeWebhooks.showMessage.title.formTrigger"),copyMessage:this.$locale.baseText("nodeWebhooks.showMessage.message.formTrigger")};default:return{toggleTitle:this.$locale.baseText("nodeWebhooks.webhookUrls"),clickToDisplay:this.$locale.baseText("nodeWebhooks.clickToDisplayWebhookUrls"),clickToHide:this.$locale.baseText("nodeWebhooks.clickToHideWebhookUrls"),clickToCopy:this.$locale.baseText("nodeWebhooks.clickToCopyWebhookUrls"),testUrl:this.$locale.baseText("nodeWebhooks.testUrl"),productionUrl:this.$locale.baseText("nodeWebhooks.productionUrl"),copyTitle:this.$locale.baseText("nodeWebhooks.showMessage.title"),copyMessage:void 0}}}},watch:{node(){this.isMinimized=!Io.includes(this.nodeType.name)}},methods:{copyWebhookUrl(e){const t=this.getWebhookUrlDisplay(e);this.clipboard.copy(t),this.showMessage({title:this.baseText.copyTitle,message:this.baseText.copyMessage,type:"success"}),this.$telemetry.track("User copied webhook URL",{pane:"parameters",type:`${this.showUrlFor} url`})},getWebhookUrlDisplay(e){return this.node?this.workflowHelpers.getWebhookUrl(e,this.node,this.isProductionOnly?"production":this.showUrlFor):""},isWebhookMethodVisible(e){try{const t=this.workflowHelpers.getWebhookExpressionValue(e,"httpMethod",!1);if(Array.isArray(t)&&t.length!==1)return!1}catch{}return typeof e.ndvHideMethod=="string"?!this.workflowHelpers.getWebhookExpressionValue(e,"ndvHideMethod"):!e.ndvHideMethod},getWebhookHttpMethod(e){const t=this.workflowHelpers.getWebhookExpressionValue(e,"httpMethod",!1);return Array.isArray(t)?t[0]:t}}}),ho=e=>(Dn("data-v-36c5dbc7"),e=e(),Cn(),e),Ba={key:0,class:"webhooks"},Ua=["title"],La={key:0,class:"node-webhooks"},xa={key:0,class:"url-selection"},Ha={key:0,class:"webhook-wrapper"},Fa={class:"http-field"},za={class:"http-method"},qa=ho(()=>h("br",null,null,-1)),ja={class:"url-field"},Ka=["onClick"],Ya=ho(()=>h("br",null,null,-1)),Ga={key:1,class:"webhook-wrapper"},Ja={class:"url-field-full-width"},Xa=["onClick"],Qa=ho(()=>h("br",null,null,-1));function Za(e,t,o,n,s,i){const l=D("font-awesome-icon"),r=D("n8n-radio-buttons"),a=D("el-col"),u=D("el-row"),c=D("n8n-tooltip"),p=D("el-collapse-transition");return e.webhooksNode.length&&e.visibleWebhookUrls.length>0?(d(),k("div",Ba,[h("div",{class:T(["clickable headline",{expanded:!e.isMinimized}]),title:e.isMinimized?e.baseText.clickToDisplay:e.baseText.clickToHide,onClick:t[0]||(t[0]=g=>e.isMinimized=!e.isMinimized)},[v(l,{icon:"angle-right",class:"minimize-button minimize-icon"}),R(" "+N(e.baseText.toggleTitle),1)],10,Ua),v(p,null,{default:b(()=>[e.isMinimized?E("",!0):(d(),k("div",La,[e.isProductionOnly?E("",!0):(d(),k("div",xa,[v(u,null,{default:b(()=>[v(a,{span:24},{default:b(()=>[v(r,{modelValue:e.showUrlFor,"onUpdate:modelValue":t[1]||(t[1]=g=>e.showUrlFor=g),options:e.urlOptions},null,8,["modelValue","options"])]),_:1})]),_:1})])),(d(!0),k(se,null,he(e.visibleWebhookUrls,(g,m)=>(d(),O(c,{key:m,class:"item",content:e.baseText.clickToCopy,placement:"left"},{default:b(()=>[e.isWebhookMethodVisible(g)?(d(),k("div",Ha,[h("div",Fa,[h("div",za,[R(N(e.getWebhookHttpMethod(g)),1),qa])]),h("div",ja,[h("div",{class:"webhook-url left-ellipsis clickable",onClick:y=>e.copyWebhookUrl(g)},[R(N(e.getWebhookUrlDisplay(g)),1),Ya],8,Ka)])])):(d(),k("div",Ga,[h("div",Ja,[h("div",{class:"webhook-url left-ellipsis clickable",onClick:y=>e.copyWebhookUrl(g)},[R(N(e.getWebhookUrlDisplay(g)),1),Qa],8,Xa)])]))]),_:2},1032,["content"]))),128))]))]),_:1})])):E("",!0)}const er=Z(Va,[["render",Za],["__scopeId","data-v-36c5dbc7"]]),tr=["data-test-id"],or=["textContent"],nr=["onClick"],sr=["onClick"],ir=["data-node-name"],ar=["onClick"],rr=Q({__name:"NDVSubConnections",props:{rootNode:{}},emits:["switchSelectedNode","openConnectionNodeCreator"],setup(e,{expose:t,emit:o}){const n=e,s=oe(),i=ue(),l=je(),{debounce:r}=Ot(),a=o,u=K([]),c=K([]),p=K(!1),g=W(()=>i.getNodeType(n.rootNode.type,n.rootNode.typeVersion)),m=W(()=>s.getNodeByName(n.rootNode.name)),y=W(()=>s.getCurrentWorkflow()),S=W(()=>{const M=l.getNodeIssues(g.value,n.rootNode,y.value,["typeUnknown","parameters","credentials","execution"]);return(M==null?void 0:M.input)??{}}),w=W(()=>u.value.reduce((M,z)=>{const G=H(y.value.getParentNodes(n.rootNode.name,z.type));return{...M,[z.type]:G}},{}));function C(M){return u.value.find(z=>z.type===M)}function I(M){const z=C(M);return(z==null?void 0:z.maxConnections)!==1}function P(M){return I(M)&&!c.value.includes(M)}function V(M,z){I(M)&&(z?c.value=[...c.value,M]:c.value=c.value.filter(G=>G!==M))}function H(M){return M.map(z=>{const G=s.getNodeByName(z);if(G){const ne=i.getNodeType(G.type);if(ne){const re=l.getNodeIssues(ne,G,y.value),q=re?cn(re,G):"";return{node:G,nodeType:ne,issues:q}}}return null}).filter(z=>z!==null)}function x(M){return p.value&&(S.value[M]??[]).length>0}function f(M){return typeof M=="string"?!1:"type"in M}function $(){return!g.value||!n.rootNode?[]:De(y.value,n.rootNode,g.value).filter(G=>f(G)?G.type!=="main":!1)}function A(M,z){if(I(z)&&!c.value.includes(z)){V(z,!0);return}a("switchSelectedNode",M)}function B(M){const z=w.value[M];if(I(M)&&!c.value.includes(M)&&z.length>=1){V(M,!0);return}a("openConnectionNodeCreator",n.rootNode.name,M)}function Y(){p.value=!1,setTimeout(()=>{p.value=!0},0)}return _e(m,r(()=>setTimeout(()=>{c.value=[],u.value=$()},0),{debounceTime:1e3}),{immediate:!0}),t({showNodeInputsIssues:Y}),(M,z)=>{const G=D("n8n-icon-button"),ne=D("n8n-tooltip"),re=ht("on-click-outside");return d(),k("div",{class:T(M.$style.container)},[h("div",{class:T(M.$style.connections),style:ie(`--possible-connections: ${u.value.length}`)},[(d(!0),k(se,null,he(u.value,q=>(d(),k("div",{key:q.type,"data-test-id":`subnode-connection-group-${q.type}`},[h("div",{class:T(M.$style.connectionType)},[h("span",{class:T({[M.$style.connectionLabel]:!0,[M.$style.hasIssues]:x(q.type)}),textContent:N(`${q.displayName}${q.required?" *":""}`)},null,10,or),ee((d(),k("div",{class:T({[M.$style.connectedNodesWrapper]:!0,[M.$style.connectedNodesWrapperExpanded]:c.value.includes(q.type)}),style:ie(`--nodes-length: ${w.value[q.type].length}`),onClick:L=>V(q.type,!0)},[!(w.value[q.type].length>=1)||q.maxConnections!==1?(d(),k("div",{key:0,class:T({[M.$style.plusButton]:!0,[M.$style.hasIssues]:x(q.type)}),onClick:L=>B(q.type)},[v(ne,{placement:"top",teleported:!0,offset:10,"show-after":300,disabled:P(q.type)&&w.value[q.type].length>=1},{content:b(()=>[R(" Add "+N(q.displayName)+" ",1),x(q.type)?(d(),O(jt,{key:0,title:`${M.$locale.baseText("node.issues")}:`,items:S.value[q.type]},null,8,["title","items"])):E("",!0)]),default:b(()=>[v(G,{size:"medium",icon:"plus",type:"tertiary","data-test-id":`add-subnode-${q.type}`},null,8,["data-test-id"])]),_:2},1032,["disabled"])],10,sr)):E("",!0),w.value[q.type].length>0?(d(),k("div",{key:1,class:T({[M.$style.connectedNodes]:!0,[M.$style.connectedNodesMultiple]:w.value[q.type].length>1})},[(d(!0),k(se,null,he(w.value[q.type],(L,F)=>(d(),k("div",{key:L.node.name,class:T({[M.$style.nodeWrapper]:!0,[M.$style.hasIssues]:L.issues}),"data-test-id":"floating-subnode","data-node-name":L.node.name,style:ie(`--node-index: ${F}`)},[(d(),O(ne,{key:L.node.name,placement:"top",teleported:!0,offset:10,"show-after":300,disabled:P(q.type)},{content:b(()=>[R(N(L.node.name)+" ",1),L.issues?(d(),O(jt,{key:0,title:`${M.$locale.baseText("node.issues")}:`,items:L.issues},null,8,["title","items"])):E("",!0)]),default:b(()=>[h("div",{class:T(M.$style.connectedNode),onClick:be=>A(L.node.name,q.type)},[v(Fe,{"node-type":L.nodeType,"node-name":L.node.name,"tooltip-position":"top",size:20,circle:""},null,8,["node-type","node-name"])],10,ar)]),_:2},1032,["disabled"]))],14,ir))),128))],2)):E("",!0)],14,nr)),[[re,()=>V(q.type,!1)]])],2)],8,tr))),128))],6)],2)}}}),lr="_container_dier5_18",dr="_connections_dier5_26",ur="_connectionType_dier5_38",cr="_connectionLabel_dier5_45",hr="_hasIssues_dier5_51",pr="_connectedNodesWrapper_dier5_55",fr="_plusButton_dier5_63",mr="_connectedNodesWrapperExpanded_dier5_81",gr="_connectedNodesMultiple_dier5_87",yr="_connectedNode_dier5_55",wr="_connectedNodes_dier5_55",vr="_nodeWrapper_dier5_125",Nr={container:lr,connections:dr,connectionType:ur,connectionLabel:cr,hasIssues:hr,connectedNodesWrapper:pr,plusButton:fr,"horizontal-shake":"_horizontal-shake_dier5_1",connectedNodesWrapperExpanded:mr,connectedNodesMultiple:gr,connectedNode:yr,connectedNodes:wr,nodeWrapper:vr},kr={$style:Nr},br=Z(rr,[["__cssModules",kr]]),ln="N8N_NODE_TEST_STEP_POPUP_COUNT",dn=10,Tr=3e3,Sr=Q({inheritAttrs:!1,props:{nodeName:{type:String,required:!0},disabled:{type:Boolean,default:!1},label:{type:String},type:{type:String},size:{type:String},transparent:{type:Boolean,default:!1},telemetrySource:{type:String},hideIcon:{type:Boolean},tooltip:{type:String}},emits:["stopExecution","execute"],setup(e){const t=ct(),n=oe().getNodeByName(e.nodeName),s=Ce(n),i=ze(),{runWorkflow:l,stopCurrentExecution:r}=mn({router:t});return{externalHooks:i,pinnedData:s,runWorkflow:l,stopCurrentExecution:r,lastPopupCountUpdate:0,...qe(),...no()}},computed:{...ve(ue,ae,oe,Ne),node(){return this.workflowsStore.getNodeByName(this.nodeName)},nodeType(){return this.node?this.nodeTypesStore.getNodeType(this.node.type,this.node.typeVersion):null},nodeRunning(){var t,o;const e=this.workflowsStore.executedNode;return this.workflowRunning&&(this.workflowsStore.isNodeExecuting(((t=this.node)==null?void 0:t.name)??"")||e===((o=this.node)==null?void 0:o.name))},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},isTriggerNode(){return this.node?this.nodeTypesStore.isTriggerNode(this.node.type):!1},isManualTriggerNode(){return!!(this.nodeType&&this.nodeType.name===so)},isChatNode(){return!!(this.nodeType&&this.nodeType.name===He)},isChatChild(){return this.workflowsStore.checkIfNodeHasChatParent(this.nodeName)},isFormTriggerNode(){return!!(this.nodeType&&this.nodeType.name===ut)},isPollingTypeNode(){var e;return!!((e=this.nodeType)!=null&&e.polling)},isScheduleTrigger(){var e;return!!((e=this.nodeType)!=null&&e.group.includes("schedule"))},isWebhookNode(){return!!(this.nodeType&&this.nodeType.name===io)},isListeningForEvents(){const e=this.workflowsStore.executionWaitingForWebhook,t=this.workflowsStore.executedNode;return!!this.node&&!this.node.disabled&&this.isTriggerNode&&e&&(!t||t===this.nodeName)},isListeningForWorkflowEvents(){return this.nodeRunning&&this.isTriggerNode&&!this.isScheduleTrigger&&!this.isManualTriggerNode},hasIssues(){var e;return!!((e=this.node)!=null&&e.issues&&(this.node.issues.parameters||this.node.issues.credentials))},disabledHint(){var e;if(this.isListeningForEvents)return"";if(this.isTriggerNode&&((e=this.node)!=null&&e.disabled))return this.$locale.baseText("ndv.execute.nodeIsDisabled");if(this.isTriggerNode&&this.hasIssues){const t=this.ndvStore.activeNode;return t&&t.name!==this.nodeName?this.$locale.baseText("ndv.execute.fixPrevious"):this.$locale.baseText("ndv.execute.requiredFieldsMissing")}return this.workflowRunning&&!this.nodeRunning?this.$locale.baseText("ndv.execute.workflowAlreadyRunning"):""},tooltipText(){return this.disabledHint?this.disabledHint:this.tooltip&&!this.loading&&this.testStepButtonPopupCount()<dn?this.tooltip:""},buttonLabel(){var e;return this.isListeningForEvents||this.isListeningForWorkflowEvents?this.$locale.baseText("ndv.execute.stopListening"):this.label?this.label:this.isChatNode?this.$locale.baseText("ndv.execute.testChat"):this.isWebhookNode?this.$locale.baseText("ndv.execute.listenForTestEvent"):this.isFormTriggerNode?this.$locale.baseText("ndv.execute.testStep"):this.isPollingTypeNode||(e=this.nodeType)!=null&&e.mockManualExecution?this.$locale.baseText("ndv.execute.fetchEvent"):this.$locale.baseText("ndv.execute.testNode")},loading(){return this.nodeRunning&&!this.isListeningForEvents&&!this.isListeningForWorkflowEvents}},methods:{async stopWaitingForWebhook(){try{await this.workflowsStore.removeTestWebhook(this.workflowsStore.workflowId)}catch(e){this.showError(e,this.$locale.baseText("ndv.execute.stopWaitingForWebhook.error"));return}},testStepButtonPopupCount(){return Number(localStorage.getItem(ln))},onMouseOver(){const e=this.testStepButtonPopupCount();if(e<dn&&!this.disabledHint&&this.tooltipText){const t=Date.now();(!this.lastPopupCountUpdate||t-this.lastPopupCountUpdate>=Tr)&&(localStorage.setItem(ln,`${e+1}`),this.lastPopupCountUpdate=t)}},async onClick(){if(this.isChatNode||this.isChatChild&&this.ndvStore.isNDVDataEmpty("input"))this.ndvStore.setActiveNodeName(null),pe.emit("openChat");else if(this.isListeningForEvents)await this.stopWaitingForWebhook();else if(this.isListeningForWorkflowEvents)await this.stopCurrentExecution(),this.$emit("stopExecution");else{let e=!1;if(this.pinnedData.hasData.value&&(e=await this.confirm(this.$locale.baseText("ndv.pinData.unpinAndExecute.description"),this.$locale.baseText("ndv.pinData.unpinAndExecute.title"),{confirmButtonText:this.$locale.baseText("ndv.pinData.unpinAndExecute.confirm"),cancelButtonText:this.$locale.baseText("ndv.pinData.unpinAndExecute.cancel")})===et,e&&this.node&&this.pinnedData.unsetData("unpin-and-execute-modal")),!this.pinnedData.hasData.value||e){const t={node_type:this.nodeType?this.nodeType.name:null,workflow_id:this.workflowsStore.workflowId,source:this.telemetrySource,push_ref:this.ndvStore.pushRef};this.$telemetry.track("User clicked execute node button",t),await this.externalHooks.run("nodeExecuteButton.onClick",t),await this.runWorkflow({destinationNode:this.nodeName,source:"RunData.ExecuteNodeButton"}),this.$emit("execute")}}}}});function Dr(e,t,o,n,s,i){const l=D("n8n-button"),r=D("n8n-tooltip");return d(),k("div",null,[v(r,{placement:"right",disabled:!e.tooltipText},{content:b(()=>[h("div",null,N(e.tooltipText),1)]),default:b(()=>[h("div",null,[v(l,ra(e.$attrs,{loading:e.loading,disabled:e.disabled||!!e.disabledHint,label:e.buttonLabel,type:e.type,size:e.size,icon:!e.isListeningForEvents&&!e.hideIcon?"flask":void 0,"transparent-background":e.transparent,title:!e.isTriggerNode&&!e.tooltipText?e.$locale.baseText("ndv.execute.testNode.description"):"",onMouseover:e.onMouseOver,onClick:e.onClick}),null,16,["loading","disabled","label","type","size","icon","transparent-background","title","onMouseover","onClick"])])]),_:1},8,["disabled"])])}const po=Z(Sr,[["render",Dr]]),Cr=Q({name:"NodeSettings",components:{NodeTitle:Aa,NodeCredentials:$s,ParameterInputList:Os,NodeSettingsTabs:Wa,NodeWebhooks:er,NDVSubConnections:br,NodeExecuteButton:po},setup(){const e=je(),t=ze(),{showMessage:o}=qe();return{externalHooks:t,nodeHelpers:e,showMessage:o}},computed:{...ve(ao,ue,ae,Ne,yn,oe,gn),isReadOnly(){return this.readOnly||this.hasForeignCredential},isExecutable(){if(this.nodeType&&this.node){const e=this.workflowsStore.getCurrentWorkflow(),t=e.getNode(this.node.name),o=De(e,t,this.nodeType);if(!Ie(o).includes(U.Main)&&!this.isTriggerNode)return!1}return this.executable||this.hasForeignCredential},nodeTypeName(){if(this.nodeType){const e=this.$locale.shortNodeType(this.nodeType.name);return this.$locale.headerText({key:`headers.${e}.displayName`,fallback:this.nodeType.name})}return""},nodeTypeVersions(){return this.node?this.nodeTypesStore.getNodeVersions(this.node.type):[]},latestVersion(){return Math.max(...this.nodeTypeVersions)},isLatestNodeVersion(){var e;return!((e=this.node)!=null&&e.typeVersion)||this.latestVersion===this.node.typeVersion},executeButtonTooltip(){return this.node&&this.isLatestNodeVersion&&this.inputSize>1&&!gs(this.node.type,this.node.parameters)?this.$locale.baseText("nodeSettings.executeButtonTooltip.times",{interpolate:{inputSize:this.inputSize}}):""},nodeVersionTag(){return!this.nodeType||this.nodeType.hidden?this.$locale.baseText("nodeSettings.deprecated"):this.isLatestNodeVersion?this.$locale.baseText("nodeSettings.latest"):this.$locale.baseText("nodeSettings.latestVersion",{interpolate:{version:this.latestVersion.toString()}})},nodeTypeDescription(){var e;if((e=this.nodeType)!=null&&e.description){const t=this.$locale.shortNodeType(this.nodeType.name);return this.$locale.headerText({key:`headers.${t}.description`,fallback:this.nodeType.description})}else return this.$locale.baseText("nodeSettings.noDescriptionFound")},headerStyle(){return this.node?{"background-color":this.node.color}:{}},node(){return this.ndvStore.activeNode},parametersSetting(){return this.parameters.filter(e=>e.isNodeSetting)},parametersNoneSetting(){return this.parameters.filter(e=>!e.isNodeSetting)},parameters(){var e;return this.nodeType===null?[]:((e=this.nodeType)==null?void 0:e.properties)??[]},outputPanelEditMode(){return this.ndvStore.outputPanelEditMode},isCommunityNode(){return!!this.node&&pn(this.node.type)},isTriggerNode(){return!!this.node&&this.nodeTypesStore.isTriggerNode(this.node.type)},workflowOwnerName(){return this.workflowsEEStore.getWorkflowOwnerName(`${this.workflowsStore.workflowId}`)},hasForeignCredential(){return this.foreignCredentials.length>0},usedCredentials(){return Object.values(this.workflowsStore.usedCredentials).filter(e=>{var t;return Object.values(((t=this.node)==null?void 0:t.credentials)||[]).find(o=>o.id===e.id)})},credentialOwnerName(){const e=this.usedCredentials?Object.values(this.usedCredentials).find(t=>t.id===this.foreignCredentials[0]):void 0;return this.credentialsStore.getCredentialOwnerName(e)}},props:{eventBus:{type:Object},dragging:{type:Boolean},pushRef:{type:String},nodeType:{type:Object},readOnly:{type:Boolean,default:!1},foreignCredentials:{type:Array,default:()=>[]},blockUI:{type:Boolean,default:!1},executable:{type:Boolean,default:!0},inputSize:{type:Number,default:0}},data(){return{nodeValid:!0,nodeColor:null,openPanel:"params",nodeValues:{color:"#ff0000",alwaysOutputData:!1,executeOnce:!1,notesInFlow:!1,onError:"stopWorkflow",retryOnFail:!1,maxTries:3,waitBetweenTries:1e3,notes:"",parameters:{}},nodeValuesInitialized:!1,nodeSettings:[],COMMUNITY_NODES_INSTALLATION_DOCS_URL:fn,CUSTOM_NODES_DOCS_URL:Rs,MAIN_NODE_PANEL_WIDTH:Qe,hiddenIssuesInputs:[]}},watch:{node(e,t){this.setNodeValues()}},mounted(){var e;this.populateHiddenIssuesSet(),this.populateSettings(),this.setNodeValues(),(e=this.eventBus)==null||e.on("openSettings",this.openSettings),this.nodeHelpers.updateNodeParameterIssues(this.node,this.nodeType),Po.on("setHttpNodeParameters",this.setHttpNodeParameters)},beforeUnmount(){var e;(e=this.eventBus)==null||e.off("openSettings",this.openSettings),Po.off("setHttpNodeParameters",this.setHttpNodeParameters)},methods:{setHttpNodeParameters(e){var t;try{this.valueChanged({node:(t=this.node)==null?void 0:t.name,name:"parameters",value:e})}catch{}},onSwitchSelectedNode(e){this.$emit("switchSelectedNode",e)},onOpenConnectionNodeCreator(e,t){this.$emit("openConnectionNodeCreator",e,t)},populateHiddenIssuesSet(){!this.node||!this.workflowsStore.isNodePristine(this.node.name)||(this.hiddenIssuesInputs.push("credentials"),this.parametersNoneSetting.forEach(e=>{this.hiddenIssuesInputs.push(e.name)}),this.workflowsStore.setNodePristine(this.node.name,!1))},populateSettings(){this.isExecutable&&!this.isTriggerNode&&this.nodeSettings.push({displayName:this.$locale.baseText("nodeSettings.alwaysOutputData.displayName"),name:"alwaysOutputData",type:"boolean",default:!1,noDataExpression:!0,description:this.$locale.baseText("nodeSettings.alwaysOutputData.description")},{displayName:this.$locale.baseText("nodeSettings.executeOnce.displayName"),name:"executeOnce",type:"boolean",default:!1,noDataExpression:!0,description:this.$locale.baseText("nodeSettings.executeOnce.description")},{displayName:this.$locale.baseText("nodeSettings.retryOnFail.displayName"),name:"retryOnFail",type:"boolean",default:!1,noDataExpression:!0,description:this.$locale.baseText("nodeSettings.retryOnFail.description")},{displayName:this.$locale.baseText("nodeSettings.maxTries.displayName"),name:"maxTries",type:"number",typeOptions:{minValue:2,maxValue:5},default:3,displayOptions:{show:{retryOnFail:[!0]}},noDataExpression:!0,description:this.$locale.baseText("nodeSettings.maxTries.description")},{displayName:this.$locale.baseText("nodeSettings.waitBetweenTries.displayName"),name:"waitBetweenTries",type:"number",typeOptions:{minValue:0,maxValue:5e3},default:1e3,displayOptions:{show:{retryOnFail:[!0]}},noDataExpression:!0,description:this.$locale.baseText("nodeSettings.waitBetweenTries.description")},{displayName:this.$locale.baseText("nodeSettings.onError.displayName"),name:"onError",type:"options",options:[{name:this.$locale.baseText("nodeSettings.onError.options.stopWorkflow.displayName"),value:"stopWorkflow",description:this.$locale.baseText("nodeSettings.onError.options.stopWorkflow.description")},{name:this.$locale.baseText("nodeSettings.onError.options.continueRegularOutput.displayName"),value:"continueRegularOutput",description:this.$locale.baseText("nodeSettings.onError.options.continueRegularOutput.description")},{name:this.$locale.baseText("nodeSettings.onError.options.continueErrorOutput.displayName"),value:"continueErrorOutput",description:this.$locale.baseText("nodeSettings.onError.options.continueErrorOutput.description")}],default:"stopWorkflow",noDataExpression:!0,description:this.$locale.baseText("nodeSettings.onError.description")}),this.nodeSettings.push({displayName:this.$locale.baseText("nodeSettings.notes.displayName"),name:"notes",type:"string",typeOptions:{rows:5},default:"",noDataExpression:!0,description:this.$locale.baseText("nodeSettings.notes.description")},{displayName:this.$locale.baseText("nodeSettings.notesInFlow.displayName"),name:"notesInFlow",type:"boolean",default:!1,noDataExpression:!0,description:this.$locale.baseText("nodeSettings.notesInFlow.description")})},onParameterBlur(e){this.hiddenIssuesInputs=this.hiddenIssuesInputs.filter(t=>t!==e)},onWorkflowActivate(){this.hiddenIssuesInputs=[],this.$emit("activate")},onNodeExecute(){var e;this.hiddenIssuesInputs=[],(e=this.$refs.subConnections)==null||e.showNodeInputsIssues(),this.$emit("execute")},setValue(e,t){const o=e.split(".");let n=o.pop(),s=!1;if(n!==void 0&&n.includes("[")){const i=n.match(/(.*)\[(\d+)\]$/);i&&(o.push(i[1]),n=i[2],s=!0)}if(o.length===0)if(t===null){if(n){const{[n]:i,...l}=this.nodeValues;this.nodeValues=l}}else this.nodeValues={...this.nodeValues,[n]:t};else if(t===null){let i=Se(this.nodeValues,o.join("."));if(n&&!Array.isArray(i)){const{[n]:l,...r}=i;i=r}if(s&&Array.isArray(i)&&i.length===0&&(n=o.pop(),i=Se(this.nodeValues,o.join(".")),n)){const{[n]:l,...r}=i;i=r}}else typeof t=="object"?Je(Se(this.nodeValues,o.join(".")),n,xe(t)):Je(Se(this.nodeValues,o.join(".")),n,t);this.nodeValues={...this.nodeValues}},credentialSelected(e){this.workflowsStore.updateNodeProperties(e);const t=this.workflowsStore.getNodeByName(e.name);t&&this.nodeHelpers.updateNodeCredentialIssues(t),this.externalHooks.run("nodeSettings.credentialSelected",{updateInformation:e})},nameChanged(e){this.node&&this.historyStore.pushCommandToUndo(new wn(this.node.name,e)),this.valueChanged({value:e,name:"name"})},valueChanged(e){var s,i,l;let t;e.hasOwnProperty("value")?t=e.value:t=Se(this.nodeValues,e.name);const o=e.node||((s=this.node)==null?void 0:s.name);if(!o)return;const n=this.workflowsStore.getNodeByName(o);if(n!==null)if(e.name==="onError"&&this.$emit("redrawRequired"),e.name==="name"){const r={value:t,oldValue:o,name:e.name};this.$emit("valueChanged",r)}else if(e.name==="parameters"){const r=this.nodeTypesStore.getNodeType(n.type,n.typeVersion);if(!r)return;let a=Ze(r.properties,n.parameters,!1,!1,n);const u=Object.assign({},a);if(a=xe(a),e.value&&typeof e.value=="object")for(const c of Object.keys(e.value)){t=e.value[c];const p=c.split(".").slice(1).join("."),g=p.match(/(.*)\[(\d+)\]$/);if(e[c]===void 0&&g!==null){const m=g[1],y=g[2],S=Se(a,m);Array.isArray(S)&&(S.splice(parseInt(y,10),1),Je(a,m,S))}else t===void 0?Ht(a,p):Je(a,p,t);this.externalHooks.run("nodeSettings.valueChanged",{parameterPath:p,newValue:t,parameters:this.parameters,oldNodeParameters:u})}a=Ze(r.properties,a,!0,!1,n);for(const c of Object.keys(a))a&&a[c]!==null&&a[c]!==void 0&&this.setValue(`parameters.${c}`,a[c]);if(a){const c={name:n.name,value:a};this.workflowsStore.setNodeParameters(c),this.nodeHelpers.updateNodeParameterIssuesByName(n.name),this.nodeHelpers.updateNodeCredentialIssuesByName(n.name)}}else if(e.name.startsWith("parameters.")){const r=this.nodeTypesStore.getNodeType(n.type,n.typeVersion);if(!r)return;e.type&&this.workflowsStore.nodeHasOutputConnection(n.name)&&((i=_o[r.name])!=null&&i.eventTypes.includes(e.type))&&((l=_o[r.name])!=null&&l.parameterPaths.includes(e.name))&&(this.workflowsStore.removeAllNodeConnection(n,{preserveInputConnections:!0}),this.showMessage({type:"warning",title:this.$locale.baseText("nodeSettings.outputCleared.title"),message:this.$locale.baseText("nodeSettings.outputCleared.message")}));let a=Ze(r.properties,n.parameters,!1,!1,n);const u=Object.assign({},a);a=xe(a);const c=e.name.split(".").slice(1).join("."),p=c.match(/(.*)\[(\d+)\]$/);if(e.value===void 0&&p!==null){const m=p[1],y=p[2],S=Se(a,m);Array.isArray(S)&&(S.splice(parseInt(y,10),1),Je(a,m,S))}else t===void 0?Ht(a,c):Je(a,c,t),this.removeMismatchedOptionValues(r,a,{name:c,value:t});a=Ze(r.properties,a,!0,!1,n);for(const m of Object.keys(a))a&&a[m]!==null&&a[m]!==void 0&&this.setValue(`parameters.${m}`,a[m]);const g={name:n.name,value:a};this.workflowsStore.setNodeParameters(g),this.externalHooks.run("nodeSettings.valueChanged",{parameterPath:c,newValue:t,parameters:this.parameters,oldNodeParameters:u}),this.nodeHelpers.updateNodeParameterIssuesByName(n.name),this.nodeHelpers.updateNodeCredentialIssuesByName(n.name),this.$telemetry.trackNodeParametersValuesChange(r.name,e)}else{this.nodeValues={...this.nodeValues,[e.name]:t};const r={name:n.name,key:e.name,value:t};this.workflowsStore.setNodeValue(r)}},removeMismatchedOptionValues(e,t,o){e.properties.forEach(n=>{var a,u;const s=n.displayOptions;if(!(t!=null&&t.hasOwnProperty(n.name))||!s||!n.options)return;const i=(a=s.show)==null?void 0:a[o.name],l=(u=s.hide)==null?void 0:u[o.name];if(i===void 0&&l===void 0)return;let r=!0;ys(n.options)||ws(n.options)?r=Object.keys(t).every(c=>(n.options??[]).find(p=>p.name===c)!==void 0):vs(n.options)&&(r=!!n.options.find(c=>c.value===t[n.name])),!r&&Ns(t,n,this.node)&&Ht(t,n.name)})},setNodeValues(){if(!this.node){this.nodeValuesInitialized=!0;return}if(this.nodeType!==null){this.nodeValid=!0;const e=[];this.node.color&&(e.push("color"),this.nodeValues={...this.nodeValues,color:this.node.color}),this.node.notes&&(e.push("notes"),this.nodeValues={...this.nodeValues,notes:this.node.notes}),this.node.alwaysOutputData&&(e.push("alwaysOutputData"),this.nodeValues={...this.nodeValues,alwaysOutputData:this.node.alwaysOutputData}),this.node.executeOnce&&(e.push("executeOnce"),this.nodeValues={...this.nodeValues,executeOnce:this.node.executeOnce}),this.node.continueOnFail&&(e.push("onError"),this.nodeValues={...this.nodeValues,onError:"continueRegularOutput"}),this.node.onError&&(e.push("onError"),this.nodeValues={...this.nodeValues,onError:this.node.onError}),this.node.notesInFlow&&(e.push("notesInFlow"),this.nodeValues={...this.nodeValues,notesInFlow:this.node.notesInFlow}),this.node.retryOnFail&&(e.push("retryOnFail"),this.nodeValues={...this.nodeValues,retryOnFail:this.node.retryOnFail}),this.node.maxTries&&(e.push("maxTries"),this.nodeValues={...this.nodeValues,maxTries:this.node.maxTries}),this.node.waitBetweenTries&&(e.push("waitBetweenTries"),this.nodeValues={...this.nodeValues,waitBetweenTries:this.node.waitBetweenTries});for(const t of this.nodeSettings)e.includes(t.name)||(this.nodeValues={...this.nodeValues,[t.name]:t.default});this.nodeValues={...this.nodeValues,parameters:xe(this.node.parameters)}}else this.nodeValid=!1;this.nodeValuesInitialized=!0},onMissingNodeTextClick(e){e.target.localName==="a"&&this.$telemetry.track("user clicked cnr browse button",{source:"cnr missing node modal"})},onMissingNodeLearnMoreLinkClick(){var e,t;this.$telemetry.track("user clicked cnr docs link",{source:"missing node modal source",package_name:(e=this.node)==null?void 0:e.type.split(".")[0],node_type:(t=this.node)==null?void 0:t.type})},onStopExecution(){this.$emit("stopExecution")},openSettings(){this.openPanel="settings"},onTabSelect(e){this.openPanel=e}}}),Er="_header_1pn0y_1",Ir="_warningIcon_1pn0y_5",Pr="_descriptionContainer_1pn0y_10",_r={header:Er,warningIcon:Ir,descriptionContainer:Pr},$r={class:"header-side-menu"},Or={key:1},Rr={key:0,class:"node-is-not-valid"},Mr={class:"missingNodeTitleContainer mt-s mb-xs"},Ar={class:"mb-l"},Wr=["href"],Vr=["href","textContent"],Br={key:1,class:"node-parameters-wrapper","data-test-id":"node-parameters"},Ur={key:1,class:"no-parameters"},Lr={key:2,class:"parameter-item parameter-notice","data-test-id":"node-parameters-http-notice"},xr={class:"node-version","data-test-id":"node-version"};function Hr(e,t,o,n,s,i){var P,V;const l=D("NodeTitle"),r=D("NodeExecuteButton"),a=D("NodeSettingsTabs"),u=D("font-awesome-icon"),c=D("n8n-text"),p=D("i18n-t"),g=D("n8n-link"),m=D("n8n-notice"),y=D("NodeWebhooks"),S=D("NodeCredentials"),w=D("ParameterInputList"),C=D("NDVSubConnections"),I=D("n8n-block-ui");return d(),k("div",{class:T({"node-settings":!0,dragging:e.dragging}),onKeydown:t[0]||(t[0]=fe(()=>{},["stop"]))},[h("div",{class:T(e.$style.header)},[h("div",$r,[e.node?(d(),O(l,{key:0,class:"node-name","model-value":e.node.name,"node-type":e.nodeType,"read-only":e.isReadOnly,"onUpdate:modelValue":e.nameChanged},null,8,["model-value","node-type","read-only","onUpdate:modelValue"])):E("",!0),e.isExecutable?(d(),k("div",Or,[!e.blockUI&&e.node&&e.nodeValid?(d(),O(r,{key:0,"data-test-id":"node-execute-button","node-name":e.node.name,disabled:e.outputPanelEditMode.enabled&&!e.isTriggerNode,tooltip:e.executeButtonTooltip,size:"small","telemetry-source":"parameters",onExecute:e.onNodeExecute,onStopExecution:e.onStopExecution},null,8,["node-name","disabled","tooltip","onExecute","onStopExecution"])):E("",!0)])):E("",!0)]),e.node&&e.nodeValid?(d(),O(a,{key:0,"model-value":e.openPanel,"node-type":e.nodeType,"push-ref":e.pushRef,"onUpdate:modelValue":e.onTabSelect},null,8,["model-value","node-type","push-ref","onUpdate:modelValue"])):E("",!0)],2),e.node&&!e.nodeValid?(d(),k("div",Rr,[h("p",{class:T(e.$style.warningIcon)},[v(u,{icon:"exclamation-triangle"})],2),h("div",Mr,[v(c,{size:"large",color:"text-dark",bold:""},{default:b(()=>[R(N(e.$locale.baseText("nodeSettings.communityNodeUnknown.title")),1)]),_:1})]),e.isCommunityNode?(d(),k("div",{key:0,class:T(e.$style.descriptionContainer)},[h("div",Ar,[v(p,{keypath:"nodeSettings.communityNodeUnknown.description",tag:"span",onClick:e.onMissingNodeTextClick},{action:b(()=>[h("a",{href:`https://www.npmjs.com/package/${e.node.type.split(".")[0]}`,target:"_blank"},N(e.node.type.split(".")[0]),9,Wr)]),_:1},8,["onClick"])]),v(g,{to:e.COMMUNITY_NODES_INSTALLATION_DOCS_URL,onClick:e.onMissingNodeLearnMoreLinkClick},{default:b(()=>[R(N(e.$locale.baseText("nodeSettings.communityNodeUnknown.installLink.text")),1)]),_:1},8,["to","onClick"])],2)):(d(),O(p,{key:1,keypath:"nodeSettings.nodeTypeUnknown.description",tag:"span"},{action:b(()=>[h("a",{href:e.CUSTOM_NODES_DOCS_URL,target:"_blank",textContent:N(e.$locale.baseText("nodeSettings.nodeTypeUnknown.description.customNode"))},null,8,Vr)]),_:1}))])):E("",!0),e.node&&e.nodeValid?(d(),k("div",Br,[e.hasForeignCredential?(d(),O(m,{key:0,content:e.$locale.baseText("nodeSettings.hasForeignCredential",{interpolate:{owner:e.credentialOwnerName}})},null,8,["content"])):E("",!0),ee(h("div",null,[v(y,{node:e.node,"node-type":e.nodeType},null,8,["node","node-type"]),e.nodeValuesInitialized?(d(),O(w,{key:0,parameters:e.parametersNoneSetting,"hide-delete":!0,"node-values":e.nodeValues,"is-read-only":e.isReadOnly,"hidden-issues-inputs":e.hiddenIssuesInputs,path:"parameters",onValueChanged:e.valueChanged,onActivate:e.onWorkflowActivate,onParameterBlur:e.onParameterBlur},{default:b(()=>[v(S,{node:e.node,readonly:e.isReadOnly,"show-all":!0,"hide-issues":e.hiddenIssuesInputs.includes("credentials"),onCredentialSelected:e.credentialSelected,onValueChanged:e.valueChanged,onBlur:e.onParameterBlur},null,8,["node","readonly","hide-issues","onCredentialSelected","onValueChanged","onBlur"])]),_:1},8,["parameters","node-values","is-read-only","hidden-issues-inputs","onValueChanged","onActivate","onParameterBlur"])):E("",!0),e.parametersNoneSetting.length===0?(d(),k("div",Ur,[v(c,null,{default:b(()=>[R(N(e.$locale.baseText("nodeSettings.thisNodeDoesNotHaveAnyParameters")),1)]),_:1})])):E("",!0),e.nodeHelpers.isCustomApiCallSelected(e.nodeValues)?(d(),k("div",Lr,[v(m,{content:e.$locale.baseText("nodeSettings.useTheHttpRequestNode",{interpolate:{nodeTypeDisplayName:((P=e.nodeType)==null?void 0:P.displayName)??""}})},null,8,["content"])])):E("",!0)],512),[[de,e.openPanel==="params"]]),ee(h("div",null,[v(w,{parameters:e.parametersSetting,"node-values":e.nodeValues,"is-read-only":e.isReadOnly,"hidden-issues-inputs":e.hiddenIssuesInputs,path:"parameters",onValueChanged:e.valueChanged,onParameterBlur:e.onParameterBlur},null,8,["parameters","node-values","is-read-only","hidden-issues-inputs","onValueChanged","onParameterBlur"]),v(w,{parameters:e.nodeSettings,"hide-delete":!0,"node-values":e.nodeValues,"is-read-only":e.isReadOnly,"hidden-issues-inputs":e.hiddenIssuesInputs,path:"",onValueChanged:e.valueChanged,onParameterBlur:e.onParameterBlur},null,8,["parameters","node-values","is-read-only","hidden-issues-inputs","onValueChanged","onParameterBlur"]),h("div",xr,[R(N(e.$locale.baseText("nodeSettings.nodeVersion",{interpolate:{node:(V=e.nodeType)==null?void 0:V.displayName,version:(e.node.typeVersion??e.latestVersion).toString()}}))+" ",1),h("span",null,"("+N(e.nodeVersionTag)+")",1)])],512),[[de,e.openPanel==="settings"]])])):E("",!0),e.node?(d(),O(C,{key:2,ref:"subConnections","root-node":e.node,onSwitchSelectedNode:e.onSwitchSelectedNode,onOpenConnectionNodeCreator:e.onOpenConnectionNodeCreator},null,8,["root-node","onSwitchSelectedNode","onOpenConnectionNodeCreator"])):E("",!0),v(I,{show:e.blockUI},null,8,["show"])],34)}const Fr={$style:_r},zr=Z(Cr,[["render",Hr],["__cssModules",Fr],["__scopeId","data-v-07fe6014"]]),qr=Q({name:"Draggable",props:{disabled:{type:Boolean},type:{type:String,required:!0},data:{type:String},tag:{type:String,default:"div"},targetDataKey:{type:String}},data(){const e={x:-100,y:-100};return{isDragging:!1,draggablePosition:e,draggingEl:null,draggableStyle:{transform:`translate(${e.x}px, ${e.y}px)`},animationFrameId:0}},computed:{...ve(ae),canDrop(){return this.ndvStore.canDraggableDrop},stickyPosition(){return this.ndvStore.draggableStickyPos}},methods:{setDraggableStyle(){this.draggableStyle={transform:`translate(${this.draggablePosition.x}px, ${this.draggablePosition.y}px)`}},onDragStart(e){var o,n,s;if(this.disabled||(this.draggingEl=e.target,this.targetDataKey&&((o=this.draggingEl.dataset)==null?void 0:o.target)!==this.targetDataKey&&(this.draggingEl=this.draggingEl.closest(`[data-target="${this.targetDataKey}"]`)),this.targetDataKey&&((s=(n=this.draggingEl)==null?void 0:n.dataset)==null?void 0:s.target)!==this.targetDataKey))return;e.preventDefault(),e.stopPropagation(),this.isDragging=!1,this.draggablePosition={x:e.pageX,y:e.pageY},this.setDraggableStyle(),window.addEventListener("mousemove",this.onDrag),window.addEventListener("mouseup",this.onDragEnd);const t=document.activeElement;t&&t.blur()},onDrag(e){var t;if(e.preventDefault(),e.stopPropagation(),!this.disabled){if(!this.isDragging){this.isDragging=!0;const o=this.targetDataKey&&this.draggingEl?this.draggingEl.dataset.value:this.data||"";this.ndvStore.draggableStartDragging({type:this.type,data:o||"",dimensions:((t=this.draggingEl)==null?void 0:t.getBoundingClientRect())??null}),this.$emit("dragstart",this.draggingEl),document.body.style.cursor="grabbing"}this.animationFrameId=window.requestAnimationFrame(()=>{this.canDrop&&this.stickyPosition?this.draggablePosition={x:this.stickyPosition[0],y:this.stickyPosition[1]}:this.draggablePosition={x:e.pageX,y:e.pageY},this.setDraggableStyle(),this.$emit("drag",this.draggablePosition)})}},onDragEnd(){this.disabled||(document.body.style.cursor="unset",window.removeEventListener("mousemove",this.onDrag),window.removeEventListener("mouseup",this.onDragEnd),window.cancelAnimationFrame(this.animationFrameId),setTimeout(()=>{this.$emit("dragend",this.draggingEl),this.isDragging=!1,this.draggingEl=null,this.ndvStore.draggableStopDragging()},0))}}}),jr="_dragging_176yl_1",Kr="_draggable_176yl_6",Yr={dragging:jr,draggable:Kr,"draggable-data-transfer":"_draggable-data-transfer_176yl_13"};function Gr(e,t,o,n,s,i){return d(),O(In(e.tag),{ref:"wrapper",class:T({[e.$style.dragging]:e.isDragging}),onMousedown:e.onDragStart},{default:b(()=>[le(e.$slots,"default",{isDragging:e.isDragging}),(d(),O(En,{to:"body"},[ee(h("div",{ref:"draggable",class:T(e.$style.draggable),style:ie(e.draggableStyle)},[le(e.$slots,"preview",{canDrop:e.canDrop,el:e.draggingEl})],6),[[de,e.isDragging]])]))]),_:3},40,["class","onMousedown"])}const Jr={$style:Yr},Xr=Z(qr,[["render",Gr],["__cssModules",Jr]]),Qr=Q({components:{Draggable:Xr},props:{canMoveRight:{type:Boolean},canMoveLeft:{type:Boolean}},methods:{onDrag(e){this.$emit("drag",e)},onDragStart(){this.$emit("dragstart")},onDragEnd(){this.$emit("dragend")}}}),Zr="_dragContainer_1fum9_1",el="_dragButton_1fum9_5",tl="_leftArrow_1fum9_19 _arrow_1fum9_28",ol="_rightArrow_1fum9_20 _arrow_1fum9_28",nl="_visible_1fum9_24",sl="_arrow_1fum9_28",il="_grid_1fum9_46",al={dragContainer:Zr,dragButton:el,leftArrow:tl,rightArrow:ol,visible:nl,arrow:sl,grid:il},rl=h("div",null,[h("div"),h("div"),h("div"),h("div"),h("div")],-1),ll=h("div",null,[h("div"),h("div"),h("div"),h("div"),h("div")],-1),dl=[rl,ll];function ul(e,t,o,n,s,i){const l=D("font-awesome-icon"),r=D("Draggable");return d(),O(r,{type:"panel-resize",class:T(e.$style.dragContainer),onDrag:e.onDrag,onDragstart:e.onDragStart,onDragend:e.onDragEnd},{default:b(({isDragging:a})=>[h("div",{class:T({[e.$style.dragButton]:!0})},[e.canMoveLeft?(d(),k("span",{key:0,class:T({[e.$style.leftArrow]:!0,[e.$style.visible]:a})},[v(l,{icon:"arrow-left"})],2)):E("",!0),e.canMoveRight?(d(),k("span",{key:1,class:T({[e.$style.rightArrow]:!0,[e.$style.visible]:a})},[v(l,{icon:"arrow-right"})],2)):E("",!0),h("div",{class:T(e.$style.grid)},dl,2)],2)]),_:1},8,["class","onDrag","onDragstart","onDragend"])}const cl={$style:al},hl=Z(Qr,[["render",ul],["__cssModules",cl]]),pl=["data-node-name","data-node-placement","onClick"],fl=Q({__name:"NDVFloatingNodes",props:{rootNode:{}},emits:["switchSelectedNode"],setup(e,{expose:t,emit:o}){const n=e,s=oe(),i=ue(),l=s.getCurrentWorkflow(),r=o;function a(y){const S=p.value[y][0];S&&r("switchSelectedNode",S.node.name)}function u(y){if(y.shiftKey&&y.altKey&&(y.ctrlKey||y.metaKey)){const w={ArrowUp:"outputSub",ArrowRight:"outputMain",ArrowLeft:"inputMain"}[y.key]||null;w&&a(w)}}function c(y){return y.map(S=>{const w=s.getNodeByName(S);if(w){const C=i.getNodeType(w.type);if(C)return{node:w,nodeType:C}}return null}).filter(S=>S!==null)}const p=W(()=>{const y=n.rootNode.name;return{outputSub:c(l.getChildNodes(y,"ALL_NON_MAIN")),outputMain:c(l.getChildNodes(y,"main",1)),inputMain:c(l.getParentNodes(y,"main",1))}}),g=["outputSub","outputMain","inputMain"],m={outputSub:"bottom",outputMain:"left",inputMain:"right"};return uo(()=>{document.addEventListener("keydown",u,!0)}),Pn(()=>{document.removeEventListener("keydown",u,!0)}),t({moveNodeDirection:a}),(y,S)=>{const w=D("n8n-tooltip");return d(),k("aside",{class:T(y.$style.floatingNodes)},[(d(),k(se,null,he(g,C=>h("ul",{key:C,class:T([y.$style.nodesList,y.$style[C]])},[(d(!0),k(se,null,he(p.value[C],({node:I,nodeType:P})=>(d(),k(se,null,[I&&P?(d(),O(w,{key:I.name,placement:m[C],teleported:!1,offset:60},{content:b(()=>[R(N(I.name),1)]),default:b(()=>[h("li",{class:T(y.$style.connectedNode),"data-test-id":"floating-node","data-node-name":I.name,"data-node-placement":C,onClick:V=>y.$emit("switchSelectedNode",I.name)},[v(Fe,{"node-type":P,"node-name":I.name,"tooltip-position":m[C],size:35,circle:""},null,8,["node-type","node-name","tooltip-position"])],10,pl)]),_:2},1032,["placement"])):E("",!0)],64))),256))],2)),64))],2)}}}),ml="_floatingNodes_1c7jr_1",gl="_nodesList_1c7jr_15",yl="_inputSub_1c7jr_29",wl="_outputSub_1c7jr_29",vl="_outputMain_1c7jr_40",Nl="_inputMain_1c7jr_40",kl="_connectedNode_1c7jr_63",bl={floatingNodes:ml,nodesList:gl,inputSub:yl,outputSub:wl,outputMain:vl,inputMain:Nl,connectedNode:kl},Tl={$style:bl},Sl=Z(fl,[["__cssModules",Tl]]),Le=24,un=80,Xe=280,Dl=320,Cl=420,El={regular:Qe,dragless:Qe,unknown:Qe,inputless:Qe,wide:Qe*2},Il=Q({name:"NDVDraggablePanels",components:{PanelDragButton:hl,NDVFloatingNodes:Sl},props:{isDraggable:{type:Boolean},hideInputAndOutput:{type:Boolean},position:{type:Number},nodeType:{type:Object,default:()=>({})}},setup(){const{callDebounced:e}=Ot();return{callDebounced:e}},data(){return{windowWidth:1,isDragging:!1,MIN_PANEL_WIDTH:Xe,initialized:!1}},mounted(){this.setTotalWidth(),this.mainPanelDimensions.relativeLeft===1&&this.mainPanelDimensions.relativeRight===1&&(this.setMainPanelWidth(),this.setPositions(this.getInitialLeftPosition(this.mainPanelDimensions.relativeWidth)),this.restorePositionData()),window.addEventListener("resize",this.setTotalWidth),this.$emit("init",{position:this.mainPanelDimensions.relativeLeft}),setTimeout(()=>{this.initialized=!0},0),_t.on("setPositionByName",this.setPositionByName)},beforeUnmount(){window.removeEventListener("resize",this.setTotalWidth),_t.off("setPositionByName",this.setPositionByName)},computed:{...ve(ae),mainPanelDimensions(){return this.ndvStore.getMainPanelDimensions(this.currentNodePaneType)},activeNode(){return this.ndvStore.activeNode},supportedResizeDirections(){const e=["right"];return this.isDraggable&&e.push("left"),e},currentNodePaneType(){return this.hasInputSlot?this.isDraggable?this.nodeType===null?"unknown":Se(this,"nodeType.parameterPane")||"regular":"dragless":"inputless"},hasInputSlot(){return this.$slots.input!==void 0},inputPanelMargin(){return this.pxToRelativeWidth(un)},minWindowWidth(){return 2*(Le+un)+Xe},minimumLeftPosition(){return this.windowWidth<this.minWindowWidth?this.pxToRelativeWidth(1):this.hasInputSlot?this.pxToRelativeWidth(Le+20)+this.inputPanelMargin:this.pxToRelativeWidth(Le)},maximumRightPosition(){return this.windowWidth<this.minWindowWidth?this.pxToRelativeWidth(1):this.pxToRelativeWidth(Le+20)+this.inputPanelMargin},canMoveLeft(){return this.mainPanelDimensions.relativeLeft>this.minimumLeftPosition},canMoveRight(){return this.mainPanelDimensions.relativeRight>this.maximumRightPosition},mainPanelStyles(){return{left:`${this.relativeWidthToPx(this.mainPanelDimensions.relativeLeft)}px`,right:`${this.relativeWidthToPx(this.mainPanelDimensions.relativeRight)}px`}},inputPanelStyles(){return{right:`${this.relativeWidthToPx(this.calculatedPositions.inputPanelRelativeRight)}px`}},outputPanelStyles(){return{left:`${this.relativeWidthToPx(this.calculatedPositions.outputPanelRelativeLeft)}px`,transform:`translateX(-${this.relativeWidthToPx(this.outputPanelRelativeTranslate)}px)`}},calculatedPositions(){const e=this.$slots.input!==void 0,t=this.mainPanelDimensions.relativeLeft+this.mainPanelDimensions.relativeWidth;return{inputPanelRelativeRight:e?1-t+this.mainPanelDimensions.relativeWidth:1-this.pxToRelativeWidth(Le),outputPanelRelativeLeft:t}},outputPanelRelativeTranslate(){const e=1-this.pxToRelativeWidth(Xe+Le),t=this.calculatedPositions.outputPanelRelativeLeft-e;return t>0?t:0},hasDoubleWidth(){return Se(this,"nodeType.parameterPane")==="wide"},fixedPanelWidth(){const e=this.hasDoubleWidth?2:1;return this.windowWidth>1700?Cl*e:Dl*e},isBelowMinWidthMainPanel(){const e=this.pxToRelativeWidth(Xe);return this.mainPanelDimensions.relativeWidth<e}},watch:{windowWidth(e){const t=this.pxToRelativeWidth(Xe);this.isBelowMinWidthMainPanel&&this.setMainPanelWidth(t);const o=this.minimumLeftPosition>this.mainPanelDimensions.relativeLeft,n=this.maximumRightPosition>this.mainPanelDimensions.relativeRight;e>this.minWindowWidth&&o&&n&&(this.setMainPanelWidth(t),this.setPositions(this.getInitialLeftPosition(this.mainPanelDimensions.relativeWidth))),this.setPositions(this.mainPanelDimensions.relativeLeft)}},methods:{onSwitchSelectedNode(e){this.$emit("switchSelectedNode",e)},getInitialLeftPosition(e){return this.currentNodePaneType==="dragless"?this.pxToRelativeWidth(Le+1+this.fixedPanelWidth):this.hasInputSlot?.5-e/2:this.minimumLeftPosition},setMainPanelWidth(e){const t=e||this.pxToRelativeWidth(El[this.currentNodePaneType]);this.ndvStore.setMainPanelDimensions({panelType:this.currentNodePaneType,dimensions:{relativeWidth:t}})},setPositions(e){const t=e||1-this.calculatedPositions.inputPanelRelativeRight,o=1-t-this.mainPanelDimensions.relativeWidth,n=this.maximumRightPosition>o,s=this.minimumLeftPosition>t,i=this.currentNodePaneType==="inputless";if(s){this.ndvStore.setMainPanelDimensions({panelType:this.currentNodePaneType,dimensions:{relativeLeft:this.minimumLeftPosition,relativeRight:1-this.mainPanelDimensions.relativeWidth-this.minimumLeftPosition}});return}if(n){this.ndvStore.setMainPanelDimensions({panelType:this.currentNodePaneType,dimensions:{relativeLeft:1-this.mainPanelDimensions.relativeWidth-this.maximumRightPosition,relativeRight:this.maximumRightPosition}});return}this.ndvStore.setMainPanelDimensions({panelType:this.currentNodePaneType,dimensions:{relativeLeft:i?this.minimumLeftPosition:t,relativeRight:o}})},setPositionByName(e){const t={minLeft:this.minimumLeftPosition,maxRight:this.maximumRightPosition,initial:this.getInitialLeftPosition(this.mainPanelDimensions.relativeWidth)};this.setPositions(t[e])},pxToRelativeWidth(e){return e/this.windowWidth},relativeWidthToPx(e){return e*this.windowWidth},onResizeStart(){this.setTotalWidth()},onResizeEnd(){this.storePositionData()},onResizeDebounced(e){this.initialized&&this.callDebounced(this.onResize,{debounceTime:10,trailing:!0},e)},onResize({direction:e,x:t,width:o}){const n=this.pxToRelativeWidth(t),s=this.pxToRelativeWidth(o);e==="left"&&n<=this.minimumLeftPosition||e==="right"&&1-n<=this.maximumRightPosition||o<=Xe||(this.setMainPanelWidth(s),this.setPositions(e==="left"?n:this.mainPanelDimensions.relativeLeft))},restorePositionData(){const e=Re(`${$o}_${this.currentNodePaneType}`).value;if(e){const t=parseFloat(e);this.setMainPanelWidth(t);const o=this.getInitialLeftPosition(t);return this.setPositions(o),!0}return!1},storePositionData(){Re(`${$o}_${this.currentNodePaneType}`).value=this.mainPanelDimensions.relativeWidth.toString()},onDragStart(){this.isDragging=!0,this.$emit("dragstart",{position:this.mainPanelDimensions.relativeLeft})},onDrag(e){const t=this.pxToRelativeWidth(e.x)-this.mainPanelDimensions.relativeWidth/2;this.setPositions(t)},onDragEnd(){setTimeout(()=>{this.isDragging=!1,this.$emit("dragend",{windowWidth:this.windowWidth,position:this.mainPanelDimensions.relativeLeft})},0),this.storePositionData()},setTotalWidth(){this.windowWidth=window.innerWidth},close(){this.$emit("close")}}}),Pl="_dataPanel_a6j4o_1",_l="_inputPanel_a6j4o_10 _dataPanel_a6j4o_1",$l="_outputPanel_a6j4o_18 _dataPanel_a6j4o_1",Ol="_mainPanel_a6j4o_26",Rl="_draggable_a6j4o_30",Ml="_mainPanelInner_a6j4o_34",Al="_dragging_a6j4o_41",Wl="_dragButtonContainer_a6j4o_54",Vl="_visible_a6j4o_70",Bl={dataPanel:Pl,inputPanel:_l,outputPanel:$l,mainPanel:Ol,draggable:Rl,mainPanelInner:Ml,dragging:Al,"double-width":"_double-width_a6j4o_50",dragButtonContainer:Wl,visible:Vl};function Ul(e,t,o,n,s,i){const l=D("NDVFloatingNodes"),r=D("PanelDragButton"),a=D("n8n-resize-wrapper");return d(),k("div",null,[e.activeNode?(d(),O(l,{key:0,"root-node":e.activeNode,onSwitchSelectedNode:e.onSwitchSelectedNode},null,8,["root-node","onSwitchSelectedNode"])):E("",!0),e.hideInputAndOutput?E("",!0):(d(),k("div",{key:1,class:T(e.$style.inputPanel),style:ie(e.inputPanelStyles)},[le(e.$slots,"input")],6)),e.hideInputAndOutput?E("",!0):(d(),k("div",{key:2,class:T(e.$style.outputPanel),style:ie(e.outputPanelStyles)},[le(e.$slots,"output")],6)),h("div",{class:T(e.$style.mainPanel),style:ie(e.mainPanelStyles)},[v(a,{"is-resizing-enabled":e.currentNodePaneType!=="unknown",width:e.relativeWidthToPx(e.mainPanelDimensions.relativeWidth),"min-width":e.MIN_PANEL_WIDTH,"grid-size":20,"supported-directions":e.supportedResizeDirections,onResize:e.onResizeDebounced,onResizestart:e.onResizeStart,onResizeend:e.onResizeEnd},{default:b(()=>[h("div",{class:T(e.$style.dragButtonContainer)},[!e.hideInputAndOutput&&e.isDraggable?(d(),O(r,{key:0,class:T({[e.$style.draggable]:!0,[e.$style.visible]:e.isDragging}),"can-move-left":e.canMoveLeft,"can-move-right":e.canMoveRight,onDragstart:e.onDragStart,onDrag:e.onDrag,onDragend:e.onDragEnd},null,8,["class","can-move-left","can-move-right","onDragstart","onDrag","onDragend"])):E("",!0)],2),h("div",{class:T({[e.$style.mainPanelInner]:!0,[e.$style.dragging]:e.isDragging})},[le(e.$slots,"main")],2)]),_:3},8,["is-resizing-enabled","width","min-width","supported-directions","onResize","onResizestart","onResizeend"])],6)])}const Ll={$style:Bl},xl=Z(Il,[["render",Ul],["__cssModules",Ll]]),Hl={allowVulnerableTags:!1,enforceHtmlBoundary:!1,disallowedTagsMode:"discard",allowedTags:[...So.defaults.allowedTags,"style","img","title"],allowedAttributes:{...So.defaults.allowedAttributes,"*":["class","style"]},transformTags:{head:""}},Fl={name:"RunDataHtml",props:{inputHtml:{type:String,required:!0}},computed:{sanitizedHtml(){return ks(this.inputHtml,Hl)}}},zl=["srcdoc"];function ql(e,t,o,n,s,i){return d(),k("iframe",{class:"__html-display",srcdoc:i.sanitizedHtml},null,8,zl)}const _n=Z(Fl,[["render",ql]]),jl=Object.freeze(Object.defineProperty({__proto__:null,default:_n},Symbol.toStringTag,{value:"Module"})),Kl=Q({name:"BinaryDataDisplayEmbed",components:{VueJsonPretty:fa,RunDataHtml:_n},props:{binaryData:{type:Object,required:!0}},data(){return{isLoading:!0,embedSource:"",error:!1,data:""}},computed:{...ve(oe)},async mounted(){const{id:e,data:t,fileName:o,fileType:n,mimeType:s}=this.binaryData,i=n==="json",l=n==="html";if(!e)i||l?this.data=Xt(atob(t)):this.embedSource="data:"+s+";base64,"+t;else try{const r=this.workflowsStore.getBinaryUrl(e,"view",o??"",s);if(i||l){const a=await fetch(r,{credentials:"include"});this.data=await(i?a.json():a.text())}else this.embedSource=r}catch{this.error=!0}this.isLoading=!1},methods:{embedClass(){const{fileType:e}=this.binaryData;return[e??"other"]}}}),Yl={key:0},Gl={key:1},Jl={key:2},Xl={key:0,controls:"",autoplay:""},Ql=["src","type"],Zl={key:1,controls:"",autoplay:""},ed=["src","type"],td=["src"];function od(e,t,o,n,s,i){const l=D("VueJsonPretty"),r=D("RunDataHtml");return d(),k("span",null,[e.isLoading?(d(),k("div",Yl,"Loading binary data...")):e.error?(d(),k("div",Gl,"Error loading binary data")):(d(),k("span",Jl,[e.binaryData.fileType==="video"?(d(),k("video",Xl,[h("source",{src:e.embedSource,type:e.binaryData.mimeType},null,8,Ql),R(" "+N(e.$locale.baseText("binaryDataDisplay.yourBrowserDoesNotSupport")),1)])):e.binaryData.fileType==="audio"?(d(),k("audio",Zl,[h("source",{src:e.embedSource,type:e.binaryData.mimeType},null,8,ed),R(" "+N(e.$locale.baseText("binaryDataDisplay.yourBrowserDoesNotSupport")),1)])):e.binaryData.fileType==="json"?(d(),O(l,{key:2,data:e.data,deep:3,"show-length":!0},null,8,["data"])):e.binaryData.fileType==="html"?(d(),O(r,{key:3,"input-html":e.data},null,8,["input-html"])):(d(),k("embed",{key:4,src:e.embedSource,class:T(["binary-data",e.embedClass()])},null,10,td))]))])}const nd=Z(Kl,[["render",od]]),sd=Q({name:"BinaryDataDisplay",components:{BinaryDataDisplayEmbed:nd},props:["displayData","windowVisible"],setup(){return{nodeHelpers:je()}},computed:{...ve(oe),binaryData(){const e=this.nodeHelpers.getBinaryData(this.workflowRunData,this.displayData.node,this.displayData.runIndex,this.displayData.outputIndex);return e.length===0||this.displayData.index>=e.length||e[this.displayData.index][this.displayData.key]===void 0?null:e[this.displayData.index][this.displayData.key]},workflowRunData(){const e=this.workflowsStore.getWorkflowExecution;if(e===null)return null;const t=e.data;return t?t.resultData.runData:null}},methods:{closeWindow(){return this.$emit("close"),!1}}}),id={class:"binary-data-window-wrapper"},ad={key:0};function rd(e,t,o,n,s,i){var a;const l=D("n8n-button"),r=D("BinaryDataDisplayEmbed");return e.windowVisible?(d(),k("div",{key:0,class:T(["binary-data-window",(a=e.binaryData)==null?void 0:a.fileType])},[v(l,{size:"small",class:"binary-data-window-back",title:e.$locale.baseText("binaryDataDisplay.backToOverviewPage"),icon:"arrow-left",label:e.$locale.baseText("binaryDataDisplay.backToList"),onClick:fe(e.closeWindow,["stop"])},null,8,["title","label","onClick"]),h("div",id,[e.binaryData?(d(),O(r,{key:1,"binary-data":e.binaryData},null,8,["binary-data"])):(d(),k("div",ad,N(e.$locale.baseText("binaryDataDisplay.noDataFoundToDisplay")),1))])],2)):E("",!0)}const ld=Z(sd,[["render",rd]]),dd={class:"node-error-view"},ud={class:"node-error-view__header"},cd={class:"node-error-view__header-message","data-test-id":"node-error-message"},hd=["innerHTML"],pd={class:"node-error-view__info"},fd={class:"node-error-view__info-header"},md={class:"node-error-view__info-title"},gd={class:"copy-button"},yd={class:"node-error-view__info-content"},wd={key:0,class:"node-error-view__details"},vd={class:"node-error-view__details-summary"},Nd={class:"node-error-view__details-content"},kd={key:0,class:"node-error-view__details-row"},bd={class:"node-error-view__details-label"},Td={class:"node-error-view__details-value"},Sd={key:1,class:"node-error-view__details-row"},Dd={class:"node-error-view__details-label"},Cd={class:"node-error-view__details-value"},Ed={key:2,class:"node-error-view__details-row"},Id={class:"node-error-view__details-label"},Pd={class:"node-error-view__details-value"},_d={key:3,class:"node-error-view__details-row"},$d={class:"node-error-view__details-label"},Od={class:"node-error-view__details-value"},Rd={key:4,class:"node-error-view__details-row"},Md={class:"node-error-view__details-label"},Ad={class:"node-error-view__details-value"},Wd={class:"node-error-view__details"},Vd={class:"node-error-view__details-summary"},Bd={class:"node-error-view__details-content"},Ud={key:0,class:"node-error-view__details-row"},Ld={class:"node-error-view__details-label"},xd={class:"node-error-view__details-value"},Hd={key:1,class:"node-error-view__details-row"},Fd={class:"node-error-view__details-label"},zd={class:"node-error-view__details-value"},qd={key:2,class:"node-error-view__details-row"},jd={class:"node-error-view__details-label"},Kd={class:"node-error-view__details-value"},Yd={key:3,class:"node-error-view__details-row"},Gd={class:"node-error-view__details-label"},Jd={class:"node-error-view__details-value"},Xd={key:4,class:"node-error-view__details-row"},Qd={class:"node-error-view__details-label"},Zd={class:"node-error-view__details-value"},eu={class:"node-error-view__details-row"},tu={class:"node-error-view__details-label"},ou={class:"node-error-view__details-value"},nu={key:5,class:"node-error-view__details-row"},su={class:"node-error-view__details-label"},iu={class:"node-error-view__details-value"},au={key:6,class:"node-error-view__details-row"},ru={class:"node-error-view__details-label"},lu={class:"node-error-view__details-value"},du={key:7,class:"node-error-view__details-row"},uu={class:"node-error-view__details-label"},cu={class:"node-error-view__details-value"},hu={key:8,class:"node-error-view__details-row"},pu={class:"node-error-view__details-label"},fu={class:"node-error-view__details-value"},mu=Q({__name:"NodeErrorView",props:{error:{}},setup(e){const t=e,o=oo(),n=qe(),s=We(),i=ue(),l=ae(),r=ro(),a=W(()=>JSON.stringify(t.error.cause??"").length<vn),u=W(()=>{const f=l.activeNode;if(!f)return[];const $=i.getNodeType(f.type,f.typeVersion);return $===null?[]:$.properties}),c=W(()=>{const f=r.urlBaseEditor;let $="Self Hosted";return f.includes("n8n.cloud")&&($="Cloud"),r.versionCli+` (${$})`}),p=W(()=>l.ndvInputData.length>1),g=W(()=>{var A,B;const f=(A=t.error)==null?void 0:A.node;if(!f)return"Node";const $=i.getNodeType(f.type,f.typeVersion);return((B=$==null?void 0:$.defaults)==null?void 0:B.name)||f.name}),m=W(()=>{var A;const f=[];if(!((A=t.error.messages)!=null&&A.length))return[];const $=I();return Array.from(new Set(t.error.messages)).forEach(B=>{const M=/^\d{3} - \{/.test(B)?B.split(" - ").map(z=>z.trim()):[];for(const z of M)try{const G=JSON.parse(z);if(typeof G=="object"){f.push(G);return}}catch{}B!==$&&f.push(B)}),f});function y(f){if(!f||"hidden"in f&&f.hidden)return s.baseText("nodeSettings.deprecated");const $=Math.max(...i.getNodeVersions(f.type));return $===f.typeVersion?s.baseText("nodeSettings.latest"):s.baseText("nodeSettings.latestVersion",{interpolate:{version:$.toString()}})}function S(f){return Ms(f.replace(/`(.*?)`/g,"<code>$1</code>"))}function w(){var A,B;if(t.error.name==="NodeOperationError"&&t.error.functionality==="configuration-node")return S(t.error.description+s.baseText("pushConnection.executionError.openNode",{interpolate:{node:t.error.node.name}}));if((A=t.error.context)!=null&&A.descriptionKey){const Y={nodeCause:t.error.context.nodeCause,runIndex:t.error.context.runIndex??"0",itemIndex:t.error.context.itemIndex??"0"};return S(s.baseText(`nodeErrorView.description.${t.error.context.descriptionKey}`,{interpolate:Y}))}if(!((B=t.error.context)!=null&&B.descriptionTemplate))return S(t.error.description??"");const $=P(t.error.context.parameter);return S(t.error.context.descriptionTemplate.replace(/%%PARAMETER%%/g,$))}function C(f){var B,Y;let $="";return p.value&&!f.includes("[item ")&&((Y=(B=t.error)==null?void 0:B.context)==null?void 0:Y.itemIndex)!==void 0&&($=` [item ${t.error.context.itemIndex}]`),f+$}function I(){var B,Y,M;let f="";const $=t.error.name==="NodeOperationError"&&t.error.functionality==="configuration-node",A=z=>!!z&&typeof z=="string";if($)f=s.baseText("nodeErrorView.errorSubNode",{interpolate:{node:t.error.node.name}});else if(A(t.error.message)&&(t.error.message===t.error.description||!((B=t.error.context)!=null&&B.messageTemplate)))f=t.error.message;else if(A((Y=t.error.context)==null?void 0:Y.messageTemplate)&&A((M=t.error.context)==null?void 0:M.parameter)){const z=P(t.error.context.parameter);f=t.error.context.messageTemplate.replace(/%%PARAMETER%%/g,z)}else Array.isArray(t.error.messages)&&t.error.messages.length>0&&(f=t.error.messages[0]);return C(f)}function P(f,$=!0){try{const A=V(u.value,f.split("."));if(!A.length)throw new Error;return $?A.map(B=>B.displayName).join(" > "):A.pop().displayName}catch{return`Could not find parameter "${f}"`}}function V(f,$){let A=$.shift();if(A===void 0)return[];const B=A.match(/(.*)\[([\d])\]$/);B!==null&&B.length>0&&(A=B[1]);const Y=f.find(M=>M.name===A);if(Y===void 0)throw new Error(`Could not find parameter "${A}"`);return $.length===0?[Y]:Y.hasOwnProperty("options")?[Y,...V(Y.options,$)]:Y.hasOwnProperty("values")?[Y,...V(Y.values,$)]:[Y]}function H(){var Y,M,z,G,ne,re;const f=t.error,$={errorMessage:I()};f.description&&($.errorDescription=f.description);const A={};(Y=f==null?void 0:f.messages)!=null&&Y.length&&(A.rawErrorMessage=f.messages),"httpCode"in f&&f.httpCode&&(A.httpCode=f.httpCode),f.context&&f.context.data&&(A.errorData=f.context.data),f.extra&&(A.errorExtra=f.extra),$.errorDetails=A;const B={};f.node&&(B.nodeName=f.node.name,B.nodeType=f.node.type,B.nodeVersion=f.node.typeVersion,(z=(M=f.node)==null?void 0:M.parameters)!=null&&z.resource&&(B.resource=f.node.parameters.resource),(ne=(G=f==null?void 0:f.node)==null?void 0:G.parameters)!=null&&ne.operation&&(B.operation=f.node.parameters.operation)),f.context&&(f.context.itemIndex!==void 0&&(B.itemIndex=f.context.itemIndex),f.context.runIndex!==void 0&&(B.runIndex=f.context.runIndex),f.context.parameter!==void 0&&(B.parameter=f.context.parameter),f.context.causeDetailed&&(B.causeDetailed=f.context.causeDetailed)),f.timestamp&&(B.time=new Date(f.timestamp).toLocaleString()),B.n8nVersion=c.value,B.binaryDataMode=r.binaryDataMode,f.cause&&(B.cause=f.cause),B.stackTrace=(re=f.stack)==null?void 0:re.split(`
`),$.n8nDetails=B,o.copy(JSON.stringify($,null,2)),x()}function x(){n.showMessage({title:s.baseText("nodeErrorView.showMessage.title"),type:"info"})}return(f,$)=>{var M,z,G,ne,re;const A=D("n8n-icon-button"),B=D("n8n-tooltip"),Y=D("font-awesome-icon");return d(),k("div",dd,[h("div",ud,[h("div",cd,[h("div",null,N(I()),1)]),f.error.description||(M=f.error.context)!=null&&M.descriptionKey?(d(),k("div",{key:0,"data-test-id":"node-error-description",class:"node-error-view__header-description",innerHTML:w()},null,8,hd)):E("",!0)]),h("div",pd,[h("div",fd,[h("p",md,N(j(s).baseText("nodeErrorView.details.title")),1),v(B,{class:"item",content:j(s).baseText("nodeErrorView.copyToClipboard.tooltip"),placement:"left"},{default:b(()=>[h("div",gd,[v(A,{icon:"copy",type:"secondary",size:"mini",text:"true","transparent-background":"transparent",onClick:H})])]),_:1},8,["content"])]),h("div",yd,["httpCode"in f.error&&f.error.httpCode||m.value.length||(G=(z=f.error)==null?void 0:z.context)!=null&&G.data||f.error.extra?(d(),k("details",wd,[h("summary",vd,[v(Y,{class:"node-error-view__details-icon",icon:"angle-right"}),R(" "+N(j(s).baseText("nodeErrorView.details.from",{interpolate:{node:`${g.value}`}})),1)]),h("div",Nd,["httpCode"in f.error&&f.error.httpCode?(d(),k("div",kd,[h("p",bd,N(j(s).baseText("nodeErrorView.errorCode")),1),h("p",Td,[h("code",null,N(f.error.httpCode),1)])])):E("",!0),m.value.length?(d(),k("div",Sd,[h("p",Dd,N(j(s).baseText("nodeErrorView.details.rawMessages")),1),h("div",Cd,[(d(!0),k(se,null,he(m.value,(q,L)=>(d(),k("div",{key:L},[h("pre",null,[h("code",null,N(q),1)])]))),128))])])):E("",!0),(re=(ne=f.error)==null?void 0:ne.context)!=null&&re.data?(d(),k("div",Ed,[h("p",Id,N(j(s).baseText("nodeErrorView.details.errorData")),1),h("div",Pd,[h("pre",null,[h("code",null,N(f.error.context.data),1)])])])):E("",!0),f.error.extra?(d(),k("div",_d,[h("p",$d,N(j(s).baseText("nodeErrorView.details.errorExtra")),1),h("div",Od,[h("pre",null,[h("code",null,N(f.error.extra),1)])])])):E("",!0),f.error.context&&f.error.context.request?(d(),k("div",Rd,[h("p",Md,N(j(s).baseText("nodeErrorView.details.request")),1),h("div",Ad,[h("pre",null,[h("code",null,N(f.error.context.request),1)])])])):E("",!0)])])):E("",!0),h("details",Wd,[h("summary",Vd,[v(Y,{class:"node-error-view__details-icon",icon:"angle-right"}),R(" "+N(j(s).baseText("nodeErrorView.details.info")),1)]),h("div",Bd,[f.error.context&&f.error.context.itemIndex!==void 0?(d(),k("div",Ud,[h("p",Ld,N(j(s).baseText("nodeErrorView.itemIndex")),1),h("p",xd,[h("code",null,N(f.error.context.itemIndex),1)])])):E("",!0),f.error.context&&f.error.context.runIndex!==void 0?(d(),k("div",Hd,[h("p",Fd,N(j(s).baseText("nodeErrorView.runIndex")),1),h("p",zd,[h("code",null,N(f.error.context.runIndex),1)])])):E("",!0),f.error.context&&f.error.context.parameter!==void 0?(d(),k("div",qd,[h("p",jd,N(j(s).baseText("nodeErrorView.inParameter")),1),h("p",Kd,[h("code",null,N(P(`${f.error.context.parameter}`)),1)])])):E("",!0),f.error.node&&f.error.node.type?(d(),k("div",Yd,[h("p",Gd,N(j(s).baseText("nodeErrorView.details.nodeType")),1),h("p",Jd,[h("code",null,N(f.error.node.type),1)])])):E("",!0),f.error.node&&f.error.node.typeVersion?(d(),k("div",Xd,[h("p",Qd,N(j(s).baseText("nodeErrorView.details.nodeVersion")),1),h("p",Zd,[h("code",null,[h("span",null,N(f.error.node.typeVersion+" "),1),h("span",null,"("+N(y(f.error.node))+")",1)])])])):E("",!0),h("div",eu,[h("p",tu,N(j(s).baseText("nodeErrorView.details.n8nVersion")),1),h("p",ou,[h("code",null,N(c.value),1)])]),f.error.timestamp?(d(),k("div",nu,[h("p",su,N(j(s).baseText("nodeErrorView.time")),1),h("p",iu,[h("code",null,N(new Date(f.error.timestamp).toLocaleString()),1)])])):E("",!0),f.error.cause&&a.value?(d(),k("div",au,[h("p",ru,N(j(s).baseText("nodeErrorView.details.errorCause")),1),h("pre",lu,[h("code",null,N(f.error.cause),1)])])):E("",!0),f.error.context&&f.error.context.causeDetailed?(d(),k("div",du,[h("p",uu,N(j(s).baseText("nodeErrorView.details.causeDetailed")),1),h("pre",cu,[h("code",null,N(f.error.context.causeDetailed),1)])])):E("",!0),f.error.stack?(d(),k("div",hu,[h("p",pu,N(j(s).baseText("nodeErrorView.details.stackTrace")),1),h("pre",fu,[h("code",null,N(f.error.stack),1)])])):E("",!0)])])])])])}}}),gu={key:0},yu={key:1},wu={key:2},vu=Q({__name:"RunDataPinButton",props:{tooltipContentsVisibility:{},dataPinningDocsUrl:{},pinnedData:{},disabled:{type:Boolean}},emits:["togglePinData"],setup(e,{emit:t}){const o=We(),n=e,s=t,i=W(()=>n.tooltipContentsVisibility.pinDataDiscoveryTooltipContent?!0:void 0);return(l,r)=>{const a=D("n8n-link"),u=D("n8n-text"),c=D("n8n-icon-button"),p=D("n8n-tooltip");return d(),O(p,{placement:"bottom-end",visible:i.value},{content:b(()=>[n.tooltipContentsVisibility.binaryDataTooltipContent?(d(),k("div",gu,N(j(o).baseText("ndv.pinData.pin.binary")),1)):n.tooltipContentsVisibility.pinDataDiscoveryTooltipContent?(d(),k("div",yu,N(j(o).baseText("node.discovery.pinData.ndv")),1)):(d(),k("div",wu,[h("strong",null,N(j(o).baseText("ndv.pinData.pin.title")),1),v(u,{size:"small",tag:"p"},{default:b(()=>[R(N(j(o).baseText("ndv.pinData.pin.description"))+" ",1),v(a,{to:n.dataPinningDocsUrl,size:"small"},{default:b(()=>[R(N(j(o).baseText("ndv.pinData.pin.link")),1)]),_:1},8,["to"])]),_:1})]))]),default:b(()=>[v(c,{class:T(l.$style.pinDataButton),type:"tertiary",active:n.pinnedData.hasData.value,icon:"thumbtack",disabled:n.disabled,"data-test-id":"ndv-pin-data",onClick:r[0]||(r[0]=g=>s("togglePinData"))},null,8,["class","active","disabled"])]),_:1},8,["visible"])}}}),Nu="_pinDataButton_9zxxl_1",ku={pinDataButton:Nu},bu={$style:ku},Tu=Z(vu,[["__cssModules",bu]]),Su=Ve(async()=>await Ae(()=>import("./RunDataTable-DQx4IB1X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),Du=Ve(async()=>await Ae(()=>import("./RunDataJson-BLrjtyKU.js"),__vite__mapDeps([45,2,3,4,5,6,7,8,36,9,1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,37,38,39,40,41,42,43,46]))),Cu=Ve(async()=>await Ae(()=>import("./RunDataSchema-B-52gDNr.js"),__vite__mapDeps([47,9,6,1,2,3,4,5,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,48]))),Eu=Ve(async()=>await Ae(()=>Promise.resolve().then(()=>jl),void 0)),Iu=Ve(async()=>await Ae(()=>import("./RunDataSearch-ZA9rLECQ.js"),__vite__mapDeps([49,9,6,1,2,3,4,5,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,50]))),Pu=Q({name:"RunData",components:{BinaryDataDisplay:ld,NodeErrorView:mu,JsonEditor:As,RunDataTable:Su,RunDataJson:Du,RunDataSchema:Cu,RunDataHtml:Eu,RunDataSearch:Iu,RunDataPinButton:Tu},props:{node:{type:Object,default:null},workflow:{type:Object,required:!0},runIndex:{type:Number,required:!0},linkedRuns:{type:Boolean},canLinkRuns:{type:Boolean},tooMuchDataTitle:{type:String},noDataInBranchMessage:{type:String},isExecuting:{type:Boolean},executingMessage:{type:String},pushRef:{type:String},paneType:{type:String,required:!0},overrideOutputs:{type:Array},mappingEnabled:{type:Boolean},distanceFromActive:{type:Number,default:0},blockUI:{type:Boolean,default:!1},isProductionExecutionPreview:{type:Boolean,default:!1},isPaneActive:{type:Boolean,default:!1}},setup(e){const t=ae(),o=je(),n=ze(),s=la(e,"node"),i=Ce(s,{runIndex:e.runIndex,displayMode:t.getPanelDisplayMode(e.paneType)});return{...qe(),externalHooks:n,nodeHelpers:o,pinnedData:i}},data(){return{connectionType:U.Main,binaryDataPreviewActive:!1,dataSize:0,showData:!1,outputIndex:0,binaryDataDisplayVisible:!1,binaryDataDisplayData:null,MAX_DISPLAY_DATA_SIZE:vn,MAX_DISPLAY_ITEMS_AUTO_ALL:Ws,currentPage:1,pageSize:10,pageSizes:[10,25,50,100],pinDataDiscoveryTooltipVisible:!1,isControlledPinDataTooltip:!1,search:""}},computed:{...ve(ue,ae,oe,Zt,ro),isReadOnlyRoute(){var e,t;return((t=(e=this.$route)==null?void 0:e.meta)==null?void 0:t.readOnlyCanvas)===!0},activeNode(){return this.ndvStore.activeNode},dataPinningDocsUrl(){return Vs},dataEditingDocsUrl(){return Bs},displayMode(){return this.ndvStore.getPanelDisplayMode(this.paneType)},nodeType(){return this.node?this.nodeTypesStore.getNodeType(this.node.type,this.node.typeVersion):null},isSchemaView(){return this.displayMode==="schema"},isTriggerNode(){return this.node===null?!1:this.nodeTypesStore.isTriggerNode(this.node.type)},canPinData(){return this.node===null?!1:Ce(this.node).canPinNode(!1)&&!this.isPaneTypeInput&&this.pinnedData.isValidNodeType.value&&!(this.binaryData&&this.binaryData.length>0)},buttons(){var o;const e=[{label:this.$locale.baseText("runData.table"),value:"table"},{label:this.$locale.baseText("runData.json"),value:"json"}];this.binaryData.length&&e.push({label:this.$locale.baseText("runData.binary"),value:"binary"});const t={label:this.$locale.baseText("runData.schema"),value:"schema"};return this.isPaneTypeInput?e.unshift(t):e.push(t),this.isPaneTypeOutput&&((o=this.activeNode)==null?void 0:o.type)===Oo&&this.activeNode.parameters.operation==="generateHtmlTemplate"&&e.unshift({label:"HTML",value:"html"}),e},hasNodeRun(){return!!(!this.isExecuting&&this.node&&(this.workflowRunData&&this.workflowRunData.hasOwnProperty(this.node.name)||this.pinnedData.hasData.value))},isArtificialRecoveredEventItem(){var e,t,o;return!!((o=(t=(e=this.rawInputData)==null?void 0:e[0])==null?void 0:t.json)!=null&&o.isArtificialRecoveredEventItem)},subworkflowExecutionError(){var e;return{node:this.node,messages:[((e=this.workflowsStore.subWorkflowExecutionError)==null?void 0:e.message)??""]}},hasSubworkflowExecutionError(){return!!this.workflowsStore.subWorkflowExecutionError},workflowRunErrorAsNodeError(){var e,t,o,n;return this.node?(n=(o=(t=this.workflowRunData)==null?void 0:t[(e=this.node)==null?void 0:e.name])==null?void 0:o[this.runIndex])==null?void 0:n.error:null},hasRunError(){return!!(this.node&&this.workflowRunErrorAsNodeError)},executionHints(){var e,t,o;if(this.hasNodeRun){const n=this.node&&((o=(t=(e=this.workflowRunData)==null?void 0:e[this.node.name])==null?void 0:t[this.runIndex])==null?void 0:o.hints);if(n)return n}return[]},workflowExecution(){return this.workflowsStore.getWorkflowExecution},workflowRunData(){if(this.workflowExecution===null)return null;const e=this.workflowExecution.data;return e!=null&&e.resultData?e.resultData.runData:null},dataCount(){return this.getDataCount(this.runIndex,this.currentOutputIndex)},unfilteredDataCount(){return this.pinnedData.data.value?this.pinnedData.data.value.length:this.rawInputData.length},dataSizeInMB(){return(this.dataSize/1024/1e3).toLocaleString()},maxOutputIndex(){if(this.node===null||this.runIndex===void 0)return 0;const e=this.workflowRunData;if(e===null||!e.hasOwnProperty(this.node.name)||e[this.node.name].length<this.runIndex)return 0;if(e[this.node.name][this.runIndex]){const t=e[this.node.name][this.runIndex].data;if(t!=null&&t.main)return t.main.length-1}return 0},currentPageOffset(){return this.pageSize*(this.currentPage-1)},maxRunIndex(){if(this.node===null)return 0;const e=this.workflowRunData;return e===null||!e.hasOwnProperty(this.node.name)?0:e[this.node.name].length?e[this.node.name].length-1:0},rawInputData(){return this.getRawInputData(this.runIndex,this.currentOutputIndex,this.connectionType)},unfilteredInputData(){return this.getPinDataOrLiveData(this.rawInputData)},inputData(){return this.getFilteredData(this.unfilteredInputData)},inputDataPage(){const e=this.pageSize*(this.currentPage-1);return this.inputData.slice(e,e+this.pageSize)},jsonData(){return Ro(this.inputData)},binaryData(){return this.node?this.nodeHelpers.getBinaryData(this.workflowRunData,this.node.name,this.runIndex,this.currentOutputIndex).filter(t=>!!(t&&Object.keys(t).length)):[]},inputHtml(){var e,t;return String(((t=(e=this.inputData[0])==null?void 0:e.json)==null?void 0:t.html)??"")},currentOutputIndex(){var e;return(e=this.overrideOutputs)!=null&&e.length&&!this.overrideOutputs.includes(this.outputIndex)?this.overrideOutputs[0]:this.outputIndex},branches(){var o;const e=n=>n.charAt(0).toLocaleUpperCase()+n.slice(1),t=[];for(let n=0;n<=this.maxOutputIndex;n++){if(this.overrideOutputs&&!this.overrideOutputs.includes(n))continue;const s=this.getRawInputData(this.runIndex,n).length,i=this.getDataCount(this.runIndex,n),l=this.search?this.$locale.baseText("ndv.search.items",{adjustToNumber:s,interpolate:{matched:i,total:s}}):this.$locale.baseText("ndv.output.items",{adjustToNumber:i,interpolate:{count:i}});let r=this.getOutputName(n);if(`${r}`==`${n}`)r=`${this.$locale.baseText("ndv.output")} ${r}`;else{const a=Us.includes(((o=this.node)==null?void 0:o.type)??"")?"":` ${this.$locale.baseText("ndv.output.branch")}`;r=e(`${this.getOutputName(n)}${a}`)}t.push({label:this.search&&i||s?`${r} (${l})`:r,value:n})}return t},editMode(){return this.isPaneTypeInput?{enabled:!1,value:""}:this.ndvStore.outputPanelEditMode},isPaneTypeInput(){return this.paneType==="input"},isPaneTypeOutput(){return this.paneType==="output"},readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},showIOSearch(){return this.hasNodeRun&&!this.hasRunError&&this.unfilteredInputData.length>0},extraControlsLocation(){return this.hasNodeRun?this.maxRunIndex>0?"runs":this.maxOutputIndex>0&&this.branches.length>1?"outputs":"items":"header"},showIoSearchNoMatchContent(){return this.hasNodeRun&&!this.inputData.length&&!!this.search},parentNodeOutputData(){var o;const e=this.workflow.getParentNodesByDepth(((o=this.node)==null?void 0:o.name)??"")[0];let t=[];return e!=null&&e.name&&(t=this.nodeHelpers.getNodeInputData(this.workflow.getNode(e==null?void 0:e.name),this.runIndex,this.outputIndex,"input",this.connectionType)),t}},watch:{node(e,t){e.id!==t.id&&this.init()},hasNodeRun(){this.paneType==="output"&&this.setDisplayMode()},inputDataPage:{handler(e){this.paneType&&e&&this.ndvStore.setNDVPanelDataIsEmpty({panel:this.paneType,isEmpty:e.every(t=>Ls(t.json))})},immediate:!0,deep:!0},jsonData(e,t){ha(e,t)||(this.refreshDataSize(),this.showPinDataDiscoveryTooltip(e))},binaryData(e,t){e.length&&!t.length&&this.displayMode!=="binary"?this.switchToBinary():!e.length&&this.displayMode==="binary"&&this.onDisplayModeChange("table")},currentOutputIndex(e){this.ndvStore.setNDVBranchIndex({pane:this.paneType,branchIndex:e})},search(e){this.$emit("search",e)}},mounted(){var e,t,o;if(this.init(),this.isPaneTypeInput||this.showPinDataDiscoveryTooltip(this.jsonData),this.ndvStore.setNDVBranchIndex({pane:this.paneType,branchIndex:this.currentOutputIndex}),this.paneType==="output"&&(this.setDisplayMode(),this.activatePane()),this.hasRunError&&this.node){const n=(o=(t=(e=this.workflowRunData)==null?void 0:e[this.node.name])==null?void 0:t[this.runIndex])==null?void 0:o.error;n&&["unknown error"].some(i=>n.message.toLowerCase().includes(i))&&this.$telemetry.track(`User encountered an error: "${n.message}"`,{node:this.node.type,errorMessage:n.message,nodeVersion:this.node.typeVersion,n8nVersion:this.rootStore.versionCli},{withPostHog:!0})}},beforeUnmount(){this.hidePinDataDiscoveryTooltip()},methods:{getResolvedNodeOutputs(){if(this.node&&this.nodeType){const e=this.workflow.getNode(this.node.name);if(e)return Oe(this.workflow,e,this.nodeType)}return[]},shouldHintBeDisplayed(e){const{location:t,whenToDisplay:o}=e;return!(t&&(t==="ndv"&&!["input","output"].includes(this.paneType)||t==="inputPane"&&this.paneType!=="input"||t==="outputPane"&&this.paneType!=="output")||o==="afterExecution"&&!this.hasNodeRun||o==="beforeExecution"&&this.hasNodeRun)},getNodeHints(){var e;if(this.node&&this.nodeType){const t=this.workflow.getNode(this.node.name);if(t){const o=this.executionHints,n=bs(this.workflow,t,this.nodeType,{runExecutionData:((e=this.workflowExecution)==null?void 0:e.data)??null,runIndex:this.runIndex,connectionInputData:this.parentNodeOutputData});return o.concat(n).filter(this.shouldHintBeDisplayed)}}return[]},onItemHover(e){if(e===null){this.$emit("itemHover",null);return}this.$emit("itemHover",{outputIndex:this.currentOutputIndex,itemIndex:e})},onClickDataPinningDocsLink(){var e;this.$telemetry.track("User clicked ndv link",{workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,node_type:(e=this.activeNode)==null?void 0:e.type,pane:"output",type:"data-pinning-docs"})},showPinDataDiscoveryTooltip(e){if(!this.isTriggerNode)return;const t=Re(Ao).value;e&&e.length>0&&!this.isReadOnlyRoute&&!t&&(this.pinDataDiscoveryComplete(),setTimeout(()=>{this.isControlledPinDataTooltip=!0,this.pinDataDiscoveryTooltipVisible=!0,$e.emit("data-pinning-discovery",{isTooltipVisible:!0})},500))},hidePinDataDiscoveryTooltip(){this.pinDataDiscoveryTooltipVisible&&(this.isControlledPinDataTooltip=!1,this.pinDataDiscoveryTooltipVisible=!1,$e.emit("data-pinning-discovery",{isTooltipVisible:!1}))},pinDataDiscoveryComplete(){Re(Ao).value="true",Re(Kt).value="true"},enterEditMode({origin:e}){var s;const t=this.pinnedData.data.value?Mo(this.pinnedData.data.value):Ro(this.rawInputData),n=(Array.isArray(t)?t.length:Object.keys(t??{}).length)>0?t:Hs;this.ndvStore.setOutputPanelEditModeEnabled(!0),this.ndvStore.setOutputPanelEditModeValue(JSON.stringify(n,null,2)),this.$telemetry.track("User opened ndv edit state",{node_type:(s=this.activeNode)==null?void 0:s.type,click_type:e==="editIconButton"?"button":"link",push_ref:this.pushRef,run_index:this.runIndex,is_output_present:this.hasNodeRun||this.pinnedData.hasData.value,view:!this.hasNodeRun&&!this.pinnedData.hasData.value?"undefined":this.displayMode,is_data_pinned:this.pinnedData.hasData.value})},onClickCancelEdit(){this.ndvStore.setOutputPanelEditModeEnabled(!1),this.ndvStore.setOutputPanelEditModeValue(""),this.onExitEditMode({type:"cancel"})},onClickSaveEdit(){if(!this.node)return;const{value:e}=this.editMode;this.clearAllStickyNotifications();try{const t=Mo(e);try{this.pinnedData.setData(t,"save-edit")}catch{return}}catch(t){this.showError(t,this.$locale.baseText("ndv.pinData.error.syntaxError.title"));return}this.ndvStore.setOutputPanelEditModeEnabled(!1),this.onExitEditMode({type:"save"})},onExitEditMode({type:e}){var t;this.$telemetry.track("User closed ndv edit state",{node_type:(t=this.activeNode)==null?void 0:t.type,push_ref:this.pushRef,run_index:this.runIndex,view:this.displayMode,type:e})},async onTogglePinData({source:e}){var t;if(this.node){if(e==="pin-icon-click"){const o={node_type:(t=this.activeNode)==null?void 0:t.type,push_ref:this.pushRef,run_index:this.runIndex,view:!this.hasNodeRun&&!this.pinnedData.hasData.value?"none":this.displayMode};this.externalHooks.run("runData.onTogglePinData",o),this.$telemetry.track("User clicked pin data icon",o)}if(this.nodeHelpers.updateNodeParameterIssues(this.node),this.pinnedData.hasData.value){this.pinnedData.unsetData(e);return}try{this.pinnedData.setData(this.rawInputData,"pin-icon-click")}catch(o){console.error(o);return}this.maxRunIndex>0&&this.showToast({title:this.$locale.baseText("ndv.pinData.pin.multipleRuns.title",{interpolate:{index:`${this.runIndex}`}}),message:this.$locale.baseText("ndv.pinData.pin.multipleRuns.description"),type:"success",duration:2e3}),this.hidePinDataDiscoveryTooltip(),this.pinDataDiscoveryComplete()}},switchToBinary(){this.onDisplayModeChange("binary")},onBranchChange(e){var t;this.outputIndex=e,this.$telemetry.track("User changed ndv branch",{push_ref:this.pushRef,branch_index:e,node_type:(t=this.activeNode)==null?void 0:t.type,node_type_input_selection:this.nodeType?this.nodeType.name:"",pane:this.paneType})},showTooMuchData(){var e;this.showData=!0,this.$telemetry.track("User clicked ndv button",{node_type:(e=this.activeNode)==null?void 0:e.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:this.paneType,type:"showTooMuchData"})},toggleLinkRuns(){this.linkedRuns?this.unlinkRun():this.linkRun()},linkRun(){this.$emit("linkRun")},unlinkRun(){this.$emit("unlinkRun")},onCurrentPageChange(e){var t;this.currentPage=e,this.$telemetry.track("User changed ndv page",{node_type:(t=this.activeNode)==null?void 0:t.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:this.paneType,page_selected:this.currentPage,page_size:this.pageSize,items_total:this.dataCount})},onPageSizeChange(e){var o;this.pageSize=e;const t=Math.ceil(this.dataCount/this.pageSize);t<this.currentPage&&(this.currentPage=t),this.$telemetry.track("User changed ndv page size",{node_type:(o=this.activeNode)==null?void 0:o.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:this.paneType,page_selected:this.currentPage,page_size:this.pageSize,items_total:this.dataCount})},onDisplayModeChange(e){const t=this.displayMode;this.ndvStore.setPanelDisplayMode({pane:this.paneType,mode:e});const o=this.$refs.dataContainer;if(o){const n=o.children[0];n&&n.scrollTo(0,0)}this.closeBinaryDataDisplay(),this.externalHooks.run("runData.displayModeChanged",{newValue:e,oldValue:t}),this.activeNode&&this.$telemetry.track("User changed ndv item view",{previous_view:t,new_view:e,node_type:this.activeNode.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:this.paneType})},getRunLabel(e){let t=0;for(let s=0;s<=this.maxOutputIndex;s++)t+=this.getPinDataOrLiveData(this.getRawInputData(e-1,s)).length;const o=this.$locale.baseText("ndv.output.items",{adjustToNumber:t,interpolate:{count:t}}),n=t>0?` (${o})`:"";return e+this.$locale.baseText("ndv.output.of")+(this.maxRunIndex+1)+n},getRawInputData(e,t,o=U.Main){let n=[];return this.node&&(n=this.nodeHelpers.getNodeInputData(this.node,e,t,this.paneType,o)),n.length===0||!Array.isArray(n)?[]:n},getPinDataOrLiveData(e){return this.pinnedData.data.value&&!this.isProductionExecutionPreview?Array.isArray(this.pinnedData.data.value)?this.pinnedData.data.value.map(t=>({json:t})):[{json:this.pinnedData.data.value}]:e},getFilteredData(e){return this.search?(this.currentPage=1,e.filter(({json:t})=>xs(t,this.search))):e},getDataCount(e,t,o=U.Main){var i,l,r;if(!this.node)return 0;if((r=(l=(i=this.workflowRunData)==null?void 0:i[this.node.name])==null?void 0:l[e])!=null&&r.hasOwnProperty("error"))return 1;const n=this.getRawInputData(e,t,o),s=this.getPinDataOrLiveData(n);return this.getFilteredData(s).length},init(){this.outputIndex=0,this.refreshDataSize(),this.closeBinaryDataDisplay();let e=[];if(this.nodeType!==null&&this.node!==null){const t=this.getResolvedNodeOutputs();e=Ie(t)}this.connectionType=e.length===0?U.Main:e[0],this.binaryData.length>0?this.ndvStore.setPanelDisplayMode({pane:this.paneType,mode:"binary"}):this.displayMode==="binary"&&this.ndvStore.setPanelDisplayMode({pane:this.paneType,mode:"table"})},closeBinaryDataDisplay(){this.binaryDataDisplayVisible=!1,this.binaryDataDisplayData=null},clearExecutionData(){this.workflowsStore.setWorkflowExecutionData(null),this.nodeHelpers.updateNodesExecutionIssues()},isViewable(e,t){const{fileType:o}=this.binaryData[e][t];return!!o&&["image","audio","video","text","json","pdf","html"].includes(o)},isDownloadable(e,t){const{mimeType:o,fileName:n}=this.binaryData[e][t];return!!(o&&n)},async downloadBinaryData(e,t){const{id:o,data:n,fileName:s,fileExtension:i,mimeType:l}=this.binaryData[e][t];if(o){const r=this.workflowsStore.getBinaryUrl(o,"download",s??"",l);Ft.saveAs(r,[s,i].join("."));return}else{const r="data:"+l+";base64,"+n,a=await fetch(r).then(async u=>await u.blob());Ft.saveAs(a,s)}},async downloadJsonData(){var o;const e=(((o=this.node)==null?void 0:o.name)??"").replace(/[^\w\d]/g,"_"),t=new Blob([JSON.stringify(this.rawInputData,null,2)],{type:"application/json"});Ft.saveAs(t,`${e}.json`)},displayBinaryData(e,t){var s;const{data:o,mimeType:n}=this.binaryData[e][t];this.binaryDataDisplayVisible=!0,this.binaryDataDisplayData={node:(s=this.node)==null?void 0:s.name,runIndex:this.runIndex,outputIndex:this.currentOutputIndex,index:e,key:t,data:o,mimeType:n}},getOutputName(e){if(this.node===null)return e+1;const t=this.nodeType,o=this.getResolvedNodeOutputs(),n=o==null?void 0:o[e];return n&&pa(n)?n==null?void 0:n.displayName:!(t!=null&&t.outputNames)||t.outputNames.length<=e?e+1:t.outputNames[e]},refreshDataSize(){this.showData=!1;const e=this.inputDataPage.map(t=>t.json);this.dataSize=JSON.stringify(e).length,this.dataSize<this.MAX_DISPLAY_DATA_SIZE&&(this.showData=!0)},onRunIndexChange(e){this.$emit("runChange",e)},enableNode(){if(this.node){const e={name:this.node.name,properties:{disabled:!this.node.disabled}};this.workflowsStore.updateNodeProperties(e)}},setDisplayMode(){if(!this.activeNode)return;this.activeNode.type===Oo&&this.activeNode.parameters.operation==="generateHtmlTemplate"&&this.ndvStore.setPanelDisplayMode({pane:"output",mode:"html"})},activatePane(){this.$emit("activatePane")},onSearchClear(){this.search="",document.dispatchEvent(new KeyboardEvent("keyup",{key:"/"}))}}}),_u="_infoIcon_12qaq_1",$u="_center_12qaq_5",Ou="_container_12qaq_19",Ru="_pinnedDataCallout_12qaq_28",Mu="_header_12qaq_36",Au="_dataContainer_12qaq_50",Wu="_dataDisplay_12qaq_59",Vu="_outputs_12qaq_71",Bu="_tabs_12qaq_80",Uu="_itemsCount_12qaq_87",Lu="_itemsText_12qaq_95",xu="_muted_12qaq_101",Hu="_inputSelect_12qaq_106",Fu="_runSelector_12qaq_112",zu="_search_12qaq_124",qu="_runSelectorInner_12qaq_128",ju="_pagination_12qaq_132",Ku="_pageSizeSelector_12qaq_142",Yu="_binaryIndex_12qaq_148",Gu="_binaryRow_12qaq_165",Ju="_binaryCell_12qaq_170",Xu="_binaryHeader_12qaq_182",Qu="_binaryButtonContainer_12qaq_191",Zu="_binaryValue_12qaq_202",ec="_displayModes_12qaq_207",tc="_tooltipContain_12qaq_213",oc="_spinner_12qaq_217",nc="_editMode_12qaq_228",sc="_editModeBody_12qaq_237",ic="_editModeFooter_12qaq_244",ac="_editModeFooterInfotip_12qaq_254",rc="_editModeActions_12qaq_260",lc="_stretchVertically_12qaq_267",dc="_uiBlocker_12qaq_271",uc="_hintCallout_12qaq_276",cc={infoIcon:_u,center:$u,container:Ou,pinnedDataCallout:Ru,header:Mu,dataContainer:Au,"actions-group":"_actions-group_12qaq_55",dataDisplay:Wu,outputs:Vu,tabs:Bu,itemsCount:Uu,itemsText:Lu,muted:xu,inputSelect:Hu,runSelector:Fu,search:zu,runSelectorInner:qu,pagination:ju,pageSizeSelector:Ku,binaryIndex:Yu,binaryRow:Gu,binaryCell:Ju,binaryHeader:Xu,binaryButtonContainer:Qu,binaryValue:Zu,displayModes:ec,tooltipContain:tc,spinner:oc,editMode:nc,editModeBody:sc,editModeFooter:ic,editModeFooterInfotip:ac,editModeActions:rc,stretchVertically:lc,uiBlocker:dc,hintCallout:uc},hc={key:0,class:"ml-4xs"},pc={key:0},fc=["innerHTML"],mc=["data-test-id"],gc={key:0},yc={key:1},wc={key:2},vc={key:3},Nc={key:4};function kc(e,t,o,n,s,i){var G,ne,re,q,L;const l=D("n8n-link"),r=D("n8n-callout"),a=D("BinaryDataDisplay"),u=D("n8n-radio-buttons"),c=D("n8n-icon-button"),p=D("RunDataPinButton"),g=D("n8n-button"),m=D("n8n-option"),y=D("n8n-select"),S=D("n8n-tooltip"),w=D("RunDataSearch"),C=D("n8n-text"),I=D("n8n-tabs"),P=D("n8n-spinner"),V=D("JsonEditor"),H=D("n8n-info-tip"),x=D("NodeErrorView"),f=D("i18n-t"),$=D("RunDataTable"),A=D("RunDataJson"),B=D("RunDataHtml"),Y=D("RunDataSchema"),M=D("el-pagination"),z=D("n8n-block-ui");return d(),k("div",{class:T(["run-data",e.$style.container]),onMouseover:t[14]||(t[14]=(...F)=>e.activatePane&&e.activatePane(...F))},[e.canPinData&&e.pinnedData.hasData.value&&!e.editMode.enabled&&!e.isProductionExecutionPreview?(d(),O(r,{key:0,theme:"secondary",icon:"thumbtack",class:T(e.$style.pinnedDataCallout)},{trailingContent:b(()=>[v(l,{to:e.dataPinningDocsUrl,size:"small",theme:"secondary",bold:"",underline:"",onClick:e.onClickDataPinningDocsLink},{default:b(()=>[R(N(e.$locale.baseText("runData.pindata.learnMore")),1)]),_:1},8,["to","onClick"])]),default:b(()=>[R(N(e.$locale.baseText("runData.pindata.thisDataIsPinned"))+" ",1),!e.isReadOnlyRoute&&!e.readOnlyEnv?(d(),k("span",hc,[v(l,{theme:"secondary",size:"small",underline:"",bold:"",onClick:t[0]||(t[0]=fe(F=>e.onTogglePinData({source:"banner-link"}),["stop"]))},{default:b(()=>[R(N(e.$locale.baseText("runData.pindata.unpin")),1)]),_:1})])):E("",!0)]),_:1},8,["class"])):E("",!0),v(a,{"window-visible":e.binaryDataDisplayVisible,"display-data":e.binaryDataDisplayData,onClose:e.closeBinaryDataDisplay},null,8,["window-visible","display-data","onClose"]),h("div",{class:T(e.$style.header)},[le(e.$slots,"header",{},void 0,!0),ee(h("div",{class:T(e.$style.displayModes),"data-test-id":"run-data-pane-header",onClick:t[3]||(t[3]=fe(()=>{},["stop"]))},[ee(v(u,{"model-value":e.displayMode,options:e.buttons,"data-test-id":"ndv-run-data-display-mode","onUpdate:modelValue":e.onDisplayModeChange},null,8,["model-value","options","onUpdate:modelValue"]),[[de,e.hasNodeRun&&(e.inputData.length||e.binaryData.length||e.search)&&!e.editMode.enabled]]),e.canPinData&&!e.isReadOnlyRoute&&!e.readOnlyEnv?ee((d(),O(c,{key:0,title:e.$locale.baseText("runData.editOutput"),circle:!1,disabled:(G=e.node)==null?void 0:G.disabled,class:"ml-2xs",icon:"pencil-alt",type:"tertiary","data-test-id":"ndv-edit-pinned-data",onClick:t[1]||(t[1]=F=>e.enterEditMode({origin:"editIconButton"}))},null,8,["title","disabled"])),[[de,!e.editMode.enabled]]):E("",!0),(e.canPinData||(ne=e.binaryData)!=null&&ne.length)&&e.rawInputData.length&&!e.editMode.enabled?(d(),O(p,{key:1,disabled:!e.rawInputData.length&&!e.pinnedData.hasData.value||e.isReadOnlyRoute||e.readOnlyEnv||!!((re=e.binaryData)!=null&&re.length),"tooltip-contents-visibility":{binaryDataTooltipContent:!!((q=e.binaryData)!=null&&q.length),pinDataDiscoveryTooltipContent:e.isControlledPinDataTooltip&&e.pinDataDiscoveryTooltipVisible},"data-pinning-docs-url":e.dataPinningDocsUrl,"pinned-data":e.pinnedData,onTogglePinData:t[2]||(t[2]=F=>e.onTogglePinData({source:"pin-icon-click"}))},null,8,["disabled","tooltip-contents-visibility","data-pinning-docs-url","pinned-data"])):E("",!0),ee(h("div",{class:T(e.$style.editModeActions)},[v(g,{type:"tertiary",label:e.$locale.baseText("runData.editor.cancel"),onClick:e.onClickCancelEdit},null,8,["label","onClick"]),v(g,{class:"ml-2xs",type:"primary",label:e.$locale.baseText("runData.editor.save"),onClick:e.onClickSaveEdit},null,8,["label","onClick"])],2),[[de,e.editMode.enabled]])],2),[[de,!e.hasRunError]])],2),e.extraControlsLocation==="header"?(d(),k("div",{key:1,class:T(e.$style.inputSelect)},[le(e.$slots,"input-select",{},void 0,!0)],2)):E("",!0),e.maxRunIndex>0?ee((d(),k("div",{key:2,class:T(e.$style.runSelector)},[e.extraControlsLocation==="runs"?le(e.$slots,"input-select",{key:0},void 0,!0):E("",!0),v(y,{"model-value":e.runIndex,class:T(e.$style.runSelectorInner),size:"small",teleported:"","data-test-id":"run-selector","onUpdate:modelValue":e.onRunIndexChange,onClick:t[4]||(t[4]=fe(()=>{},["stop"]))},{prepend:b(()=>[R(N(e.$locale.baseText("ndv.output.run")),1)]),default:b(()=>[(d(!0),k(se,null,he(e.maxRunIndex+1,F=>(d(),O(m,{key:F,label:e.getRunLabel(F),value:F-1},null,8,["label","value"]))),128))]),_:1},8,["model-value","class","onUpdate:modelValue"]),e.canLinkRuns?(d(),O(S,{key:1,placement:"right"},{content:b(()=>[R(N(e.$locale.baseText(e.linkedRuns?"runData.unlinking.hint":"runData.linking.hint")),1)]),default:b(()=>[v(c,{icon:e.linkedRuns?"unlink":"link",class:"linkRun",text:"",type:"tertiary",size:"small","data-test-id":"link-run",onClick:e.toggleLinkRuns},null,8,["icon","onClick"])]),_:1})):E("",!0),le(e.$slots,"run-info",{},void 0,!0),e.showIOSearch&&e.extraControlsLocation==="runs"?(d(),O(w,{key:2,modelValue:e.search,"onUpdate:modelValue":t[5]||(t[5]=F=>e.search=F),class:T(e.$style.search),"pane-type":e.paneType,"is-area-active":e.isPaneActive,onFocus:e.activatePane},null,8,["modelValue","class","pane-type","is-area-active","onFocus"])):E("",!0)],2)),[[de,!e.editMode.enabled]]):E("",!0),le(e.$slots,"before-data",{},void 0,!0),(d(!0),k(se,null,he(e.getNodeHints(),F=>(d(),O(r,{key:F.message,class:T(e.$style.hintCallout),theme:F.type||"info"},{default:b(()=>[v(C,{size:"small",innerHTML:F.message},null,8,["innerHTML"])]),_:2},1032,["class","theme"]))),128)),e.maxOutputIndex>0&&e.branches.length>1?(d(),k("div",{key:3,class:T(e.$style.outputs),"data-test-id":"branches"},[e.extraControlsLocation==="outputs"?le(e.$slots,"input-select",{key:0},void 0,!0):E("",!0),h("div",{class:T(e.$style.tabs)},[v(I,{"model-value":e.currentOutputIndex,options:e.branches,"onUpdate:modelValue":e.onBranchChange},null,8,["model-value","options","onUpdate:modelValue"]),e.showIOSearch&&e.extraControlsLocation==="outputs"?(d(),O(w,{key:0,modelValue:e.search,"onUpdate:modelValue":t[6]||(t[6]=F=>e.search=F),"pane-type":e.paneType,"is-area-active":e.isPaneActive,onFocus:e.activatePane},null,8,["modelValue","pane-type","is-area-active","onFocus"])):E("",!0)],2)],2)):!e.hasRunError&&e.hasNodeRun&&(e.dataCount>0&&e.maxRunIndex===0||e.search)&&!e.isArtificialRecoveredEventItem?ee((d(),k("div",{key:4,class:T([e.$style.itemsCount,{[e.$style.muted]:e.paneType==="input"&&e.maxRunIndex===0}]),"data-test-id":"ndv-items-count"},[e.extraControlsLocation==="items"?le(e.$slots,"input-select",{key:0},void 0,!0):E("",!0),e.search?(d(),O(C,{key:1,class:T(e.$style.itemsText)},{default:b(()=>[R(N(e.$locale.baseText("ndv.search.items",{adjustToNumber:e.unfilteredDataCount,interpolate:{matched:e.dataCount,total:e.unfilteredDataCount}})),1)]),_:1},8,["class"])):(d(),O(C,{key:2,class:T(e.$style.itemsText)},{default:b(()=>[R(N(e.$locale.baseText("ndv.output.items",{adjustToNumber:e.dataCount,interpolate:{count:e.dataCount}})),1)]),_:1},8,["class"])),e.showIOSearch&&e.extraControlsLocation==="items"?(d(),O(w,{key:3,modelValue:e.search,"onUpdate:modelValue":t[7]||(t[7]=F=>e.search=F),class:T(e.$style.search),"pane-type":e.paneType,"is-area-active":e.isPaneActive,onFocus:e.activatePane},null,8,["modelValue","class","pane-type","is-area-active","onFocus"])):E("",!0)],2)),[[de,!e.editMode.enabled&&!e.hasRunError]]):E("",!0),h("div",{ref:"dataContainer",class:T(e.$style.dataContainer),"data-test-id":"ndv-data-container"},[e.isExecuting?(d(),k("div",{key:0,class:T(e.$style.center),"data-test-id":"ndv-executing"},[h("div",{class:T(e.$style.spinner)},[v(P,{type:"ring"})],2),v(C,null,{default:b(()=>[R(N(e.executingMessage),1)]),_:1})],2)):e.editMode.enabled?(d(),k("div",{key:1,class:T(e.$style.editMode)},[h("div",{class:T([e.$style.editModeBody,"ignore-key-press"])},[v(V,{"model-value":e.editMode.value,"fill-parent":!0,"onUpdate:modelValue":t[8]||(t[8]=F=>e.ndvStore.setOutputPanelEditModeValue(F))},null,8,["model-value"])],2),h("div",{class:T(e.$style.editModeFooter)},[v(H,{bold:!1,class:T(e.$style.editModeFooterInfotip)},{default:b(()=>[R(N(e.$locale.baseText("runData.editor.copyDataInfo"))+" ",1),v(l,{to:e.dataEditingDocsUrl,size:"small"},{default:b(()=>[R(N(e.$locale.baseText("generic.learnMore")),1)]),_:1},8,["to"])]),_:1},8,["class"])],2)],2)):e.paneType==="output"&&e.hasSubworkflowExecutionError?(d(),k("div",{key:2,class:T(e.$style.stretchVertically)},[v(x,{error:e.subworkflowExecutionError,class:T(e.$style.errorDisplay)},null,8,["error","class"])],2)):e.hasNodeRun?e.paneType==="input"&&((L=e.node)!=null&&L.disabled)?(d(),k("div",{key:4,class:T(e.$style.center)},[v(C,null,{default:b(()=>[R(N(e.$locale.baseText("ndv.input.disabled",{interpolate:{nodeName:e.node.name}}))+" ",1),v(l,{onClick:e.enableNode},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.disabled.cta")),1)]),_:1},8,["onClick"])]),_:1})],2)):e.hasNodeRun&&e.isArtificialRecoveredEventItem?(d(),k("div",{key:5,class:T(e.$style.center)},[le(e.$slots,"recovered-artificial-output-data",{},void 0,!0)],2)):e.hasNodeRun&&e.hasRunError?(d(),k("div",{key:6,class:T(e.$style.stretchVertically)},[e.isPaneTypeInput?(d(),O(C,{key:0,class:T(e.$style.center),size:"large",tag:"p",bold:""},{default:b(()=>{var F;return[R(N(e.$locale.baseText("nodeErrorView.inputPanel.previousNodeError.title",{interpolate:{nodeName:((F=e.node)==null?void 0:F.name)??""}})),1)]}),_:1},8,["class"])):e.$slots.content?le(e.$slots,"content",{key:1},void 0,!0):e.workflowRunErrorAsNodeError?(d(),O(x,{key:2,error:e.workflowRunErrorAsNodeError,class:T(e.$style.dataDisplay)},null,8,["error","class"])):E("",!0)],2)):e.hasNodeRun&&(!e.unfilteredDataCount||e.search&&!e.dataCount)&&e.branches.length>1?(d(),k("div",{key:7,class:T(e.$style.center)},[e.search?(d(),k("div",pc,[v(C,{tag:"h3",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.search.noMatch.title")),1)]),_:1}),v(C,null,{default:b(()=>[v(f,{keypath:"ndv.search.noMatch.description",tag:"span"},{link:b(()=>[h("a",{href:"#",onClick:t[9]||(t[9]=(...F)=>e.onSearchClear&&e.onSearchClear(...F))},N(e.$locale.baseText("ndv.search.noMatch.description.link")),1)]),_:1})]),_:1})])):(d(),O(C,{key:1},{default:b(()=>[R(N(e.noDataInBranchMessage),1)]),_:1}))],2)):e.hasNodeRun&&!e.inputData.length&&!e.search?(d(),k("div",{key:8,class:T(e.$style.center)},[le(e.$slots,"no-output-data",{},()=>[R("xxx")],!0)],2)):e.hasNodeRun&&!e.showData?(d(),k("div",{key:9,class:T(e.$style.center)},[v(C,{bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.tooMuchDataTitle),1)]),_:1}),v(C,{align:"center",tag:"div"},{default:b(()=>[h("span",{innerHTML:e.$locale.baseText("ndv.output.tooMuchData.message",{interpolate:{size:e.dataSizeInMB}})},null,8,fc)]),_:1}),v(g,{outline:"",label:e.$locale.baseText("ndv.output.tooMuchData.showDataAnyway"),onClick:e.showTooMuchData},null,8,["label","onClick"]),v(g,{size:"small",label:e.$locale.baseText("runData.downloadBinaryData"),onClick:t[10]||(t[10]=F=>e.downloadJsonData())},null,8,["label"])],2)):e.hasNodeRun&&e.$slots.content?le(e.$slots,"content",{key:10},void 0,!0):e.hasNodeRun&&e.displayMode==="table"&&e.binaryData.length>0&&e.inputData.length===1&&Object.keys(e.jsonData[0]||{}).length===0?(d(),k("div",{key:11,class:T(e.$style.center)},[v(C,null,{default:b(()=>[R(N(e.$locale.baseText("runData.switchToBinary.info"))+" ",1),h("a",{onClick:t[11]||(t[11]=(...F)=>e.switchToBinary&&e.switchToBinary(...F))},N(e.$locale.baseText("runData.switchToBinary.binary")),1)]),_:1})],2)):e.showIoSearchNoMatchContent?(d(),k("div",{key:12,class:T(e.$style.center)},[v(C,{tag:"h3",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.search.noMatch.title")),1)]),_:1}),v(C,null,{default:b(()=>[v(f,{keypath:"ndv.search.noMatch.description",tag:"span"},{link:b(()=>[h("a",{href:"#",onClick:t[12]||(t[12]=(...F)=>e.onSearchClear&&e.onSearchClear(...F))},N(e.$locale.baseText("ndv.search.noMatch.description.link")),1)]),_:1})]),_:1})],2)):e.hasNodeRun&&e.displayMode==="table"&&e.node?(d(),O(Ee,{key:13},{default:b(()=>[v($,{node:e.node,"input-data":e.inputDataPage,"mapping-enabled":e.mappingEnabled,"distance-from-active":e.distanceFromActive,"run-index":e.runIndex,"page-offset":e.currentPageOffset,"total-runs":e.maxRunIndex,"has-default-hover-state":e.paneType==="input"&&!e.search,search:e.search,onMounted:t[13]||(t[13]=F=>e.$emit("tableMounted",F)),onActiveRowChanged:e.onItemHover,onDisplayModeChange:e.onDisplayModeChange},null,8,["node","input-data","mapping-enabled","distance-from-active","run-index","page-offset","total-runs","has-default-hover-state","search","onActiveRowChanged","onDisplayModeChange"])]),_:1})):e.hasNodeRun&&e.displayMode==="json"&&e.node?(d(),O(Ee,{key:14},{default:b(()=>[v(A,{"pane-type":e.paneType,"edit-mode":e.editMode,"push-ref":e.pushRef,node:e.node,"input-data":e.inputDataPage,"mapping-enabled":e.mappingEnabled,"distance-from-active":e.distanceFromActive,"run-index":e.runIndex,"total-runs":e.maxRunIndex,search:e.search},null,8,["pane-type","edit-mode","push-ref","node","input-data","mapping-enabled","distance-from-active","run-index","total-runs","search"])]),_:1})):e.hasNodeRun&&e.isPaneTypeOutput&&e.displayMode==="html"?(d(),O(Ee,{key:15},{default:b(()=>[v(B,{"input-html":e.inputHtml},null,8,["input-html"])]),_:1})):e.hasNodeRun&&e.isSchemaView?(d(),O(Ee,{key:16},{default:b(()=>[v(Y,{data:e.jsonData,"mapping-enabled":e.mappingEnabled,"distance-from-active":e.distanceFromActive,node:e.node,"pane-type":e.paneType,"run-index":e.runIndex,"total-runs":e.maxRunIndex,search:e.search},null,8,["data","mapping-enabled","distance-from-active","node","pane-type","run-index","total-runs","search"])]),_:1})):e.displayMode==="binary"&&e.binaryData.length===0?(d(),k("div",{key:17,class:T(e.$style.center)},[v(C,{align:"center",tag:"div"},{default:b(()=>[R(N(e.$locale.baseText("runData.noBinaryDataFound")),1)]),_:1})],2)):e.displayMode==="binary"?(d(),k("div",{key:18,class:T(e.$style.dataDisplay)},[(d(!0),k(se,null,he(e.binaryData,(F,be)=>(d(),k("div",{key:be},[e.binaryData.length>1?(d(),k("div",{key:0,class:T(e.$style.binaryIndex)},[h("div",null,N(be+1),1)],2)):E("",!0),h("div",{class:T(e.$style.binaryRow)},[(d(!0),k(se,null,he(F,(me,Te)=>(d(),k("div",{key:be+"_"+Te,class:T(e.$style.binaryCell)},[h("div",{"data-test-id":"ndv-binary-data_"+be},[h("div",{class:T(e.$style.binaryHeader)},N(Te),3),me.fileName?(d(),k("div",gc,[h("div",null,[v(C,{size:"small",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("runData.fileName"))+": ",1)]),_:1})]),h("div",{class:T(e.$style.binaryValue)},N(me.fileName),3)])):E("",!0),me.directory?(d(),k("div",yc,[h("div",null,[v(C,{size:"small",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("runData.directory"))+": ",1)]),_:1})]),h("div",{class:T(e.$style.binaryValue)},N(me.directory),3)])):E("",!0),me.fileExtension?(d(),k("div",wc,[h("div",null,[v(C,{size:"small",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("runData.fileExtension"))+":",1)]),_:1})]),h("div",{class:T(e.$style.binaryValue)},N(me.fileExtension),3)])):E("",!0),me.mimeType?(d(),k("div",vc,[h("div",null,[v(C,{size:"small",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("runData.mimeType"))+": ",1)]),_:1})]),h("div",{class:T(e.$style.binaryValue)},N(me.mimeType),3)])):E("",!0),me.fileSize?(d(),k("div",Nc,[h("div",null,[v(C,{size:"small",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("runData.fileSize"))+": ",1)]),_:1})]),h("div",{class:T(e.$style.binaryValue)},N(me.fileSize),3)])):E("",!0),h("div",{class:T(e.$style.binaryButtonContainer)},[e.isViewable(be,Te)?(d(),O(g,{key:0,size:"small",label:e.$locale.baseText("runData.showBinaryData"),"data-test-id":"ndv-view-binary-data",onClick:ot=>e.displayBinaryData(be,Te)},null,8,["label","onClick"])):E("",!0),e.isDownloadable(be,Te)?(d(),O(g,{key:1,size:"small",type:"secondary",label:e.$locale.baseText("runData.downloadBinaryData"),"data-test-id":"ndv-download-binary-data",onClick:ot=>e.downloadBinaryData(be,Te)},null,8,["label","onClick"])):E("",!0)],2)],8,mc)],2))),128))],2)]))),128))],2)):E("",!0):(d(),k("div",{key:3,class:T(e.$style.center)},[le(e.$slots,"node-not-run",{},void 0,!0)],2))],2),e.hasNodeRun&&!e.hasRunError&&e.binaryData.length===0&&e.dataCount>e.pageSize&&!e.isSchemaView&&!e.isArtificialRecoveredEventItem?ee((d(),k("div",{key:5,class:T(e.$style.pagination),"data-test-id":"ndv-data-pagination"},[v(M,{background:"","hide-on-single-page":!0,"current-page":e.currentPage,"pager-count":5,"page-size":e.pageSize,layout:"prev, pager, next",total:e.dataCount,"onUpdate:currentPage":e.onCurrentPageChange},null,8,["current-page","page-size","total","onUpdate:currentPage"]),h("div",{class:T(e.$style.pageSizeSelector)},[v(y,{size:"mini","model-value":e.pageSize,teleported:"","onUpdate:modelValue":e.onPageSizeChange},{prepend:b(()=>[R(N(e.$locale.baseText("ndv.output.pageSize")),1)]),default:b(()=>[(d(!0),k(se,null,he(e.pageSizes,F=>(d(),O(m,{key:F,label:F,value:F},null,8,["label","value"]))),128)),v(m,{label:e.$locale.baseText("ndv.output.all"),value:e.dataCount},null,8,["label","value"])]),_:1},8,["model-value","onUpdate:modelValue"])],2)],2)),[[de,!e.editMode.enabled]]):E("",!0),v(z,{show:e.blockUI,class:T(e.$style.uiBlocker)},null,8,["show","class"])],34)}const bc={$style:cc},$n=Z(Pu,[["render",kc],["__cssModules",bc],["__scopeId","data-v-1e75df0c"]]),Tc=Q({props:{taskData:{},hasStaleData:Boolean,hasPinData:Boolean},computed:{theme(){var e;return(e=this.runTaskData)!=null&&e.error?"danger":"success"},runTaskData(){return this.taskData},runMetadata(){if(!this.runTaskData)return null;const{date:e,time:t}=ma(this.runTaskData.startTime);return{executionTime:this.runTaskData.executionTime,startTime:`${e} at ${t}`}}}}),Sc=["innerHTML"],Dc=h("br",null,null,-1),Cc=h("br",null,null,-1);function Ec(e,t,o,n,s,i){const l=D("n8n-info-tip"),r=D("n8n-text");return e.hasStaleData?(d(),O(l,{key:0,theme:"warning",type:"tooltip","tooltip-placement":"right","data-test-id":"node-run-info-stale"},{default:b(()=>[h("span",{innerHTML:e.$locale.baseText(e.hasPinData?"ndv.output.staleDataWarning.pinData":"ndv.output.staleDataWarning.regular")},null,8,Sc)]),_:1})):e.runMetadata?(d(),O(l,{key:1,type:"tooltip",theme:e.theme,"data-test-id":`node-run-info-${e.theme}`,"tooltip-placement":"right"},{default:b(()=>[h("div",null,[v(r,{bold:!0,size:"small"},{default:b(()=>[R(N(e.runTaskData.error?e.$locale.baseText("runData.executionStatus.failed"):e.$locale.baseText("runData.executionStatus.success")),1)]),_:1}),Dc,v(r,{bold:!0,size:"small"},{default:b(()=>[R(N(e.$locale.baseText("runData.startTime")+":"),1)]),_:1}),R(" "+N(e.runMetadata.startTime),1),Cc,v(r,{bold:!0,size:"small"},{default:b(()=>[R(N(e.$locale.baseText("runData.executionTime")+":"),1)]),_:1}),R(" "+N(e.runMetadata.executionTime)+" "+N(e.$locale.baseText("runData.ms")),1)])]),_:1},8,["theme","data-test-id"])):E("",!0)}const Ic=Z(Tc,[["render",Ec]]),qt={REGULAR:"regular",LOGS:"logs"},Pc=Q({name:"OutputPanel",components:{RunData:$n,RunInfo:Ic,RunDataAi:ga},props:{workflow:{type:Object,required:!0},runIndex:{type:Number,required:!0},isReadOnly:{type:Boolean},linkedRuns:{type:Boolean},canLinkRuns:{type:Boolean},pushRef:{type:String},blockUI:{type:Boolean,default:!1},isProductionExecutionPreview:{type:Boolean,default:!1},isPaneActive:{type:Boolean,default:!1}},setup(e){const t=ae(),{activeNode:o}=Qt(t),{isSubNodeType:n}=Fs({node:o});return{pinnedData:Ce(o,{runIndex:e.runIndex,displayMode:t.getPanelDisplayMode("output")}),isSubNodeType:n}},data(){return{outputMode:"regular",outputTypes:[{label:this.$locale.baseText("ndv.output.outType.regular"),value:qt.REGULAR},{label:this.$locale.baseText("ndv.output.outType.logs"),value:qt.LOGS}]}},computed:{...ve(ue,ae,Ne,oe),node(){return this.ndvStore.activeNode??void 0},nodeType(){return this.node?this.nodeTypesStore.getNodeType(this.node.type,this.node.typeVersion):null},isTriggerNode(){return!!this.node&&this.nodeTypesStore.isTriggerNode(this.node.type)},hasAiMetadata(){if(this.node){const e=this.workflowsStore.getWorkflowResultDataByNodeName(this.node.name);return!e||!Array.isArray(e)||e.length===0?!1:!!e[e.length-1].metadata}return!1},isPollingTypeNode(){var e;return!!((e=this.nodeType)!=null&&e.polling)},isScheduleTrigger(){return!!(this.nodeType&&this.nodeType.group.includes("schedule"))},isNodeRunning(){return!!this.node&&this.workflowsStore.isNodeExecuting(this.node.name)},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},workflowExecution(){return this.workflowsStore.getWorkflowExecution},workflowRunData(){var t;if(this.workflowExecution===null)return null;const e=this.workflowExecution.data;return(t=e==null?void 0:e.resultData)!=null&&t.runData?e.resultData.runData:null},hasNodeRun(){return this.workflowsStore.subWorkflowExecutionError?!0:!!(this.node&&this.workflowRunData&&this.workflowRunData.hasOwnProperty(this.node.name))},runTaskData(){if(!this.node||this.workflowExecution===null)return null;const e=this.workflowRunData;return e===null||!e.hasOwnProperty(this.node.name)||e[this.node.name].length<=this.runIndex?null:e[this.node.name][this.runIndex]},runsCount(){if(this.node===null)return 0;const e=this.workflowRunData;return e===null||this.node&&!e.hasOwnProperty(this.node.name)?0:this.node&&e[this.node.name].length?e[this.node.name].length:0},staleData(){if(!this.node)return!1;const e=this.workflowsStore.getParametersLastUpdate(this.node.name);if(!e||!this.runTaskData)return!1;const t=this.runTaskData.startTime;return e>t},outputPanelEditMode(){return this.ndvStore.outputPanelEditMode},canPinData(){return this.pinnedData.isValidNodeType.value&&!this.isReadOnly}},methods:{insertTestData(){var t;const e=this.$refs.runData;e&&(e.enterEditMode({origin:"insertTestDataLink"}),this.$telemetry.track("User clicked ndv link",{workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,node_type:(t=this.node)==null?void 0:t.type,pane:"output",type:"insert-test-data"}))},onLinkRun(){this.$emit("linkRun")},onUnlinkRun(){this.$emit("unlinkRun")},openSettings(){var e;this.$emit("openSettings"),this.$telemetry.track("User clicked ndv link",{node_type:(e=this.node)==null?void 0:e.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:"output",type:"settings"})},onRunIndexChange(e){this.$emit("runChange",e)},onUpdateOutputMode(e){e===qt.LOGS?_t.emit("setPositionByName","minLeft"):_t.emit("setPositionByName","initial")},activatePane(){this.$emit("activatePane")}}}),_c="_outputTypeSelect_f1tu5_6",$c="_titleSection_f1tu5_11",Oc="_title_f1tu5_11",Rc="_noOutputData_f1tu5_27",Mc="_recoveredOutputData_f1tu5_37",Ac={outputTypeSelect:_c,titleSection:$c,title:Oc,noOutputData:Rc,recoveredOutputData:Mc},Wc=h("br",null,null,-1);function Vc(e,t,o,n,s,i){const l=D("n8n-radio-buttons"),r=D("RunInfo"),a=D("n8n-text"),u=D("RunDataAi"),c=D("RunData");return d(),O(c,{ref:"runData",node:e.node,workflow:e.workflow,"run-index":e.runIndex,"linked-runs":e.linkedRuns,"can-link-runs":e.canLinkRuns,"too-much-data-title":e.$locale.baseText("ndv.output.tooMuchData.title"),"no-data-in-branch-message":e.$locale.baseText("ndv.output.noOutputDataInBranch"),"is-executing":e.isNodeRunning,"executing-message":e.$locale.baseText("ndv.output.executing"),"push-ref":e.pushRef,"block-u-i":e.blockUI,"is-production-execution-preview":e.isProductionExecutionPreview,"is-pane-active":e.isPaneActive,"pane-type":"output","data-output-type":e.outputMode,onActivatePane:e.activatePane,onRunChange:e.onRunIndexChange,onLinkRun:e.onLinkRun,onUnlinkRun:e.onUnlinkRun,onTableMounted:t[3]||(t[3]=p=>e.$emit("tableMounted",p)),onItemHover:t[4]||(t[4]=p=>e.$emit("itemHover",p)),onSearch:t[5]||(t[5]=p=>e.$emit("search",p))},co({header:b(()=>[h("div",{class:T(e.$style.titleSection)},[e.hasAiMetadata?(d(),O(l,{key:0,modelValue:e.outputMode,"onUpdate:modelValue":[t[0]||(t[0]=p=>e.outputMode=p),e.onUpdateOutputMode],options:e.outputTypes},null,8,["modelValue","options","onUpdate:modelValue"])):(d(),k("span",{key:1,class:T(e.$style.title)},N(e.$locale.baseText(e.outputPanelEditMode.enabled?"ndv.output.edit":"ndv.output")),3)),e.hasNodeRun&&!e.pinnedData.hasData.value&&e.runsCount===1?ee((d(),O(r,{key:2,"task-data":e.runTaskData,"has-stale-data":e.staleData,"has-pin-data":e.pinnedData.hasData.value},null,8,["task-data","has-stale-data","has-pin-data"])),[[de,!e.outputPanelEditMode.enabled]]):E("",!0)],2)]),"node-not-run":b(()=>[e.workflowRunning&&!e.isTriggerNode?(d(),O(a,{key:0,"data-test-id":"ndv-output-waiting"},{default:b(()=>[R(N(e.$locale.baseText("ndv.output.waitingToRun")),1)]),_:1})):E("",!0),e.workflowRunning?E("",!0):(d(),O(a,{key:1,"data-test-id":"ndv-output-run-node-hint"},{default:b(()=>[e.isSubNodeType?(d(),k(se,{key:0},[R(N(e.$locale.baseText("ndv.output.runNodeHintSubNode")),1)],64)):(d(),k(se,{key:1},[R(N(e.$locale.baseText("ndv.output.runNodeHint"))+" ",1),e.canPinData?(d(),k("span",{key:0,onClick:t[1]||(t[1]=(...p)=>e.insertTestData&&e.insertTestData(...p))},[Wc,R(" "+N(e.$locale.baseText("generic.or"))+" ",1),v(a,{tag:"a",size:"medium",color:"primary"},{default:b(()=>[R(N(e.$locale.baseText("ndv.output.insertTestData")),1)]),_:1})])):E("",!0)],64))]),_:1}))]),"no-output-data":b(()=>[v(a,{bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.output.noOutputData.title")),1)]),_:1}),v(a,null,{default:b(()=>[R(N(e.$locale.baseText("ndv.output.noOutputData.message"))+" ",1),h("a",{onClick:t[2]||(t[2]=(...p)=>e.openSettings&&e.openSettings(...p))},N(e.$locale.baseText("ndv.output.noOutputData.message.settings")),1),R(" "+N(e.$locale.baseText("ndv.output.noOutputData.message.settingsOption")),1)]),_:1})]),"recovered-artificial-output-data":b(()=>[h("div",{class:T(e.$style.recoveredOutputData)},[v(a,{tag:"div",bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("executionDetails.executionFailed.recoveredNodeTitle")),1)]),_:1}),v(a,null,{default:b(()=>[R(N(e.$locale.baseText("executionDetails.executionFailed.recoveredNodeMessage")),1)]),_:1})],2)]),_:2},[e.outputMode==="logs"&&e.node?{name:"content",fn:b(()=>[v(u,{node:e.node,"run-index":e.runIndex},null,8,["node","run-index"])]),key:"0"}:void 0,!e.pinnedData.hasData.value&&e.runsCount>1?{name:"run-info",fn:b(()=>[v(r,{"task-data":e.runTaskData},null,8,["task-data"])]),key:"1"}:void 0]),1032,["node","workflow","run-index","linked-runs","can-link-runs","too-much-data-title","no-data-in-branch-message","is-executing","executing-message","push-ref","block-u-i","is-production-execution-preview","is-pane-active","data-output-type","onActivatePane","onRunChange","onLinkRun","onUnlinkRun"])}const Bc={$style:Ac},Uc=Z(Pc,[["render",Vc],["__cssModules",Bc]]),Lc={key:0},xc=Q({__name:"InputNodeSelect",props:{nodes:{},workflow:{},modelValue:{}},emits:["update:model-value"],setup(e,{emit:t}){const o=e,n=t,s=We(),i=oe(),l=ue(),r=ae(),a=W(()=>i.getNodeByName(o.modelValue??"")),u=W(()=>{const I=a.value;return I?l.getNodeType(I.type,I.typeVersion):null}),c=W(()=>o.nodes.map(I=>{const P=i.getNodeByName(I.name);return P?{node:P,type:l.getNodeType(P.type,P.typeVersion),depth:I.depth}:null}).filter(zs)),p=W(()=>r.activeNode),g=W(()=>{const I=p.value;return I?l.getNodeType(I.type,I.typeVersion):null}),m=W(()=>{const I=g.value;return I!==null&&I.inputs.length>1});function y(I){var x;if(!I||!m.value||!p.value||!((x=g.value)!=null&&x.inputNames))return"";const H=(o.workflow.connectionsByDestinationNode[p.value.name].main||[]).reduce((f,$,A)=>$[0]&&$[0].node===I?[...f,A]:f,[]).map(f=>{var $,A;return(A=($=g.value)==null?void 0:$.inputNames)==null?void 0:A[f]});return H.length===0?"":`(${H.join(" & ")})`}function S(I){const P=I.substring(0,30);return P.length<I.length?`${P}...`:P}function w(I,P){const V=y(I);return V||s.baseText("ndv.input.nodeDistance",{adjustToNumber:P})}function C(I){n("update:model-value",I)}return(I,P)=>{const V=D("n8n-option"),H=D("n8n-select");return d(),O(H,{"model-value":I.modelValue,"no-data-text":j(s).baseText("ndv.input.noNodesFound"),placeholder:j(s).baseText("ndv.input.parentNodes"),class:T(I.$style.select),teleported:"",size:"small",filterable:"","data-test-id":"ndv-input-select","onUpdate:modelValue":C},{prefix:b(()=>{var x;return[v(Fe,{disabled:(x=a.value)==null?void 0:x.disabled,"node-type":u.value,size:14,shrink:!1},null,8,["disabled","node-type"])]}),default:b(()=>[(d(!0),k(se,null,he(c.value,({node:x,type:f,depth:$})=>(d(),O(V,{key:x.name,value:x.name,class:T([I.$style.node,{[I.$style.disabled]:x.disabled}]),label:`${S(x.name)} ${y(x.name)}`,"data-test-id":"ndv-input-option"},{default:b(()=>[v(Fe,{disabled:x.disabled,"node-type":f,size:14,shrink:!1,class:T(I.$style.icon)},null,8,["disabled","node-type","class"]),h("span",{class:T(I.$style.title)},[R(N(S(x.name))+" ",1),x.disabled?(d(),k("span",Lc,"("+N(j(s).baseText("node.disabled"))+")",1)):E("",!0)],2),h("span",{class:T(I.$style.subtitle)},N(w(x.name,$)),3)]),_:2},1032,["value","class","label"]))),128))]),_:1},8,["model-value","no-data-text","placeholder","class"])}}}),Hc="_select_wn2ej_1",Fc="_node_wn2ej_9",zc="_icon_wn2ej_17",qc="_title_wn2ej_21",jc="_disabled_wn2ej_26",Kc="_subtitle_wn2ej_30",Yc={select:Hc,node:Fc,icon:zc,title:qc,disabled:jc,subtitle:Kc},Gc={$style:Yc},Jc=Z(xc,[["__cssModules",Gc]]),Xc={},Qc={width:"112",height:"80",viewBox:"0 0 112 80",fill:"none",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Zc=da('<mask id="mask0_489_46042" style="mask-type:alpha;" maskUnits="userSpaceOnUse" x="0" y="0" width="112" height="80"><rect width="112" height="80" fill="url(#paint0_linear_489_46042)"></rect></mask><g mask="url(#mask0_489_46042)"><rect x="-0.5" width="112" height="80" fill="url(#pattern0)" fill-opacity="0.6"></rect></g><defs><pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1"><use xlink:href="#image0_489_46042" transform="scale(0.00357143 0.005)"></use></pattern><linearGradient id="paint0_linear_489_46042" x1="90.5" y1="40.4494" x2="112.5" y2="40.4494" gradientUnits="userSpaceOnUse"><stop></stop><stop offset="1" stop-color="white" stop-opacity="0"></stop></linearGradient><image id="image0_489_46042" width="280" height="200" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAADICAYAAAAzx/4XAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAABhdSURBVHgB7d0JcFTVngbw/72d4IYa0Ie4IK2llgpodNwtB9AaxVILF7ZxynkgWupojaRwASXQGEBqEAI8LXfBpZQS9IFabjMFkXFfijCKyqjQqIiKShCUpdP3vvPdpXP7pjtk6dPdSX+/qlPpJX07UfrL/yz3XEOIPJNiswaZkbKBtkiluC0qRB1gCJW86ntmjzYM81YvWIhyhgFTwlCxGJGyBcJKhTQxhUrSpJraKSpcVgjDhTQqEyo5U+6prbVExmV6TnWT6ixbnuxmSZ262xCLVTUIUTsxYEoMKpdM4aKCZV5ZUmIMFMoljsGUkMk1c9RArjE39HBchcuYadVVdUKUYwyYEjEhVhstj8gqdbMi8HA8kpTBqmqJC5EGHOQtEeVlMkXSw6WB4UK6cQymBKB6UYMso4OPWYZMrWG4kGasYEpAmWGHB3Xj0ydVzRUizRgwJcAwjaFpD9gyVYjygAHTxTndo9Bium2WLBWiPGDAdHFlkWT4/KK6uVzrQnnCgOniDNuIBu/blr1aiPKEAdPF2Xba1DQeYfVCecOAISJtGDBEpA0Dhoi0YcAQkTYMGCLShgFDRNowYIhIGwYMEWnDgCEibRgwRKQNA4aItGHAEJE2DBgi0oYBQ0TaMGCISBsGDBFpw4AhIm0YMESkDQOGiLRhwBCRNgwYItKGAUNE2jBgiEgbBgwRacOAISJtGDBEpA0Dhoi0YcAQkTYMGCLShgFDRNowYIhIGwYMEWnDgCEibRgwRKQNA4aItGHAEJE2DBgi0oYBQ0TaMGCISBsGDBFpw4AhIm0YMESkDQOGiLRhwBCRNgwYItKGAUNE2jBgiEgbBgwRacOAISJtGDBEpA0Dhoi0YcAQkTYMGCLShgFDRNowYIhIGwYMEWnDgCEibRgwRKQNA4aItGHAEJE2DBgi0oYBQ0TaMGCISBsGDBFpw4AhIm0YMESkDQOGiLRhwBCRNgwYItKGAUNE2hhCXc7ll19eUVZWNto0zYFGJDLIamys8J+LRMrilpWst217WSKRqFu6dGlciDRhwHQho0aNilqWVavC4/I2vGyhCpqpDBrSISLUJYwcOfJWFS6vq5vHS9tURiKRcf3795c1a9a8JUQ5xAqmk0N3qLy8/O/q5iDpIMMwlu7evXuMqmYahCgHOMjbyalwWSE5CBdA18o7HlFOsIvUiY0YMaJWfWnLeEtr9FbdpQrVXXpDiDqIXaROavjw4aPVlwWiiapmBi9ZsqROiDqAXaTOa4popMZjtIUXlQ4GTCfkVS9R0SvqvQ9RuzFgOqe/Sn7k632oi+IYTCfjTUtvkTxJJBI9OG1N7cUKppMpKyurlDzK9/tR18KA6Xzy+oG3LCsqRO3EgOl8KiSPTNOMClE7MWCISJsyIUcsVlvRGJEVhm3Nq5k8fqEUr3wPuHKAl9qNFYwnFqtqMND9MMwF1TW16yfXzLl1Qqw2KkXGtu245Fe9ELUTAybAaPprHbXFmFsekfXV02oX3BX7r6KZSUkmk3WSR42NjQwYajcGTIBl2aubPWjL6EikfJWqalZU3zN7tBSYtyalTvJAVUt1XANDHcExmDTofmRdezhIdZ8GqaCZYog9d3fSWDYzVhWXwnhScrRFQ0sMw3hSiDqAFUyAZUi8Fd9W8O5TIpFYqr7ERa/44sWLFwpRBzBggiJm28YbCtR9QrfFsqwq0WuqEHUQz0UKwFR1MiIdOc8nns/u01VXXTXXNM1bJcdUeM174YUXxglRBzFgQlQ1goDp+GpZQxYmGxPzZsTu0DYL4534iC0uc9lNq1ddo1OEKAfYRQoYpyoYI1djG6r7ZEbKF+CYogm6Smo8ZjA265YcwHFwPCHKkZKrYPCB31cSUTEjlaYtUSNi9rVtqTTcqiUqOWKLzCtLql5XrCov07zDhg2LqYBo9y53akq6asmSJXOFKIe6ZMDEYvdGG6W80jKNioiYJ6vfUs38qDBxA0T7yYJqNqpq+qSqvH9YceG1xsZGBE1bNorihddIm04ZMMEqJILAMFWI2E5wYCwiKoUTV0E2Zlp1VZ0UEIImmUwOUjeHRiKRSnU76j9nlpU1WI2NdapieUuF0UIupCOdijZgUIXslkhFhq5MVPRWIQ3tOb4KlnrVJboiVrjFdxlNmjo7ZphmqutkW9bUaVPGx4QoDwq6ktfvyhimEVV/W/uiKyNuFVKRVC110SbEoJ2zNGywMZ1sSL2dtLdahlFvGtKgwqEe4aCmqqNqqnp9Ww6Y7/EWos5Ca8Bk6cpExa1CoipEdJVQ6Ko0uCFibbAMM94tIvWSkPieQgAho6aqpbUKNd5C1Bl0OGCaDaiaUpHelSlv+mZbcimuWr1t2RvUoGbcNiSOKkQ91pCDSiIuex7LccZbVLjUhR5vT2bm9r8MUZHYY8CgCqmQnRVZujKpKiTVnclTV0b0QlBFsz2ZZbzFCH0N3w4dIo3Riu/Z0+NERScVMM5Je1nWhiRlb21dGcGHWQWHWLJahVVDa7syOjlVkZn5Nw6Nt4S/yQg0LGJECJ+n2nGqdVPtO9XeUW2lagnZw4+R4bYdeE8GDRW9VMCURcoX2PhA5HhA1WvNujLFNtsSZBjetg12+mfYErtq+uTx86QpQFIvkab/ZOgTnqlajWpniBssQY2qrVJtumornMOK9BQ3jE5XrY9q3VXbodo61d5U7TPVtgeO4QcNQ4aKWipgsNmS+qvdnnNaAl2ZtAHVhmIOkZbYKmCM9HCJJ3bvGjtz2sT/FffDv7e4/+3wTegl7lJtt3f/JHHD5VzVjH333Ve6deuGZfjYHU62b99eZts2gmS+ajHVvlZtjGqjVNsnw4+DkxkfVW2OapuF1Qx1IoExmBY3W1LPFV9XRhcracUjpulUMKq8WP3Lr1uGPzx/Gk6CPFu1gaqdrNrB4lYjP6n2iWr/p9pG1W5X7Z9UM4499li59NJL5ZRTTnFC5ssvv5Tly5fL+++/L7t370alMkO1TaqdYqr36969uxx44IG42Bm2xpStW7fK77//fqAKpPHiVkYIpR+897Wl5WBh6FDBNQWMaSJAFhZgQLXYGNbO5AZzn4gkLWv+199+O23xgr/tpR7/V9VuUK1fhtdcLW43BhXOaart07NnT5kzZ44MGTLECQxABTN06FAZM2aM1NfXI817oyFcEEbnn3++DBgwwAmZbdu2yTvvvCNvvPGGbN68WRVU9s3ijt9sFbdqOki1fcUNEoTfL9I0rhOsbogKJhUw06qrcEZuTs7K7exmzpy49a7qe8feWzPxKXErh39TrVq1ngiLCjWv1qNHD+ybggpDGhoasMtcf/X8ieJ9sC+88EI599xzU+ECuH3MMcfIyJEjETCpxw8++GCpqqqSa665RtCl8g0fPlzuuusuWbRoEaoZHOhKcSumY8Ttgh0pbjWD6ul/xJ39+i3wq7CKoYLinrzpUlPNM9xwwQAtQuM/VeuJILjgggucdvTRRzsVyTfffCPLli2T9957D1VHauD3zDPPdLpFYfvtt5+cdtppTpD8+eefzmP9+vWTgQMHpoULoAq69tpr5e2333a6S8r54obLaaHDXqTaNar9TbUnVPtVguGC8SSDBQ3lHwOmueA0MwZdMRN01D777COnnnqq1NTUON2ZIHRr7rzzTidkfAcddJBEIpHmB1cfdARV37595YsvvnAeQ0X0l7/8JeMPc8IJJ8ghhxwin3/+ObZU6KUe6uUfPxqNyo4dO2TdunXGzp07D1UP/4dq34hbiWJ2Cq8x8J4MGSoEbjjVJLhQLhgwGNB1xkVQuYTDBc444ww5++yz5YADDkg9tv/++zthkgnCChUQIITQ3cLxM8FxjjrqKCkvb1oRjdCZMWOGzJs3zxnnufrqq3ENaTyFMZ1LxR2ANv3fif0kKhRWMOnCC+XQMMDrjJ+EuzC+vfbay+n2YEB2zZo1zmP+1HQme++9t1OV+LdRwQTHasJQ7SBg1MyTc//mm2+W66+/3jk+xoHw3GuvvSabNm3CQfp4zRmLsdWkO+sWKhRWMJkFF9JhdsYZL9m4cWPWF5x++ulOpeGHSksBg0BCFwdQoWTrHvmOOOKIVAWDMBoxYkTq2KhcevXq5by3Zz9xK5iI83uoAEL3yKlibNYylF8MmHTh6sWfoXEGWT/99NPUwGwYxkMwJY1qA10m3M80BgPoEmGGqbKy0hkMRmsJxn4wOIxQwXuEAwlhhuDx74obMs7vkFRjMIwVKhR2kVzBpf7BbhICZr1qW5LJZA/MGK1du9ZZOBeGLs5ll13mTEPj9mGHHeaPizSDQBg8eLAzZoNqpn///tISjPvMmjVLNmzYIIMGDWr2PN4Hx/Eg1RAyTsBgkDdVubCzRHnGgMkcLH4Fg9vbxK1iBm7evNlZhZspYODII4902h7fUH3QES4ImdbA2M+wYcOcGSNUMpkEwsw/uT01yEtUKKXeRco0c4SG2ZgrVLtRtb+KNxGDBXXvvvsuVtZKvmEMBqGUrdsVkgpIO5k0/HMK2FWifCvlCiZT5YJp6RGqjVXtEO++3+Vwzg/CepS6ujpnlW2RMkKNqGBYwTRVLvuLe8byveIurouKGzKYkUktcME09EsvveSvrC16lhAVTqlWMMHqxe9O3CbuuT7OdMzxxx/vnAmNLsknn3wiK1eudNah7Nq1ywmZVatWZRxwLQScsrBz507/LjIFJz2ygqGCK+Uukj8Iiq/YcW6keOFyww03yN133+2sUcHgKaqV5557TqZOnepMU3/77bfO1gvFEjDougWmzxEuu4WoCJRiwGSaLbpANWdxyVlnnSUPPfRQ2gswuDp27Fhn1ezEiROdr63xww8/yPr16+Wcc85ptugOA8aYkcIpAlg3Ex68xZQ0zrg++eSTpU+fPi0O7qKCCXTZEC47hKgIlOoYTDBk8MnFMlhnqewll1yS8QVYeYvl+Y8++qjMnDnTmTZuCVb94gzp8847T6qrq9OeQxg888wzcvHFF8tNN90kL7/8ctrzv/zyi0yYMEGuvPJKufHGG+Wrr75q8b3QbcNrPOgrdY4BIurySrmCQbj660XKvcdSS/gzwXPXXXedtAbGabBXjG3bznYLQVjP8v333zu3f/vtN6fLFYSw2LJli1Mpff3119hms8X3QsD8+uuv/l30lRAwzsw0l2pTIZXav7/wJUX8CuYP8SZc8IHvTBBgCKA//vjDuStuBfO7EBWBUvwDF5xd8cdgUttNrlu3TjqTRCIh8Xg8dVfczaawCTnX1VHBlXIFHewqob/iBAy6NnYnOusYAYOBZA+ql58leOUBNQvGVXdUKFxo58In1Pmrj5W6GP/o8IEDs0aYRtYFa3NwlrcH/SR/TwlWMFRwpV7B+PChxEhrI3bzf/7556WjsGudHzLZtnjoKExPYzr7448/9h/CANL/S9OpR9gvk0FDBVPKARP84KHEeEu89SNPPPFEh09oxJYNfsDoqmAwsPvqq6/6U9T42dHVQ1Cmn9+In4NbNVABlGLAhK/57DcsRomrlvzoo4/kvvvuS21RWawwIP3444/7dzG4i8vMImgwI8YTqKngSi1ggpdd9ZvlNVwxEbvxO4tO8MFdunRpq1ft5hsGonH6gjfrhSTEJWhxWYNguLCLRAVV6l0kS9JD5lVxr87oLFybPXu2rFixQnINXSd/gygERXtCDCdfPvvss/5d9JH+W7Ufpel3SS20S80gsZtEeVaqXaRgwwCJ5X3FwMsDqq3CN+JcICzz/+CDDySXcF6Rv8UlBmrb2hVbvXq1cyVIbxNyTK9jqTACxgo1VjBUUKVawQS7R37I+A19DlwhcR0++NiWAdce+uyzzySXgicvtqWCQWU1efJk5+cS9+fHz/uCuDNIflimmmFGbFYuVCilXMH4H0L/Q9no3cbXD1Wbr9pm7LPyyiuvSG1tbcFX+SKIHnzwQXn99df9hzCw+4i4ewYHQ5KDvFQUSn0Mxg+a4IcTAYM+CwZfZqm2BetYsDYGlcN3333XqoMfeuihqbUwuMJAEK4qgEuXADb0Dp9giX1ounfv7rwWx8HF2QAXV3vssceCXaoHxb3o/W7v5/ZD0g9PB8dfqFBatYN0F5TppMdwQ/g0iLv0/sxEIlGOcEFFc+KJJ2a91KsPwYFrUGNnPGy5cPjhh6eewxoZvB7PY9OqK664wgkVHwIFe9DgciWjRo2Sk046yTkDe/z48c64kKdO3IDBVQ8QLAlJr8KcKmbg4Iv+WQXVoFTA2PZbK+verBOiPCjVHe0QHn6I+GMwqOYS3vP+SZAIl9dU66Vme67fsmVL+YIFC+Tnn3+W6dOnOxdZywZVysiRI51qI3ypEYy/IHjuuOOO8DWNUq+96KKLnMua4Htx//777xesz/HOk8Ks0Qxxt2VISnq4sItERaPUr4sUnk0KngDp38bWB4vFvUb1v2/durUcm36j4sBMznHHHZf14AiOcHgEZbvWNaDK8a9XjbGXxYsXC05j8Dyh2iZp6hZlC5emlbxEBVDKAROsYvzxiuAVHYMnIP+k2jOq7VIVxLXbt2/f++mnn3bOMbrttttkwIABohO23sSWDN5sE6qVl6SpagmHS7ARFVSpn02daU1MIktDyDyl2gMqZLbhPKCnnnpKbr/9dmeLh/ZAcNxyyy3Su3dv6devnzz88MPBKiUF2zFg1zoPRpl/C/1smWaQRNhFogLjpWObPoTBv/jB7pIEvqK7hDUn+LTfotoBb775pnOdJAziBi5Av0c//vijzJ8/Xx544AHn/k8//SRTpkxxFt5hn97gda2xQXjghMmNkh4o4XDh+AsVDW7Zmnm62p+V8S8BEqwWMLD6d9UeVu1nDLouX77cuYxJa2FbTgQTAsZ7b6e7g5BZtGiRfPjhh2lnYKN6CWyCtUOyj70EqxeigmPAuIJdinDQBMPGb9jg5RPVPseLsGQfVUZrYYOoWbNmOVPP4p5cWe8dy8a1r1ER4Zh+qIQueWJK5vEWW9g1oiLDLlKTTFPXRuh5/3vQsO2ds7k2LkPiX4wNMLUcvg4SwgLbW2ItDS7g5p16gLDCiU4LVTtBtR5qILcPVuuiizRkyBBnvQwqG7zWg+s3ZQsXdo2oqDBg0vkBgg+tXymINL9YW3DTcKfL88gjj8iLL77oBAMWygXHUABjK9iKEwHj7aGLY8dVW6baN+IO3PZW7SpVDVXgTO4lS5Y44zp4XWBXvL7e+zJYqOgxYJoLhox4t4NB4y/CA2clNFb34vrVbYBuF1IG+898JE1ncmO7CKzK+xd1zB5r167N1IXtJu51nFi9UNFjwGQWDhlfsILBtDVOisSJRPuGno9I8038cUzMPmHnf8wEYd+ZleKGjR8MOJtyobhbX1aqdqB3LASQf0lY7PD9hzBYqBNgwGQXDBm/e+QP/vrXUkIFgg98T0m/UmQ3aQqi4DQ4ggELXbBvrn/1xeDMD74f4YNFfW94x8WxEt7rMO6zSTKfDsCQoaLDgGlZeLVveJUvQgZBgS5LRJoCxsxwnEzbRPiDyb5gFwxVzEbJvAgwKaxgqBNgwLROOBwQMqb31YcP/Z4CxsrS/IDwqx5T0isgW9L3rOGCOuoUGDB7FuyCBM9bagw8jsf8cMk2/tJSwPiCYzzB2apM+9bwrGkqegyY1guGCzQGHiuTpqom05VagwETDppgQISnws0Mr/cXAPK8Iyp6DJjWC6/2Dd72181ASwETrmQyVR/h7SLCxwhu88kxGCpqDJjWCa/ytaR5WIR3xAu/Pjzj01LA7Cmk2DWiToEB03Z+mJiB28GAEckcMMHbVuhxO/S6TCHlf1+msGLQUFFiwLSeX8X4ty1pHiit2TouU7cmU8BI6Lad5StR0WLAtE0wCMKDs209RkvPtTY8GDJU1Bgw7WNnuW+04TVEXR4DJrcYIkQB3HCKiLRhwBCRNgwYItKGAUNE2jBgiEgbBgwRacOAISJtGDBdnGFI2gWbjIjZV4jyhAHTxdmGHU9/QKJClCcMmC6uLBmpDz1UOS5W2/qLaBN1AAOmi4vFquLiXuDNV7GfaY0WojxgwJQA27KeDN43DXOoEOUBA6YElNnmwtBDg6rvmT1OiDRjwJQAdJNssdOqGDHMKRNitVEh0ogBUyLKkkZMfQlOWVeUR2QFQ4Z0YsCUCGew15CpoYejCJlJNbWDhEiDtmz1SF2ACpOY+p8+pdkThixMNMrUme6sE1FOMGBK0KSaOXMNMW7N8vRSNe20LGkl62fE7qgXog5gwJSorJUMUQ4xYEoYxl7UP4AF6mZUiDRgwJBU31M7Wv1LQDUTFaIcYsBQSmx6bWVjo3W5mOZAww2bqBB1wD8AobUpv0xPqN8AAAAASUVORK5CYII="></image></defs>',3),eh=[Zc];function th(e,t){return d(),k("svg",Qc,eh)}const oh=Z(Xc,[["render",th]]),nh=Q({name:"InputPanel",components:{RunData:$n,NodeExecuteButton:po,WireMeUp:oh,InputNodeSelect:Jc},props:{currentNodeName:{type:String},runIndex:{type:Number,required:!0},linkedRuns:{type:Boolean},workflow:{type:Object,required:!0},canLinkRuns:{type:Boolean},pushRef:{type:String},readOnly:{type:Boolean},isProductionExecutionPreview:{type:Boolean,default:!1},isPaneActive:{type:Boolean,default:!1}},emits:["itemHover","tableMounted","linkRun","unlinkRun","runChange","search","changeInputNode","execute","activatePane"],data(){return{showDraggableHintWithDelay:!1,draggableHintShown:!1,inputMode:"debugging",mappedNode:null,inputModes:[{value:"mapping",label:this.$locale.baseText("ndv.input.mapping")},{value:"debugging",label:this.$locale.baseText("ndv.input.debugging")}]}},computed:{...ve(ue,ae,oe,Ne),focusedMappableInput(){return this.ndvStore.focusedMappableInput},isUserOnboarded(){return this.ndvStore.isMappingOnboarded},isMappingMode(){return this.isActiveNodeConfig&&this.inputMode==="mapping"},showDraggableHint(){const e=[lo,so,qs,js];return!this.currentNode||e.includes(this.currentNode.type)?!1:!!this.focusedMappableInput&&!this.isUserOnboarded},isActiveNodeConfig(){var o,n;let e=((o=this.activeNodeType)==null?void 0:o.inputs)??[],t=((n=this.activeNodeType)==null?void 0:n.outputs)??[];if(this.activeNode!==null&&this.workflow!==null){const s=this.workflow.getNode(this.activeNode.name);e=De(this.workflow,s,this.activeNodeType),t=Oe(this.workflow,s,this.activeNodeType)}else Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]);return!!(e.length===0||e.every(s=>this.filterOutConnectionType(s,U.Main))&&t.find(s=>this.filterOutConnectionType(s,U.Main)))},isMappingEnabled(){return this.readOnly?!1:this.isActiveNodeConfig?this.isMappingMode&&this.mappedNode!==null:!0},isExecutingPrevious(){if(!this.workflowRunning)return!1;const e=this.workflowsStore.executedNode,t=this.workflowsStore.executingNode;return this.activeNode&&e===this.activeNode.name&&!this.workflowsStore.isNodeExecuting(this.activeNode.name)?!0:t.length||e?!!this.parentNodes.find(o=>this.workflowsStore.isNodeExecuting(o.name)||o.name===e):!1},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},activeNode(){return this.ndvStore.activeNode},rootNode(){var o;return this.workflow.getChildNodes(((o=this.activeNode)==null?void 0:o.name)??"","ALL_NON_MAIN")[0]},rootNodesParents(){return[...this.workflow.getParentNodes(this.rootNode,"main")].reverse().map(o=>({name:o,depth:1,indicies:[]}))},currentNode(){return this.isActiveNodeConfig?this.mappedNode?this.workflowsStore.getNodeByName(this.mappedNode):this.activeNode:this.workflowsStore.getNodeByName(this.currentNodeName??"")},connectedCurrentNodeOutputs(){const e=this.parentNodes.find(({name:t})=>t===this.currentNodeName);if(e)return e.indicies},parentNodes(){if(!this.activeNode)return[];const e=this.workflow.getParentNodesByDepth(this.activeNode.name);return e.filter(({name:t},o)=>this.activeNode&&t!==this.activeNode.name&&e.findIndex(n=>n.name===t)===o)},currentNodeDepth(){const e=this.parentNodes.find(t=>this.currentNode&&t.name===this.currentNode.name);return e?e.depth:-1},activeNodeType(){return this.activeNode?this.nodeTypesStore.getNodeType(this.activeNode.type,this.activeNode.typeVersion):null},isMultiInputNode(){return this.activeNodeType!==null&&this.activeNodeType.inputs.length>1}},watch:{inputMode:{handler(e){var t;this.onRunIndexChange(-1),e==="mapping"?(this.onUnlinkRun(),this.mappedNode=((t=this.rootNodesParents[0])==null?void 0:t.name)??null):this.mappedNode=null},immediate:!0},showDraggableHint(e,t){e&&!t?setTimeout(()=>{this.draggableHintShown||(this.showDraggableHintWithDelay=this.showDraggableHint,this.showDraggableHintWithDelay&&(this.draggableHintShown=!0,this.$telemetry.track("User viewed data mapping tooltip",{type:"unexecuted input pane"})))},1e3):e||(this.showDraggableHintWithDelay=!1)}},methods:{filterOutConnectionType(e,t){return e?typeof e=="string"?e!==t:e.type!==t:!1},onInputModeChange(e){this.inputMode=e},onMappedNodeSelected(e){this.mappedNode=e,this.onRunIndexChange(0),this.onUnlinkRun()},onNodeExecute(){this.$emit("execute"),this.activeNode&&this.$telemetry.track("User clicked ndv button",{node_type:this.activeNode.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:"input",type:"executePrevious"})},onRunIndexChange(e){this.$emit("runChange",e)},onLinkRun(){this.$emit("linkRun")},onUnlinkRun(){this.$emit("unlinkRun")},onInputNodeChange(e){const t=this.parentNodes.findIndex(o=>o.name===e)+1;this.$emit("changeInputNode",e,t)},onConnectionHelpClick(){this.activeNode&&this.$telemetry.track("User clicked ndv link",{node_type:this.activeNode.type,workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:"input",type:"not-connected-help"})},activatePane(){this.$emit("activatePane")}}}),sh="_mappedNode_17wvq_1",ih="_titleSection_17wvq_5",ah="_inputModeTab_17wvq_14",rh="_noOutputData_17wvq_18",lh="_recoveredOutputData_17wvq_28",dh="_notConnected_17wvq_37",uh="_title_17wvq_5",ch={mappedNode:sh,titleSection:ih,inputModeTab:ah,noOutputData:rh,recoveredOutputData:lh,notConnected:dh,title:uh},hh=["innerHTML"];function ph(e,t,o,n,s,i){const l=D("n8n-radio-buttons"),r=D("InputNodeSelect"),a=D("n8n-text"),u=D("NodeExecuteButton"),c=D("n8n-tooltip"),p=D("WireMeUp"),g=D("RunData");return d(),O(g,{node:e.currentNode,workflow:e.workflow,"run-index":e.runIndex,"linked-runs":e.linkedRuns,"can-link-runs":!e.mappedNode&&e.canLinkRuns,"too-much-data-title":e.$locale.baseText("ndv.input.tooMuchData.title"),"no-data-in-branch-message":e.$locale.baseText("ndv.input.noOutputDataInBranch"),"is-executing":e.isExecutingPrevious,"executing-message":e.$locale.baseText("ndv.input.executingPrevious"),"push-ref":e.pushRef,"override-outputs":e.connectedCurrentNodeOutputs,"mapping-enabled":e.isMappingEnabled,"distance-from-active":e.currentNodeDepth,"is-production-execution-preview":e.isProductionExecutionPreview,"is-pane-active":e.isPaneActive,"pane-type":"input","data-test-id":"ndv-input-panel",onActivatePane:e.activatePane,onItemHover:t[1]||(t[1]=m=>e.$emit("itemHover",m)),onLinkRun:e.onLinkRun,onUnlinkRun:e.onUnlinkRun,onRunChange:e.onRunIndexChange,onTableMounted:t[2]||(t[2]=m=>e.$emit("tableMounted",m)),onSearch:t[3]||(t[3]=m=>e.$emit("search",m))},co({header:b(()=>[h("div",{class:T(e.$style.titleSection)},[h("span",{class:T(e.$style.title)},N(e.$locale.baseText("ndv.input")),3),e.isActiveNodeConfig&&!e.readOnly?(d(),O(l,{key:0,options:e.inputModes,"model-value":e.inputMode,"onUpdate:modelValue":e.onInputModeChange},null,8,["options","model-value","onUpdate:modelValue"])):E("",!0)],2)]),"input-select":b(()=>[e.parentNodes.length&&e.currentNodeName?(d(),O(r,{key:0,"model-value":e.currentNodeName,workflow:e.workflow,nodes:e.parentNodes,"onUpdate:modelValue":e.onInputNodeChange},null,8,["model-value","workflow","nodes","onUpdate:modelValue"])):E("",!0)]),"node-not-run":b(()=>[e.isActiveNodeConfig&&e.rootNode||e.parentNodes.length?(d(),k("div",{key:0,class:T(e.$style.noOutputData)},[v(a,{tag:"div",bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.noOutputData.title")),1)]),_:1}),e.readOnly?E("",!0):(d(),O(c,{key:0,visible:e.showDraggableHint&&e.showDraggableHintWithDelay},{content:b(()=>[h("div",{innerHTML:e.$locale.baseText("dataMapping.dragFromPreviousHint",{interpolate:{name:e.focusedMappableInput}})},null,8,hh)]),default:b(()=>[v(u,{type:"secondary","hide-icon":"",transparent:!0,"node-name":e.isActiveNodeConfig?e.rootNode:e.currentNodeName??"",label:e.$locale.baseText("ndv.input.noOutputData.executePrevious"),"telemetry-source":"inputs","data-test-id":"execute-previous-node",onExecute:e.onNodeExecute},null,8,["node-name","label","onExecute"])]),_:1},8,["visible"])),e.readOnly?E("",!0):(d(),O(a,{key:1,tag:"div",size:"small"},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.noOutputData.hint")),1)]),_:1}))],2)):(d(),k("div",{key:1,class:T(e.$style.notConnected)},[h("div",null,[v(p)]),v(a,{tag:"div",bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.notConnected.title")),1)]),_:1}),v(a,{tag:"div"},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.notConnected.message"))+" ",1),h("a",{href:"https://docs.n8n.io/workflows/connections/",target:"_blank",onClick:t[0]||(t[0]=(...m)=>e.onConnectionHelpClick&&e.onConnectionHelpClick(...m))},N(e.$locale.baseText("ndv.input.notConnected.learnMore")),1)]),_:1})],2))]),"no-output-data":b(()=>[v(a,{tag:"div",bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("ndv.input.noOutputData")),1)]),_:1})]),"recovered-artificial-output-data":b(()=>[h("div",{class:T(e.$style.recoveredOutputData)},[v(a,{tag:"div",bold:!0,color:"text-dark",size:"large"},{default:b(()=>[R(N(e.$locale.baseText("executionDetails.executionFailed.recoveredNodeTitle")),1)]),_:1}),v(a,null,{default:b(()=>[R(N(e.$locale.baseText("executionDetails.executionFailed.recoveredNodeMessage")),1)]),_:1})],2)]),_:2},[e.isMappingMode?{name:"before-data",fn:b(()=>[(d(),O(In("style"),null,{default:b(()=>[R("button.linkRun { display: none }")]),_:1})),h("div",{class:T(e.$style.mappedNode)},[v(r,{"model-value":e.mappedNode,workflow:e.workflow,nodes:e.rootNodesParents,"onUpdate:modelValue":e.onMappedNodeSelected},null,8,["model-value","workflow","nodes","onUpdate:modelValue"])],2)]),key:"0"}:void 0]),1032,["node","workflow","run-index","linked-runs","can-link-runs","too-much-data-title","no-data-in-branch-message","is-executing","executing-message","push-ref","override-outputs","mapping-enabled","distance-from-active","is-production-execution-preview","is-pane-active","onActivatePane","onLinkRun","onUnlinkRun","onRunChange"])}const fh={$style:ch},mh=Z(nh,[["render",ph],["__cssModules",fh]]),gh=Q({name:"TriggerPanel",components:{NodeExecuteButton:po,CopyInput:Ks,NodeIcon:Fe},props:{nodeName:{type:String,required:!0},pushRef:{type:String,default:""}},emits:{activate:null,execute:null},setup(){const e=ct();return{workflowHelpers:$t({router:e})}},data:()=>({executionsHelpEventBus:Jt()}),computed:{...ve(ue,ae,Ne,oe),node(){return this.workflowsStore.getNodeByName(this.nodeName)},nodeType(){return this.node?this.nodeTypesStore.getNodeType(this.node.type,this.node.typeVersion):null},triggerPanel(){var t;const e=(t=this.nodeType)==null?void 0:t.triggerPanel;if(Ys(e))return e},hideContent(){var t;const e=(t=this.triggerPanel)==null?void 0:t.hideContent;if(typeof e=="boolean")return e;if(this.node){const o=this.workflowHelpers.getCurrentWorkflow().expression.getSimpleParameterValue(this.node,e,"internal",{});if(typeof o=="boolean")return o}return!1},hasIssues(){var e;return!!((e=this.node)!=null&&e.issues&&(this.node.issues.parameters??this.node.issues.credentials))},serviceName(){return this.nodeType?Et(this.nodeType):""},displayChatButton(){return!!(this.node&&this.node.type===He&&this.node.parameters.mode!=="webhook")},isWebhookNode(){return!!(this.node&&this.node.type===io)},webhookHttpMethod(){var t,o;if(!this.node||!((o=(t=this.nodeType)==null?void 0:t.webhooks)!=null&&o.length))return;const e=this.workflowHelpers.getWebhookExpressionValue(this.nodeType.webhooks[0],"httpMethod",!1);return Array.isArray(e)?e.join(", "):e},webhookTestUrl(){var e,t;if(!(!this.node||!((t=(e=this.nodeType)==null?void 0:e.webhooks)!=null&&t.length)))return this.workflowHelpers.getWebhookUrl(this.nodeType.webhooks[0],this.node,"test")},isWebhookBasedNode(){var e,t;return!!((t=(e=this.nodeType)==null?void 0:e.webhooks)!=null&&t.length)},isPollingNode(){var e;return!!((e=this.nodeType)!=null&&e.polling)},isListeningForEvents(){const e=this.workflowsStore.executionWaitingForWebhook,t=this.workflowsStore.executedNode;return!!this.node&&!this.node.disabled&&this.isWebhookBasedNode&&e&&(!t||t===this.nodeName)},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},isActivelyPolling(){const e=this.workflowsStore.executedNode;return this.workflowRunning&&this.isPollingNode&&this.nodeName===e},isWorkflowActive(){return this.workflowsStore.isWorkflowActive},listeningTitle(){var e;return((e=this.nodeType)==null?void 0:e.name)===ut?this.$locale.baseText("ndv.trigger.webhookNode.formTrigger.listening"):this.$locale.baseText("ndv.trigger.webhookNode.listening")},listeningHint(){var e;switch((e=this.nodeType)==null?void 0:e.name){case He:return this.$locale.baseText("ndv.trigger.webhookBasedNode.chatTrigger.serviceHint");case ut:return this.$locale.baseText("ndv.trigger.webhookBasedNode.formTrigger.serviceHint");default:return this.$locale.baseText("ndv.trigger.webhookBasedNode.serviceHint",{interpolate:{service:this.serviceName}})}},header(){var t;const e=this.nodeType?Et(this.nodeType):"";return this.isActivelyPolling?this.$locale.baseText("ndv.trigger.pollingNode.fetchingEvent"):(t=this.triggerPanel)!=null&&t.header?this.triggerPanel.header:this.isWebhookBasedNode?this.$locale.baseText("ndv.trigger.webhookBasedNode.action",{interpolate:{name:e}}):""},subheader(){const e=this.nodeType?Et(this.nodeType):"";return this.isActivelyPolling?this.$locale.baseText("ndv.trigger.pollingNode.fetchingHint",{interpolate:{name:e}}):""},executionsHelp(){var e;if((e=this.triggerPanel)!=null&&e.executionsHelp){if(typeof this.triggerPanel.executionsHelp=="string")return this.triggerPanel.executionsHelp;if(!this.isWorkflowActive&&this.triggerPanel.executionsHelp.inactive)return this.triggerPanel.executionsHelp.inactive;if(this.isWorkflowActive&&this.triggerPanel.executionsHelp.active)return this.triggerPanel.executionsHelp.active}return this.isWebhookBasedNode?this.isWorkflowActive?this.$locale.baseText("ndv.trigger.webhookBasedNode.executionsHelp.active",{interpolate:{service:this.serviceName}}):this.$locale.baseText("ndv.trigger.webhookBasedNode.executionsHelp.inactive",{interpolate:{service:this.serviceName}}):this.isPollingNode?this.isWorkflowActive?this.$locale.baseText("ndv.trigger.pollingNode.executionsHelp.active",{interpolate:{service:this.serviceName}}):this.$locale.baseText("ndv.trigger.pollingNode.executionsHelp.inactive",{interpolate:{service:this.serviceName}}):""},activationHint(){if(this.isActivelyPolling||!this.triggerPanel)return"";if(this.triggerPanel.activationHint){if(typeof this.triggerPanel.activationHint=="string")return this.triggerPanel.activationHint;if(!this.isWorkflowActive&&typeof this.triggerPanel.activationHint.inactive=="string")return this.triggerPanel.activationHint.inactive;if(this.isWorkflowActive&&typeof this.triggerPanel.activationHint.active=="string")return this.triggerPanel.activationHint.active}return this.isWebhookBasedNode?this.isWorkflowActive?this.$locale.baseText("ndv.trigger.webhookBasedNode.activationHint.active",{interpolate:{service:this.serviceName}}):this.$locale.baseText("ndv.trigger.webhookBasedNode.activationHint.inactive",{interpolate:{service:this.serviceName}}):this.isPollingNode?this.isWorkflowActive?this.$locale.baseText("ndv.trigger.pollingNode.activationHint.active",{interpolate:{service:this.serviceName}}):this.$locale.baseText("ndv.trigger.pollingNode.activationHint.inactive",{interpolate:{service:this.serviceName}}):""}},methods:{expandExecutionHelp(){this.$refs.help&&this.executionsHelpEventBus.emit("expand")},openWebhookUrl(){this.$telemetry.track("User clicked ndv link",{workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:"input",type:"open-chat"}),window.open(this.webhookTestUrl,"_blank","noreferrer")},onLinkClick(e){var o;if(!e.target)return;const t=e.target;t.localName==="a"&&(o=t.dataset)!=null&&o.key&&(e.stopPropagation(),e.preventDefault(),t.dataset.key==="activate"?this.$emit("activate"):t.dataset.key==="executions"?(this.$telemetry.track("User clicked ndv link",{workflow_id:this.workflowsStore.workflowId,push_ref:this.pushRef,pane:"input",type:"open-executions-log"}),this.ndvStore.activeNodeName=null,this.$router.push({name:te.EXECUTIONS})):t.dataset.key==="settings"&&this.uiStore.openModal(Gs))},onTestLinkCopied(){this.$telemetry.track("User copied webhook URL",{pane:"inputs",type:"test url"})},onNodeExecute(){this.$emit("execute")}}}),yh="_container_1evnm_1",wh="_header_1evnm_18",vh="_action_1evnm_25",Nh="_shake_1evnm_29",kh="_accordion_1evnm_50",bh={container:yh,header:wh,action:vh,shake:Nh,accordion:kh},Th={key:"empty"},Sh={key:"listening"},Dh={key:0},Ch={key:1},Eh={key:0},Ih={key:"default"},Ph={key:0,class:"mb-xl"},_h=["textContent"],$h=["innerHTML"];function Oh(e,t,o,n,s,i){const l=D("NodeIcon"),r=D("n8n-pulse"),a=D("n8n-text"),u=D("CopyInput"),c=D("NodeExecuteButton"),p=D("n8n-button"),g=D("n8n-spinner"),m=D("n8n-heading"),y=D("n8n-link"),S=D("n8n-info-accordion");return d(),k("div",{class:T(e.$style.container)},[v(ua,{name:"fade",mode:"out-in"},{default:b(()=>[e.hasIssues||e.hideContent?(d(),k("div",Th)):e.isListeningForEvents?(d(),k("div",Sh,[v(r,null,{default:b(()=>[v(l,{"node-type":e.nodeType,size:40},null,8,["node-type"])]),_:1}),e.isWebhookNode?(d(),k("div",Dh,[v(a,{tag:"div",size:"large",color:"text-dark",class:"mb-2xs",bold:""},{default:b(()=>[R(N(e.$locale.baseText("ndv.trigger.webhookNode.listening")),1)]),_:1}),h("div",{class:T([e.$style.shake,"mb-xs"])},[v(a,null,{default:b(()=>[R(N(e.$locale.baseText("ndv.trigger.webhookNode.requestHint",{interpolate:{type:e.webhookHttpMethod??""}})),1)]),_:1})],2),v(u,{value:e.webhookTestUrl,"toast-title":e.$locale.baseText("ndv.trigger.copiedTestUrl"),class:"mb-2xl",size:"medium",collapse:!0,"copy-button-text":e.$locale.baseText("generic.clickToCopy"),onCopy:e.onTestLinkCopied},null,8,["value","toast-title","copy-button-text","onCopy"]),v(c,{"data-test-id":"trigger-execute-button","node-name":e.nodeName,size:"medium","telemetry-source":"inputs",onExecute:e.onNodeExecute},null,8,["node-name","onExecute"])])):(d(),k("div",Ch,[v(a,{tag:"div",size:"large",color:"text-dark",class:"mb-2xs",bold:""},{default:b(()=>[R(N(e.listeningTitle),1)]),_:1}),h("div",{class:T([e.$style.shake,"mb-xs"])},[v(a,{tag:"div"},{default:b(()=>[R(N(e.listeningHint),1)]),_:1})],2),e.displayChatButton?(d(),k("div",Eh,[v(p,{class:"mb-xl",onClick:t[0]||(t[0]=w=>e.openWebhookUrl())},{default:b(()=>[R(N(e.$locale.baseText("ndv.trigger.chatTrigger.openChat")),1)]),_:1})])):E("",!0),v(c,{"data-test-id":"trigger-execute-button","node-name":e.nodeName,size:"medium","telemetry-source":"inputs",onExecute:e.onNodeExecute},null,8,["node-name","onExecute"])]))])):(d(),k("div",Ih,[e.isActivelyPolling?(d(),k("div",Ph,[v(g,{type:"ring"})])):E("",!0),h("div",{class:T(e.$style.action)},[h("div",{class:T(e.$style.header)},[e.header?(d(),O(m,{key:0,tag:"h1",bold:""},{default:b(()=>[R(N(e.header),1)]),_:1})):E("",!0),e.subheader?(d(),O(a,{key:1},{default:b(()=>[h("span",{textContent:N(e.subheader)},null,8,_h)]),_:1})):E("",!0)],2),v(c,{"data-test-id":"trigger-execute-button","node-name":e.nodeName,size:"medium","telemetry-source":"inputs",onExecute:e.onNodeExecute},null,8,["node-name","onExecute"])],2),e.activationHint?(d(),O(a,{key:1,size:"small",onClick:e.onLinkClick},{default:b(()=>[h("span",{innerHTML:e.activationHint},null,8,$h),R("  ")]),_:1},8,["onClick"])):E("",!0),e.activationHint&&e.executionsHelp?(d(),O(y,{key:2,size:"small",onClick:e.expandExecutionHelp},{default:b(()=>[R(N(e.$locale.baseText("ndv.trigger.moreInfo")),1)]),_:1},8,["onClick"])):E("",!0),e.executionsHelp?(d(),O(S,{key:3,ref:"help",class:T(e.$style.accordion),title:e.$locale.baseText("ndv.trigger.executionsHint.question"),description:e.executionsHelp,"event-bus":e.executionsHelpEventBus,"onClick:body":e.onLinkClick},null,8,["class","title","description","event-bus","onClick:body"])):E("",!0)]))]),_:1})],2)}const Rh={$style:bh},Mh=Z(gh,[["render",Oh],["__cssModules",Rh],["__scopeId","data-v-d2fb56be"]]),Ah=Q({name:"NodeDetailsView",components:{NodeSettings:zr,InputPanel:mh,OutputPanel:Uc,NDVDraggablePanels:xl,TriggerPanel:Mh},props:{readOnly:{type:Boolean},renaming:{type:Boolean},isProductionExecutionPreview:{type:Boolean,default:!1}},emits:["saveKeyboardShortcut","valueChanged","nodeTypeSelected","switchSelectedNode","openConnectionNodeCreator","redrawNode","stopExecution"],setup(e,{emit:t}){const o=ae(),n=ze(),s=je(),{activeNode:i}=Qt(o),l=Ce(i),r=ct(),a=$t({router:r}),u=ya(),c=ue(),p=Ne(),g=oe(),m=Nn(),y=Me(),S=to(),w=We(),C=no(),I=Jt(),P=K(!1),V=K(-1),H=K(-1),x=K(!0),f=K(),$=K(!1),A=K(!1),B=K(0),Y=K(!1),M=K(0),z=K(0),G=K(!1),ne=K(!1),re=K(!0),q=W(()=>o.pushRef),L=W(()=>i.value?c.getNodeType(i.value.type,i.value.typeVersion):null),F=W(()=>p.isActionActive("workflowRunning")),be=W(()=>$.value&&!!L.value&&!L.value.group.includes("trigger")&&F.value&&g.executionWaitingForWebhook),me=W(()=>{if(fo.value===null)return null;const _=fo.value.data;return _!=null&&_.resultData?_.resultData.runData:null}),Te=W(()=>a.getCurrentWorkflow()),ot=W(()=>i.value?Te.value.getParentNodesByDepth(i.value.name,1).map(({name:_})=>_)||[]:[]),Mn=W(()=>{var _,X;for(const J of ot.value)if((_=g==null?void 0:g.pinnedWorkflowData)!=null&&_[J]||(X=me.value)!=null&&X[J])return J;return ot.value[0]}),Ke=W(()=>f.value||Mn.value),ft=W(()=>Ke.value?g.getNodeByName(Ke.value):null),An=W(()=>o.ndvInputDataWithPinnedData.length),mt=W(()=>!!L.value&&(L.value.group.includes("trigger")||L.value.name===lo)),Wn=W(()=>{var ce,ge,Pe,bo,To;const _=!!((ce=L.value)!=null&&ce.triggerPanel);if(typeof((ge=L.value)==null?void 0:ge.triggerPanel)=="boolean")return _;const X=!!((bo=(Pe=L.value)==null?void 0:Pe.webhooks)!=null&&bo.length),J=(To=L.value)==null?void 0:To.polling;return!e.readOnly&&mt.value&&(X||J||_)}),Vn=W(()=>{var X,J;if(!i.value)return!1;const _=g.outgoingConnectionsByNodeName(i.value.name);return(((J=(X=Object.values(_))==null?void 0:X[0])==null?void 0:J[0])??[]).length>0}),Bn=W(()=>L.value?Js.includes(L.value.name):!1),Rt=W(()=>!!o.activeNode&&o.activeNode.type===ke),fo=W(()=>g.getWorkflowExecution),Be=W(()=>{if(i.value===null)return 0;const _=me.value;return _!=null&&_[i.value.name]&&_[i.value.name].length?_[i.value.name].length-1:0}),gt=W(()=>H.value===-1?Be.value:Math.min(H.value,Be.value)),Ye=W(()=>{if(ft.value===null||i.value===null)return 0;const _=Te.value.getNode(i.value.name);if(!_||!L.value)return 0;const X=Oe(Te.value,_,L.value);let J=ft.value;const ce=me.value;return X.some(ge=>ge!==U.Main)&&(J=i.value),!J||!ce||!ce.hasOwnProperty(J.name)?0:ce[J.name].length?ce[J.name].length-1:0}),yt=W(()=>x.value&&Be.value===Ye.value?gt.value:V.value===-1?Ye.value:Math.min(V.value,Ye.value)),mo=W(()=>Be.value>0&&Be.value===Ye.value),Mt=W(()=>x.value&&mo.value),Un=W(()=>mt.value?0:80),go=W(()=>L.value?`${Xs}${L.value.name}`:""),yo=W(()=>o.outputPanelEditMode),Ln=W(()=>p.isActionActive("workflowRunning")),xn=W(()=>g.executionWaitingForWebhook),Hn=W(()=>Ln.value||xn.value),wo=W(()=>{var ce;const _=(ce=i.value)==null?void 0:ce.credentials,X=g.usedCredentials,J=[];return _&&m.isEnterpriseFeatureEnabled(It.Sharing)&&Object.values(_).forEach(ge=>{ge.id&&X[ge.id]&&!X[ge.id].currentUserHasAccess&&J.push(ge.id)}),J}),vo=W(()=>wo.value.length>0),No=({isTooltipVisible:_})=>{Y.value=_},Fn=_=>{if(_.key==="s"&&y.isCtrlKeyPressed(_)){if(_.stopPropagation(),_.preventDefault(),e.readOnly)return;t("saveKeyboardShortcut",_)}},zn=_=>{if(_===null||!Ke.value||!re.value){o.setHoveringItem(null);return}const X={nodeName:Ke.value,runIndex:yt.value,outputIndex:_.outputIndex,itemIndex:_.itemIndex};o.setHoveringItem(X)},qn=_=>{M.value=_.avgRowHeight},jn=()=>{o.activeNodeName=null,setTimeout(()=>{u.activateCurrentWorkflow("ndv")},1e3)},Kn=_=>{var J;if(_===null||!i.value||!re.value){o.setHoveringItem(null);return}const X={nodeName:(J=i.value)==null?void 0:J.name,runIndex:gt.value,outputIndex:_.outputIndex,itemIndex:_.itemIndex};o.setHoveringItem(X)},Yn=()=>{window.open(go.value,"_blank"),i.value&&S.track("User clicked ndv link",{node_type:i.value.type,workflow_id:g.workflowId,push_ref:q.value,pane:U.Main,type:"i-wish-this-node-would"})},Gn=_=>{A.value=!1,S.track("User moved parameters pane",{window_width:_.windowWidth,start_position:B.value,end_position:_.position,node_type:L.value?L.value.name:"",push_ref:q.value,workflow_id:g.workflowId}),B.value=_.position},Jn=_=>{A.value=!0,B.value=_.position},Xn=_=>{B.value=_.position},Qn=()=>{x.value=!0,At("output")},Zn=_=>{V.value=H.value,x.value=!1,At(_)},es=()=>{setTimeout(()=>{!i.value||!F.value||($.value=!0)},1e3)},ts=()=>{I.emit("openSettings")},At=_=>{S.track("User changed ndv run linking",{node_type:L.value?L.value.name:"",push_ref:q.value,linked:Mt.value,pane:_})},os=()=>{H.value=V.value,x.value=!0,At("input")},ns=_=>{t("valueChanged",_)},ss=_=>{t("nodeTypeSelected",_)},is=_=>{t("switchSelectedNode",_)},as=(_,X)=>{t("openConnectionNodeCreator",_,X)},rs=async()=>{var _,X,J;if(!A.value){if(i.value&&(typeof((_=L.value)==null?void 0:_.outputs)=="string"||typeof((X=L.value)==null?void 0:X.inputs)=="string"||P.value)){const ce=i.value.name;setTimeout(()=>{t("redrawNode",ce)},1)}if(yo.value.enabled&&i.value){if(await C.confirm("",w.baseText("ndv.pinData.beforeClosing.title"),{confirmButtonText:w.baseText("ndv.pinData.beforeClosing.confirm"),cancelButtonText:w.baseText("ndv.pinData.beforeClosing.cancel")})===et){const{value:ge}=yo.value;try{l.setData(Xt(ge),"on-ndv-close-modal")}catch(Pe){console.error(Pe)}}o.setOutputPanelEditModeEnabled(!1)}await n.run("dataDisplay.nodeEditingFinished"),S.track("User closed node modal",{node_type:L.value?(J=L.value)==null?void 0:J.name:"",push_ref:q.value,workflow_id:g.workflowId}),$.value=!1,o.activeNodeName=null,o.resetNDVPushRef()}},ko=(_,X)=>{var J;S.track("User changed ndv run dropdown",{push_ref:q.value,run_index:_,node_type:L.value?(J=L.value)==null?void 0:J.name:"",pane:X})},ls=_=>{H.value=_,ko(_,"output")},ds=_=>{V.value=_,Mt.value&&(H.value=_),ko(_,"input")},us=_=>{z.value=_.avgRowHeight},cs=(_,X)=>{V.value=-1,x.value=!0,f.value=_,S.track("User changed ndv input dropdown",{node_type:i.value?i.value.type:"",push_ref:q.value,workflow_id:g.workflowId,selection_value:X,input_node_type:ft.value?ft.value.type:""})},hs=()=>{t("stopExecution")},ps=()=>{G.value=!0,ne.value=!1},fs=()=>{G.value=!1,ne.value=!0},ms=_=>{re.value=!_};return _e(i,(_,X)=>{if(_&&_.name!==(X==null?void 0:X.name)&&!Rt.value){if(V.value=-1,H.value=-1,x.value=!0,f.value=void 0,$.value=!1,z.value=0,M.value=0,setTimeout(()=>o.setNDVPushRef(),0),!L.value)return;n.run("dataDisplay.nodeTypeChanged",{nodeSubtitle:s.getNodeSubtitle(_,L.value,a.getCurrentWorkflow())}),setTimeout(()=>{var J,ce,ge;if(i.value){const Pe=g.outgoingConnectionsByNodeName((J=i.value)==null?void 0:J.name);S.track("User opened node modal",{node_type:L.value?(ce=L.value)==null?void 0:ce.name:"",workflow_id:g.workflowId,push_ref:q.value,is_editable:!vo.value,parameters_pane_position:B.value,input_first_connector_runs:Ye.value,output_first_connector_runs:Be.value,selected_view_inputs:mt.value?"trigger":o.inputPanelDisplayMode,selected_view_outputs:o.outputPanelDisplayMode,input_connectors:ot.value.length,output_connectors:(ge=Pe==null?void 0:Pe.main)==null?void 0:ge.length,input_displayed_run_index:yt.value,output_displayed_run_index:gt.value,data_pinning_tooltip_presented:Y.value,input_displayed_row_height_avg:M.value,output_displayed_row_height_avg:z.value})}},2e3)}window.top&&!Rt.value&&window.top.postMessage(JSON.stringify({command:_?"openNDV":"closeNDV"}),"*")},{immediate:!0}),_e(Be,()=>{H.value=-1}),_e(Ye,()=>{V.value=-1}),_e(Ke,_=>{setTimeout(()=>{o.setInputNodeName(_)},0)}),_e(yt,_=>{setTimeout(()=>{o.setInputRunIndex(_)},0)}),uo(()=>{$e.on("data-pinning-discovery",No)}),Pn(()=>{$e.off("data-pinning-discovery",No)}),{externalHooks:n,nodeHelpers:s,pinnedData:l,workflowHelpers:a,workflowActivate:u,redrawRequired:P,isInputPaneActive:G,isDragging:A,activeNodeType:L,pushRef:q,workflowRunning:F,showTriggerWaitingWarning:be,activeNode:i,isExecutableTriggerNode:Bn,showTriggerPanel:Wn,hasOutputConnection:Vn,blockUi:Hn,isActiveStickyNode:Rt,isTriggerNode:mt,workflow:Te,canLinkRuns:mo,inputRun:yt,linked:Mt,inputNodeName:Ke,inputSize:An,hasForeignCredential:vo,outputRun:gt,isOutputPaneActive:ne,foreignCredentials:wo,featureRequestUrl:go,settingsEventBus:I,inputPanelMargin:Un,nodeTypeSelected:ss,onOutputItemHover:Kn,onOutputTableMounted:us,onInputTableMounted:qn,onRunOutputIndexChange:ls,onStopExecution:hs,activateInputPane:ps,activateOutputPane:fs,onSearch:ms,onInputNodeChange:cs,onRunInputIndexChange:ds,onLinkRunToInput:os,valueChanged:ns,onSwitchSelectedNode:is,onOpenConnectionNodeCreator:as,close:rs,onKeyDown:Fn,onInputItemHover:zn,onWorkflowActivate:jn,onFeatureRequestClick:Yn,onDragEnd:Gn,onDragStart:Jn,onPanelsInit:Xn,onLinkRunToOutput:Qn,onUnlinkRun:Zn,onNodeExecute:es,openSettings:ts}}}),Wh="_modalBackground_16z4c_1",Vh="_triggerWarning_16z4c_6",Bh="_backToCanvas_16z4c_10",Uh="_featureRequest_16z4c_31",Lh={modalBackground:Wh,triggerWarning:Vh,backToCanvas:Bh,featureRequest:Uh};function xh(e,t,o,n,s,i){const l=D("n8n-icon"),r=D("n8n-text"),a=D("n8n-tooltip"),u=D("TriggerPanel"),c=D("InputPanel"),p=D("OutputPanel"),g=D("NodeSettings"),m=D("font-awesome-icon"),y=D("NDVDraggablePanels"),S=D("el-dialog");return d(),O(S,{"model-value":(!!e.activeNode||e.renaming)&&!e.isActiveStickyNode,"before-close":e.close,"show-close":!1,class:"data-display-wrapper ndv-wrapper","overlay-class":"data-display-overlay",width:"auto","append-to-body":"","data-test-id":"ndv","data-has-output-connection":e.hasOutputConnection},{default:b(()=>{var w;return[v(a,{placement:"bottom-start",visible:e.showTriggerWaitingWarning,disabled:!e.showTriggerWaitingWarning},{content:b(()=>[h("div",{class:T(e.$style.triggerWarning)},N(e.$locale.baseText("ndv.backToCanvas.waitingForTriggerWarning")),3)]),default:b(()=>[h("div",{class:T(e.$style.backToCanvas),"data-test-id":"back-to-canvas",onClick:t[0]||(t[0]=(...C)=>e.close&&e.close(...C))},[v(l,{icon:"arrow-left",color:"text-xlight",size:"medium"}),v(r,{color:"text-xlight",size:"medium",bold:!0},{default:b(()=>[R(N(e.$locale.baseText("ndv.backToCanvas")),1)]),_:1})],2)]),_:1},8,["visible","disabled"]),e.activeNode?(d(),k("div",{key:0,ref:"container",class:"data-display",tabindex:"0",onKeydownCapture:t[6]||(t[6]=(...C)=>e.onKeyDown&&e.onKeyDown(...C))},[h("div",{class:T(e.$style.modalBackground),onClick:t[1]||(t[1]=(...C)=>e.close&&e.close(...C))},null,2),(d(),O(y,{key:e.activeNode.name,"is-trigger-node":e.isTriggerNode,"hide-input-and-output":e.activeNodeType===null,position:e.isTriggerNode&&!e.showTriggerPanel?0:void 0,"is-draggable":!e.isTriggerNode,"has-double-width":((w=e.activeNodeType)==null?void 0:w.parameterPane)==="wide","node-type":e.activeNodeType,onSwitchSelectedNode:e.onSwitchSelectedNode,onOpenConnectionNodeCreator:e.onOpenConnectionNodeCreator,onClose:e.close,onInit:e.onPanelsInit,onDragstart:e.onDragStart,onDragend:e.onDragEnd},co({output:b(()=>[v(p,{"data-test-id":"output-panel",workflow:e.workflow,"can-link-runs":e.canLinkRuns,"run-index":e.outputRun,"linked-runs":e.linked,"push-ref":e.pushRef,"is-read-only":e.readOnly||e.hasForeignCredential,"block-u-i":e.blockUi&&e.isTriggerNode&&!e.isExecutableTriggerNode,"is-production-execution-preview":e.isProductionExecutionPreview,"is-pane-active":e.isOutputPaneActive,onActivatePane:e.activateOutputPane,onLinkRun:e.onLinkRunToOutput,onUnlinkRun:t[3]||(t[3]=()=>e.onUnlinkRun("output")),onRunChange:e.onRunOutputIndexChange,onOpenSettings:e.openSettings,onTableMounted:e.onOutputTableMounted,onItemHover:e.onOutputItemHover,onSearch:e.onSearch},null,8,["workflow","can-link-runs","run-index","linked-runs","push-ref","is-read-only","block-u-i","is-production-execution-preview","is-pane-active","onActivatePane","onLinkRun","onRunChange","onOpenSettings","onTableMounted","onItemHover","onSearch"])]),main:b(()=>[v(g,{"event-bus":e.settingsEventBus,dragging:e.isDragging,"push-ref":e.pushRef,"node-type":e.activeNodeType,"foreign-credentials":e.foreignCredentials,"read-only":e.readOnly,"block-u-i":e.blockUi&&e.showTriggerPanel,executable:!e.readOnly,"input-size":e.inputSize,onValueChanged:e.valueChanged,onExecute:e.onNodeExecute,onStopExecution:e.onStopExecution,onRedrawRequired:t[4]||(t[4]=C=>e.redrawRequired=!0),onActivate:e.onWorkflowActivate,onSwitchSelectedNode:e.onSwitchSelectedNode,onOpenConnectionNodeCreator:e.onOpenConnectionNodeCreator},null,8,["event-bus","dragging","push-ref","node-type","foreign-credentials","read-only","block-u-i","executable","input-size","onValueChanged","onExecute","onStopExecution","onActivate","onSwitchSelectedNode","onOpenConnectionNodeCreator"]),e.featureRequestUrl?(d(),k("a",{key:0,class:T(e.$style.featureRequest),target:"_blank",onClick:t[5]||(t[5]=(...C)=>e.onFeatureRequestClick&&e.onFeatureRequestClick(...C))},[v(m,{icon:"lightbulb"}),R(" "+N(e.$locale.baseText("ndv.featureRequest")),1)],2)):E("",!0)]),_:2},[e.showTriggerPanel||!e.isTriggerNode?{name:"input",fn:b(()=>[e.showTriggerPanel?(d(),O(u,{key:0,"node-name":e.activeNode.name,"push-ref":e.pushRef,onExecute:e.onNodeExecute,onActivate:e.onWorkflowActivate},null,8,["node-name","push-ref","onExecute","onActivate"])):e.isTriggerNode?E("",!0):(d(),O(c,{key:1,workflow:e.workflow,"can-link-runs":e.canLinkRuns,"run-index":e.inputRun,"linked-runs":e.linked,"current-node-name":e.inputNodeName,"push-ref":e.pushRef,"read-only":e.readOnly||e.hasForeignCredential,"is-production-execution-preview":e.isProductionExecutionPreview,"is-pane-active":e.isInputPaneActive,onActivatePane:e.activateInputPane,onLinkRun:e.onLinkRunToInput,onUnlinkRun:t[2]||(t[2]=()=>e.onUnlinkRun("input")),onRunChange:e.onRunInputIndexChange,onOpenSettings:e.openSettings,onChangeInputNode:e.onInputNodeChange,onExecute:e.onNodeExecute,onTableMounted:e.onInputTableMounted,onItemHover:e.onInputItemHover,onSearch:e.onSearch},null,8,["workflow","can-link-runs","run-index","linked-runs","current-node-name","push-ref","read-only","is-production-execution-preview","is-pane-active","onActivatePane","onLinkRun","onRunChange","onOpenSettings","onChangeInputNode","onExecute","onTableMounted","onItemHover","onSearch"]))]),key:"0"}:void 0]),1032,["is-trigger-node","hide-input-and-output","position","is-draggable","has-double-width","node-type","onSwitchSelectedNode","onOpenConnectionNodeCreator","onClose","onInit","onDragstart","onDragend"]))],544)):E("",!0)]}),_:1},8,["model-value","before-close","data-has-output-connection"])}const Hh={$style:Lh},Fh=Z(Ah,[["render",xh],["__cssModules",Hh]]),zh=Q({__name:"ContextMenu",emits:["action"],setup(e,{emit:t}){const o=pt(),{position:n,isOpen:s,actions:i,target:l}=o,r=K(),a=t;_e(s,()=>{var p,g;s?(p=r.value)==null||p.open():(g=r.value)==null||g.close()},{flush:"post"});function u(p){const g=p;o._dispatchAction(g),a("action",g,o.targetNodes.value)}function c(p){p||o.close()}return(p,g)=>j(s)?(d(),O(En,{key:0,to:"body"},[h("div",{class:T(p.$style.contextMenu),style:ie({left:`${j(n)[0]}px`,top:`${j(n)[1]}px`})},[v(j(Ts),{ref_key:"dropdown",ref:r,items:j(i),placement:"bottom-start","data-test-id":"context-menu","hide-arrow":j(l).source!=="node-button",onSelect:u,onVisibleChange:c},{activator:b(()=>[h("div",{class:T(p.$style.activator)},null,2)]),_:1},8,["items","hide-arrow"])],6)])):E("",!0)}}),qh="_contextMenu_1t4kq_1",jh="_activator_1t4kq_5",Kh={contextMenu:qh,activator:jh},Yh={$style:Kh},Gh=Z(zh,[["__cssModules",Yh]]),Jh=(e,t)=>{const o=si.includes(e);return{type:"N8nAddInput",options:{width:24,height:72,color:t,multiple:o}}},Xh=()=>({type:"Rectangle",options:{height:10,width:10,cssClass:"diamond-output-endpoint"}}),Qh=e=>e<=2?"small":e<=6?"medium":"large",On=Q({data(){return{inputs:[],outputs:[]}},mounted(){if(this.data!==null)try{this.__addNode(this.data)}catch{}},computed:{...ve(ue,Ne,eo,oe,ao),data(){return this.workflowsStore.getNodeByName(this.name)},nodeId(){var e;return((e=this.data)==null?void 0:e.id)||""}},props:{name:{type:String,required:!0},instance:{type:Object},isReadOnly:{type:Boolean},isActive:{type:Boolean},hideActions:{type:Boolean},disableSelecting:{type:Boolean},showCustomTooltip:{type:Boolean},workflow:{type:Object,required:!0}},methods:{__addEndpointTestingData(e,t,o){if(window!=null&&window.Cypress&&"canvas"in e.endpoint){const n=e.endpoint.canvas;this.instance.setAttribute(n,"data-endpoint-name",this.data.name),this.instance.setAttribute(n,"data-input-index",o.toString()),this.instance.setAttribute(n,"data-endpoint-type",t)}},__addInputEndpoints(e,t){const o={},n={},s=De(this.workflow,this.data,t)||[];this.inputs=s;const i=[...s];i.sort((l,r)=>typeof l=="string"?1:typeof r=="string"||l.required&&!r.required?-1:!l.required&&r.required?1:0),i.forEach((l,r)=>{var x,f;let a;typeof l=="string"?a={type:l}:a=l;const u=a.type,c=u===U.Main?U.Main:"other";o.hasOwnProperty(c)?o[c]++:o[c]=0,n.hasOwnProperty(u)?n[u]++:n[u]=0;const p=o[c],g=n[u],m=s.filter($=>{const A=typeof $=="string"?$:$.type;return u===U.Main?A===U.Main:A!==U.Main}),y=m.filter($=>$!==U.Main),S=y.filter($=>typeof $!="string"&&$.required),w=y.filter($=>typeof $!="string"&&!$.required),C=this.getSpacerIndexes(S.length,w.length),I=Wo(u,"input",m.length,C)[p],P=tt(u),V={uuid:kn(this.nodeId,u,g),anchor:I,maxConnections:a.maxConnections??-1,endpoint:"Rectangle",paintStyle:Vt(t,"--color-foreground-xdark",u),hoverPaintStyle:Vt(t,"--color-primary",u),scope:Qs(P),source:u!==U.Main,target:!this.isReadOnly&&s.length>1,parameters:{connection:"target",nodeId:this.nodeId,type:u,index:g},enabled:!this.isReadOnly,cssClass:"rect-input-endpoint",dragAllowedWhenFull:!0,hoverClass:"rect-input-endpoint-hover",...this.__getInputConnectionStyle(u,t)},H=(x=this.instance)==null?void 0:x.addEndpoint(this.$refs[this.data.name],V);this.__addEndpointTestingData(H,"input",g),(a.displayName||(f=t.inputNames)!=null&&f[r])&&H.addOverlay(Zs(a.displayName||t.inputNames[r],u,a.required)),Array.isArray(H)||(H.__meta={nodeName:e.name,nodeId:this.nodeId,index:g,totalEndpoints:m.length,nodeType:e.type})}),i.length===0&&this.instance.manage(this.$refs[this.data.name])},getSpacerIndexes(e,t,o=ei,n=ti){const s=[];if(e>0&&t>0){if(o)s.push(e);else if(e+t<n)for(let i=e;i<n-t;i++)s.push(i)}else if(e>0&&e<n&&t===0)for(let i=0;i<n-e;i++)s.push(i+e);else if(e===0&&t>0&&t<n)for(let i=0;i<n-t;i++)s.push(i);return s},__addOutputEndpoints(e,t){const o={},n={};this.outputs=Oe(this.workflow,this.data,t)||[];let s=0;const i=[];this.outputs.forEach((r,a)=>{var c;let u;typeof r=="string"?u={type:r}:u=r,(c=t.outputNames)!=null&&c[a]&&(u.displayName=t.outputNames[a]),u.displayName&&(s=u.displayName.length>s?u.displayName.length:s),i.push(u)});const l=Qh(s);this.outputs.forEach((r,a)=>{const u=i[a],c=u.type,p=c===U.Main?U.Main:"other";o.hasOwnProperty(p)?o[p]++:o[p]=0,n.hasOwnProperty(c)?n[c]++:n[c]=0;const g=o[p],m=n[c],y=this.outputs.filter(P=>{const V=typeof P=="string"?P:P.type;return c===U.Main?V===U.Main:V!==U.Main}),S=Wo(c,"output",y.length)[g],w=tt(c),C={uuid:Yt(this.nodeId,c,m),anchor:S,maxConnections:-1,endpoint:{type:"Dot",options:{radius:t&&y.length>2?7:9}},hoverPaintStyle:nt(t,"--color-primary"),scope:w,source:!0,target:c!==U.Main,enabled:!this.isReadOnly,parameters:{connection:"source",nodeId:this.nodeId,type:c,index:m},hoverClass:"dot-output-endpoint-hover",connectionsDirected:!0,dragAllowedWhenFull:!1,...this.__getOutputConnectionStyle(c,u,t)},I=this.instance.addEndpoint(this.$refs[this.data.name],C);if(this.__addEndpointTestingData(I,"output",m),u.displayName){const P=oi(u.displayName,c,u==null?void 0:u.category);I.addOverlay(P)}if(Array.isArray(I)||(I.__meta={nodeName:e.name,nodeId:this.nodeId,index:m,totalEndpoints:y.length,endpointLabelLength:l}),!this.isReadOnly&&c===U.Main){const P={uuid:Yt(this.nodeId,c,m),anchor:S,maxConnections:-1,endpoint:{type:"N8nPlus",options:{dimensions:24,connectedEndpoint:I,showOutputLabel:this.outputs.length===1,size:this.outputs.length>=3?"small":"medium",endpointLabelLength:l,hoverMessage:this.$locale.baseText("nodeBase.clickToAddNodeOrDragToConnect")}},source:!0,target:!1,enabled:!this.isReadOnly,paintStyle:{outlineStroke:"none"},hoverPaintStyle:{outlineStroke:"none"},parameters:{connection:"source",nodeId:this.nodeId,type:c,index:m,category:u==null?void 0:u.category},cssClass:"plus-draggable-endpoint",dragAllowedWhenFull:!1};u!=null&&u.category&&(P.cssClass=`${P.cssClass} ${u==null?void 0:u.category}`);const V=this.instance.addEndpoint(this.$refs[this.data.name],P);this.__addEndpointTestingData(V,"plus",m),Array.isArray(V)||(V.__meta={nodeName:e.name,nodeId:this.nodeId,index:m,nodeType:e.type,totalEndpoints:y.length})}})},__addNode(e){const t=this.nodeTypesStore.getNodeType(e.type,e.typeVersion)??this.nodeTypesStore.getNodeType(ni);this.__addInputEndpoints(e,t),this.__addOutputEndpoints(e,t)},__getEndpointColor(e){return`--node-type-${e}-color`},__getInputConnectionStyle(e,t){return e===U.Main?{paintStyle:Vt(t,this.__getEndpointColor(U.Main),e)}:Object.values(U).includes(e)?(n=>({endpoint:Jh(n,this.__getEndpointColor(n))}))(e):{}},__getOutputConnectionStyle(e,t,o){const n="output",s=i=>({endpoint:Xh(),paintStyle:nt(o,this.__getEndpointColor(i)),hoverPaintStyle:nt(o,this.__getEndpointColor(i))});return e===U.Main?t.category==="error"?{paintStyle:{...nt(o,this.__getEndpointColor(U.Main)),fill:"var(--color-danger)"},cssClass:`dot-${n}-endpoint`}:{paintStyle:nt(o,this.__getEndpointColor(U.Main)),cssClass:`dot-${n}-endpoint`}:Object.values(U).includes(e)?s(e):{}},touchEnd(e){Me().isTouchDevice&&this.uiStore.isActionActive("dragActive")&&this.uiStore.removeActiveAction("dragActive")},mouseLeftClick(e){const t=Me(),o=e.path||e.composedPath&&e.composedPath();for(let n=0;n<o.length;n++)if(o[n].className&&typeof o[n].className=="string"&&o[n].className.includes("no-select-on-click"))return;t.isTouchDevice||(this.uiStore.isActionActive("dragActive")?this.uiStore.removeActiveAction("dragActive"):(t.isCtrlKeyPressed(e)||this.$emit("deselectAllNodes"),this.uiStore.isNodeSelected(this.data.name)?this.$emit("deselectNode",this.name):this.$emit("nodeSelected",this.name)))}}}),Zh=Q({name:"Node",components:{TitledList:jt,FontAwesomeIcon:Ss,NodeIcon:Fe},mixins:[On],props:{isProductionExecutionPreview:{type:Boolean,default:!1},disablePointerEvents:{type:Boolean,default:!1},hideNodeIssues:{type:Boolean,default:!1}},setup(e){const t=oe(),o=pt(),n=ze(),s=je(),i=t.getNodeByName(e.name),l=Ce(i),r=Me(),{callDebounced:a}=Ot();return{contextMenu:o,externalHooks:n,nodeHelpers:s,pinnedData:l,deviceSupport:r,callDebounced:a}},data(){return{isTouchActive:!1,nodeSubtitle:"",showTriggerNodeTooltip:!1,pinDataDiscoveryTooltipVisible:!1,dragging:!1,unwatchWorkflowDataItems:()=>{}}},computed:{...ve(ue,ae,Ne,oe),showPinnedDataInfo(){return this.pinnedData.hasData.value&&!this.isProductionExecutionPreview},isDuplicatable(){return this.nodeType?hn.includes(this.nodeType.name)?!1:this.nodeType.maxNodes===void 0||this.sameTypeNodes.length<this.nodeType.maxNodes:!0},isScheduledGroup(){var e;return((e=this.nodeType)==null?void 0:e.group.includes("schedule"))===!0},iconColorDefault(){if(this.isConfigNode)return"var(--color-text-base)"},nodeRunData(){var e;return this.workflowsStore.getWorkflowResultDataByNodeName(((e=this.data)==null?void 0:e.name)||"")||[]},hasIssues(){var e;return this.nodeExecutionStatus&&["crashed","error"].includes(this.nodeExecutionStatus)?!0:this.pinnedData.hasData.value?!1:!!(((e=this.data)==null?void 0:e.issues)!==void 0&&Object.keys(this.data.issues).length)},workflowDataItems(){const e=this.nodeRunData;return e===null?0:e.length},canvasOffsetPosition(){return this.uiStore.nodeViewOffsetPosition},getTriggerNodeTooltip(){if(this.nodeType!==null&&this.nodeType.hasOwnProperty("eventTriggerDescription")){const e=this.$locale.shortNodeType(this.nodeType.name),{eventTriggerDescription:t}=this.nodeType;return this.$locale.nodeText().eventTriggerDescription(e,t||"")}else return this.$locale.baseText("node.waitingForYouToCreateAnEventIn",{interpolate:{nodeType:this.nodeType?Et(this.nodeType):""}})},isPollingTypeNode(){var e;return!!((e=this.nodeType)!=null&&e.polling)},isExecuting(){return this.data?this.workflowsStore.isNodeExecuting(this.data.name):!1},isSingleActiveTriggerNode(){return this.workflowsStore.workflowTriggerNodes.filter(t=>{const o=this.nodeTypesStore.getNodeType(t.type,t.typeVersion);return o&&o.eventTriggerDescription!==""&&!t.disabled}).length===1},isManualTypeNode(){var e;return((e=this.data)==null?void 0:e.type)===so},isConfigNode(){return this.data?this.nodeTypesStore.isConfigNode(this.workflow,this.data,this.data.type??""):!1},isConfigurableNode(){var e;return this.data?this.nodeTypesStore.isConfigurableNode(this.workflow,this.data,((e=this.data)==null?void 0:e.type)??""):!1},isTriggerNode(){var e;return this.nodeTypesStore.isTriggerNode(((e=this.data)==null?void 0:e.type)||"")},isTriggerNodeTooltipEmpty(){return this.nodeType!==null?this.nodeType.eventTriggerDescription==="":!1},isNodeDisabled(){return this.node&&this.node.disabled},nodeType(){return this.data&&this.nodeTypesStore.getNodeType(this.data.type,this.data.typeVersion)},node(){return this.workflowsStore.nodesByName[this.name]},sameTypeNodes(){return this.workflowsStore.allNodes.filter(e=>{var t;return e.type===((t=this.data)==null?void 0:t.type)})},nodeWrapperClass(){const e={"node-wrapper":!0,"node-wrapper--trigger":this.isTriggerNode,"node-wrapper--configurable":this.isConfigurableNode,"node-wrapper--config":this.isConfigNode};if(this.outputs.length){const o=Ie(this.outputs).filter(n=>n!==U.Main);o.length&&o.forEach(n=>{e[`node-wrapper--connection-type-${n}`]=!0})}return e},nodeWrapperStyles(){const e={left:this.position[0]+"px",top:this.position[1]+"px"};if(this.node&&this.nodeType){const t=De(this.workflow,this.node,this.nodeType)||[],n=Ie(t).filter(r=>r!==U.Main);if(n.length){t.filter(a=>typeof a!="string"&&a.required);let r=0;e["--configurable-node-input-count"]=n.length+r}let s=[];this.workflow.nodes[this.node.name]&&(s=Oe(this.workflow,this.node,this.nodeType));const l=Ie(s).filter(r=>r===U.Main);e["--node-main-output-count"]=l.length}return e},nodeClass(){var e;return{"node-box":!0,disabled:(e=this.data)==null?void 0:e.disabled,executing:this.isExecuting}},nodeExecutionStatus(){var t;const e=(t=this.workflowsStore.getWorkflowRunData)==null?void 0:t[this.name];return e?e.filter(Boolean)[0].executionStatus??"":""},nodeIssues(){var o,n;const e=[],t=(o=this.workflowsStore.getWorkflowRunData)==null?void 0:o[this.name];return t&&t.forEach(s=>{if(s!=null&&s.error){const{message:i,description:l}=s.error,r=`${i}${l?` (${l})`:""}`;e.push(Ds(r))}}),((n=this.data)==null?void 0:n.issues)!==void 0&&e.push(...cn(this.data.issues,this.data)),e},nodeDisabledTitle(){var e;return(e=this.data)!=null&&e.disabled?this.$locale.baseText("node.enable"):this.$locale.baseText("node.disable")},position(){return this.node?this.node.position:[0,0]},showDisabledLinethrough(){var e;return!this.isConfigurableNode&&!!((e=this.data)!=null&&e.disabled&&this.inputs.length===1&&this.outputs.length===1)},shortNodeType(){var e;return this.$locale.shortNodeType(((e=this.data)==null?void 0:e.type)??"")},nodeTitle(){var e,t;return((e=this.data)==null?void 0:e.name)==="Start"?this.$locale.headerText({key:"headers.start.displayName",fallback:"Start"}):((t=this.data)==null?void 0:t.name)??""},waiting(){const e=this.workflowsStore.getWorkflowExecution;if(e!=null&&e.waitTill){const t=Se(e,"data.resultData.lastNodeExecuted");if(this.name===t){const o=new Date(e.waitTill);return o.toISOString()===ii?this.$locale.baseText("node.theNodeIsWaitingIndefinitelyForAnIncomingWebhookCall"):this.$locale.baseText("node.nodeIsWaitingTill",{interpolate:{date:o.toLocaleDateString(),time:o.toLocaleTimeString()}})}}},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},nodeStyle(){var o,n,s,i;const e={};let t="--color-foreground-xdark";return(this.isConfigurableNode||this.isConfigNode)&&(t="--color-foreground-dark"),(o=this.data)!=null&&o.disabled?t="--color-foreground-base":this.isExecuting||(this.hasIssues&&!this.hideNodeIssues?((i=(s=(n=this.nodeRunData)==null?void 0:n[0])==null?void 0:s.error)==null?void 0:i.functionality)!=="configuration-node"&&(t="--color-danger",e["border-width"]="2px",e["border-style"]="solid"):this.waiting||this.showPinnedDataInfo?t="--color-canvas-node-pinned-border":this.nodeExecutionStatus==="unknown"?t="--color-foreground-xdark":this.workflowDataItems&&(e["border-width"]="2px",e["border-style"]="solid",t="--color-success")),e["border-color"]=`var(${t})`,e},isSelected(){return this.uiStore.getSelectedNodes.find(e=>{var t;return e.name===((t=this.data)==null?void 0:t.name)})!==void 0},shiftOutputCount(){return!!(this.nodeType&&this.outputs.length>2)},shouldShowTriggerTooltip(){return!!this.node&&this.isTriggerNode&&!this.isPollingTypeNode&&!this.pinnedData.hasData.value&&!this.isNodeDisabled&&this.workflowRunning&&this.workflowDataItems===0&&this.isSingleActiveTriggerNode&&!this.isTriggerNodeTooltipEmpty&&!this.hasIssues&&!this.dragging},isContextMenuOpen(){var e;return this.contextMenu.isOpen.value&&this.contextMenu.target.value.source==="node-button"&&this.contextMenu.target.value.node.name===((e=this.data)==null?void 0:e.name)},iconNodeType(){var e,t,o;if(((e=this.data)==null?void 0:e.type)===ai||((t=this.data)==null?void 0:t.type)===ri){const n=(o=this.data.parameters)==null?void 0:o.icon,s=this.workflow.expression.getSimpleParameterValue(this.data,n,"internal",{});if(s&&typeof s=="string")return this.nodeTypesStore.getNodeType(s)}return this.nodeType}},watch:{isActive(e,t){!e&&t&&this.setSubtitle()},canvasOffsetPosition(){this.showTriggerNodeTooltip&&(this.showTriggerNodeTooltip=!1,setTimeout(()=>{this.showTriggerNodeTooltip=this.shouldShowTriggerTooltip},200)),this.pinDataDiscoveryTooltipVisible&&(this.pinDataDiscoveryTooltipVisible=!1,setTimeout(()=>{this.pinDataDiscoveryTooltipVisible=!0},200))},shouldShowTriggerTooltip(e){e?setTimeout(()=>{this.showTriggerNodeTooltip=this.shouldShowTriggerTooltip},2500):this.showTriggerNodeTooltip=!1},nodeRunData(e){this.data&&this.$emit("run",{name:this.data.name,data:e,waiting:!!this.waiting})}},created(){Re(Kt).value||(this.unwatchWorkflowDataItems=this.$watch("workflowDataItems",t=>{this.showPinDataDiscoveryTooltip(t)}))},mounted(){setTimeout(()=>{this.setSubtitle()},0),this.nodeRunData&&setTimeout(()=>{this.$emit("run",{name:this.data&&this.data.name,data:this.nodeRunData,waiting:!!this.waiting})},0)},methods:{showPinDataDiscoveryTooltip(e){!this.isTriggerNode||this.isManualTypeNode||this.isScheduledGroup||this.uiStore.isAnyModalOpen||e===0||(Re(Kt).value="true",this.pinDataDiscoveryTooltipVisible=!0,this.unwatchWorkflowDataItems())},setSubtitle(){if(!(!this.data||!this.nodeType))try{const e=this.nodeHelpers.getNodeSubtitle(this.data,this.nodeType,this.workflow)??"";this.nodeSubtitle=e.includes(li)?"":e}catch{}},disableNode(){this.data!==null&&(this.nodeHelpers.disableNodes([this.data]),this.historyStore.pushCommandToUndo(new di(this.data.name,!this.data.disabled,this.data.disabled===!0)),this.$telemetry.track("User clicked node hover button",{node_type:this.data.type,button_name:"disable",workflow_id:this.workflowsStore.workflowId}))},executeNode(){var e,t;this.$emit("runWorkflow",(e=this.data)==null?void 0:e.name,"Node.executeNode"),this.$telemetry.track("User clicked node hover button",{node_type:(t=this.data)==null?void 0:t.type,button_name:"execute",workflow_id:this.workflowsStore.workflowId})},deleteNode(){var e,t;this.$telemetry.track("User clicked node hover button",{node_type:(e=this.data)==null?void 0:e.type,button_name:"delete",workflow_id:this.workflowsStore.workflowId}),this.$emit("removeNode",(t=this.data)==null?void 0:t.name)},toggleDisableNode(e){var t;e.currentTarget.blur(),this.$telemetry.track("User clicked node hover button",{node_type:(t=this.data)==null?void 0:t.type,button_name:"disable",workflow_id:this.workflowsStore.workflowId}),this.$emit("toggleDisableNode",this.data)},onClick(e){this.callDebounced(this.onClickDebounced,{debounceTime:50,trailing:!0},e)},onClickDebounced(...e){const t=e[0];t.detail>=2?this.setNodeActive():this.mouseLeftClick(t)},setNodeActive(){this.ndvStore.activeNodeName=this.data?this.data.name:"",this.pinDataDiscoveryTooltipVisible=!1},touchStart(){this.deviceSupport.isTouchDevice&&!this.deviceSupport.isMacOs&&!this.isTouchActive&&(this.isTouchActive=!0,setTimeout(()=>{this.isTouchActive=!1},2e3))},openContextMenu(e,t){this.data&&this.contextMenu.open(e,{source:t,node:this.data})}}}),Rn=e=>(Dn("data-v-ef66b845"),e=e(),Cn(),e),ep=["id","data-name","data-node-type"],tp={class:"select-background"},op={key:0,class:"trigger-icon"},np=["innerHTML"],sp={key:0,class:"node-issues","data-test-id":"node-issues"},ip={key:1,class:"waiting"},ap=["textContent"],rp={key:2,class:"node-pin-data-icon"},lp={key:0,class:"items-count"},dp={key:3},up={key:4,class:"data-count"},cp={key:0,class:"items-count"},hp=["title"],pp={class:"node-trigger-tooltip__wrapper"},fp=["textContent"],mp=Rn(()=>h("span",null,null,-1)),gp=Rn(()=>h("span",null,null,-1)),yp={class:"node-description"},wp=["title"],vp={"data-test-id":"canvas-node-box-title"},Np={key:0},kp=["title"],bp={class:"node-options-inner"};function Tp(e,t,o,n,s,i){var g;const l=D("FontAwesomeIcon"),r=D("n8n-tooltip"),a=D("TitledList"),u=D("NodeIcon"),c=D("n8n-icon-button"),p=ht("touch");return e.data?(d(),k("div",{key:0,id:e.nodeId,ref:e.data.name,class:T(e.nodeWrapperClass),style:ie(e.nodeWrapperStyles),"data-test-id":"canvas-node","data-name":e.data.name,"data-node-type":(g=e.nodeType)==null?void 0:g.name,onContextmenu:t[4]||(t[4]=m=>e.openContextMenu(m,"node-right-click"))},[ee(h("div",tp,null,512),[[de,e.isSelected]]),h("div",{class:T({"node-default":!0,"touch-active":e.isTouchActive,"is-touch-device":e.deviceSupport.isTouchDevice,"menu-open":e.isContextMenuOpen,"disable-pointer-events":e.disablePointerEvents})},[ee((d(),k("div",{class:T(e.nodeClass),style:ie(e.nodeStyle),onClick:t[0]||(t[0]=fe((...m)=>e.onClick&&e.onClick(...m),["left"]))},[e.isTriggerNode?(d(),k("i",op,[v(r,{placement:"bottom"},{content:b(()=>[h("span",{innerHTML:e.$locale.baseText("node.thisIsATriggerNode")},null,8,np)]),default:b(()=>[v(l,{icon:"bolt",size:"lg"})]),_:1})])):E("",!0),e.data.disabled?E("",!0):(d(),k("div",{key:1,class:T({"node-info-icon":!0,"shift-icon":e.shiftOutputCount})},[e.hasIssues&&!e.hideNodeIssues?(d(),k("div",sp,[v(r,{"show-after":500,placement:"bottom"},{content:b(()=>[v(a,{title:`${e.$locale.baseText("node.issues")}:`,items:e.nodeIssues},null,8,["title","items"])]),default:b(()=>[v(l,{icon:"exclamation-triangle"})]),_:1})])):e.waiting||e.nodeExecutionStatus==="waiting"?(d(),k("div",ip,[v(r,{placement:"bottom"},{content:b(()=>[h("div",{textContent:N(e.waiting)},null,8,ap)]),default:b(()=>[v(l,{icon:"clock"})]),_:1})])):e.showPinnedDataInfo?(d(),k("span",rp,[v(l,{icon:"thumbtack"}),e.workflowDataItems>1?(d(),k("span",lp,N(e.workflowDataItems),1)):E("",!0)])):e.nodeExecutionStatus==="unknown"?(d(),k("span",dp)):e.workflowDataItems?(d(),k("span",up,[v(l,{icon:"check"}),e.workflowDataItems>1?(d(),k("span",cp,N(e.workflowDataItems),1)):E("",!0)])):E("",!0)],2)),h("div",{class:"node-executing-info",title:e.$locale.baseText("node.nodeIsExecuting")},[v(l,{icon:"sync-alt",spin:""})],8,hp),h("div",pp,[v(r,{placement:"top","show-after":500,visible:e.showTriggerNodeTooltip,"popper-class":"node-trigger-tooltip__wrapper--item"},{content:b(()=>[h("div",{textContent:N(e.getTriggerNodeTooltip)},null,8,fp)]),default:b(()=>[mp]),_:1},8,["visible"]),e.isTriggerNode?(d(),O(r,{key:0,placement:"top",visible:e.pinDataDiscoveryTooltipVisible,"popper-class":"node-trigger-tooltip__wrapper--item"},{content:b(()=>[R(N(e.$locale.baseText("node.discovery.pinData.canvas")),1)]),default:b(()=>[gp]),_:1},8,["visible"])):E("",!0)]),v(u,{class:"node-icon","node-type":e.iconNodeType,size:40,shrink:!1,"color-default":e.iconColorDefault,disabled:e.data.disabled},null,8,["node-type","color-default","disabled"])],6)),[[p,e.touchStart,"start"],[p,e.touchEnd,"end"]]),e.showDisabledLinethrough?(d(),k("div",{key:0,class:T({"disabled-linethrough":!0,success:!["unknown"].includes(e.nodeExecutionStatus)&&e.workflowDataItems>0})},null,2)):E("",!0)],2),h("div",yp,[h("div",{class:"node-name",title:e.nodeTitle},[h("p",vp,N(e.nodeTitle),1),e.data.disabled?(d(),k("p",Np,"("+N(e.$locale.baseText("node.disabled"))+")",1)):E("",!0)],8,wp),e.nodeSubtitle!==void 0?(d(),k("div",{key:0,class:"node-subtitle",title:e.nodeSubtitle},N(e.nodeSubtitle),9,kp)):E("",!0)]),e.isReadOnly?E("",!0):ee((d(),k("div",{key:0,class:"node-options no-select-on-click",onContextmenu:t[2]||(t[2]=fe(()=>{},["stop"])),onMousedown:t[3]||(t[3]=fe(()=>{},["stop"]))},[h("div",bp,[e.isConfigNode?E("",!0):(d(),O(c,{key:0,"data-test-id":"execute-node-button",type:"tertiary",text:"",size:"small",icon:"play",disabled:e.workflowRunning,title:e.$locale.baseText("node.testStep"),onClick:e.executeNode},null,8,["disabled","title","onClick"])),v(c,{"data-test-id":"disable-node-button",type:"tertiary",text:"",size:"small",icon:"power-off",title:e.nodeDisabledTitle,onClick:e.toggleDisableNode},null,8,["title","onClick"]),v(c,{"data-test-id":"delete-node-button",type:"tertiary",size:"small",text:"",icon:"trash",title:e.$locale.baseText("node.delete"),onClick:e.deleteNode},null,8,["title","onClick"]),v(c,{"data-test-id":"overflow-node-button",type:"tertiary",size:"small",text:"",icon:"ellipsis-h",onClick:t[1]||(t[1]=m=>e.openContextMenu(m,"node-button"))})])],544)),[[de,!e.hideActions]])],46,ep)):E("",!0)}const Sp=Z(Zh,[["render",Tp],["__scopeId","data-v-ef66b845"]]),Dp=Q({name:"Sticky",mixins:[On],props:{nodeViewScale:{type:Number,default:1},gridSize:{type:Number,default:dt}},emits:{removeNode:null,nodeSelected:null},setup(){const e=Me(),t=qe(),o=K(),n=K(!1),s=l=>{n.value=l},i=pt(l=>{var r;l==="change_color"&&(s(!0),(r=o.value)==null||r.click())});return{deviceSupport:e,toast:t,colorPopoverTrigger:o,contextMenu:i,forceActions:n,setForceActions:s}},data(){return{isResizing:!1,isTouchActive:!1}},computed:{...ve(ue,ae,Ne,oe),defaultText(){if(!this.nodeType)return"";const t=this.nodeType.properties.find(o=>o.name==="content");return t&&Bt(t.default)?t.default:""},isSelected(){return this.uiStore.getSelectedNodes.find(e=>e.name===this.data.name)!==void 0},nodeType(){return this.data&&this.nodeTypesStore.getNodeType(this.data.type,this.data.typeVersion)},node(){return this.workflowsStore.getNodeByName(this.name)},position(){return this.node?this.node.position:[0,0]},height(){return this.node&&vt(this.node.parameters.height)?this.node.parameters.height:0},width(){return this.node&&vt(this.node.parameters.width)?this.node.parameters.width:0},stickySize(){return{height:this.height+"px",width:this.width+"px"}},stickyPosition(){return{left:this.position[0]+"px",top:this.position[1]+"px",zIndex:this.isActive?9999999:-1*Math.floor(this.height*this.width/1e3)}},showActions(){return!(this.hideActions||this.isReadOnly||this.workflowRunning||this.isResizing)||this.forceActions},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")}},methods:{onShowPopover(){this.setForceActions(!0)},onHidePopover(){this.setForceActions(!1)},async deleteNode(){ui(this.data),await this.$nextTick(),this.$emit("removeNode",this.data.name)},changeColor(e){var t,o;this.workflowsStore.updateNodeProperties({name:this.name,properties:{parameters:{...(t=this.node)==null?void 0:t.parameters,color:e},position:((o=this.node)==null?void 0:o.position)??[0,0]}})},onEdit(e){e&&!this.isActive&&this.node?this.ndvStore.activeNodeName=this.node.name:this.isActive&&!e&&(this.ndvStore.activeNodeName=null)},onMarkdownClick(e){if(e){const t=this.name===bn,o=e.querySelector('img[alt="n8n quickstart video"'),n=t&&o?"welcome_video":t&&e.getAttribute("href")==="/templates"?"templates":"other";this.$telemetry.track("User clicked note link",{type:n})}},onInputChange(e){this.node&&(this.node.parameters.content=e,this.setParameters({content:e}))},onResizeStart(){this.isResizing=!0,!this.isSelected&&this.node&&this.$emit("nodeSelected",this.node.name,!1,!0)},onResize({height:e,width:t,dX:o,dY:n}){this.node&&((o!==0||n!==0)&&this.setPosition([this.node.position[0]+(o||0),this.node.position[1]+(n||0)]),this.setParameters({height:e,width:t}))},onResizeEnd(){this.isResizing=!1},setParameters(e){if(this.node){const t={content:Bt(e.content)?e.content:this.node.parameters.content,height:vt(e.height)?e.height:this.node.parameters.height,width:vt(e.width)?e.width:this.node.parameters.width,color:Bt(e.color)?e.color:this.node.parameters.color},o={key:this.node.id,name:this.node.name,value:t};this.workflowsStore.setNodeParameters(o)}},setPosition(e){if(!this.node)return;const t={name:this.node.name,properties:{position:e}};this.workflowsStore.updateNodeProperties(t)},touchStart(){this.deviceSupport.isTouchDevice&&!this.deviceSupport.isMacOs&&!this.isTouchActive&&(this.isTouchActive=!0,setTimeout(()=>{this.isTouchActive=!1},2e3))},onContextMenu(e){this.node&&!this.isActive?this.contextMenu.open(e,{source:"node-right-click",node:this.node}):e.stopPropagation()}}}),Cp=["id","data-name"],Ep={class:"select-sticky-background"},Ip=["title"],Pp=["title"],_p={class:"content"},$p=["onClick"];function Op(e,t,o,n,s,i){var c,p;const l=D("n8n-sticky"),r=D("font-awesome-icon"),a=D("n8n-popover"),u=ht("touch");return d(),k("div",{id:e.nodeId,ref:(c=e.data)==null?void 0:c.name,class:"sticky-wrapper",style:ie(e.stickyPosition),"data-name":(p=e.data)==null?void 0:p.name,"data-test-id":"sticky"},[h("div",{class:T({"sticky-default":!0,"touch-active":e.isTouchActive,"is-touch-device":e.deviceSupport.isTouchDevice,"is-read-only":e.isReadOnly}),style:ie(e.stickySize)},[ee(h("div",Ep,null,512),[[de,e.isSelected]]),ee((d(),k("div",{class:"sticky-box",onClick:t[0]||(t[0]=fe((...g)=>e.mouseLeftClick&&e.mouseLeftClick(...g),["left"])),onContextmenu:t[1]||(t[1]=(...g)=>e.onContextMenu&&e.onContextMenu(...g))},[e.node?(d(),O(l,{key:0,id:e.node.id,"model-value":e.node.parameters.content,height:e.node.parameters.height,width:e.node.parameters.width,scale:e.nodeViewScale,"background-color":e.node.parameters.color,"read-only":e.isReadOnly,"default-text":e.defaultText,"edit-mode":e.isActive&&!e.isReadOnly,"grid-size":e.gridSize,onEdit:e.onEdit,onResizestart:e.onResizeStart,onResize:e.onResize,onResizeend:e.onResizeEnd,onMarkdownClick:e.onMarkdownClick,"onUpdate:modelValue":e.onInputChange},null,8,["id","model-value","height","width","scale","background-color","read-only","default-text","edit-mode","grid-size","onEdit","onResizestart","onResize","onResizeend","onMarkdownClick","onUpdate:modelValue"])):E("",!0)],32)),[[u,e.touchStart,"start"],[u,e.touchEnd,"end"]]),ee(h("div",{class:T({"sticky-options":!0,"no-select-on-click":!0,"force-show":e.forceActions})},[ee((d(),k("div",{class:"option","data-test-id":"delete-sticky",title:e.$locale.baseText("node.delete")},[v(r,{icon:"trash"})],8,Ip)),[[u,e.deleteNode,"tap"]]),v(a,{effect:"dark","popper-style":{width:"208px"},trigger:"click",placement:"top",onShow:e.onShowPopover,onHide:e.onHidePopover},{reference:b(()=>[h("div",{ref:"colorPopoverTrigger",class:"option","data-test-id":"change-sticky-color",title:e.$locale.baseText("node.changeColor")},[v(r,{icon:"palette"})],8,Pp)]),default:b(()=>[h("div",_p,[(d(!0),k(se,null,he(Array.from({length:7}),(g,m)=>{var y,S;return d(),k("div",{key:m,class:T(["color",`sticky-color-${m+1}`]),"data-test-id":"color",style:ie({"border-width":"1px","border-style":"solid","border-color":"var(--color-foreground-xdark)","background-color":`var(--color-sticky-background-${m+1})`,"box-shadow":m===0&&((y=e.node)==null?void 0:y.parameters.color)===""||m+1===((S=e.node)==null?void 0:S.parameters.color)?`0 0 0 1px var(--color-sticky-background-${m+1})`:"none"}),onClick:w=>e.changeColor(m+1)},null,14,$p)}),128))])]),_:1},8,["onShow","onHide"])],2),[[de,e.showActions]])],6)],12,Cp)}const Rp=Z(Dp,[["render",Op],["__scopeId","data-v-3103467d"]]),Mp=["textContent"],Ap=Q({__name:"CanvasAddButton",props:{showTooltip:{type:Boolean},position:{}},setup(e){const t=e,o=Gt(),n=W(()=>({"--trigger-placeholder-left-position":`${t.position[0]}px`,"--trigger-placeholder-top-position":`${t.position[1]}px`}));return(s,i)=>{const l=D("font-awesome-icon"),r=D("n8n-tooltip");return d(),k("div",{ref:"container",class:T(s.$style.canvasAddButton),style:ie(n.value),"data-test-id":"canvas-add-button"},[v(r,{placement:"top",visible:s.showTooltip,disabled:j(o).showScrim,"popper-class":s.$style.tooltip,"show-after":700},{content:b(()=>[R(N(s.$locale.baseText("nodeView.canvasAddButton.addATriggerNodeBeforeExecuting")),1)]),default:b(()=>[h("button",{class:T(s.$style.button),"data-test-id":"canvas-plus-button",onClick:i[0]||(i[0]=a=>s.$emit("click"))},[v(l,{icon:"plus",size:"lg"})],2)]),_:1},8,["visible","disabled","popper-class"]),h("p",{class:T(s.$style.label),textContent:N(s.$locale.baseText("nodeView.canvasAddButton.addFirstStep"))},null,10,Mp)],6)}}}),Wp="_canvasAddButton_1easi_1",Vp="_button_1easi_13",Bp="_label_1easi_34",Up={canvasAddButton:Wp,button:Vp,label:Bp},Lp={$style:Up},xp=Z(Ap,[["__cssModules",Lp]]),Hp=["onClick"],Fp=Q({__name:"NextStepPopup",emits:["optionSelected"],setup(e,{emit:t}){const o=Tn(),n=We(),s=to(),i=t,l=W(()=>o.assistantChatOpen),r=W(()=>o.nextStepPopupConfig.title),a=W(()=>[{label:n.baseText("nextStepPopup.option.choose"),icon:"➕",key:"choose",disabled:!1},{label:n.baseText("nextStepPopup.option.generate"),icon:"✨",key:"generate",disabled:l.value}]),u=W(()=>[o.nextStepPopupConfig.position[0],o.nextStepPopupConfig.position[1]]),c=W(()=>({left:`${u.value[0]}px`,top:`${u.value[1]}px`})),p=()=>{o.closeNextStepPopup()},g=m=>{m==="choose"?i("optionSelected",m):m==="generate"&&(s.track("User clicked generate AI button",{},{withPostHog:!0}),o.assistantChatOpen=!0),p()};return(m,y)=>{const S=ht("on-click-outside");return ee((d(),k("div",{class:T(m.$style.container),style:ie(c.value)},[h("div",{class:T(m.$style.title)},N(r.value),3),h("ul",{class:T(m.$style.options)},[(d(!0),k(se,null,he(a.value,w=>(d(),k("li",{key:w.key,class:T({[m.$style.option]:!0,[m.$style.disabled]:w.disabled}),onClick:C=>g(w.key)},[h("div",{class:T(m.$style.icon)},N(w.icon),3),h("div",{class:T(m.$style.label)},N(w.label),3)],10,Hp))),128))],2)],6)),[[S,p]])}}}),zp="_container_1bss5_1",qp="_title_1bss5_33",jp="_options_1bss5_39",Kp="_option_1bss5_39",Yp="_disabled_1bss5_57",Gp={container:zp,title:qp,options:jp,option:Kp,disabled:Yp},Jp={$style:Gp},Xp=Z(Fp,[["__cssModules",Jp]]);function Qp(e,t={}){const o=Ne(),n=K([0,0]),s=Me();function i(u){const c=o.nodeViewOffsetPosition,[p,g]=Pt(u),m=c[0]+(p-n.value[0]),y=c[1]+(g-n.value[1]);return o.nodeViewOffsetPosition=[m,y],n.value=[p,g],[m,y]}function l(u,c){if(!(s.isCtrlKeyPressed(u)||c)||o.isActionActive("dragActive"))return;u.button!==ci.MIDDLE&&(o.nodeViewMoveInProgress=!0);const[p,g]=Pt(u);n.value=[p,g];const m=j(e);m==null||m.addEventListener("mousemove",a)}function r(){if(!o.nodeViewMoveInProgress)return;const u=j(e);u==null||u.removeEventListener("mousemove",a),o.nodeViewMoveInProgress=!1}function a(u){const c=j(e);if(!(u.target&&!(c===u.target||c!=null&&c.contains(u.target)))&&!o.isActionActive("dragActive")){if(u instanceof MouseEvent&&u.buttons===Vo.MIDDLE&&(o.nodeViewMoveInProgress=!0),u instanceof MouseEvent&&u.buttons===Vo.NONE){const p=j(t.onMouseMoveEnd);p==null||p(u);return}i(u)}}return{moveLastPosition:n,onMouseDown:l,onMouseUp:r,onMouseMove:a,panCanvas:i}}const Zp=Ve(async()=>await Ae(()=>import("./NodeCreation-DHuCOx3T.js").then(e=>e.N),__vite__mapDeps([51,2,3,4,5,6,7,8,9,1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,41,52]))),ef=Ve(async()=>await Ae(()=>import("./CanvasControls-CQPytmej.js"),__vite__mapDeps([53,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,54]))),tf=Ve(async()=>await Ae(()=>import("./SetupWorkflowCredentialsButton-DkvMQv2u.js"),__vite__mapDeps([55,9,6,1,2,3,4,5,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]))),of=Q({name:"NodeView",components:{NodeDetailsView:Fh,Node:Sp,Sticky:Rp,CanvasAddButton:xp,KeyboardShortcutTooltip:hi,NodeCreation:Zp,CanvasControls:ef,ContextMenu:Gh,SetupWorkflowCredentialsButton:tf,NextStepPopup:Xp},async beforeRouteLeave(e,t,o){if(Nt(e)===st.EXECUTIONS||t.name===te.TEMPLATE_IMPORT||Nt(e)===st.WORKFLOW&&t.name===te.EXECUTION_DEBUG){o();return}if(this.uiStore.stateIsDirty&&!this.readOnlyEnv){const n=await this.confirm(this.$locale.baseText("generic.unsavedWork.confirmMessage.message"),{title:this.$locale.baseText("generic.unsavedWork.confirmMessage.headline"),type:"warning",confirmButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.confirmButtonText"),cancelButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.cancelButtonText"),showClose:!0});n===et?(this.workflowsStore.setWorkflowId(it),await this.workflowHelpers.saveCurrentWorkflow({},!1)&&await this.settingsStore.fetchPromptsData(),this.uiStore.stateIsDirty=!1,t.name===te.NEW_WORKFLOW?(await this.$router.replace({name:te.WORKFLOW,params:{name:this.currentWorkflow}}),await this.$router.push(e)):(this.collaborationStore.notifyWorkflowClosed(this.currentWorkflow),o())):n===Bo&&(this.collaborationStore.notifyWorkflowClosed(this.currentWorkflow),this.workflowsStore.setWorkflowId(it),this.resetWorkspace(),this.uiStore.stateIsDirty=!1,o())}else this.collaborationStore.notifyWorkflowClosed(this.currentWorkflow),o()},setup(){const e=K(null),t=K(null),o=K(null),n=ct(),s=ae(),i=ze(),l=We(),r=pt(),a=na(),u=je(),c=oo(),{activeNode:p}=Qt(s),g=Ce(p),m=Me(),{callDebounced:y}=Ot(),S=Qp(e,{onMouseMoveEnd:o}),w=$t({router:n}),{runWorkflow:C,stopCurrentExecution:I}=mn({router:n});return{locale:l,contextMenu:r,dataSchema:a,nodeHelpers:u,externalHooks:i,clipboard:c,pinnedData:g,deviceSupport:m,canvasPanning:S,nodeViewRootRef:e,nodeViewRef:t,onMouseMoveEnd:o,workflowHelpers:w,runWorkflow:C,stopCurrentExecution:I,callDebounced:y,...ba(),...pi(),...fi(),...qe(),...no(),...Ta(),...ca()}},data(){return{GRID_SIZE:dt,STICKY_NODE_TYPE:ke,createNodeActive:!1,lastClickPosition:[450,450],ctrlKeyPressed:!1,moveCanvasKeyPressed:!1,stopExecutionInProgress:!1,blankRedirect:!1,credentialsUpdated:!1,pullConnActiveNodeName:null,pullConnActive:!1,dropPrevented:!1,connectionDragScope:{type:null,connection:null},renamingActive:!1,showStickyButton:!1,isExecutionPreview:!1,showTriggerMissingTooltip:!1,workflowData:null,activeConnection:null,isInsertingNodes:!1,isProductionExecutionPreview:!1,enterTimer:void 0,exitTimer:void 0,readOnlyNotification:null,suspendRecordingDetachedConnections:!1,NODE_CREATOR_OPEN_SOURCES:ye,eventsAttached:!1,unloadTimeout:void 0,canOpenNDV:!0,hideNodeIssues:!1}},computed:{...ve(eo,ki,yn,Gt,ue,ae,ro,Nn,Ni,Ne,oe,vi,Gt,wi,gn,ao,yi,va,wa,Zt,gi,mi,Tn),nativelyNumberSuffixedDefaults(){return this.nodeTypesStore.nativelyNumberSuffixedDefaults},currentUser(){return this.usersStore.currentUser},activeNode(){return this.ndvStore.activeNode},executionWaitingForWebhook(){return this.workflowsStore.executionWaitingForWebhook},isDemo(){return this.$route.name===te.DEMO},showCanvasAddButton(){return!this.isLoading&&!this.containsTrigger&&!this.isDemo&&!this.readOnlyEnv},lastSelectedNode(){return this.uiStore.getLastSelectedNode},nodes(){return this.workflowsStore.allNodes},nodesToRender(){return this.workflowsStore.allNodes.filter(e=>e.type!==ke)},stickiesToRender(){return this.workflowsStore.allNodes.filter(e=>e.type===ke)},runButtonText(){return this.workflowRunning?this.executionWaitingForWebhook?this.$locale.baseText("nodeView.runButtonText.waitingForTriggerEvent"):this.$locale.baseText("nodeView.runButtonText.executingWorkflow"):this.$locale.baseText("nodeView.runButtonText.executeWorkflow")},workflowStyle(){const e=this.uiStore.nodeViewOffsetPosition;return{left:e[0]+"px",top:e[1]+"px"}},canvasAddButtonStyle(){return{"pointer-events":this.createNodeActive?"none":"all"}},backgroundStyle(){return bi(this.nodeViewScale,this.uiStore.nodeViewOffsetPosition,this.isExecutionPreview)},workflowClasses(){const e=[];return(this.ctrlKeyPressed||this.moveCanvasKeyPressed)&&(this.uiStore.nodeViewMoveInProgress?e.push("move-in-process"):e.push("move-active")),(this.selectActive||this.ctrlKeyPressed||this.moveCanvasKeyPressed)&&e.push("do-not-select"),this.connectionDragScope.type&&(e.push("connection-drag-scope-active"),e.push(`connection-drag-scope-active-type-${this.connectionDragScope.type}`),e.push(`connection-drag-scope-active-connection-${this.connectionDragScope.connection}`)),e},workflowExecution(){return this.workflowsStore.getWorkflowExecution},workflowRunning(){return this.uiStore.isActionActive("workflowRunning")},currentWorkflow(){var e;return((e=this.$route.params.name)==null?void 0:e.toString())||this.workflowsStore.workflowId},workflowName(){return this.workflowsStore.workflowName},allTriggersDisabled(){return this.triggerNodes.filter(t=>t.disabled).length===this.triggerNodes.length},triggerNodes(){return this.nodes.filter(e=>e.type===lo||this.nodeTypesStore.isTriggerNode(e.type))},containsTrigger(){return this.triggerNodes.length>0},containsChatNodes(){return!this.executionWaitingForWebhook&&!!this.nodes.find(e=>[Ti,He].includes(e.type)&&e.disabled!==!0)},isManualChatOnly(){return this.canvasChatNode?this.containsChatNodes&&this.triggerNodes.length===1&&!this.pinnedChatNodeData:!1},canvasChatNode(){return this.nodes.find(e=>e.type===He)},pinnedChatNodeData(){return this.canvasChatNode?this.workflowsStore.pinDataByNodeName(this.canvasChatNode.name):null},isExecutionDisabled(){return this.containsChatNodes&&this.triggerNodes.every(e=>e.disabled||e.type===He)&&!this.pinnedChatNodeData?!0:!this.containsTrigger||this.allTriggersDisabled},getNodeViewOffsetPosition(){return this.uiStore.nodeViewOffsetPosition},nodeViewScale(){return this.canvasStore.nodeViewScale},instance(){return this.canvasStore.jsPlumbInstance},isLoading(){return this.canvasStore.isLoading},currentWorkflowObject(){return this.workflowsStore.getCurrentWorkflow()},readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},isReadOnlyRoute(){var e,t;return((t=(e=this.$route)==null?void 0:e.meta)==null?void 0:t.readOnlyCanvas)===!0},isNextStepPopupVisible(){return this.aiStore.nextStepPopupConfig.open},shouldShowNextStepDialog(){const e=Re(sa).value==="true",t=this.aiStore.isAssistantExperimentEnabled;return this.settingsStore.isCloudDeployment&&t&&!e}},watch:{async $route(e,t){this.readOnlyEnvRouteCheck();const o=Nt(e),n=!this.uiStore.nodeViewInitialized;let s=t.params.name!==e.params.name&&!(t.params.name==="new"&&this.currentWorkflow===it)&&t.name!==te.NEW_WORKFLOW&&e.params.action!=="workflowSave";const i=e.name===te.TEMPLATE_IMPORT;if(o===st.WORKFLOW||i){if(s||n||i){if(this.canvasStore.startLoading(),n){const l=this.uiStore.stateIsDirty;this.resetWorkspace(),this.uiStore.stateIsDirty=l}await this.initView(),this.canvasStore.stopLoading(),this.blankRedirect&&(this.blankRedirect=!1)}await this.checkAndInitDebugMode()}o===st.EXECUTIONS&&(s=t.params.name!==e.params.name&&!(e.params.name==="new"&&t.params.name===void 0),s&&(this.uiStore.nodeViewInitialized=!1))},activeNode(){this.createNodeActive=!1},containsTrigger(e){e===!1&&this.canvasStore.setRecenteredCanvasAddButtonPosition(this.getNodeViewOffsetPosition)},nodeViewScale(e){const t=this.nodeViewRef;t&&(t.style.transform=`scale(${e})`)}},errorCaptured:e=>{console.error("errorCaptured"),console.error(e)},async mounted(){var t;if(this.onMouseMoveEnd=this.mouseUp,this.resetWorkspace(),!this.nodeViewRef){this.showError(new Error("NodeView reference not found"),this.$locale.baseText("nodeView.showError.mounted1.title"),this.$locale.baseText("nodeView.showError.mounted1.message")+":");return}this.canvasStore.initInstance(this.nodeViewRef),this.titleReset(),window.addEventListener("message",this.onPostMessageReceived),this.clipboard.onPaste.value=this.onClipboardPasteEvent,this.canvasStore.startLoading();const e=(()=>{if(this.settingsStore.isPreviewMode&&this.isDemo)return[];const o=[this.loadActiveWorkflows(),this.loadCredentialTypes()];return this.settingsStore.isEnterpriseFeatureEnabled(It.Variables)&&o.push(this.loadVariables()),this.settingsStore.isEnterpriseFeatureEnabled(It.ExternalSecrets)&&o.push(this.loadSecrets()),o})();this.nodeTypesStore.allNodeTypes.length===0&&e.push(this.loadNodeTypes());try{await Promise.all(e)}catch(o){this.showError(o,this.$locale.baseText("nodeView.showError.mounted1.title"),this.$locale.baseText("nodeView.showError.mounted1.message")+":");return}if(Na(async()=>{try{try{this.bindCanvasEvents()}catch{}await this.initView(),window.parent&&window.parent.postMessage(JSON.stringify({command:"n8nReady",version:this.rootStore.versionCli}),"*")}catch(o){this.showError(o,this.$locale.baseText("nodeView.showError.mounted2.title"),this.$locale.baseText("nodeView.showError.mounted2.message")+":")}this.canvasStore.stopLoading(),setTimeout(()=>{this.usersStore.showPersonalizationSurvey(),this.addPinDataConnections(this.workflowsStore.pinnedWorkflowData||{})},0)}),this.externalHooks.run("nodeView.mount").catch(()=>{}),((t=this.currentUser)==null?void 0:t.personalizationAnswers)!==null&&this.settingsStore.onboardingCallPromptEnabled&&this.currentUser&&Si(this.currentUser)<=Di){const o=await this.uiStore.getNextOnboardingPrompt(),n=(o==null?void 0:o.toast_sequence_number)===1?Ci:1e3;o!=null&&o.title&&(o!=null&&o.description)&&setTimeout(async()=>{this.showToast({type:"info",title:o.title,message:o.description,duration:0,customClass:"clickable",closeOnClick:!0,onClick:()=>{this.$telemetry.track("user clicked onboarding toast",{seq_num:o.toast_sequence_number,title:o.title,description:o.description}),this.uiStore.openModal(Ei)}})},n)}Uo.on("pull",this.onSourceControlPull),this.registerCustomAction({key:"openNodeDetail",action:({node:o})=>{this.nodeSelectedByName(o,!0)}}),this.registerCustomAction({key:"openSelectiveNodeCreator",action:this.openSelectiveNodeCreator}),this.registerCustomAction({key:"showNodeCreator",action:()=>{this.ndvStore.activeNodeName=null,this.$nextTick(()=>{this.showTriggerCreator(ye.TAB)})}}),this.readOnlyEnvRouteCheck(),this.canvasStore.isDemo=this.isDemo},activated(){this.uiStore.addFirstStepOnLoad&&this.showTriggerCreator(ye.TRIGGER_PLACEHOLDER_BUTTON),this.uiStore.addFirstStepOnLoad=!1,this.bindCanvasEvents(),document.addEventListener("keydown",this.keyDown),document.addEventListener("keyup",this.keyUp),window.addEventListener("message",this.onPostMessageReceived),window.addEventListener("pageshow",this.onPageShow),pe.on("newWorkflow",this.newWorkflow),pe.on("importWorkflowData",this.onImportWorkflowDataEvent),pe.on("importWorkflowUrl",this.onImportWorkflowUrlEvent),pe.on("openChat",this.onOpenChat),we.on("nodeMove",this.onMoveNode),we.on("revertAddNode",this.onRevertAddNode),we.on("revertRemoveNode",this.onRevertRemoveNode),we.on("revertAddConnection",this.onRevertAddConnection),we.on("revertRemoveConnection",this.onRevertRemoveConnection),we.on("revertRenameNode",this.onRevertNameChange),we.on("enableNodeToggle",this.onRevertEnableToggle),$e.on("pin-data",this.addPinDataConnections),$e.on("unpin-data",this.removePinDataConnections),pe.on("saveWorkflow",this.saveCurrentWorkflowExternal),this.canvasStore.isDemo=this.isDemo},deactivated(){this.unbindCanvasEvents(),document.removeEventListener("keydown",this.keyDown),document.removeEventListener("keyup",this.keyUp),window.removeEventListener("message",this.onPostMessageReceived),window.removeEventListener("beforeunload",this.onBeforeUnload),window.removeEventListener("pageshow",this.onPageShow),pe.off("newWorkflow",this.newWorkflow),pe.off("importWorkflowData",this.onImportWorkflowDataEvent),pe.off("importWorkflowUrl",this.onImportWorkflowUrlEvent),pe.off("openChat",this.onOpenChat),we.off("nodeMove",this.onMoveNode),we.off("revertAddNode",this.onRevertAddNode),we.off("revertRemoveNode",this.onRevertRemoveNode),we.off("revertAddConnection",this.onRevertAddConnection),we.off("revertRemoveConnection",this.onRevertRemoveConnection),we.off("revertRenameNode",this.onRevertNameChange),we.off("enableNodeToggle",this.onRevertEnableToggle),$e.off("pin-data",this.addPinDataConnections),$e.off("unpin-data",this.removePinDataConnections),pe.off("saveWorkflow",this.saveCurrentWorkflowExternal)},beforeMount(){this.isDemo||this.pushStore.pushConnect(),this.collaborationStore.initialize()},beforeUnmount(){document.removeEventListener("keydown",this.keyDown),document.removeEventListener("keyup",this.keyUp),this.unregisterCustomAction("showNodeCreator"),this.unregisterCustomAction("openNodeDetail"),this.unregisterCustomAction("openSelectiveNodeCreator"),this.isDemo||this.pushStore.pushDisconnect(),this.collaborationStore.terminate(),this.resetWorkspace(),this.instance.unbind(),this.instance.destroy(),this.uiStore.stateIsDirty=!1,this.workflowsStore.resetChatMessages(),window.removeEventListener("message",this.onPostMessageReceived),pe.off("newWorkflow",this.newWorkflow),pe.off("importWorkflowData",this.onImportWorkflowDataEvent),pe.off("importWorkflowUrl",this.onImportWorkflowUrlEvent),this.workflowsStore.setWorkflowId(it),Uo.off("pull",this.onSourceControlPull)},methods:{async openSelectiveNodeCreator({connectiontype:e,node:t,creatorview:o}){const n=t??this.ndvStore.activeNodeName,s=n?this.workflowsStore.getNodeByName(n):null;this.ndvStore.activeNodeName=null,await this.redrawNode(t),setTimeout(()=>{o?this.onToggleNodeCreator({createNodeActive:!0,nodeCreatorView:o}):e&&s&&this.insertNodeAfterSelected({index:0,endpointUuid:`${s.id}-input${e}0`,eventSource:ye.NOTICE_ERROR_MESSAGE,outputType:e,sourceId:s.id})})},editAllowedCheck(){return this.readOnlyNotification?!1:this.isReadOnlyRoute||this.readOnlyEnv?(this.readOnlyNotification=this.showMessage({title:this.$locale.baseText(this.readOnlyEnv?`readOnlyEnv.showMessage.${this.isReadOnlyRoute?"executions":"workflows"}.title`:"readOnly.showMessage.executions.title"),message:this.$locale.baseText(this.readOnlyEnv?`readOnlyEnv.showMessage.${this.isReadOnlyRoute?"executions":"workflows"}.message`:"readOnly.showMessage.executions.message"),type:"info",dangerouslyUseHTMLString:!0,onClose:()=>{this.readOnlyNotification=null}}),!1):!0},showTriggerMissingToltip(e){this.showTriggerMissingTooltip=e},onRunNode(e,t){const o=this.workflowsStore.getNodeByName(e),n={node_type:o?o.type:null,workflow_id:this.workflowsStore.workflowId,source:"canvas",push_ref:this.ndvStore.pushRef};this.$telemetry.track("User clicked execute node button",n),this.externalHooks.run("nodeView.onRunNode",n),this.runWorkflow({destinationNode:e,source:t})},async onOpenChat(){const e={workflow_id:this.workflowsStore.workflowId};this.$telemetry.track("User clicked chat open button",e),this.externalHooks.run("nodeView.onOpenChat",e),this.uiStore.openModal(Ii)},async onRunWorkflow(){this.workflowHelpers.getWorkflowDataToSave().then(e=>{const t={workflow_id:this.workflowsStore.workflowId,node_graph_string:JSON.stringify(Wt(e,this.workflowHelpers.getNodeTypes(),{isCloudDeployment:this.settingsStore.isCloudDeployment}).nodeGraph)};this.$telemetry.track("User clicked execute workflow button",t),this.externalHooks.run("nodeView.onRunWorkflow",t)}),await this.runWorkflow({}),this.refreshEndpointsErrorsState()},resetEndpointsErrors(){Object.values(this.instance.getManagedElements()).flatMap(t=>t.endpoints).filter(t=>(t==null?void 0:t.endpoint.type)===Pi).forEach(t=>{const o=t==null?void 0:t.endpoint;o&&((t==null?void 0:t.connections)??[]).length>0&&o.resetError()})},refreshEndpointsErrorsState(){const e=this.workflowsStore.allNodes.filter(t=>t.issues);this.resetEndpointsErrors(),e.forEach(t=>{var s;const o=this.instance.getManagedElement(t.id),n=this.instance.getEndpoints(o);Object.keys(((s=t==null?void 0:t.issues)==null?void 0:s.input)??{}).forEach(i=>{n.filter(r=>r._defaultType.scope===i).forEach(r=>{const a=r==null?void 0:r.endpoint;a&&a.setError()})})})},onRunContainerClick(){if(this.containsTrigger&&!this.allTriggersDisabled)return;const e=this.containsTrigger&&this.allTriggersDisabled?this.$locale.baseText("nodeView.addOrEnableTriggerNode"):this.$locale.baseText("nodeView.addATriggerNodeFirst"),t=this.showMessage({type:"info",title:this.$locale.baseText("nodeView.cantExecuteNoTrigger"),message:e,duration:3e3,onClick:()=>setTimeout(()=>{this.createNodeActive&&t.close()},0),dangerouslyUseHTMLString:!0})},clearExecutionData(){this.workflowsStore.workflowExecutionData=null,this.nodeHelpers.updateNodesExecutionIssues()},async onSaveKeyboardShortcut(e){let t=await this.workflowHelpers.saveCurrentWorkflow();t&&(await this.settingsStore.fetchPromptsData(),this.$route.name===te.EXECUTION_DEBUG&&await this.$router.replace({name:te.WORKFLOW,params:{name:this.currentWorkflow}})),this.activeNode&&(e.target instanceof HTMLInputElement?t=e.target.readOnly:t=!0,t&&this.showMessage({title:this.$locale.baseText("generic.workflowSaved"),type:"success"}))},async onCanvasAddButtonCLick(e){if(e){if(this.shouldShowNextStepDialog){const t=e.target.closest("button");t&&(this.aiStore.latestConnectionInfo=null,this.aiStore.openNextStepPopup(this.$locale.baseText("nextStepPopup.title.firstStep"),t));return}this.showTriggerCreator(ye.TRIGGER_PLACEHOLDER_BUTTON);return}},onNextStepSelected(e){if(e==="choose"){const t=this.aiStore.latestConnectionInfo;t===null?this.showTriggerCreator(ye.TRIGGER_PLACEHOLDER_BUTTON):this.insertNodeAfterSelected(t)}},showTriggerCreator(e){this.createNodeActive||(this.ndvStore.activeNodeName=null,this.nodeCreatorStore.setSelectedView(Ut),this.nodeCreatorStore.setShowScrim(!0),this.onToggleNodeCreator({source:e,createNodeActive:!0,nodeCreatorView:Ut}))},async openExecution(e){var o,n;this.canvasStore.startLoading(),this.resetWorkspace();let t;try{t=await this.workflowsStore.getExecution(e)}catch(s){this.showError(s,this.$locale.baseText("nodeView.showError.openExecution.title"));return}if(t===void 0)throw new Error(`Execution with id "${e}" could not be found!`);if(this.workflowsStore.setWorkflowName({newName:t.workflowData.name,setStateDirty:!1}),this.workflowsStore.setWorkflowId(it),this.workflowsStore.setWorkflowExecutionData(t),t.workflowData.pinData&&this.workflowsStore.setWorkflowPinData(t.workflowData.pinData),t.workflowData.sharedWithProjects&&this.workflowsEEStore.setWorkflowSharedWith({workflowId:t.workflowData.id,sharedWithProjects:t.workflowData.sharedWithProjects}),t.workflowData.usedCredentials&&this.workflowsStore.setUsedCredentials(t.workflowData.usedCredentials),await this.addNodes(xe(t.workflowData.nodes),xe(t.workflowData.connections)),await this.$nextTick(),this.canvasStore.zoomToFit(),this.uiStore.stateIsDirty=!1,this.externalHooks.run("execution.open",{workflowId:t.workflowData.id,workflowName:t.workflowData.name,executionId:e}),this.$telemetry.track("User opened read-only execution",{workflow_id:t.workflowData.id,execution_mode:t.mode,execution_finished:t.finished}),!t.finished&&((n=(o=t.data)==null?void 0:o.resultData)!=null&&n.error)){let s=!1;if(t.data.resultData.runData){const i=t.data.resultData.runData;e:for(const l of Object.keys(i))for(const r of i[l])if(r.error){s=!0;break e}}!s&&(t.data.resultData.error.stack||t.data.resultData.error.message)&&(console.error(`Execution ${e} error:`),console.error(t.data.resultData.error.stack),this.showMessage({title:this.$locale.baseText("nodeView.showError.workflowError"),message:t.data.resultData.error.message,type:"error",duration:0}))}t.waitTill&&this.showMessage({title:this.$locale.baseText("nodeView.thisExecutionHasntFinishedYet"),message:`<a data-action="reload">${this.$locale.baseText("nodeView.refresh")}</a> ${this.$locale.baseText("nodeView.toSeeTheLatestStatus")}.<br/> <a href="https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.wait/" target="_blank">${this.$locale.baseText("nodeView.moreInfo")}</a>`,type:"warning",duration:0}),this.canvasStore.stopLoading()},async importWorkflowExact(e){if(!e.workflow.nodes||!e.workflow.connections)throw new Error("Invalid workflow object");this.resetWorkspace(),e.workflow.nodes=_i(e.workflow.nodes),await this.addNodes(e.workflow.nodes,e.workflow.connections),e.workflow.pinData&&this.workflowsStore.setWorkflowPinData(e.workflow.pinData),await this.$nextTick(),this.canvasStore.zoomToFit()},async openWorkflowTemplate(e){this.canvasStore.startLoading(),this.canvasStore.setLoadingText(this.$locale.baseText("nodeView.loadingTemplate")),this.resetWorkspace(),this.workflowsStore.currentWorkflowExecutions=[],this.executionsStore.activeExecution=null;let t;try{if(this.externalHooks.run("template.requested",{templateId:e}),t=await this.templatesStore.getFixedWorkflowTemplate(e),!t)throw new Error(this.$locale.baseText("nodeView.workflowTemplateWithIdCouldNotBeFound",{interpolate:{templateId:e}}))}catch(n){this.showError(n,this.$locale.baseText("nodeView.couldntImportWorkflow")),await this.$router.replace({name:te.NEW_WORKFLOW});return}this.$telemetry.track("User inserted workflow template",{source:"workflow",template_id:$i(e),wf_template_repo_session_id:this.templatesStore.previousSessionId},{withPostHog:!0}),this.blankRedirect=!0,await this.$router.replace({name:te.NEW_WORKFLOW,query:{templateId:e}});const o=t.workflow.nodes.map(this.workflowsStore.convertTemplateNodeToNodeUi);await this.addNodes(o,t.workflow.connections),this.workflowData=await this.workflowsStore.getNewWorkflowData(t.name,this.projectsStore.currentProjectId)||{},this.workflowsStore.addToWorkflowMetadata({templateId:e}),await this.$nextTick(),this.canvasStore.zoomToFit(),this.uiStore.stateIsDirty=!0,this.externalHooks.run("template.open",{templateId:e,templateName:t.name,workflow:t.workflow}),this.canvasStore.stopLoading()},async openWorkflow(e){this.canvasStore.startLoading();const t=this.executionsStore.activeExecution;this.resetWorkspace(),this.workflowsStore.addWorkflow(e),this.workflowsStore.setActive(e.active||!1),this.workflowsStore.setWorkflowId(e.id),this.workflowsStore.setWorkflowName({newName:e.name,setStateDirty:!1}),this.workflowsStore.setWorkflowSettings(e.settings??{}),this.workflowsStore.setWorkflowPinData(e.pinData??{}),this.workflowsStore.setWorkflowVersionId(e.versionId),this.workflowsStore.setWorkflowMetadata(e.meta),e.sharedWithProjects&&this.workflowsEEStore.setWorkflowSharedWith({workflowId:e.id,sharedWithProjects:e.sharedWithProjects}),e.usedCredentials&&this.workflowsStore.setUsedCredentials(e.usedCredentials);const o=e.tags??[],n=o.map(s=>s.id);this.workflowsStore.setWorkflowTagIds(n||[]),this.tagsStore.upsertTags(o),await this.addNodes(e.nodes,e.connections),this.credentialsUpdated||(this.uiStore.stateIsDirty=!1),this.canvasStore.zoomToFit(),this.externalHooks.run("workflow.open",{workflowId:e.id,workflowName:e.name}),(t==null?void 0:t.workflowId)!==e.id?(this.executionsStore.activeExecution=null,this.workflowsStore.currentWorkflowExecutions=[]):this.executionsStore.activeExecution=t,this.canvasStore.stopLoading(),this.collaborationStore.notifyWorkflowOpened(e.id)},touchTap(e){this.deviceSupport.isTouchDevice&&this.mouseDown(e)},mouseDown(e){this.lastClickPosition=this.getMousePositionWithinNodeView(e),e instanceof MouseEvent&&e.button===1&&(this.aiStore.closeNextStepPopup(),this.moveCanvasKeyPressed=!0),this.mouseDownMouseSelect(e,this.moveCanvasKeyPressed),this.canvasPanning.onMouseDown(e,this.moveCanvasKeyPressed),this.createNodeActive=!1},mouseUp(e){e instanceof MouseEvent&&e.button===1&&(this.moveCanvasKeyPressed=!1),this.mouseUpMouseSelect(e),this.canvasPanning.onMouseUp()},keyUp(e){e.key===this.deviceSupport.controlKeyCode&&(this.ctrlKeyPressed=!1),e.key===" "&&(this.moveCanvasKeyPressed=!1)},async keyDown(e){this.contextMenu.close(),this.aiStore.closeNextStepPopup();const t=this.deviceSupport.isCtrlKeyPressed(e)&&!e.shiftKey&&!e.altKey,o=e.shiftKey&&!e.altKey&&!this.deviceSupport.isCtrlKeyPressed(e),n=this.deviceSupport.isCtrlKeyPressed(e)&&e.altKey&&!e.shiftKey,s=!this.deviceSupport.isCtrlKeyPressed(e)&&!e.shiftKey&&!e.altKey,i=this.isReadOnlyRoute||this.readOnlyEnv;if(e.key==="s"&&t&&!i){if(e.stopPropagation(),e.preventDefault(),this.isReadOnlyRoute||this.readOnlyEnv)return;this.callDebounced(this.onSaveKeyboardShortcut,{debounceTime:1e3},e);return}const l=(e==null?void 0:e.composedPath())??[];for(const a of l)if(a instanceof HTMLElement&&a.className&&typeof a.className=="string"&&a.className.includes("ignore-key-press"))return;if(window.document.body.classList.contains("el-popup-parent--hidden"))return;if(e.key==="Escape"&&s){this.createNodeActive=!1,this.activeNode&&(this.externalHooks.run("dataDisplay.nodeEditingFinished"),this.ndvStore.activeNodeName=null);return}if(this.activeNode)return;const r=this.uiStore.getSelectedNodes.map(a=>a&&this.workflowsStore.getNodeByName(a.name)).filter(a=>!!a);if(e.key==="d"&&s&&!i)this.callDebounced(this.toggleActivationNodes,{debounceTime:350},r);else if(e.key==="d"&&t&&!i)r.length>0&&(e.preventDefault(),this.duplicateNodes(r));else if(e.key==="p"&&s&&!i)r.length>0&&(e.preventDefault(),this.togglePinNodes(r,"keyboard-shortcut"));else if((e.key==="Delete"||e.key==="Backspace")&&s&&!i)e.stopPropagation(),e.preventDefault(),this.callDebounced(this.deleteNodes,{debounceTime:500},r);else if(e.key==="Tab"&&s&&!i)this.onToggleNodeCreator({source:ye.TAB,createNodeActive:!this.createNodeActive&&!this.isReadOnlyRoute&&!this.readOnlyEnv});else if(e.key==="Enter"&&t&&!i)this.onRunWorkflow();else if(e.key==="S"&&o&&!i)this.onAddNodes({nodes:[{type:ke}],connections:[]});else if(e.key===this.deviceSupport.controlKeyCode)this.ctrlKeyPressed=!0;else if(e.key===" ")this.moveCanvasKeyPressed=!0;else if(e.key==="F2"&&s&&!i){const a=this.lastSelectedNode;a!==null&&a.type!==ke&&this.callDebounced(this.renameNodePrompt,{debounceTime:1500},a.name)}else if(e.key==="a"&&t)e.stopPropagation(),e.preventDefault(),this.callDebounced(this.selectAllNodes,{debounceTime:1e3});else if(e.key==="c"&&t)this.callDebounced(this.copyNodes,{debounceTime:1e3},r);else if(e.key==="x"&&t&&!i)e.stopPropagation(),e.preventDefault(),this.callDebounced(this.cutNodes,{debounceTime:1e3},r);else if(e.key==="n"&&n){if(e.stopPropagation(),e.preventDefault(),this.isDemo)return;this.$router.currentRoute.value.name===te.NEW_WORKFLOW?pe.emit("newWorkflow"):this.$router.push({name:te.NEW_WORKFLOW}),this.showMessage({title:this.$locale.baseText("nodeView.showMessage.keyDown.title"),type:"success"})}else if(e.key==="Enter"&&s){const a=this.lastSelectedNode;if(a!==null){if(a.type===ke&&(this.isReadOnlyRoute||this.readOnlyEnv))return;this.ndvStore.activeNodeName=a.name}}else if(e.key==="ArrowRight"&&o)e.stopPropagation(),e.preventDefault(),this.callDebounced(this.selectDownstreamNodes,{debounceTime:1e3});else if(e.key==="ArrowRight"&&s){const a=this.lastSelectedNode;if(a===null)return;const u=this.workflowsStore.outgoingConnectionsByNodeName(a.name);if(u.main===void 0||u.main.length===0)return;this.callDebounced(this.nodeSelectedByName,{debounceTime:100},u.main[0][0].node,!1,!0)}else if(e.key==="ArrowLeft"&&o)e.stopPropagation(),e.preventDefault(),this.callDebounced(this.selectUpstreamNodes,{debounceTime:1e3});else if(e.key==="ArrowLeft"&&s){const a=this.lastSelectedNode;if(a===null)return;const u=this.workflowHelpers.getCurrentWorkflow();if(!u.connectionsByDestinationNode.hasOwnProperty(a.name))return;const c=u.connectionsByDestinationNode[a.name];if(c.main===void 0||c.main.length===0)return;this.callDebounced(this.nodeSelectedByName,{debounceTime:100},c.main[0][0].node,!1,!0)}else if(["ArrowUp","ArrowDown"].includes(e.key)&&s){const a=this.lastSelectedNode;if(a===null)return;const u=this.workflowHelpers.getCurrentWorkflow();if(!u.connectionsByDestinationNode.hasOwnProperty(a.name))return;const c=u.connectionsByDestinationNode[a.name];if(!Array.isArray(c.main)||!c.main.length)return;const p=c.main[0][0].node,g=this.workflowsStore.outgoingConnectionsByNodeName(p);if(!Array.isArray(g.main)||!g.main.length)return;let m,y=e.key==="ArrowUp"?-99999999:99999999,S=null;for(const w of g.main)for(const C of w)C.node!==a.name&&(m=this.workflowsStore.getNodeByName(C.node),m&&(e.key==="ArrowUp"?m.position[1]<=a.position[1]&&m.position[1]>y&&(S=m.name,y=m.position[1]):m.position[1]>=a.position[1]&&m.position[1]<y&&(S=m.name,y=m.position[1])));S!==null&&this.callDebounced(this.nodeSelectedByName,{debounceTime:100},S,!1,!0)}},toggleActivationNodes(e){this.editAllowedCheck()&&this.nodeHelpers.disableNodes(e,!0)},togglePinNodes(e,t){if(!this.editAllowedCheck())return;this.historyStore.startRecordingUndo();const o=e.some(n=>!this.workflowsStore.pinDataByNodeName(n.name));for(const n of e){const s=Ce(n);if(o){const i=this.dataSchema.getInputDataWithPinned(n);i.length!==0&&s.setData(i,t)}else s.unsetData(t)}this.historyStore.stopRecordingUndo()},deleteNodes(e){this.historyStore.startRecordingUndo(),e.forEach(t=>{this.removeNode(t.name,!0,!1)}),setTimeout(()=>{this.historyStore.stopRecordingUndo()},200)},selectAllNodes(){this.nodes.forEach(e=>{this.nodeSelectedByName(e.name)})},selectUpstreamNodes(){const e=this.lastSelectedNode;if(e===null)return;this.deselectAllNodes();const t=this.workflowHelpers.getCurrentWorkflow(),o=this.workflowHelpers.getConnectedNodes("upstream",t,e.name);for(const n of o)this.nodeSelectedByName(n);this.nodeSelectedByName(e.name)},selectDownstreamNodes(){const e=this.lastSelectedNode;if(e===null)return;this.deselectAllNodes();const t=this.workflowHelpers.getCurrentWorkflow(),o=this.workflowHelpers.getConnectedNodes("downstream",t,e.name);for(const n of o)this.nodeSelectedByName(n);this.nodeSelectedByName(e.name)},pushDownstreamNodes(e,t,o=!1){const n=this.workflowsStore.nodesByName[e],s=this.workflowHelpers.getCurrentWorkflow(),i=this.workflowHelpers.getConnectedNodes("downstream",s,e);for(const l of i){const r=this.workflowsStore.nodesByName[l],a=r.position;if(r.position[0]<n.position[0])continue;const u={name:l,properties:{position:[r.position[0]+t,r.position[1]]}};this.workflowsStore.updateNodeProperties(u),this.onNodeMoved(r),(o&&a[0]!==u.properties.position[0]||a[1]!==u.properties.position[1])&&this.historyStore.pushCommandToUndo(new Oi(l,a,u.properties.position),o)}},cutNodes(e){const t=!this.isReadOnlyRoute&&!this.readOnlyEnv;this.copyNodes(e,t),t&&this.deleteNodes(e)},copyNodes(e,t=!1){this.getNodesToSave(e).then(o=>{const n={meta:{...this.workflowsStore.workflow.meta??{},instanceId:this.rootStore.instanceId},...o};this.workflowHelpers.removeForeignCredentialsFromWorkflow(n,this.credentialsStore.allCredentials);const s=JSON.stringify(n,null,2);this.clipboard.copy(s),o.nodes.length>0&&(t||this.showMessage({title:"Copied!",message:"",type:"success"}),this.$telemetry.track("User copied nodes",{node_types:o.nodes.map(i=>i.type),workflow_id:this.workflowsStore.workflowId}))})},async stopExecution(){const e=this.workflowsStore.activeExecutionId;if(e!==null){try{this.stopExecutionInProgress=!0,await this.executionsStore.stopCurrentExecution(e)}catch(t){const o=await this.workflowsStore.getExecution(e);if(o===void 0)this.workflowsStore.finishActiveExecution({executionId:e,data:{finished:!0,stoppedAt:new Date}}),this.workflowsStore.executingNode.length=0,this.uiStore.removeActiveAction("workflowRunning"),this.titleSet(this.workflowsStore.workflowName,"IDLE"),this.showMessage({title:this.$locale.baseText("nodeView.showMessage.stopExecutionCatch.unsaved.title"),message:this.$locale.baseText("nodeView.showMessage.stopExecutionCatch.unsaved.message"),type:"success"});else if(o!=null&&o.finished){const n={data:o.data,finished:o.finished,mode:o.mode,startedAt:o.startedAt,stoppedAt:o.stoppedAt},s={data:n,executionId:e,retryOf:o.retryOf};this.workflowsStore.finishActiveExecution(s),this.titleSet(o.workflowData.name,"IDLE"),this.workflowsStore.executingNode.length=0,this.workflowsStore.setWorkflowExecutionData(n),this.uiStore.removeActiveAction("workflowRunning"),this.showMessage({title:this.$locale.baseText("nodeView.showMessage.stopExecutionCatch.title"),message:this.$locale.baseText("nodeView.showMessage.stopExecutionCatch.message"),type:"success"})}else this.showError(t,this.$locale.baseText("nodeView.showError.stopExecution.title"))}this.stopExecutionInProgress=!1,this.workflowHelpers.getWorkflowDataToSave().then(t=>{const o={workflow_id:this.workflowsStore.workflowId,node_graph_string:JSON.stringify(Wt(t,this.workflowHelpers.getNodeTypes(),{isCloudDeployment:this.settingsStore.isCloudDeployment}).nodeGraph)};this.$telemetry.track("User clicked stop workflow execution",o)})}},async stopWaitingForWebhook(){try{await this.workflowsStore.removeTestWebhook(this.workflowsStore.workflowId)}catch(e){this.showError(e,this.$locale.baseText("nodeView.showError.stopWaitingForWebhook.title"));return}},async onClipboardPasteEvent(e){if(this.readOnlyEnv)return;if(Nt(this.$route)===st.WORKFLOW){let o;if(!this.editAllowedCheck())return;if(e.match(/^http[s]?:\/\/.*\.json$/i)){if(!this.editAllowedCheck()||await this.confirm(this.$locale.baseText("nodeView.confirmMessage.onClipboardPasteEvent.message",{interpolate:{plainTextData:e}}),this.$locale.baseText("nodeView.confirmMessage.onClipboardPasteEvent.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("nodeView.confirmMessage.onClipboardPasteEvent.confirmButtonText"),cancelButtonText:this.$locale.baseText("nodeView.confirmMessage.onClipboardPasteEvent.cancelButtonText"),dangerouslyUseHTMLString:!0})!==et||(o=await this.getWorkflowDataFromUrl(e),o===void 0))return}else try{if(o=JSON.parse(e),!this.editAllowedCheck())return}catch{return}return await this.importWorkflowData(o,"paste",!1)}},async getWorkflowDataFromUrl(e){let t;this.canvasStore.startLoading();try{t=await this.workflowsStore.getWorkflowFromUrl(e)}catch(o){this.canvasStore.stopLoading(),this.showError(o,this.$locale.baseText("nodeView.showError.getWorkflowDataFromUrl.title"));return}return this.canvasStore.stopLoading(),t},async importWorkflowData(e,t,o=!0){if(!(!e.hasOwnProperty("nodes")||!e.hasOwnProperty("connections")))try{const n={};if(e.nodes){const a=e.nodes.map(u=>u.name);e.nodes.forEach(u=>{if(!u.name){const c=this.nodeTypesStore.getNodeType(u.type),p=this.uniqueNodeName((c==null?void 0:c.displayName)??u.type,a);u.name=p,a.push(p)}if(u.webhookId&&Ri.includes(u.type)&&Object.values(this.workflowHelpers.getCurrentWorkflow().nodes).some(p=>p.webhookId===u.webhookId)&&(u.webhookId=Ue()),u.id){const c=Ue();n[c]=u.id,u.id=c}else u.id=Ue()})}this.removeUnknownCredentials(e);const s=this.rootStore.instanceId,i=JSON.stringify(Wt(e,this.workflowHelpers.getNodeTypes(),{nodeIdMap:n,sourceInstanceId:e.meta&&e.meta.instanceId!==s?e.meta.instanceId:"",isCloudDeployment:this.settingsStore.isCloudDeployment}).nodeGraph);t==="paste"?this.$telemetry.track("User pasted nodes",{workflow_id:this.workflowsStore.workflowId,node_graph_string:i}):t==="duplicate"?this.$telemetry.track("User duplicated nodes",{workflow_id:this.workflowsStore.workflowId,node_graph_string:i}):this.$telemetry.track("User imported workflow",{source:t,workflow_id:this.workflowsStore.workflowId,node_graph_string:i}),this.deselectAllNodes(),this.workflowHelpers.updateNodePositions(e,Ge(this.nodes,this.lastClickPosition));const l=await this.addNodesToWorkflow(e);setTimeout(()=>{((l==null?void 0:l.nodes)??[]).forEach(a=>{this.nodeSelectedByName(a.name)})});const r=this.settingsStore.areTagsEnabled;if(o&&r&&Array.isArray(e.tags)){const a=await this.tagsStore.fetchAll(),u=new Set(a.map(y=>y.name)),c=e.tags,p=c.filter(y=>!u.has(y.name)),g=[];for(const y of p){const S=this.tagsStore.create(y.name).then(w=>(a.push(w),w));g.push(S)}await Promise.all(g);const m=c.reduce((y,S)=>{const w=a.find(C=>C.name===S.name);return w&&y.push(w.id),y},[]);this.workflowsStore.addWorkflowTagIds(m),setTimeout(()=>{this.addPinDataConnections(this.workflowsStore.pinnedWorkflowData||{})})}}catch(n){this.showError(n,this.$locale.baseText("nodeView.showError.importWorkflowData.title"))}},removeUnknownCredentials(e){if(e!=null&&e.nodes){for(const t of e.nodes)if(t.credentials)for(const[o,n]of Object.entries(t.credentials))typeof n=="string"||n.id===null||this.credentialsStore.getCredentialById(n.id)||delete t.credentials[o]}},onDragOver(e){e.preventDefault()},async onDrop(e){if(!e.dataTransfer)return;const t=Xt(e.dataTransfer.getData(Mi));if(t){const o=this.getMousePositionWithinNodeView(e),n=[o[0]-at/2+dt,o[1]-at/2];await this.onAddNodes(t,!0,n),this.createNodeActive=!1}},nodeDeselectedByName(e){const t=this.workflowsStore.getNodeByName(e);t&&this.nodeDeselected(t)},nodeSelectedByName(e,t=!1,o){o===!0&&this.deselectAllNodes();const n=this.workflowsStore.getNodeByName(e);n&&(this.nodeSelected(n),this.uiStore.lastSelectedNode=n.name,this.uiStore.lastSelectedNodeOutputIndex=null,this.uiStore.lastSelectedNodeEndpointUuid=null,this.canvasStore.newNodeInsertPosition=null,this.canvasStore.setLastSelectedConnection(void 0),t&&(this.ndvStore.activeNodeName=n.name))},showMaxNodeTypeError(e){const t=e.maxNodes;this.showMessage({title:this.$locale.baseText("nodeView.showMessage.showMaxNodeTypeError.title"),message:this.$locale.baseText("nodeView.showMessage.showMaxNodeTypeError.message",{adjustToNumber:t,interpolate:{nodeTypeDataDisplayName:e.displayName}}),type:"error",duration:0})},async getNewNodeWithDefaultCredential(e,t){var i,l,r,a;let o=e.defaultVersion;o===void 0&&(o=Array.isArray(e.version)?e.version.slice(-1)[0]:e.version);const n={id:Ue(),name:t.name??e.defaults.name,type:e.name,typeVersion:o,position:[0,0],parameters:{}},s=(i=e.credentials)==null?void 0:i.map(u=>this.credentialsStore.getUsableCredentialByType(u.name)).flat();if(s&&s.length===1){const u=s[0],c=this.credentialsStore.getCredentialById(u.id),p={id:c.id,name:c.name},g={[u.type]:p};await this.loadNodesProperties([n].map(S=>({name:S.type,version:S.typeVersion})));const m=this.nodeTypesStore.getNodeType(n.type,n.typeVersion),y=Ze((m==null?void 0:m.properties)||[],{},!0,!1,n);if(e.credentials){const S=e.credentials.find(C=>C.name===u.type);if((l=S==null?void 0:S.displayOptions)!=null&&l.hide)return n;const w=(r=S==null?void 0:S.displayOptions)==null?void 0:r.show;if(!w)return n.credentials=g,n;if(Object.keys(w).length===1&&w.authentication){n.credentials=g;let C={};for(const I of Object.keys(w)){if(y&&!y[I]){C={},n.credentials=void 0;break}const P=(a=w[I])==null?void 0:a[0];P&&typeof P=="string"&&(C[I]=P),n.parameters={...n.parameters,...C}}}}}return n},async injectNode(e,t={},o=!0,n=!1,s=!1){var u,c;const i=this.nodeTypesStore.getNodeType(e);if(i===null){this.showMessage({title:this.$locale.baseText("nodeView.showMessage.addNodeButton.title"),message:this.$locale.baseText("nodeView.showMessage.addNodeButton.message",{interpolate:{nodeTypeName:e}}),type:"error"});return}if(i.maxNodes!==void 0&&this.workflowHelpers.getNodeTypeCount(e)>=i.maxNodes){this.showMaxNodeTypeError(i);return}const l=await this.getNewNodeWithDefaultCredential(i,{name:t.name}),r=this.lastSelectedNode;if(t.position)l.position=Ge(this.canvasStore.getNodesWithPlaceholderNode(),t.position);else if(r){const p=this.canvasStore.lastSelectedConnection;if(p){const[g]=Ai(p);g<=Wi&&this.pushDownstreamNodes(r.name,Lt,n)}if(this.canvasStore.newNodeInsertPosition)l.position=Ge(this.nodes,[this.canvasStore.newNodeInsertPosition[0]+dt,this.canvasStore.newNodeInsertPosition[1]-at/2]),this.canvasStore.newNodeInsertPosition=null;else{let g=0;const m=this.workflowHelpers.getCurrentWorkflow();if(p){const I=this.nodeTypesStore.getNodeType(r.type,r.typeVersion);if(I){const P=[[-100,100],[-140,0,140],[-240,-100,100,240]],V=Oe(m,r,I),x=Ie(V).filter(f=>f===U.Main);if(x.length>1){const f=P[x.length-2],$=p.__meta?p.__meta.sourceOutputIndex:0;g=f[$]}}}let y=[];try{y=Oe(m,l,i)}catch{}const S=Ie(y),w=this.nodeTypesStore.getNodeType(r.type,r.typeVersion),C=m.getNode(r.name);if(!C||!w){console.error("Could not find last selected node or node type");return}if(S.length>0&&S.every(I=>I!==U.Main)){const I=De(m,C,w),V=(Ie(I)||[]).filter(H=>H!==U.Main).findIndex(H=>y[0]===H);l.position=Ge(this.nodes,[r.position[0]+at/(Math.max(((u=w==null?void 0:w.inputs)==null?void 0:u.length)??1),1)*V,r.position[1]+Lt],[100,0])}else{const I=De(m,r,w),P=Ie(I);let V=Lt;P.find(H=>H!==U.Main)&&(V+=150),l.position=Ge(this.nodes,[r.position[0]+V,r.position[1]+g],[100,0])}}}else{const p=this.nodeTypesStore.isTriggerNode(e)&&!this.containsTrigger?this.canvasStore.canvasAddButtonPosition:this.lastClickPosition;l.position=Ge(this.nodes,p)}const a=this.locale.localizeNodeName(l.name,l.type);if(l.name=this.uniqueNodeName(a),(c=i.webhooks)!=null&&c.length&&(l.webhookId=Ue()),await this.addNodes([l],void 0,n),this.workflowsStore.setNodePristine(l.name,!0),this.uiStore.stateIsDirty=!0,e===ke)this.$telemetry.trackNodesPanel("nodeView.addSticky",{workflow_id:this.workflowsStore.workflowId});else{this.externalHooks.run("nodeView.addNodeButton",{nodeTypeName:e}),Vi().trackAddedTrigger(e);const p={node_type:e,node_version:l.typeVersion,is_auto_add:s,workflow_id:this.workflowsStore.workflowId,drag_and_drop:t.dragAndDrop};r&&(p.input_node_type=r.type),this.$telemetry.trackNodesPanel("nodeView.addNodeButton",p)}return n&&(this.deselectAllNodes(),setTimeout(()=>{this.nodeSelectedByName(l.name,o&&e!==ke)})),l},getConnection(e,t,o,n,s){const i=this.workflowsStore.outgoingConnectionsByNodeName(e)[s];if(i){const l=i[t];if(l)return l.find(r=>r.node===o&&r.index===n)}},connectTwoNodes(e,t,o,n,s){this.uiStore.stateIsDirty=!0;const i=this.workflowsStore.getNodeByName(e),l=this.workflowsStore.getNodeByName(o);if(i&&l&&!this.checkNodeConnectionAllowed(i,l,s)||this.getConnection(e,t,o,n,s))return;const r=[{node:e,type:s,index:t},{node:o,type:s,index:n}];this.__addConnection(r)},async addNode(e,t={},o=!0,n=!1,s=!1){var g;if(!this.editAllowedCheck())return;const i=this.lastSelectedNode,l=this.uiStore.lastSelectedNodeOutputIndex,r=this.uiStore.lastSelectedNodeEndpointUuid,a=this.canvasStore.lastSelectedConnection;this.historyStore.startRecordingUndo();const u=await this.injectNode(e,t,o,n,s);if(!u)return;const c=l||0,p=r||"";if(r&&!s&&i){const m=this.instance.getEndpoint(r);if(m&&this.checkNodeConnectionAllowed(i,u,m.scope)){const y=m.scope,S=this.instance.getManagedElement(u.id),C=this.instance.getEndpoints(S).find(I=>I.scope===y&&m.parameters.connection!==I.parameters.connection);(g=this.instance)==null||g.connect({uuids:[p,(C==null?void 0:C.uuid)||""],detachable:!this.isReadOnlyRoute&&!this.readOnlyEnv}),this.historyStore.stopRecordingUndo();return}}if(i&&!s){if(await this.$nextTick(),a!=null&&a.__meta){this.__deleteJSPlumbConnection(a,n);const m=a.__meta.targetNodeName,y=a.__meta.targetOutputIndex;this.connectTwoNodes(u.name,0,m,y,U.Main)}this.connectTwoNodes(i.name,c,u.name,0,U.Main)}this.historyStore.stopRecordingUndo()},getNodeCreatorFilter(e,t){let o;const n=this.workflowHelpers.getCurrentWorkflow(),s=n.getNode(e);if(!s)return{nodes:[]};const i=this.nodeTypesStore.getNodeType(s==null?void 0:s.type,s.typeVersion);if(i){const r=De(n,s,i).filter(a=>!(typeof a=="string"||a.type!==t||!a.filter));r.length&&(o=r[0].filter)}return o},insertNodeAfterSelected(e){var i,l,r;const t=e.outputType??U.Main,o=this.workflowsStore.getNodeById(e.sourceId);if(!o)return;this.uiStore.lastSelectedNode=o.name,this.uiStore.lastSelectedNodeEndpointUuid=e.endpointUuid??((l=(i=e.connection)==null?void 0:i.target.jtk)==null?void 0:l.endpoint.uuid),this.uiStore.lastSelectedNodeOutputIndex=e.index,this.canvasStore.newNodeInsertPosition=null,e.connection&&this.canvasStore.setLastSelectedConnection(e.connection),this.onToggleNodeCreator({source:e.eventSource,createNodeActive:!0,nodeCreatorView:e.nodeCreatorView});const n=((r=e.connection)==null?void 0:r.endpoints[0].parameters.connection)==="source";t!==U.Main&&Cs.includes(t)&&ka().gotoCompatibleConnectionView(t,n,this.getNodeCreatorFilter(o.name,t)).catch(()=>{})},async onEventConnectionAbort(e){var t,o,n;try{if(this.dropPrevented){this.dropPrevented=!1;return}if(this.pullConnActiveNodeName){const a=this.workflowsStore.getNodeById(e.parameters.nodeId),u=e.parameters.type??U.Main,c=(t=e==null?void 0:e.connector)==null?void 0:t.overrideTargetEndpoint;if(a){const p=e.parameters.connection==="target",g=p?this.pullConnActiveNodeName:a.name,m=p?a.name:this.pullConnActiveNodeName,y=e.parameters.index;Lo(e),await this.$nextTick(),this.connectTwoNodes(g,y,m,((o=c==null?void 0:c.parameters)==null?void 0:o.index)??0,u),this.pullConnActiveNodeName=null,this.dropPrevented=!1}return}const s=`${e.parameters.nodeId}-output${e.parameters.index}`,i=e.instance.getEndpoint(s);if(!((n=i==null?void 0:i.endpoint)!=null&&n.canvas)||!this.shouldShowNextStepDialog){this.insertNodeAfterSelected({sourceId:e.parameters.nodeId,index:e.parameters.index,eventSource:ye.NODE_CONNECTION_DROP,connection:e,outputType:e.parameters.type});return}const l=i.endpoint.canvas,r=new MutationObserver(a=>{if(a.find(c=>{var g,m;const p=c.target;return kt(p)&&((m=(g=p.jtk)==null?void 0:g.endpoint)==null?void 0:m.uuid)===i.uuid&&p.style.display==="block"})){const c={sourceId:e.parameters.nodeId,index:e.parameters.index,eventSource:ye.NODE_CONNECTION_DROP,outputType:e.parameters.type,endpointUuid:i.uuid,stepName:i.__meta.nodeName};this.aiStore.latestConnectionInfo=c,this.aiStore.openNextStepPopup(this.$locale.baseText("nextStepPopup.title.nextStep"),l),r.disconnect();return}});r.observe(this.$refs.nodeViewRef,{attributes:!0,attributeFilter:["style"],subtree:!0})}catch(s){console.error(s)}},checkNodeConnectionAllowed(e,t,o){var s;const n=this.nodeTypesStore.getNodeType(t.type,t.typeVersion);if((s=n==null?void 0:n.inputs)!=null&&s.length){const i=this.workflowHelpers.getCurrentWorkflow(),l=i.getNode(t.name);let r=[];n&&l&&(r=De(i,l,n));for(const a of r||[])if(!(typeof a=="string"||a.type!==o||!a.filter)&&a.filter.nodes.length&&!a.filter.nodes.includes(e.type))return this.dropPrevented=!0,this.showToast({title:this.$locale.baseText("nodeView.showError.nodeNodeCompatible.title"),message:this.$locale.baseText("nodeView.showError.nodeNodeCompatible.message",{interpolate:{sourceNodeName:e.name,targetNodeName:t.name}}),type:"error",duration:5e3}),!1}return!0},onInterceptBeforeDrop(e){try{let t,o;if(e.connection.endpoints[0].parameters.connection==="target"?(t=e.dropEndpoint.parameters,o=e.connection.endpoints[0].parameters):(t=e.connection.endpoints[0].parameters,o=e.dropEndpoint.parameters),t.type!==o.type||t.connection===o.connection)return this.dropPrevented=!0,!1;const n=this.workflowsStore.getNodeById(t.nodeId),s=this.workflowsStore.getNodeById(o.nodeId),i=(n==null?void 0:n.name)||"",l=(s==null?void 0:s.name)||"";return n&&s&&!this.checkNodeConnectionAllowed(n,s,o.type)?!1:this.getConnection(i,t.index,l,o.index,t.type)?(this.dropPrevented=!0,this.pullConnActiveNodeName=null,!1):!0}catch(t){return console.error(t),!0}},onEventConnection(e){var t,o;try{if(e.sourceEndpoint.parameters.connection==="target"){const a=e.sourceEndpoint;e.sourceEndpoint=e.targetEndpoint,e.targetEndpoint=a}const n=e.sourceEndpoint.parameters,s=e.targetEndpoint.parameters,i=(t=this.workflowsStore.getNodeById(n.nodeId))==null?void 0:t.name,l=(o=this.workflowsStore.getNodeById(s.nodeId))==null?void 0:o.name;if(i&&l&&(e.connection.__meta={sourceNodeName:i,sourceOutputIndex:n.index,targetNodeName:l,targetOutputIndex:s.index}),bt(e.connection),Bi(e.targetEndpoint),!i||!l){console.error("Could not find source or target node name");return}const r=[{node:i,type:n.type,index:n.index},{node:l,type:s.type,index:s.index}];if(this.dropPrevented=!0,this.workflowsStore.addConnection({connection:r}),!this.isReadOnlyRoute&&!this.readOnlyEnv){Ui(e.sourceEndpoint),Li(e.connection,()=>{this.activeConnection=null,this.__deleteJSPlumbConnection(e.connection)},()=>{this.insertNodeAfterSelected({sourceId:e.sourceEndpoint.parameters.nodeId,index:n.index,connection:e.connection,eventSource:ye.NODE_CONNECTION_ACTION})});const a=xi(e.connection,Hi);n.type!==U.Main&&(e.connection.setPaintStyle(Fi(e.connection,e.sourceEndpoint.parameters.category)),a==null||a.setVisible(!1))}this.dropPrevented=!1,this.isLoading||(this.uiStore.stateIsDirty=!0,this.suspendRecordingDetachedConnections||this.historyStore.pushCommandToUndo(new zi(r)),this.isInsertingNodes||(this.nodeHelpers.updateNodesInputIssues(),this.resetEndpointsErrors(),setTimeout(()=>{var a,u;xo(e.source,e.target,(u=(a=e.connection)==null?void 0:a.connector)!=null&&u.hasOwnProperty("canvas")?e.connection.connector.canvas:void 0)},0)))}catch(n){console.error(n)}},addConectionsTestData(){this.instance.connections.forEach(e=>{var t;xo(e.source,e.target,(t=e==null?void 0:e.connector)!=null&&t.hasOwnProperty("canvas")?e==null?void 0:e.connector.canvas:void 0)})},onDragMove(){const e=this.nodes.length;this.callDebounced(this.updateConnectionsOverlays,{debounceTime:e>20?200:0})},updateConnectionsOverlays(){var e;(e=this.instance)==null||e.connections.forEach(t=>{Ho(t),Fo(t),Object.values(t.overlays).forEach(o=>{var n;o.canvas&&((n=this.instance)==null||n.repaint(o.canvas))})})},isConnectionActive(e){var t,o;return!(e!=null&&e.id)||!((t=this.activeConnection)!=null&&t.id)?!1:((o=this.activeConnection)==null?void 0:o.id)===e.id},onConnectionMouseOver(e){try{if(this.exitTimer!==void 0&&(clearTimeout(this.exitTimer),this.exitTimer=void 0),this.isReadOnlyRoute??this.readOnlyEnv??this.enterTimer??!e??this.isConnectionActive(e))return;this.enterTimer=setTimeout(()=>{this.activeConnection&&!this.isConnectionActive(e)&&zo(this.activeConnection)&&xt(this.activeConnection),this.enterTimer=void 0,e&&(qi(e),this.activeConnection=e)},150)}catch(t){console.error(t)}},onConnectionMouseOut(e){try{if(this.exitTimer||(this.enterTimer&&(clearTimeout(this.enterTimer),this.enterTimer=void 0),this.isReadOnlyRoute??this.readOnlyEnv??!e??!this.isConnectionActive(e)))return;this.exitTimer=setTimeout(()=>{this.exitTimer=void 0,e&&this.isConnectionActive(e)&&zo(this.activeConnection)&&(xt(this.activeConnection),this.activeConnection=null)},500)}catch(t){console.error(t)}},onConnectionMoved(e){var t,o;try{qo(e.connection);const n=e.connection.parameters,s=e.originalEndpoint.parameters,i=[{node:((t=this.workflowsStore.getNodeById(n.nodeId))==null?void 0:t.name)||"",type:n.type,index:n.index},{node:((o=this.workflowsStore.getNodeById(s.nodeId))==null?void 0:o.name)||"",type:s.type,index:s.index}];this.__removeConnection(i,!1)}catch(n){console.error(n)}},onEndpointMouseOver(e,t){!e.isTarget||t.target!==e.endpoint.canvas||this.instance.setHover(e,!0)},onEndpointMouseOut(e){e.isTarget&&this.instance.setHover(e,!1)},async onConnectionDetached(e){var t;try{if(e.sourceEndpoint.parameters.connection==="target"){const n=e.sourceEndpoint;e.sourceEndpoint=e.targetEndpoint,e.targetEndpoint=n}const o=jo(e);if(qo(e.targetEndpoint),ji(e.sourceEndpoint,e.connection),e.connection.removeOverlays(),this.__removeConnectionByConnectionInfo(e,!1,!1),this.pullConnActiveNodeName){this.historyStore.startRecordingUndo();const n=this.workflowsStore.getNodeById(e.connection.parameters.nodeId);if(!n)throw new Error("Could not find source node");const s=n.name,i=e.connection.parameters.index,l=e.connection.connector.overrideTargetEndpoint;o&&this.historyStore.pushCommandToUndo(new Tt(o)),this.connectTwoNodes(s,i,this.pullConnActiveNodeName,((t=l==null?void 0:l.parameters)==null?void 0:t.index)??0,U.Main),this.pullConnActiveNodeName=null,await this.$nextTick(),this.historyStore.stopRecordingUndo()}else if(!this.historyStore.bulkInProgress&&!this.suspendRecordingDetachedConnections&&o){const n=new Tt(o);this.historyStore.pushCommandToUndo(n)}this.nodeHelpers.updateNodesInputIssues()}catch(o){console.error(o)}},onConnectionDrag(e){var t;(t=e.overlays["midpoint-arrow"])==null||t.setVisible(!1);try{this.pullConnActiveNodeName=null,this.pullConnActive=!0,this.canvasStore.newNodeInsertPosition=null,xt(e),bt(e);const o=e.scope,n=Array.from(document.querySelectorAll(`[data-jtk-scope-${o}=true]`)),i=e.parameters.connection==="source"?"target":"source",l=n.filter(u=>{if(!kt(u))return!1;const c=u.jtk.endpoint;if(!c)return!1;const p=c.parameters.nodeId===e.parameters.nodeId,g=c.parameters.connection;return!p&&g===i}),r=u=>{if(!e)return;const c=l.filter(p=>{if(!kt(p))return!1;const g=p.jtk.endpoint;if(p.classList.contains("jtk-floating-endpoint"))return!1;const m=Ko(p,u,50),y=Ko(g.element,u,30);if(m||y){const S=this.workflowsStore.getNodeById(g.parameters.nodeId);if(S)return!!this.nodeTypesStore.getNodeType(S.type,S.typeVersion)}return!1}).sort((p,g)=>{const m=Yo(p,u,50),y=Yo(g,u,50);return!(m!=null&&m.y)&&!(y!=null&&y.y)?0:m!=null&&m.y?y!=null&&y.y?y.y-m.y:-1:1});if(c.length>0&&kt(c[0])){const g=c[0].jtk.endpoint,m=this.workflowsStore.getNodeById(g.parameters.nodeId);this.pullConnActiveNodeName=(m==null?void 0:m.name)??null,Ki(e,g)}else Yi(e),this.pullConnActiveNodeName=null},a=u=>{this.pullConnActive=!1,this.canvasStore.newNodeInsertPosition=this.getMousePositionWithinNodeView(u),Lo(e),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a),this.connectionDragScope={type:null,connection:null}};window.addEventListener("mousemove",r),window.addEventListener("touchmove",r),window.addEventListener("mouseup",a),window.addEventListener("touchend",r),this.connectionDragScope={type:e.parameters.type,connection:e.parameters.connection}}catch(o){console.error(o)}},onConnectionDragAbortDetached(){var e;Object.values((e=this.instance)==null?void 0:e.endpointsByElement).flatMap(t=>Object.values(t)).filter(t=>t.endpoint.type==="N8nPlus").forEach(t=>setTimeout(()=>t.instance.revalidate(t.element),0))},onPlusEndpointClick(e){if(this.shouldShowNextStepDialog){if(e!=null&&e.__meta){this.aiStore.latestConnectionInfo={sourceId:e.__meta.nodeId,index:e.__meta.index,eventSource:ye.PLUS_ENDPOINT,outputType:tt(e.scope),endpointUuid:e.uuid,stepName:e.__meta.nodeName};const t=e.endpoint.canvas;this.aiStore.openNextStepPopup(this.$locale.baseText("nextStepPopup.title.nextStep"),t)}}else this.insertNodeAfterSelected({sourceId:e.__meta.nodeId,index:e.__meta.index,eventSource:ye.PLUS_ENDPOINT,outputType:tt(e.scope),endpointUuid:e.uuid,stepName:e.__meta.nodeName})},onAddInputEndpointClick(e){e!=null&&e.__meta&&this.insertNodeAfterSelected({sourceId:e.__meta.nodeId,index:e.__meta.index,eventSource:ye.ADD_INPUT_ENDPOINT,nodeCreatorView:Go,outputType:tt(e.scope),endpointUuid:e.uuid})},bindCanvasEvents(){this.eventsAttached||(this.instance.bind(St,this.onEventConnectionAbort),this.instance.bind(Do,this.onInterceptBeforeDrop),this.instance.bind(Co,this.onEventConnection),this.instance.bind(tn,this.onDragMove),this.instance.bind(on,this.onConnectionMouseOver),this.instance.bind(nn,this.onConnectionMouseOut),this.instance.bind(Eo,this.onConnectionMoved),this.instance.bind(sn,this.onEndpointMouseOver),this.instance.bind(an,this.onEndpointMouseOut),this.instance.bind(wt,this.onConnectionDetached),this.instance.bind(Dt,this.onConnectionDrag),this.instance.bind([Dt,St,wt],this.onConnectionDragAbortDetached),this.instance.bind(Jo,this.onPlusEndpointClick),this.instance.bind(Xo,this.onAddInputEndpointClick),this.eventsAttached=!0)},unbindCanvasEvents(){this.instance.unbind(St,this.onEventConnectionAbort),this.instance.unbind(Do,this.onInterceptBeforeDrop),this.instance.unbind(Co,this.onEventConnection),this.instance.unbind(tn,this.onDragMove),this.instance.unbind(on,this.onConnectionMouseOver),this.instance.unbind(nn,this.onConnectionMouseOut),this.instance.unbind(Eo,this.onConnectionMoved),this.instance.unbind(sn,this.onEndpointMouseOver),this.instance.unbind(an,this.onEndpointMouseOut),this.instance.unbind(wt,this.onConnectionDetached),this.instance.unbind(Dt,this.onConnectionDrag),this.instance.unbind(Dt,this.onConnectionDragAbortDetached),this.instance.unbind(St,this.onConnectionDragAbortDetached),this.instance.unbind(wt,this.onConnectionDragAbortDetached),this.instance.unbind(Jo,this.onPlusEndpointClick),this.instance.unbind(Xo,this.onAddInputEndpointClick),this.eventsAttached=!1},unbindEndpointEventListeners(){if(this.instance){const e=this.instance.getManagedElements();for(const t of Object.values(e)){const o=t.endpoints;for(const n of o||[]){const s=n==null?void 0:n.endpoint;s&&s.type===Gi&&s.unbindEvents()}}}this.eventsAttached=!1},onBeforeUnload(e){if(!(this.isDemo||window.preventNodeViewBeforeUnload)){if(this.uiStore.stateIsDirty)return this.collaborationStore.notifyWorkflowClosed(this.workflowsStore.workflowId),this.unloadTimeout=setTimeout(()=>{this.collaborationStore.notifyWorkflowOpened(this.workflowsStore.workflowId)},5*Ji.SECOND),e.returnValue=!0,!0;this.canvasStore.startLoading(this.$locale.baseText("nodeView.redirecting")),this.collaborationStore.notifyWorkflowClosed(this.workflowsStore.workflowId);return}},onUnload(){clearTimeout(this.unloadTimeout)},makeNewWorkflowShareable(){const{currentProject:e,personalProject:t}=this.projectsStore,o=e??t??{},n=(e==null?void 0:e.scopes)??(t==null?void 0:t.scopes)??[];this.workflowsStore.workflow.homeProject=o,this.workflowsStore.workflow.scopes=n},async newWorkflow(){const{getVariant:e}=Xi();if(this.canvasStore.startLoading(),this.resetWorkspace(),this.workflowData=await this.workflowsStore.getNewWorkflowData(void 0,this.projectsStore.currentProjectId),this.workflowsStore.currentWorkflowExecutions=[],this.executionsStore.activeExecution=null,this.uiStore.stateIsDirty=!1,this.canvasStore.setZoomLevel(1,[0,0]),this.canvasStore.zoomToFit(),this.uiStore.nodeViewInitialized=!0,this.historyStore.reset(),this.executionsStore.activeExecution=null,this.makeNewWorkflowShareable(),this.canvasStore.stopLoading(),e(Qo.name)===Qo.variant){const t=this.canvasStore.getAutoAddManualTriggerNode();t&&(await this.addNodes([t]),this.uiStore.lastSelectedNode=t.name)}},async initView(){var e,t;if(this.$route.params.action==="workflowSave"){this.uiStore.stateIsDirty=!1;return}if(this.blankRedirect)this.blankRedirect=!1;else if(this.$route.name===te.TEMPLATE_IMPORT){const o=this.$route.params.id;await this.openWorkflowTemplate(o.toString())}else{if(this.uiStore.stateIsDirty&&!this.readOnlyEnv){const n=await this.confirm(this.$locale.baseText("generic.unsavedWork.confirmMessage.message"),{title:this.$locale.baseText("generic.unsavedWork.confirmMessage.headline"),type:"warning",confirmButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.confirmButtonText"),cancelButtonText:this.$locale.baseText("generic.unsavedWork.confirmMessage.cancelButtonText"),showClose:!0});if(n===et)await this.workflowHelpers.saveCurrentWorkflow()&&await this.settingsStore.fetchPromptsData();else if(n===Bo)return}let o=null;if(this.$route.params.name&&(o=this.$route.params.name.toString()),o!==null){let n;try{n=await this.workflowsStore.fetchWorkflow(o)}catch(s){this.showError(s,this.$locale.baseText("openWorkflow.workflowNotFoundError")),this.$router.push({name:te.NEW_WORKFLOW})}n&&(this.titleSet(n.name,"IDLE"),await this.openWorkflow(n),await this.checkAndInitDebugMode(),await this.projectsStore.setProjectNavActiveIdByWorkflowHomeProject(n.homeProject),(e=n.meta)!=null&&e.onboardingId&&this.$telemetry.track(`User opened workflow from onboarding template with ID ${n.meta.onboardingId}`,{workflow_id:n.id},{withPostHog:!0}))}else((t=this.$route.meta)==null?void 0:t.nodeView)===!0&&await this.newWorkflow()}await this.loadCredentials(),this.historyStore.reset(),this.uiStore.nodeViewInitialized=!0,document.addEventListener("keydown",this.keyDown),document.addEventListener("keyup",this.keyUp),window.addEventListener("beforeunload",this.onBeforeUnload),window.addEventListener("unload",this.onUnload),this.showNotificationForViews([te.WORKFLOW,te.NEW_WORKFLOW])},getOutputEndpointUUID(e,t,o){const n=this.workflowsStore.getNodeByName(e);return n?Yt(n.id,t,o):null},getInputEndpointUUID(e,t,o){const n=this.workflowsStore.getNodeByName(e);return n?kn(n.id,t,o):null},__addConnection(e){var s;const t=this.getOutputEndpointUUID(e[0].node,e[0].type,e[0].index),o=this.getInputEndpointUUID(e[1].node,e[1].type,e[1].index);if(!t||!o)return;const n=[t,o];(s=this.instance)==null||s.connect({uuids:n,detachable:!this.isReadOnlyRoute&&!this.readOnlyEnv}),setTimeout(()=>{this.addPinDataConnections(this.workflowsStore.pinnedWorkflowData??{})})},__removeConnection(e,t=!1){var o;if(t){const n=this.workflowsStore.getNodeByName(e[0].node),s=this.workflowsStore.getNodeByName(e[1].node);if(!n||!s)return;const i=document.getElementById(n.id),l=document.getElementById(s.id);if(i&&l){const r=(o=this.instance)==null?void 0:o.getConnections({source:i,target:l});Array.isArray(r)&&r.forEach(a=>{a.__meta?a.__meta.sourceOutputIndex===e[0].index&&a.__meta.targetOutputIndex===e[1].index&&this.__deleteJSPlumbConnection(a):this.__deleteJSPlumbConnection(a)})}}this.workflowsStore.removeConnection({connection:e})},__deleteJSPlumbConnection(e,t=!1){var o,n,s;if(e.removeOverlays(),this.pullConnActiveNodeName=null,(o=this.instance)==null||o.deleteConnection(e),t&&e.__meta){const i=[{index:(n=e.__meta)==null?void 0:n.sourceOutputIndex,node:e.__meta.sourceNodeName,type:U.Main},{index:(s=e.__meta)==null?void 0:s.targetOutputIndex,node:e.__meta.targetNodeName,type:U.Main}],l=new Tt(i);this.historyStore.pushCommandToUndo(l)}},__removeConnectionByConnectionInfo(e,t=!1,o=!1){const n=jo(e);n&&(t?this.__deleteJSPlumbConnection(e.connection,o):o&&this.historyStore.pushCommandToUndo(new Tt(n)),this.workflowsStore.removeConnection({connection:n}))},async duplicateNodes(e){if(!this.editAllowedCheck())return;const t=xe(await this.getNodesToSave(e));await this.importWorkflowData(t,"duplicate",!1)},getIncomingOutgoingConnections(e){var o,n;const t=this.workflowsStore.getNodeByName(e);if(t){const s=document.getElementById(t.id);if(!s)return{incoming:[],outgoing:[]};const i=(o=this.instance)==null?void 0:o.getConnections({source:s}),l=(n=this.instance)==null?void 0:n.getConnections({target:s});return{incoming:Array.isArray(l)?l:Object.values(l),outgoing:Array.isArray(i)?i:Object.values(i)}}return{incoming:[],outgoing:[]}},onNodeMoved(e){const{incoming:t,outgoing:o}=this.getIncomingOutgoingConnections(e.name);[...t,...o].forEach(n=>{Fo(n),Ho(n)})},onNodeRun({name:e,data:t,waiting:o}){var r;const n=this.workflowsStore.pinnedWorkflowData;if(n!=null&&n[e]){const{outgoing:a}=this.getIncomingOutgoingConnections(e);a.forEach(u=>{var c;if(((c=u.__meta)==null?void 0:c.sourceNodeName)===e){const p=this.workflowsStore.getWorkflowResultDataByNodeName(e)!==null;Qi({connection:u,overlayIds:[ia],classNames:p?["has-run"]:[],includeConnector:!0})}});return}const s=e,i=this.workflowsStore.getNodeByName(s),l=i!==null?i.id:"";if(t===null||t.length===0||o){const a=document.getElementById(l);if(!a)return;const u=(r=this.instance)==null?void 0:r.getConnections({source:a});(Array.isArray(u)?u:Object.values(u)).forEach(p=>{bt(p)}),Zi(i,this.instance).forEach(p=>{p.endpoint.type==="N8nPlus"&&p.endpoint.clearSuccessOutput()});return}this.nodeHelpers.setSuccessOutput(t,i)},removeNode(e,t=!1,o=!0){if(!this.editAllowedCheck())return;const n=this.workflowsStore.getNodeByName(e);if(!n)return;t&&o&&this.historyStore.startRecordingUndo();const s=[];if(s.includes(n.type)){let p=!1;for(const g of this.nodes)if(g.name!==n.name&&s.includes(g.type)){p=!0;break}if(!p)return}n.type===ke?this.$telemetry.track("User deleted workflow note",{workflow_id:this.workflowsStore.workflowId,is_welcome_note:n.name===bn}):(this.externalHooks.run("node.deleteNode",{node:n}),this.$telemetry.track("User deleted node",{node_type:n.type,workflow_id:this.workflowsStore.workflowId}));let i=!1;const l=this.nodeTypesStore.getNodeType(n.type,n.typeVersion),r=this.workflowHelpers.getCurrentWorkflow(),a=r.getNode(n.name);let u=[],c=[];if(l&&a&&(u=De(r,a,l),c=Oe(r,a,l)),c.length===1&&u.length===1){const{incoming:p,outgoing:g}=this.getIncomingOutgoingConnections(n.name);if(p.length===1&&g.length===1){const m=p[0],y=g[0];if(m.__meta&&y.__meta){i=!0;const S=m.__meta.sourceNodeName,w=m.__meta.sourceOutputIndex,C=y.__meta.targetNodeName,I=y.__meta.targetOutputIndex;setTimeout(()=>{var P;this.connectTwoNodes(S,w,C,I,U.Main),i&&((P=this.instance)==null||P.setSuspendDrawing(!1,!0),i=!1)},100)}}}Sn(()=>{var p,g,m;(p=this.instance)==null||p.setSuspendDrawing(!0),(((g=this.instance)==null?void 0:g.endpointsByElement[n.id])||[]).flat().forEach(y=>{var S;return(S=this.instance)==null?void 0:S.deleteEndpoint(y)}),this.workflowsStore.removeAllNodeConnection(n),this.workflowsStore.removeNode(n),this.workflowsStore.clearNodeExecutionData(n.name),i||(m=this.instance)==null||m.setSuspendDrawing(!1,!0),this.uiStore.removeNodeFromSelection(n),t&&this.historyStore.pushCommandToUndo(new aa(n))}),t&&o&&setTimeout(()=>{this.historyStore.stopRecordingUndo()},i?100:0)},async onSwitchSelectedNode(e){this.nodeSelectedByName(e,!0,!0)},async onOpenConnectionNodeCreator(e,t){await this.openSelectiveNodeCreator({connectiontype:t,node:e})},async redrawNode(e){const t="x____XXXX____x";await this.renameNode(e,t),await this.renameNode(t,e)},valueChanged(e){e.name==="name"&&e.oldValue&&this.renameNode(e.oldValue,e.value)},async renameNodePrompt(e){try{const t=this.prompt(this.$locale.baseText("nodeView.prompt.newName")+":",this.$locale.baseText("nodeView.prompt.renameNode")+`: ${e}`,{customClass:"rename-prompt",confirmButtonText:this.$locale.baseText("nodeView.prompt.rename"),cancelButtonText:this.$locale.baseText("nodeView.prompt.cancel"),inputErrorMessage:this.$locale.baseText("nodeView.prompt.invalidName"),inputValue:e,inputValidator:s=>s.trim()?!0:this.$locale.baseText("nodeView.prompt.invalidName")});await this.$nextTick();const o=document.querySelector(".rename-prompt .el-input__inner");o&&(o.focus(),o.select());const n=await t;if((n==null?void 0:n.action)!==et)return;await this.renameNode(e,n.value,!0)}catch{}},async renameNode(e,t,o=!1){var l;if(e===t)return;this.suspendRecordingDetachedConnections=!0,o&&this.historyStore.startRecordingUndo();const s=((l=this.activeNode)==null?void 0:l.name)===e;s&&(this.renamingActive=!0),t=this.uniqueNodeName(t);const i=this.workflowHelpers.getCurrentWorkflow(!0);i.renameNode(e,t),o&&this.historyStore.pushCommandToUndo(new wn(e,t)),this.workflowsStore.renameNodeSelectedAndExecution({old:e,new:t}),this.deleteEveryEndpoint(),this.workflowsStore.removeAllConnections({setStateDirty:!1}),this.workflowsStore.removeAllNodes({removePinData:!1,setStateDirty:!0}),await this.$nextTick(),await this.addNodes(Object.values(i.nodes),i.connectionsBySourceNode,!1),this.deselectAllNodes(),this.nodeSelectedByName(t),s&&(this.ndvStore.activeNodeName=t,this.renamingActive=!1),o&&this.historyStore.stopRecordingUndo(),this.suspendRecordingDetachedConnections=!1},deleteEveryEndpoint(){var e,t;this.instance&&((e=this.instance)==null||e.reset(),Object.values((t=this.instance)==null?void 0:t.endpointsByElement).flatMap(o=>o).forEach(o=>o.destroy()),this.instance.deleteEveryConnection({fireEvent:!0}))},matchCredentials(e){e.credentials&&Object.entries(e.credentials).forEach(([t,o])=>{const n=this.credentialsStore.getCredentialsByType(t);if(typeof o=="string"&&(o={id:null,name:o},this.credentialsUpdated=!0),o.id){const i=o.id.toString(),l=n.find(r=>r.id===i);if(l){(l.name!==o.name||typeof o.id=="number")&&(e.credentials[t]={id:l.id,name:l.name},this.credentialsUpdated=!0);return}}e.credentials[t]=o;const s=n.filter(i=>i.name===o.name);s.length===1&&(e.credentials[t].id=s[0].id,this.credentialsUpdated=!0)})},async addNodes(e,t,o=!1){var s,i;if(!(e!=null&&e.length))return;this.isInsertingNodes=!0,await this.loadNodesProperties(e.map(l=>({name:l.type,version:l.typeVersion})));let n;e.forEach(l=>{const r={...l};if(r.id||(r.id=Ue()),n=this.nodeTypesStore.getNodeType(r.type,r.typeVersion),r.hasOwnProperty("disabled")||(r.disabled=!1),r.hasOwnProperty("parameters")||(r.parameters={}),n!==null){let a=null;try{a=Ze(n.properties,r.parameters,!0,!1,l)}catch(u){console.error(this.$locale.baseText("nodeView.thereWasAProblemLoadingTheNodeParametersOfNode")+`: "${r.name}"`),console.error(u)}r.parameters=a??{},[io,ut].includes(r.type)&&r.parameters.path===""&&(r.parameters.path=r.webhookId)}this.matchCredentials(r),this.workflowsStore.addNode(r),o&&this.historyStore.pushCommandToUndo(new ea(r))}),await this.$nextTick(),(s=this.instance)==null||s.setSuspendDrawing(!0),t&&await this.addConnections(t),this.nodeHelpers.refreshNodeIssues(),this.nodeHelpers.updateNodesInputIssues(),this.resetEndpointsErrors(),this.isInsertingNodes=!1,(i=this.instance)==null||i.setSuspendDrawing(!1,!0)},async addConnections(e){const t=[];for(const o in e)for(const n in e[o])e[o][n].forEach((s,i)=>{s&&s.forEach(l=>{t.push([{node:o,type:tt(n)??U.Main,index:i},{node:l.node,type:l.type,index:l.index}])})});await this.processConnectionBatch(t),setTimeout(this.addConectionsTestData,0)},async processConnectionBatch(e){for(let o=0;o<e.length;o+=100)e.slice(o,o+100).forEach(s=>{this.__addConnection(s)})},async addNodesToWorkflow(e){const t={},o=[];if(!e.nodes)throw new Error(this.$locale.baseText("nodeView.noNodesGivenToAdd"));const n=this.workflowHelpers.getNodeTypesMaxCount();let s,i;const l=[];await this.loadNodesProperties(e.nodes.map(w=>({name:w.type,version:w.typeVersion}))),e.nodes.forEach(w=>{if(n[w.type]!==void 0)if(n[w.type].exist>=n[w.type].max){t[w.name]=n[w.type].nodeNames[0];return}else n[w.type].exist+=1;s=w.name;const C=this.locale.localizeNodeName(w.name,w.type);i=this.uniqueNodeName(C,o),o.push(i),t[s]=i,l.push(w)});const r={},a=e.connections,u=l.map(w=>w.name);let c,p,g,m,y;for(c of Object.keys(a)){if(!u.includes(c))continue;const w={};for(p of Object.keys(a[c]))for(w[p]=[],g=0;g<a[c][p].length;g++){const C=[];if(a[c][p][g])for(m=0;m<a[c][p][g].length;m++)y=a[c][p][g][m],u.includes(y.node)&&C.push(y);w[p].push(C)}r[c]=w}const S=this.workflowHelpers.getWorkflow(l,r);for(s in t)s!==t[s]&&S.renameNode(s,t[s]);if(e.pinData){let w=!0;for(const C of Object.keys(e.pinData)){if(!w){this.showError(new Error(this.$locale.baseText("ndv.pinData.error.tooLarge.description")),this.$locale.baseText("ndv.pinData.error.tooLarge.title"));continue}const I=S.nodes[t[C]];try{Ce(I).setData(e.pinData[C],"add-nodes"),w=!0}catch(P){w=!1,console.error(P)}}}return this.historyStore.startRecordingUndo(),await this.addNodes(Object.values(S.nodes),S.connectionsBySourceNode,!0),this.historyStore.stopRecordingUndo(),this.uiStore.stateIsDirty=!0,{nodes:Object.values(S.nodes),connections:S.connectionsBySourceNode}},async getNodesToSave(e){const t={nodes:[],connections:{},pinData:{}};let o;const n=[];for(const p of e){o=this.workflowHelpers.getNodeDataToSave(p),n.push(p.name),t.nodes.push(o);const g=this.workflowsStore.pinDataByNodeName(p.name);if(g&&(t.pinData[p.name]=g),o.credentials&&this.settingsStore.isEnterpriseFeatureEnabled(It.Sharing)){const m=this.workflowsStore.usedCredentials;o.credentials=Object.fromEntries(Object.entries(o.credentials).filter(([y,S])=>{var w;return S.id&&(!m[S.id]||((w=m[S.id])==null?void 0:w.currentUserHasAccess))}))}}let s,i,l,r,a,u,c;return t.nodes.forEach(p=>{if(i=this.workflowsStore.outgoingConnectionsByNodeName(p.name),Object.keys(i).length!==0){c={};for(l of Object.keys(i))for(a=0;a<i[l].length;a++){for(s=[],r=0;r<i[l][a].length;r++)u=i[l][a][r],n.indexOf(u.node)!==-1&&s.push(u);s.length&&(c.hasOwnProperty(l)||(c[l]=[]),c[l][a]=s)}Object.keys(c).length&&(t.connections[p.name]=c)}}),t},resetWorkspace(){if(this.workflowsStore.resetWorkflow(),this.onToggleNodeCreator({createNodeActive:!1}),this.nodeCreatorStore.setShowScrim(!1),this.canvasStore.resetZoom(),this.unbindEndpointEventListeners(),this.deleteEveryEndpoint(),this.executionWaitingForWebhook)try{this.workflowsStore.removeTestWebhook(this.workflowsStore.workflowId)}catch{}this.workflowsStore.resetState(),this.uiStore.removeActiveAction("workflowRunning"),this.uiStore.resetSelectedNodes(),this.uiStore.nodeViewOffsetPosition=[0,0],this.credentialsUpdated=!1},async loadActiveWorkflows(){await this.workflowsStore.fetchActiveWorkflows()},async loadNodeTypes(){await this.nodeTypesStore.getNodeTypes()},async loadCredentialTypes(){await this.credentialsStore.fetchCredentialTypes(!0)},async loadCredentials(){var o,n,s,i,l,r;const e=this.workflowsStore.getWorkflowById(this.currentWorkflow);let t;e?t=((o=e.homeProject)==null?void 0:o.type)===ta.Personal?(n=this.projectsStore.personalProject)==null?void 0:n.id:((s=e==null?void 0:e.homeProject)==null?void 0:s.id)??this.projectsStore.currentProjectId:t=(typeof((i=this.$route.query)==null?void 0:i.projectId)=="string"?(l=this.$route.query)==null?void 0:l.projectId:void 0)??((r=this.projectsStore.personalProject)==null?void 0:r.id),await this.credentialsStore.fetchAllCredentials(t,!1)},async loadVariables(){await this.environmentsStore.fetchAllVariables()},async loadSecrets(){await this.externalSecretsStore.fetchAllSecrets()},async loadNodesProperties(e){const t=this.nodeTypesStore.allNodeTypes,o=[];t.forEach(n=>{const s=Array.isArray(n.version)?n.version:[n.version];e.find(i=>i.name===n.name&&s.includes(i.version))&&!n.hasOwnProperty("properties")&&o.push({name:n.name,version:Array.isArray(n.version)?n.version.slice(-1)[0]:n.version})}),o.length>0&&(this.canvasStore.startLoading(),await this.nodeTypesStore.getNodesInformation(o),this.canvasStore.stopLoading())},async onPostMessageReceived(e){var t,o;if(!(!e||typeof e.data!="string"||!((o=(t=e.data)==null?void 0:t.includes)!=null&&o.call(t,'"command"'))))try{const n=JSON.parse(e.data);if(n&&n.command==="openWorkflow")try{await this.importWorkflowExact(n),this.canOpenNDV=n.canOpenNDV??!0,this.hideNodeIssues=n.hideNodeIssues??!1,this.isExecutionPreview=!1}catch(s){window.top&&window.top.postMessage(JSON.stringify({command:"error",message:this.$locale.baseText("openWorkflow.workflowImportError")}),"*"),this.showMessage({title:this.$locale.baseText("openWorkflow.workflowImportError"),message:s.message,type:"error"})}else if(n&&n.command==="openExecution")try{this.isProductionExecutionPreview=n.executionMode!=="manual",await this.openExecution(n.executionId),this.canOpenNDV=n.canOpenNDV??!0,this.hideNodeIssues=n.hideNodeIssues??!1,this.isExecutionPreview=!0}catch(s){window.top&&window.top.postMessage(JSON.stringify({command:"error",message:this.$locale.baseText("nodeView.showError.openExecution.title")}),"*"),this.showMessage({title:this.$locale.baseText("nodeView.showError.openExecution.title"),message:s.message,type:"error"})}else(n==null?void 0:n.command)==="setActiveExecution"&&(this.executionsStore.activeExecution=await this.executionsStore.fetchExecution(n.executionId))}catch{}},async onImportWorkflowDataEvent(e){await this.importWorkflowData(e.data,"file")},async onImportWorkflowUrlEvent(e){const t=await this.getWorkflowDataFromUrl(e.url);t!==void 0&&await this.importWorkflowData(t,"url")},addPinDataConnections(e){Object.keys(e).forEach(t=>{var a;const o=this.workflowsStore.getNodeByName(t);if(!o)return;const n=this.workflowsStore.getWorkflowResultDataByNodeName(t)!==null,s=["pinned"];n&&s.push("has-run");const i=document.getElementById(o.id);if(!i)return;const l=(a=this.instance)==null?void 0:a.getConnections({source:i});(Array.isArray(l)?l:Object.values(l)).forEach(u=>{oa(u,{total:e[t].length,iterations:0,classNames:s})})})},removePinDataConnections(e){Object.keys(e).forEach(t=>{var l;const o=this.workflowsStore.getNodeByName(t);if(!o)return;const n=document.getElementById(o.id);if(!n)return;const s=(l=this.instance)==null?void 0:l.getConnections({source:n}),i=Array.isArray(s)?s:Object.values(s);this.instance.setSuspendDrawing(!0),i.forEach(bt),this.instance.setSuspendDrawing(!1,!0)})},onToggleNodeCreator({source:e,createNodeActive:t,nodeCreatorView:o}){if(t===this.createNodeActive)return;o||(o=this.containsTrigger?Zo:Ut),this.nodeCreatorStore.setSelectedView(o),this.createNodeActive=t;let n;switch(this.nodeCreatorStore.selectedView){case Go:n="ai";break;case Zo:n="regular";break;default:n="regular"}t&&e&&this.nodeCreatorStore.setOpenSource(e),this.externalHooks.run("nodeView.createNodeActiveChanged",{source:e,mode:n,createNodeActive:t}),this.$telemetry.trackNodesPanel("nodeView.createNodeActiveChanged",{source:e,mode:n,createNodeActive:t,workflow_id:this.workflowsStore.workflowId})},async onAddNodes({nodes:e,connections:t},o=!1,n){let s=n;for(const{type:u,isAutoAdd:c,name:p,openDetail:g,position:m}of e){await this.addNode(u,{position:m??s,dragAndDrop:o,name:p},g??!1,!0,c);const y=this.nodes[this.nodes.length-1];s=[y.position[0]+at*2+dt,y.position[1]]}const i=this.nodes.length-e.length;for(const{from:u,to:c}of t){const p=this.nodes[i+u.nodeIndex],g=this.nodes[i+c.nodeIndex];this.connectTwoNodes(p.name,u.outputIndex??0,g.name,c.inputIndex??0,U.Main)}const l=this.nodes[this.nodes.length-1],a=this.workflowHelpers.getCurrentWorkflow().getParentNodesByDepth(l.name,1);a.length>1&&a.slice(1).forEach((u,c)=>{const p=this.workflowsStore.getNodeByName(u.name);p&&this.onMoveNode({nodeName:p.name,position:[p.position[0],p.position[1]+100*(c+1)]})}),this.addPinDataConnections(this.workflowsStore.pinnedWorkflowData||{})},async saveCurrentWorkflowExternal(e){await this.workflowHelpers.saveCurrentWorkflow(),e==null||e()},setSuspendRecordingDetachedConnections(e){this.suspendRecordingDetachedConnections=e},onMoveNode({nodeName:e,position:t}){this.workflowsStore.updateNodeProperties({name:e,properties:{position:t}});const o=this.workflowsStore.getNodeByName(e);setTimeout(()=>{var n;o&&((n=this.instance)==null||n.repaintEverything(),this.onNodeMoved(o))},0)},onRevertAddNode({node:e}){this.removeNode(e.name,!1)},async onRevertRemoveNode({node:e}){this.workflowsStore.workflow.nodes.find(o=>o.id===e.id)||(e.id=Ue(),await this.addNodes([e]))},onRevertAddConnection({connection:e}){this.suspendRecordingDetachedConnections=!0,this.__removeConnection(e,!0),this.suspendRecordingDetachedConnections=!1},async onRevertRemoveConnection({connection:e}){this.suspendRecordingDetachedConnections=!0,this.__addConnection(e),this.suspendRecordingDetachedConnections=!1},async onRevertNameChange({currentName:e,newName:t}){await this.renameNode(t,e)},onRevertEnableToggle({nodeName:e}){const t=this.workflowsStore.getNodeByName(e);t&&this.nodeHelpers.disableNodes([t])},onPageShow(e){e.persisted&&this.canvasStore.stopLoading()},readOnlyEnvRouteCheck(){this.readOnlyEnv&&(this.$route.name===te.NEW_WORKFLOW||this.$route.name===te.TEMPLATE_IMPORT)&&this.$nextTick(async()=>{this.resetWorkspace(),this.uiStore.stateIsDirty=!1,await this.$router.replace({name:te.HOMEPAGE})})},async checkAndInitDebugMode(){this.$route.name===te.EXECUTION_DEBUG&&(this.titleSet(this.workflowName,"DEBUG"),this.workflowsStore.isInDebugMode||(await this.applyExecutionData(this.$route.params.executionId),this.workflowsStore.isInDebugMode=!0))},onContextMenuAction(e,t){switch(e){case"copy":this.copyNodes(t);break;case"delete":this.deleteNodes(t);break;case"duplicate":this.duplicateNodes(t);break;case"execute":this.onRunNode(t[0].name,"NodeView.onContextMenuAction");break;case"open":this.ndvStore.activeNodeName=t[0].name;break;case"rename":this.renameNodePrompt(t[0].name);break;case"toggle_activation":this.toggleActivationNodes(t);break;case"toggle_pin":this.togglePinNodes(t,"context-menu");break;case"add_node":this.onToggleNodeCreator({source:ye.CONTEXT_MENU,createNodeActive:!this.isReadOnlyRoute&&!this.readOnlyEnv});break;case"add_sticky":this.onAddNodes({nodes:[{type:ke}],connections:[]});break;case"select_all":this.selectAllNodes();break;case"deselect_all":this.deselectAllNodes();break}},async onSourceControlPull(){let e=null;this.$route.params.name&&(e=this.$route.params.name.toString());try{if(await Promise.all([this.loadVariables(),this.tagsStore.fetchAll(),this.loadCredentials()]),e!==null&&!this.uiStore.stateIsDirty){const t=await this.workflowsStore.fetchWorkflow(e);t&&(this.titleSet(t.name,"IDLE"),await this.openWorkflow(t))}}catch(t){console.error(t)}}}}),nf="_content_yewsk_1",sf="_shake_yewsk_9",af="_setupCredentialsButtonWrapper_yewsk_27",rf={content:nf,shake:sf,setupCredentialsButtonWrapper:af},lf=["textContent"],df={key:0,class:"workflow-execute-wrapper"};function uf(e,t,o,n,s,i){const l=D("CanvasAddButton"),r=D("Node"),a=D("Sticky"),u=D("NodeDetailsView"),c=D("SetupWorkflowCredentialsButton"),p=D("NodeCreation"),g=D("CanvasControls"),m=D("ContextMenu"),y=D("NextStepPopup"),S=D("n8n-button"),w=D("KeyboardShortcutTooltip"),C=D("n8n-icon-button"),I=ht("touch");return d(),k("div",{ref:"nodeViewRootRef",class:T(e.$style.content)},[h("div",{id:"node-view-root",class:"node-view-root do-not-select","data-test-id":"node-view-root",onDragover:t[13]||(t[13]=(...P)=>e.onDragOver&&e.onDragOver(...P)),onDrop:t[14]||(t[14]=(...P)=>e.onDrop&&e.onDrop(...P))},[ee((d(),k("div",{class:T(["node-view-wrapper",e.workflowClasses]),"data-test-id":"node-view-wrapper",onTouchstart:t[3]||(t[3]=(...P)=>e.mouseDown&&e.mouseDown(...P)),onTouchend:t[4]||(t[4]=(...P)=>e.mouseUp&&e.mouseUp(...P)),onTouchmove:t[5]||(t[5]=(...P)=>e.canvasPanning.onMouseMove&&e.canvasPanning.onMouseMove(...P)),onMousedown:t[6]||(t[6]=(...P)=>e.mouseDown&&e.mouseDown(...P)),onMouseup:t[7]||(t[7]=(...P)=>e.mouseUp&&e.mouseUp(...P)),onContextmenu:t[8]||(t[8]=(...P)=>e.contextMenu.open&&e.contextMenu.open(...P)),onWheel:t[9]||(t[9]=(...P)=>e.canvasStore.wheelScroll&&e.canvasStore.wheelScroll(...P))},[h("div",{id:"node-view-background",class:"node-view-background",style:ie(e.backgroundStyle),"data-test-id":"node-view-background"},null,4),h("div",{id:"node-view",ref:"nodeViewRef",class:"node-view",style:ie(e.workflowStyle),"data-test-id":"node-view"},[ee(v(l,{ref:"canvasAddButton",style:ie(e.canvasAddButtonStyle),"show-tooltip":!e.containsTrigger&&e.showTriggerMissingTooltip,position:e.canvasStore.canvasAddButtonPosition,"data-test-id":"canvas-add-button",onClick:e.onCanvasAddButtonCLick,"onHook:mounted":e.canvasStore.setRecenteredCanvasAddButtonPosition},null,8,["style","show-tooltip","position","onClick","onHook:mounted"]),[[de,e.showCanvasAddButton]]),(d(!0),k(se,null,he(e.nodesToRender,P=>(d(),O(r,{key:`${P.id}_node`,name:P.name,"is-read-only":e.isReadOnlyRoute||e.readOnlyEnv,instance:e.instance,"is-active":!!e.activeNode&&e.activeNode.name===P.name,"hide-actions":e.pullConnActive,"is-production-execution-preview":e.isProductionExecutionPreview,workflow:e.currentWorkflowObject,"disable-pointer-events":!e.canOpenNDV,"hide-node-issues":e.hideNodeIssues,onDeselectAllNodes:e.deselectAllNodes,onDeselectNode:e.nodeDeselectedByName,onNodeSelected:e.nodeSelectedByName,onRunWorkflow:e.onRunNode,onMoved:e.onNodeMoved,onRun:e.onNodeRun,onRemoveNode:t[0]||(t[0]=V=>e.removeNode(V,!0)),onToggleDisableNode:t[1]||(t[1]=V=>e.toggleActivationNodes([V]))},{"custom-tooltip":b(()=>[h("span",{textContent:N(e.$locale.baseText("nodeView.canvasAddButton.addATriggerNodeBeforeExecuting"))},null,8,lf)]),_:2},1032,["name","is-read-only","instance","is-active","hide-actions","is-production-execution-preview","workflow","disable-pointer-events","hide-node-issues","onDeselectAllNodes","onDeselectNode","onNodeSelected","onRunWorkflow","onMoved","onRun"]))),128)),(d(!0),k(se,null,he(e.stickiesToRender,P=>(d(),O(a,{key:`${P.id}_sticky`,name:P.name,workflow:e.currentWorkflowObject,"is-read-only":e.isReadOnlyRoute||e.readOnlyEnv,instance:e.instance,"is-active":!!e.activeNode&&e.activeNode.name===P.name,"node-view-scale":e.nodeViewScale,"grid-size":e.GRID_SIZE,"hide-actions":e.pullConnActive,onDeselectAllNodes:e.deselectAllNodes,onDeselectNode:e.nodeDeselectedByName,onNodeSelected:e.nodeSelectedByName,onRemoveNode:t[2]||(t[2]=V=>e.removeNode(V,!0))},null,8,["name","workflow","is-read-only","instance","is-active","node-view-scale","grid-size","hide-actions","onDeselectAllNodes","onDeselectNode","onNodeSelected"]))),128))],4)],34)),[[I,e.touchTap,"tap"]]),v(u,{"read-only":e.isReadOnlyRoute||e.readOnlyEnv,renaming:e.renamingActive,"is-production-execution-preview":e.isProductionExecutionPreview,onRedrawNode:e.redrawNode,onSwitchSelectedNode:e.onSwitchSelectedNode,onOpenConnectionNodeCreator:e.onOpenConnectionNodeCreator,onValueChanged:e.valueChanged,onStopExecution:e.stopExecution,onSaveKeyboardShortcut:e.onSaveKeyboardShortcut},null,8,["read-only","renaming","is-production-execution-preview","onRedrawNode","onSwitchSelectedNode","onOpenConnectionNodeCreator","onValueChanged","onStopExecution","onSaveKeyboardShortcut"]),(d(),O(Ee,null,{default:b(()=>[h("div",{class:T(e.$style.setupCredentialsButtonWrapper)},[v(c)],2)]),_:1})),(d(),O(Ee,null,{default:b(()=>[!e.isReadOnlyRoute&&!e.readOnlyEnv?(d(),O(p,{key:0,"create-node-active":e.createNodeActive,"node-view-scale":e.nodeViewScale,onToggleNodeCreator:e.onToggleNodeCreator,onAddNodes:e.onAddNodes},null,8,["create-node-active","node-view-scale","onToggleNodeCreator","onAddNodes"])):E("",!0)]),_:1})),(d(),O(Ee,null,{default:b(()=>[v(g)]),_:1})),(d(),O(Ee,null,{default:b(()=>[v(m,{onAction:e.onContextMenuAction},null,8,["onAction"])]),_:1})),(d(),O(Ee,null,{default:b(()=>[ee(v(y,{onOptionSelected:e.onNextStepSelected},null,8,["onOptionSelected"]),[[de,e.isNextStepPopupVisible]])]),_:1})),!e.isReadOnlyRoute&&!e.readOnlyEnv?(d(),k("div",df,[e.isManualChatOnly?E("",!0):(d(),k("span",{key:0,onMouseenter:t[10]||(t[10]=P=>e.showTriggerMissingToltip(!0)),onMouseleave:t[11]||(t[11]=P=>e.showTriggerMissingToltip(!1)),onClick:t[12]||(t[12]=(...P)=>e.onRunContainerClick&&e.onRunContainerClick(...P))},[v(w,{label:e.runButtonText,shortcut:{metaKey:!0,keys:["↵"]}},{default:b(()=>[v(S,{loading:e.workflowRunning,label:e.runButtonText,size:"large",icon:"flask",type:"primary",disabled:e.isExecutionDisabled,"data-test-id":"execute-workflow-button",onClick:fe(e.onRunWorkflow,["stop"])},null,8,["loading","label","disabled","onClick"])]),_:1},8,["label"])],32)),e.containsChatNodes?(d(),O(S,{key:1,label:"Chat",size:"large",icon:"comment",type:"primary","data-test-id":"workflow-chat-button",onClick:fe(e.onOpenChat,["stop"])},null,8,["onClick"])):E("",!0),e.workflowRunning===!0&&!e.executionWaitingForWebhook?(d(),O(C,{key:2,icon:"stop",size:"large",class:"stop-execution",type:"secondary",title:e.stopExecutionInProgress?e.$locale.baseText("nodeView.stoppingCurrentExecution"):e.$locale.baseText("nodeView.stopCurrentExecution"),loading:e.stopExecutionInProgress,"data-test-id":"stop-execution-button",onClick:fe(e.stopExecution,["stop"])},null,8,["title","loading","onClick"])):E("",!0),e.workflowRunning===!0&&e.executionWaitingForWebhook===!0?(d(),O(C,{key:3,class:"stop-execution",icon:"stop",size:"large",title:e.$locale.baseText("nodeView.stopWaitingForWebhookCall"),type:"secondary","data-test-id":"stop-execution-waiting-for-webhook-button",onClick:fe(e.stopWaitingForWebhook,["stop"])},null,8,["title","onClick"])):E("",!0),!e.isReadOnlyRoute&&!e.readOnlyEnv&&e.workflowExecution&&!e.workflowRunning&&!e.allTriggersDisabled?(d(),O(C,{key:4,title:e.$locale.baseText("nodeView.deletesTheCurrentExecutionData"),icon:"trash",size:"large","data-test-id":"clear-execution-data-button",onClick:fe(e.clearExecutionData,["stop"])},null,8,["title","onClick"])):E("",!0)])):E("",!0)],32)],2)}const cf={$style:rf},hf=Z(of,[["render",uf],["__cssModules",cf],["__scopeId","data-v-ee7814d1"]]),_f=Object.freeze(Object.defineProperty({__proto__:null,default:hf},Symbol.toStringTag,{value:"Module"}));export{Xr as D,_f as N};
//# sourceMappingURL=NodeView-_cMwqhWw.js.map
