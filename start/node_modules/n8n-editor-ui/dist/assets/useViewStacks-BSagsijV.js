import{a4 as Y,$ as Se,cb as B,dg as V,dh as Z,di as z,dj as Q,dk as J,dl as ee,dm as te,dn as oe,cu as m,dp as Pe,dq as he,dr as re,ds as se,dt as ae,bD as K,am as ie,cv as F,an as G,du as ke,dv as ne,ah as ce,dw as le,bv as de,dx as pe,cm as xe,dy as we,dz as Ye,dA as ue,dB as Ge,dC as ge,dD as Le,dE as ye,dF as He,dG as Me,dH as Ue,dI as Be,dJ as Ve,dK as Te,aF as Ke,dL as Fe,dM as We,dN as $e,dO as Xe,dP as je,dQ as qe,dR as Ze,dS as Ee,dT as ze,dU as Qe,dV as _e,dW as Je,cw as R,w as h,dX as et,cx as tt,m as ot,dY as fe,dZ as rt}from"./index-DEwaaDne.js";import{d as ve}from"./pinia-BAhPp3pQ.js";import{C as me}from"./lodash-es-BxV-E8rt.js";import{u as st,f as Ne,s as Ae,t as U,a as at,i as it,g as be,b as nt}from"./nodeCreator.store-DR3dfsvW.js";import{N as b}from"./n8n-B6cfQsVX.js";import{r as L,e as v,n as ct}from"./vendor-Dv5OeN6t.js";import{v as Ie}from"./uuid-SoommWqA.js";function Oe(a,s){return a.filter(o=>{var l,y,g;return!o.hidden&&((g=(y=(l=o.codex)==null?void 0:l.subcategories)==null?void 0:y[R])==null?void 0:g.includes(s))}).map(o=>({key:o.name,type:"node",properties:{group:[],name:o.name,displayName:o.displayName,title:o.displayName,description:o.description,icon:o.icon,iconData:o.name.toLowerCase().includes("openai")?{type:"file",icon:"openai",fileBuffer:"/static/open-ai.svg"}:void 0}})).sort((o,l)=>o.properties.displayName.localeCompare(l.properties.displayName))}function mt(a){const s=h(),o=Y(),l=Se(),y=Oe(o.allLatestNodeTypes,et),g=Oe(o.allLatestNodeTypes,tt);return{value:B,title:s.baseText("nodeCreator.aiPanel.aiNodes"),subtitle:s.baseText("nodeCreator.aiPanel.selectAiNode"),items:[{key:"ai_templates_root",type:"link",properties:{title:s.baseText("nodeCreator.aiPanel.linkItem.title"),icon:"box-open",description:s.baseText("nodeCreator.aiPanel.linkItem.description"),name:"ai_templates_root",url:l.getWebsiteCategoryURL(void 0,"AdvancedAI"),tag:{type:"info",text:s.baseText("nodeCreator.triggerHelperPanel.manualTriggerTag")}}},...g,...y,{key:V,type:"view",properties:{title:s.baseText("nodeCreator.aiPanel.aiOtherNodes"),icon:"robot",description:s.baseText("nodeCreator.aiPanel.aiOtherNodesDescription")}}]}}function lt(a){const s=h();function o(l){return{connectionType:l,iconProps:{color:`var(--node-type-${l}-color)`},panelClass:`nodes-list-panel-${l}`}}return{value:V,title:s.baseText("nodeCreator.aiPanel.aiOtherNodes"),subtitle:s.baseText("nodeCreator.aiPanel.selectAiNode"),items:[{key:Z,type:"subcategory",properties:{title:Z,icon:"file-import",...o(b.AiDocument)}},{key:z,type:"subcategory",properties:{title:z,icon:"language",...o(b.AiLanguageModel)}},{key:Q,type:"subcategory",properties:{title:Q,icon:"brain",...o(b.AiMemory)}},{key:J,type:"subcategory",properties:{title:J,icon:"list",...o(b.AiOutputParser)}},{key:ee,type:"subcategory",properties:{title:ee,icon:"search",...o(b.AiRetriever)}},{key:te,type:"subcategory",properties:{title:te,icon:"grip-lines-vertical",...o(b.AiTextSplitter)}},{type:"subcategory",key:oe,category:m,properties:{title:oe,icon:"tools",...o(b.AiTool),sections:[{key:"popular",title:s.baseText("nodeCreator.sectionNames.popular"),items:[Pe,he]}]}},{key:re,type:"subcategory",properties:{title:re,icon:"vector-square",...o(b.AiEmbedding)}},{key:se,type:"subcategory",properties:{title:se,icon:"project-diagram",...o(b.AiVectorStore)}},{key:ae,type:"subcategory",properties:{title:ae,icon:"code"}}]}}function Nt(){const a=h();return{value:K,title:a.baseText("nodeCreator.triggerHelperPanel.selectATrigger"),subtitle:a.baseText("nodeCreator.triggerHelperPanel.selectATriggerDescription"),items:[{key:ie,type:"node",category:[m],properties:{group:[],name:ie,displayName:a.baseText("nodeCreator.triggerHelperPanel.manualTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.manualTriggerDescription"),icon:"fa:mouse-pointer"}},{key:F,type:"subcategory",properties:{forceIncludeNodes:[G,ke],title:"App Trigger Nodes",icon:"satellite-dish"}},{key:ne,type:"node",category:[m],properties:{group:[],name:ne,displayName:a.baseText("nodeCreator.triggerHelperPanel.scheduleTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.scheduleTriggerDescription"),icon:"fa:clock"}},{key:G,type:"node",category:[m],properties:{group:[],name:G,displayName:a.baseText("nodeCreator.triggerHelperPanel.webhookTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.webhookTriggerDescription"),iconData:{type:"file",icon:"webhook",fileBuffer:"/static/webhook-icon.svg"}}},{key:ce,type:"node",category:[m],properties:{group:[],name:ce,displayName:a.baseText("nodeCreator.triggerHelperPanel.formTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.formTriggerDescription"),iconData:{type:"file",icon:"form",fileBuffer:"/static/form-grey.svg"}}},{key:le,type:"node",category:[m],properties:{group:[],name:le,displayName:a.baseText("nodeCreator.triggerHelperPanel.workflowTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.workflowTriggerDescription"),icon:"fa:sign-out-alt"}},{key:de,type:"node",category:[m],properties:{group:[],name:de,displayName:a.baseText("nodeCreator.triggerHelperPanel.manualChatTriggerDisplayName"),description:a.baseText("nodeCreator.triggerHelperPanel.manualChatTriggerDescription"),icon:"fa:comments"}},{type:"subcategory",key:pe,category:m,properties:{title:pe,icon:"folder-open"}}]}}function At(a){const s=h(),o={value:xe,title:s.baseText("nodeCreator.triggerHelperPanel.whatHappensNext"),items:[{key:F,type:"subcategory",properties:{title:"App Regular Nodes",icon:"globe",forceIncludeNodes:[we,Ye]}},{type:"subcategory",key:ue,category:m,properties:{title:ue,icon:"pen",sections:[{key:"popular",title:s.baseText("nodeCreator.sectionNames.popular"),items:[Ge,ge,Le]},{key:"addOrRemove",title:s.baseText("nodeCreator.sectionNames.transform.addOrRemove"),items:[ye,He,Me,Ue]},{key:"combine",title:s.baseText("nodeCreator.sectionNames.transform.combine"),items:[Be,Ve,Te]},{key:"convert",title:s.baseText("nodeCreator.sectionNames.transform.convert"),items:[Ke,Fe,We,$e,Xe,je,qe,Ze]}]}},{type:"subcategory",key:Ee,category:m,properties:{title:Ee,icon:"code-branch",sections:[{key:"popular",title:s.baseText("nodeCreator.sectionNames.popular"),items:[ye,ze,Qe,Te]}]}},{type:"subcategory",key:_e,category:m,properties:{title:_e,icon:"toolbox",sections:[{key:"popular",title:s.baseText("nodeCreator.sectionNames.popular"),items:[Je,G,ge]}]}}]};return(a??[]).some(y=>{var g,O;return(O=(g=y.codex)==null?void 0:g.categories)==null?void 0:O.includes(R)})&&o.items.push({key:B,type:"view",properties:{title:s.baseText("nodeCreator.aiPanel.langchainAiNodes"),icon:"robot",description:s.baseText("nodeCreator.aiPanel.nodesForAi"),tag:{type:"success",text:s.baseText("nodeCreator.aiPanel.newTag")},borderless:!0}}),o.items.push({key:K,type:"view",properties:{title:s.baseText("nodeCreator.triggerHelperPanel.addAnotherTrigger"),icon:"bolt",description:s.baseText("nodeCreator.triggerHelperPanel.addAnotherTriggerDescription")}}),o}const dt="data-keyboard-nav-id",Ce=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape","Tab"],pt=ve("nodeCreatorKeyboardNavigation",()=>{const a=L([]),s=L(null),o=L({});function l(r){return r==null?void 0:r.getAttribute("data-keyboard-nav-type")}function y(r){return(r==null?void 0:r.getAttribute(dt))||void 0}async function g(){return await new Promise(r=>{x(),setTimeout(()=>{a.value=Array.from(document.querySelectorAll("[data-keyboard-nav-type]")).map(p=>new WeakRef(p)),r()},0)})}function O(r,p){Object.values(o.value).filter(A=>A.keyboardKeys.includes(r)).forEach(A=>{if(!s.value)return;(A.condition===void 0||A.condition(l(p)||"",s.value))&&s.value&&A.handler(s.value,r)})}async function C(r){var i,c,n;const p=r.key;if(!Ce.includes(p))return;r.preventDefault(),r.stopPropagation(),await g();const f=a.value.findIndex(t=>y(t==null?void 0:t.deref())===s.value),I=(i=a.value[f])==null?void 0:i.deref(),A=p==="ArrowDown",e=p==="ArrowUp";if(I){if(A){const t=f<a.value.length-1?f+1:0;D((c=a.value[t])==null?void 0:c.deref())}if(e){const t=f>0?f-1:a.value.length-1;D((n=a.value[t])==null?void 0:n.deref())}O(p,I)}}function N(r){s.value=r}function D(r){const p=y(r);p&&(N(p),r!=null&&r.scrollIntoView&&(r==null||r.scrollIntoView({block:"center"})))}async function H(r){var p;await g(),D((p=a.value[r])==null?void 0:p.deref())}function S(){document.addEventListener("keydown",C,{capture:!0})}function P(){x(),document.removeEventListener("keydown",C,{capture:!0})}function k(r,p){p.keyboardKeys.forEach(f=>{if(Ce.includes(f))o.value={...o.value,[r]:p};else throw new Error(`Key ${f} is not supported`)})}function x(){a.value=[]}function M(){return a.value.findIndex(r=>y(r==null?void 0:r.deref())===s.value)}return{activeItemId:s,attachKeydownEvent:S,refreshSelectableItems:g,detachKeydownEvent:P,registerKeyHook:k,getActiveItemIndex:M,setActiveItemId:N,setActiveItemIndex:H}}),bt=ve("nodeCreatorViewStacks",()=>{const a=st(),{getActiveItemIndex:s}=pt(),o=h(),l=L([]),y=v(()=>{const e=N();if(!(e!=null&&e.baselineItems))return e.items?r(e.items):[];if(e.search&&C.value){const i=C.value.length>0?C.value:Ne(e.baselineItems??[]),c=ot().aiNodes.length>0,n=S(e)||c?i:k(i),t=r(Ae(e.search||"",n)),E=P(t,!1)??t;return e.activeIndex=E.some(d=>d.type==="section")?1:0,E}return r(P(e.baselineItems,!0))}),g=v(()=>{const e=N();if(!e)return{};const i=Ne(e.baselineItems??[]);return{...e,items:y.value,hasSearch:i.length>8||(e==null?void 0:e.hasSearch)}}),O=v(()=>g.value.mode||K),C=v(()=>{const e=N();return e!=null&&e.searchItems?e.searchItems.map(i=>U(i,e.subcategory)):[]});function N(){return l.value[l.value.length-1]}const D=v(()=>{const e=N();if(!(e!=null&&e.search))return[];const i=a.mergedNodes.map(d=>U(d)),c=S(e)?i:k(i);let n=r(Ae(e.search||"",c));return S(e)&&(n=P(n)),n.filter(d=>!y.value.find(_=>_.type==="section"?_.children.some(T=>T.key===d.key):_.key===d.key)).filter(d=>d.type==="section"?d.children.some(u=>y.value.some(T=>T.key===u.key)):!0)}),H=v(()=>at(a.mergedNodes));function S(e){return e.rootView===B}function P(e,i=!0){const c=e.filter(n=>it(n));if(c.length>0){const n=new Map;c.forEach(u=>{var w,W,$,X,j,q;const T=($=(W=(w=u.properties.codex)==null?void 0:w.subcategories)==null?void 0:W[R])==null?void 0:$[0];if(T){const Re=((X=n.get(T))==null?void 0:X.items)??[],De=!((q=(j=u.properties.codex)==null?void 0:j.subcategories)!=null&&q[R].includes(fe));n.set(T,{key:T,title:De?`${T} (${o.baseText("nodeCreator.subnodes")})`:T,items:[...Re,u.key]})}});const t=me(e,c),E=t.filter(u=>u.type==="node"&&Y().isTriggerNode(u.properties.name)),d=me(t,E);if(t.length>0){let u="";d.length&&E.length?u=o.baseText("nodeCreator.actionsCategory.regularAndTriggers"):u=d.length?o.baseText("nodeCreator.actionsCategory.regularNodes"):o.baseText("nodeCreator.actionsCategory.triggerNodes");const T=t.map(w=>w.key);n.set(u,{key:u,title:u,items:[...T]})}const _=Array.from(n.values());return be(e,_,i)}return e}function k(e){return e.filter(c=>{var n,t,E,d,_;return c.type==="node"&&((t=(n=c.properties.codex)==null?void 0:n.categories)==null?void 0:t.includes(R))===!0?(_=(d=(E=c.properties.codex)==null?void 0:E.subcategories)==null?void 0:d[R])==null?void 0:_.includes(fe):!0})}async function x(e,i,c){var E;let n,t;i===!0?(n=Y().visibleNodeTypesByInputConnectionTypeNames,t={properties:{title:o.baseText("nodeCreator.aiPanel.aiNodes"),icon:"robot"}}):(n=Y().visibleNodeTypesByOutputConnectionTypeNames,t=lt().items.find(d=>d.properties.connectionType===e)),await ct(),p({title:t==null?void 0:t.properties.title,rootView:V,mode:"nodes",items:a.allNodeCreatorNodes,nodeIcon:{iconType:"icon",icon:t==null?void 0:t.properties.icon,color:(E=t==null?void 0:t.properties.iconProps)==null?void 0:E.color},panelClass:t==null?void 0:t.properties.panelClass,baseFilter:d=>{var u;if(d.key===rt)return!1;const _=n[e].includes(d.key);return _&&((u=c==null?void 0:c.nodes)!=null&&u.length)?c.nodes.includes(d.key):_},itemsMapper(d){return{...d,subcategory:e}},preventBack:!0})}function M(){const e=N();if(!e||!g.value.uuid)return;let i=(e==null?void 0:e.items)??[];if(!(e!=null&&e.items)){const c=(e==null?void 0:e.subcategory)??F,n=H.value[c],t=e.sections;t?i=be(n,t):i=n}if((e.forceIncludeNodes??[]).length>0){const c=a.mergedNodes.filter(n=>{var t;return(t=e.forceIncludeNodes)==null?void 0:t.includes(n.name)}).map(n=>U(n,e.subcategory));i.push(...c)}e.baseFilter&&(i=i.filter(e.baseFilter)),e.itemsMapper&&(i=i.map(e.itemsMapper)),e.items||(i=nt(i)),I({baselineItems:i})}function r(e){return e.map(i=>({...i,uuid:`${i.key}-${Ie()}`}))}function p(e){g.value.uuid&&I({activeIndex:s()});const i=Ie();l.value.push({...e,uuid:i,transitionDirection:"in",activeIndex:0}),M()}function f(){g.value.uuid&&(l.value.pop(),I({transitionDirection:"out"}))}function I(e){const i=N(),c=l.value.findIndex(n=>n.uuid===i.uuid);i&&Object.keys(e).forEach(n=>{const t=n;l.value[c]={...l.value[c],[n]:e[t]}})}function A(){l.value=[]}return{viewStacks:l,activeViewStack:g,activeViewStackMode:O,globalSearchItemsDiff:D,gotoCompatibleConnectionView:x,resetViewStacks:A,updateCurrentViewStack:I,pushViewStack:p,popViewStack:f}});export{mt as A,At as R,Nt as T,pt as a,lt as b,bt as u};
//# sourceMappingURL=useViewStacks-BSagsijV.js.map
